{"meta":{"version":1,"warehouse":"3.0.2"},"models":{"Asset":[{"_id":"source/images/7.gif","path":"images/7.gif","modified":1,"renderable":0},{"_id":"source/images/dip.jpg","path":"images/dip.jpg","modified":1,"renderable":0},{"_id":"source/images/lsp.jpg","path":"images/lsp.jpg","modified":1,"renderable":0},{"_id":"source/images/ocp.jpg","path":"images/ocp.jpg","modified":1,"renderable":0},{"_id":"source/images/orm.png","path":"images/orm.png","modified":1,"renderable":0},{"_id":"source/images/question_11.jpg","path":"images/question_11.jpg","modified":1,"renderable":0},{"_id":"source/images/sexymeo.jpg","path":"images/sexymeo.jpg","modified":1,"renderable":0},{"_id":"source/images/solid.png","path":"images/solid.png","modified":1,"renderable":0},{"_id":"source/images/sshhhh.png","path":"images/sshhhh.png","modified":1,"renderable":0},{"_id":"source/images/sshhhh_2.png","path":"images/sshhhh_2.png","modified":1,"renderable":0},{"_id":"source/images/vangnau-matngu.jpg","path":"images/vangnau-matngu.jpg","modified":1,"renderable":0},{"_id":"source/images/dauto-nongxu.jpg","path":"images/dauto-nongxu.jpg","modified":1,"renderable":0},{"_id":"source/images/hoptra.jpg","path":"images/hoptra.jpg","modified":1,"renderable":0},{"_id":"source/images/isp.png","path":"images/isp.png","modified":1,"renderable":0},{"_id":"source/images/ruby-exception.jpg","path":"images/ruby-exception.jpg","modified":1,"renderable":0},{"_id":"source/images/rack.jpeg","path":"images/rack.jpeg","modified":1,"renderable":0},{"_id":"source/images/ssl1.png","path":"images/ssl1.png","modified":1,"renderable":0},{"_id":"source/images/thanhcong.jpg","path":"images/thanhcong.jpg","modified":1,"renderable":0},{"_id":"source/images/theconnhinho.jpg","path":"images/theconnhinho.jpg","modified":1,"renderable":0},{"_id":"source/images/vancon-tamnang.jpg","path":"images/vancon-tamnang.jpg","modified":1,"renderable":0},{"_id":"source/images/file_permission.gif","path":"images/file_permission.gif","modified":1,"renderable":0},{"_id":"source/images/like-query.png","path":"images/like-query.png","modified":1,"renderable":0},{"_id":"source/images/thecon.jpg","path":"images/thecon.jpg","modified":1,"renderable":0},{"_id":"themes/solar/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/solar/source/images/apple-touch-icon.png","path":"images/apple-touch-icon.png","modified":1,"renderable":1},{"_id":"themes/solar/source/images/earth.png","path":"images/earth.png","modified":1,"renderable":1},{"_id":"themes/solar/source/images/favicon.ico","path":"images/favicon.ico","modified":1,"renderable":1},{"_id":"themes/solar/source/images/favicon-192x192.png","path":"images/favicon-192x192.png","modified":1,"renderable":1},{"_id":"themes/solar/source/images/logo.png","path":"images/logo.png","modified":1,"renderable":1},{"_id":"themes/solar/source/images/mars.png","path":"images/mars.png","modified":1,"renderable":1},{"_id":"themes/solar/source/images/mercury.png","path":"images/mercury.png","modified":1,"renderable":1},{"_id":"themes/solar/source/images/shadow.png","path":"images/shadow.png","modified":1,"renderable":1},{"_id":"themes/solar/source/images/venus.png","path":"images/venus.png","modified":1,"renderable":1},{"_id":"themes/solar/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"source/images/2-col.png","path":"images/2-col.png","modified":1,"renderable":0},{"_id":"source/images/date-first.png","path":"images/date-first.png","modified":1,"renderable":0},{"_id":"source/images/3sum_2.jpeg","path":"images/3sum_2.jpeg","modified":1,"renderable":0},{"_id":"source/images/leaf-node.png","path":"images/leaf-node.png","modified":1,"renderable":0},{"_id":"source/images/test/test1.jpg","path":"images/test/test1.jpg","modified":1,"renderable":0},{"_id":"source/images/test/test2.jpg","path":"images/test/test2.jpg","modified":1,"renderable":0},{"_id":"source/images/test/test5.jpg","path":"images/test/test5.jpg","modified":1,"renderable":0},{"_id":"source/images/sub-first.png","path":"images/sub-first.png","modified":1,"renderable":0},{"_id":"source/images/thecon-thienthan.jpg","path":"images/thecon-thienthan.jpg","modified":1,"renderable":0},{"_id":"source/images/vang-con-bi-om.jpeg","path":"images/vang-con-bi-om.jpeg","modified":1,"renderable":0},{"_id":"source/images/vangcon.jpeg","path":"images/vangcon.jpeg","modified":1,"renderable":0},{"_id":"themes/solar/source/images/jupiter.png","path":"images/jupiter.png","modified":1,"renderable":1},{"_id":"themes/solar/source/images/sun.png","path":"images/sun.png","modified":1,"renderable":1},{"_id":"source/images/b-tree-sql.png","path":"images/b-tree-sql.png","modified":1,"renderable":0},{"_id":"source/images/meta2/1.png","path":"images/meta2/1.png","modified":1,"renderable":0},{"_id":"source/images/vangcon-doi.jpeg","path":"images/vangcon-doi.jpeg","modified":1,"renderable":0},{"_id":"themes/solar/source/lib/justified-gallery/justifiedGallery.min.css","path":"lib/justified-gallery/justifiedGallery.min.css","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/justified-gallery/jquery.justifiedGallery.min.js","path":"lib/justified-gallery/jquery.justifiedGallery.min.js","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/styles.css","path":"lib/meslo-LG/styles.css","modified":1,"renderable":1},{"_id":"source/images/meta2/2.png","path":"images/meta2/2.png","modified":1,"renderable":0},{"_id":"source/images/srp.jpg","path":"images/srp.jpg","modified":1,"renderable":0},{"_id":"source/images/test/test9.jpg","path":"images/test/test9.jpg","modified":1,"renderable":0},{"_id":"themes/solar/source/images/Solar.png","path":"images/Solar.png","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/jquery/jquery.min.js","path":"lib/jquery/jquery.min.js","modified":1,"renderable":1},{"_id":"source/images/meta2/5.png","path":"images/meta2/5.png","modified":1,"renderable":0},{"_id":"source/images/test/test7.jpg","path":"images/test/test7.jpg","modified":1,"renderable":0},{"_id":"source/images/test/test8.jpg","path":"images/test/test8.jpg","modified":1,"renderable":0},{"_id":"themes/solar/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/font-awesome/fonts/FontAwesome.otf","path":"lib/font-awesome/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","path":"lib/font-awesome/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"source/images/meta2/3.png","path":"images/meta2/3.png","modified":1,"renderable":0},{"_id":"source/images/meta2/9.png","path":"images/meta2/9.png","modified":1,"renderable":0},{"_id":"source/images/test/test6.jpg","path":"images/test/test6.jpg","modified":1,"renderable":0},{"_id":"source/images/test/test4.jpg","path":"images/test/test4.jpg","modified":1,"renderable":0},{"_id":"themes/solar/source/lib/font-awesome/fonts/fontawesome-webfont.svg","path":"lib/font-awesome/fonts/fontawesome-webfont.svg","modified":1,"renderable":1},{"_id":"source/images/meta2/7.png","path":"images/meta2/7.png","modified":1,"renderable":0},{"_id":"source/images/test/test3.jpg","path":"images/test/test3.jpg","modified":1,"renderable":0},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGL-Italic.ttf","path":"lib/meslo-LG/fonts/MesloLGL-Italic.ttf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGM-Italic.ttf","path":"lib/meslo-LG/fonts/MesloLGM-Italic.ttf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGS-Italic.ttf","path":"lib/meslo-LG/fonts/MesloLGS-Italic.ttf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGL-Bold.ttf","path":"lib/meslo-LG/fonts/MesloLGL-Bold.ttf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGL-BoldItalic.ttf","path":"lib/meslo-LG/fonts/MesloLGL-BoldItalic.ttf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGM-Bold.ttf","path":"lib/meslo-LG/fonts/MesloLGM-Bold.ttf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGM-BoldItalic.ttf","path":"lib/meslo-LG/fonts/MesloLGM-BoldItalic.ttf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGL-Regular.ttf","path":"lib/meslo-LG/fonts/MesloLGL-Regular.ttf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGM-Regular.ttf","path":"lib/meslo-LG/fonts/MesloLGM-Regular.ttf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGS-Bold.ttf","path":"lib/meslo-LG/fonts/MesloLGS-Bold.ttf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGS-BoldItalic.ttf","path":"lib/meslo-LG/fonts/MesloLGS-BoldItalic.ttf","modified":1,"renderable":1},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGS-Regular.ttf","path":"lib/meslo-LG/fonts/MesloLGS-Regular.ttf","modified":1,"renderable":1},{"_id":"source/images/test/test10.jpg","path":"images/test/test10.jpg","modified":1,"renderable":0},{"_id":"source/images/thecon-tuyetlo.gif","path":"images/thecon-tuyetlo.gif","modified":1,"renderable":0},{"_id":"source/images/meta2/8.png","path":"images/meta2/8.png","modified":1,"renderable":0},{"_id":"source/images/meta2/4.png","path":"images/meta2/4.png","modified":1,"renderable":0}],"Cache":[{"_id":"themes/solar/README.md","hash":"5b393ceb93cc1d5d1802dfd0300fd8341bac5b88","modified":1643632417936},{"_id":"themes/solar/.DS_Store","hash":"37292dce89faac3d6dbcfd42219116265d29ff67","modified":1643721390735},{"_id":"themes/solar/LICENSE","hash":"5ba0225e835bf8218d1524f481efc50c85447745","modified":1643632417936},{"_id":"themes/solar/_config.yml","hash":"9d5e5a83c5e38f9e44c6b2e41895726805445b76","modified":1643799571236},{"_id":"source/_posts/2018-01-01-file-permission-in-linux.md","hash":"6c7e79245c012b87cde7c9baab8e952743ebff65","modified":1643448599925},{"_id":"source/_posts/2019-01-23-open-command-in-macos.md","hash":"77926020fdbcbdf19b5049b2686da03c8e26d81f","modified":1643448599925},{"_id":"source/_posts/2019-01-30-bash-file-in-macos-and-linux.md","hash":"18ced0e3bf304ba599d910c1c2fd2c11c9b0d8ce","modified":1643448599925},{"_id":"source/_posts/2019-01-28-count-vs-length-size-in-ruby-and-ror.md","hash":"f20aa74d0aa4349291a9b807f3664b22a06d7a80","modified":1643448599925},{"_id":"source/_posts/2019-02-19-truyen-tham-tri-va-truyen-tham-chieu.md","hash":"cbf4af6b91ef4fef9dac33b8cbad8dc0d6aee813","modified":1643448599926},{"_id":"source/_posts/2019-02-22-quy-luat-80-20.md","hash":"82f1eb5c8382de3aa84a7ec90b8181c5f82b73f9","modified":1643448599926},{"_id":"source/_posts/2019-02-20-cac-trinh-thong-dich-trong-ruby.md","hash":"512fcdbeb03ddaf1e848c096246cf5b6780eb033","modified":1643448599926},{"_id":"source/_posts/2019-02-05-root-sudo-and-package-management-system.md","hash":"c22262a735fd9db90f81c13558e42fc1b32ebc6a","modified":1643448599926},{"_id":"source/_posts/2019-02-24-ruby-method-lookup.md","hash":"e3aa0c6852581bc602a32c4b7c675e59d9f74248","modified":1643448599926},{"_id":"source/_posts/2019-02-22-xu-ly-thong-tin-quan-trong-trong-rails.md","hash":"e0c0266c336544a0be0e0b13acf174747bacbea8","modified":1643448599926},{"_id":"source/_posts/2019-02-25-van-de-n-1-trong-rails.md","hash":"59b9d1fe6fcc210ba1bc5b8d6d38c21fdc85512a","modified":1643448599926},{"_id":"source/_posts/2019-04-08-immutable-va-mutable-trong-ruby.md","hash":"35bcfc5701761300d269855277549714f15b1425","modified":1643448599926},{"_id":"source/_posts/2019-04-10-iaas-paas-saas.md","hash":"2a5d100f96bcff3eb1ae2086ec0bdbeebfac7d6e","modified":1643448599926},{"_id":"source/_posts/2019-04-10-upload-file-len-aws-s3-va-nhung-van-de-can-luu-y.md","hash":"b738a23a6ff75e535ed473659c7dd4566fe30ec6","modified":1643448599926},{"_id":"source/_posts/2019-04-11-su-dung-carrierwave-voi-s3.md","hash":"be8025909c4fa7eb17b8fef7f1f1b1e6e1f20d08","modified":1643448599926},{"_id":"source/_posts/2019-05-04-https-vai-dieu-can-nho.md","hash":"d8daaba6642c1be8322c5023fb778990085b301b","modified":1643448599927},{"_id":"source/_posts/2019-04-17-doi-dieu-ve-session-va-cookie-trong-rails.md","hash":"c399b4d65b64f370a54ca06d7fcceaf467fe024c","modified":1643448599927},{"_id":"source/_posts/2019-05-08-phan-biet-update-update-column-va-update-attribute-trong-rails.md","hash":"301a3609d63d01fc9461309ef68fc1a0b4d734b9","modified":1643448599927},{"_id":"source/_posts/2019-05-15-require-load-include-va-extend-trong-ruby.md","hash":"a4f2362e1d81b68d0bb27be0c488d4dda32a7602","modified":1643448599927},{"_id":"source/_posts/2019-05-16-autoloading-va-reloading-constants-trong-rails.md","hash":"e269b0722b5cf5e9ec013933cce9e43d5d5f7c80","modified":1643448599927},{"_id":"source/_posts/2019-05-17-nguyen-ly-solid-trong-code-ruby.md","hash":"d1f5774bb4c58b2ce38f9ba765a0ea898a4c316e","modified":1643448599927},{"_id":"source/_posts/2019-06-09-so-sanh-symbol-va-string-trong-ruby.md","hash":"86c3f70c0f9c0775191e9926f27d9ce68a446c4e","modified":1643448599927},{"_id":"source/_posts/2019-06-08-tan-cong-sql-injection-va-cach-phong-chong-trong-rails.md","hash":"7d3165180f94cf41c70f43157d29352497320dde","modified":1643448599927},{"_id":"source/_posts/2019-06-10-xu-ly-ngoai-le-trong-rails.md","hash":"1dbc40fb3215ce8d1890dd368780286b9cab6e59","modified":1643448599927},{"_id":"source/_posts/2019-06-09-luu-y-ngan-gon-ve-scope-va-class-method.md","hash":"10f470d044df0e08a9caee5885e0d4b72a52cea3","modified":1643448599927},{"_id":"source/_posts/2019-06-11-public-private-va-protected-method-trong-ruby.md","hash":"a4fa7d523d626921dbf5fe098369a841a7b4b8ef","modified":1643448599927},{"_id":"source/_posts/2019-06-25-build-a-simple-orm-with-ruby.md","hash":"54dec8cfa92e58ff3e79f417927e3510c77257d1","modified":1643448599928},{"_id":"source/_posts/2019-06-24-simple-rack-application.md","hash":"0e357744a268a9444ca51dcfa900d04d14896628","modified":1643448599928},{"_id":"source/_posts/2019-06-16-tu-khoa-super-trong-ruby.md","hash":"fa9f920d5b73bee034bed444a8e770d4777a13cb","modified":1643448599928},{"_id":"source/_posts/2019-08-05-setup-terminal-macos.md","hash":"1bc46cf0ea81e2a4edd34a183bb0b0b167a0fac3","modified":1643448599928},{"_id":"source/_posts/2019-09-20-vscode-extension.md","hash":"7162e2a730b6fa77039e6b5eceddd4f26a7457f0","modified":1643448599928},{"_id":"source/_posts/2019-10-30-basic-vim-setup.md","hash":"cb4a6d3f95e2c4545a279fc7d4f2bc99369b3a22","modified":1643448599928},{"_id":"source/_posts/2019-12-01-basic-bash-file-to-deploy-my-blog.md","hash":"385807a35156d2b9ce4f9216941f5c3c983906e2","modified":1643448599928},{"_id":"source/_posts/2019-12-01-how-to-use-multi-account-with-ssh.md","hash":"4e524c32dcde206d3732b613f8405ddd45ba0e7c","modified":1643448599928},{"_id":"source/_posts/2019-12-05-ruby-argument.md","hash":"2b905c379c58e53146d6c7cef4dc933a8a744b61","modified":1643448599928},{"_id":"source/_posts/2019-12-16-search-in-array.md","hash":"7a96990ebf9cf6e4d859a320b89b65c29b3462f2","modified":1643448599928},{"_id":"source/_posts/2019-12-06-linked-list-with-ruby.md","hash":"2d04de05353f30fc08a4acf89b42177b33a2641e","modified":1643448599928},{"_id":"source/_posts/2019-12-20-example-of-two-pointer.md","hash":"17bb1dccd6322ee0de3bb7eeabae8f4aba67a1c6","modified":1643448599928},{"_id":"source/_posts/2019-12-01-simple-bst-in-ruby.md","hash":"07f9d434c47335bf5df711b09950934bd531a2e6","modified":1643721020981},{"_id":"source/_posts/2019-12-28-clone-object-and-array-in-javascript.md","hash":"67e61f603b889dd398a11aa6fa50abceefb6792d","modified":1643448599928},{"_id":"source/_posts/2019-8-10-meta-programming-ruby.md","hash":"6ff02f99ec4f321d45486ce50db6757a1095976e","modified":1643448599929},{"_id":"source/_posts/2019-8-21-hello-hexo.md","hash":"99c7b0d3d84b1080cdf442cbc6d6e9dadab3ca34","modified":1643448599929},{"_id":"source/_posts/2020-01-05-sql-performance-explained-notes.md","hash":"edcd77494d7f2ac70ac62aca8651e3b568ca7f7c","modified":1643448599929},{"_id":"source/_posts/2020-01-08-reactjs-notes.md","hash":"2de516a3b96f322beb2f230d82858c4c02afbc2a","modified":1643448599929},{"_id":"source/_posts/2020-01-09-callback-promise-anyc-await.md","hash":"26fb8d4e106f30d5fca3fde05f6d06c99f12128d","modified":1643448599929},{"_id":"source/_posts/2020-01-10-method-and-function-notes.md","hash":"bf7325ff361710f5d49bb6276afbb580e860b9d4","modified":1643448599929},{"_id":"source/_posts/2020-01-11-this-in-javascript.md","hash":"084d8ca21f28cdbdcad5e037db2399dbf832527d","modified":1643448599929},{"_id":"source/_posts/2020-02-05-the-first-note-in-the-new-luna-year.md","hash":"c115e864c4b1c911999ae3b497b04d4042f76304","modified":1643448599929},{"_id":"source/_posts/2020-03-16-new-project-notes-2.md","hash":"a6d2edaf78f80cacedd0855b7620bc2d2d2890c5","modified":1643448599929},{"_id":"source/_posts/2020-03-8-redux-co-ban.md","hash":"4532673bb2ae91fb2b666a180f3280add3e59bb6","modified":1643448599929},{"_id":"source/_posts/2020-04-23-handle-exception-in-rails.md","hash":"ff058c2cc599ea3b569d8ece51667588acfbbb9d","modified":1643448599930},{"_id":"source/_posts/2020-05-12-safe-navigation-operator.md","hash":"349acf6cde3642bd8c11670517e05fc9e5e3515f","modified":1643448599930},{"_id":"source/_posts/2020-05-14-url-dash-vs-underscore.md","hash":"79b71432c74c56ff6dc5c0f7aac702b2da53472d","modified":1643448599930},{"_id":"source/_posts/2020-05-17-lam-mini-app-cho-vo-phan-1.md","hash":"dadbb9f7eb22aee7c6476cd499fadbce31efe336","modified":1643448599930},{"_id":"source/_posts/2020-05-13-linux-process-types-dirty-method.md","hash":"7bf6f5c6c75ef5c03da0a18dd59206dd8a57c2b4","modified":1643448599930},{"_id":"source/_posts/2020-06-27-viet-side-project.md","hash":"80f2fa3ce8abaf7c2a364c7307a9846005d22b3a","modified":1643448599930},{"_id":"source/_posts/2022-02-01-docker-2021.md","hash":"36c64630f95c084a10347972d3309a03e2b5c2bb","modified":1655541389946},{"_id":"source/about/index.md","hash":"09703cb1947571d57ca6efbf4f87646ed8812c0c","modified":1643720736679},{"_id":"source/_posts/2020-07-03-leetcode-track-list.md","hash":"d44919aeb34c475189d3bd85581a25f5eca5c0f1","modified":1643448862460},{"_id":"source/_posts/2020-06-28-goi-api-tu-fe.md","hash":"27ce61f7d577f0bed53c91e87fe7c2feac02897f","modified":1643635448245},{"_id":"source/_posts/2022-01-31-put-images-in-the-header.md","hash":"c3f5daedaa3a7331a1f2e1597d18f6896b1c4c41","modified":1643721611591},{"_id":"source/images/7.gif","hash":"b85ec503cfc4a20438125cfdf351ef1047ee437b","modified":1643448599932},{"_id":"source/images/dip.jpg","hash":"3d4204d18b0b55499ff7e209f955456a90edc8fb","modified":1643448599935},{"_id":"source/images/lsp.jpg","hash":"65e9b6cae517487c256665e96e85d24efc597986","modified":1643448599938},{"_id":"source/images/ocp.jpg","hash":"2cf898d6f4747d7280f5ea94a46baf6070e2a48e","modified":1643448599964},{"_id":"source/images/orm.png","hash":"0c5c1839671d39b0ebe69609cc1849716ad4dfc8","modified":1643448599964},{"_id":"source/images/question_11.jpg","hash":"e775d41977358490db76fca98876432928b2e076","modified":1643448599964},{"_id":"source/images/sexymeo.jpg","hash":"b184f24368abd09d5a11b9cbd612a9de3d0be01b","modified":1643448599965},{"_id":"source/images/solid.png","hash":"85d377189186938860534c3a13ff9b55199ac388","modified":1643448599966},{"_id":"source/images/sshhhh.png","hash":"289a4480f99d50b04fb0222d3f727c0d400f2567","modified":1643448599967},{"_id":"source/images/sshhhh_2.png","hash":"167cf91f4d3e0974fa2dd7cd2e9b4e17f4cf3b42","modified":1643448599967},{"_id":"themes/solar/scripts/meta.js","hash":"fa6055a39851c9953d033e70c1614547b94dce60","modified":1643632417940},{"_id":"themes/solar/scripts/thumbnail.js","hash":"df8829fd8c3119650037eba5ec11bdce06acff9d","modified":1643632417940},{"_id":"source/projects/index.md","hash":"de841cb2cb061913cdf3967926e44db0d324d4ae","modified":1643448599978},{"_id":"source/images/vangnau-matngu.jpg","hash":"7d94135737c5df8faccab6474098c4c985d20bd0","modified":1643448599978},{"_id":"source/speak/index.md","hash":"bc87ada7cf1545eb916a04124f3a92bab050e539","modified":1643448599978},{"_id":"themes/solar/layout/archive.ejs","hash":"f9c0434f023bdf2858aa8447137463c3224814be","modified":1643632417937},{"_id":"themes/solar/layout/index.ejs","hash":"0ea23cf9f01820a7e1c86600110afa876041cd25","modified":1643632417938},{"_id":"themes/solar/layout/layout.ejs","hash":"52b18d33641395aa85c1f099380ffe79eb8dd3e1","modified":1643632417938},{"_id":"themes/solar/layout/page.ejs","hash":"b6b7b1e6dc856a0e62f35da0151f67ba41143e04","modified":1643632417940},{"_id":"themes/solar/layout/post.ejs","hash":"2731e597b5d1714a6f5a775c432e99785f02a3e3","modified":1643632417940},{"_id":"source/images/dauto-nongxu.jpg","hash":"7c5d8af8371982a84f2bb69913d32d584fa9331b","modified":1643448599935},{"_id":"source/images/hoptra.jpg","hash":"4b0a09ac3695f5ba09f3c92ae5b844c33a45ff9f","modified":1643448599936},{"_id":"source/images/isp.png","hash":"8cb5c14b38c4396246f9202dacc29491936e380d","modified":1643448599936},{"_id":"source/images/ruby-exception.jpg","hash":"a8d929aac3fe8c1472f08ef1fe16081a716d906e","modified":1643448599965},{"_id":"source/images/rack.jpeg","hash":"f6e3a0bd75b58db47ac18d1eeb2b71727a5230e7","modified":1643448599965},{"_id":"source/images/ssl1.png","hash":"b1ceda2df1849ff840ccad660cdbd6aa984ff3f6","modified":1643448599968},{"_id":"source/images/thanhcong.jpg","hash":"c84daf2145d5aa0d8aefc4d5c608539801f9b4c1","modified":1643448599969},{"_id":"source/images/theconnhinho.jpg","hash":"cbeeeca81e07cc4ff303d4465335a94e6629d7fd","modified":1643448599974},{"_id":"source/images/vancon-tamnang.jpg","hash":"777b2b5707e40c1f89d5deb2dc000282ca75bb35","modified":1643448599975},{"_id":"source/images/file_permission.gif","hash":"7045495d2b775ec3c73765211edb06381d683daa","modified":1643448599936},{"_id":"source/images/like-query.png","hash":"d2b39a72ee62debfc6e5b33c0d532eeee190c4cf","modified":1643448599938},{"_id":"source/images/thecon.jpg","hash":"272a340a5748fb56151f65386685c6d838386996","modified":1643448599974},{"_id":"themes/solar/source/css/_extend.styl","hash":"2d360cc07d3cfe10fd95640346515f51fa0ea799","modified":1643632417941},{"_id":"themes/solar/source/css/_mixins.styl","hash":"c921ceb620deedddd38c9cec28190995e8764bab","modified":1643632417945},{"_id":"themes/solar/source/css/_variables.styl","hash":"05dfdc680b2a156f615433a5978bf80178acb26f","modified":1643632417946},{"_id":"themes/solar/source/css/_util.styl","hash":"f8e286a21c7ec3e771d5ddeb2909ac92390af9bd","modified":1643632417946},{"_id":"themes/solar/source/css/style.styl","hash":"2b9c9697d30759cb3c49b52486b6fc34bcfbe464","modified":1643632417946},{"_id":"themes/solar/source/images/apple-touch-icon.png","hash":"bb91acbedda435287809e41148b1b255cdf957dc","modified":1643632417948},{"_id":"themes/solar/source/images/earth.png","hash":"2cdcc68e36457410c633a578bb7b30a803193ecb","modified":1643632417948},{"_id":"themes/solar/source/images/favicon.ico","hash":"54972e5dafeb73579b30c17232553c688d702448","modified":1643632417949},{"_id":"themes/solar/source/images/favicon-192x192.png","hash":"4b07282018db1888c7bc707a3e1b576c5684eabb","modified":1643632417949},{"_id":"themes/solar/source/images/logo.png","hash":"2084e1813f7310d9543a37608f4e6690d600b9c3","modified":1643632417949},{"_id":"themes/solar/source/images/mars.png","hash":"4b33fb4ef0359cb401d4ed6d862caf55fb560802","modified":1643632417949},{"_id":"themes/solar/source/images/mercury.png","hash":"e5ecda952ae568b8890026c7ab02a175652535a2","modified":1643632417950},{"_id":"themes/solar/source/images/shadow.png","hash":"ec5cfff7997edd1b5e01516604daca7c7a4f3788","modified":1643632417950},{"_id":"themes/solar/source/images/venus.png","hash":"d45968836d952cd017439323135e6fad155c45ae","modified":1643632417950},{"_id":"themes/solar/source/js/main.js","hash":"481f730da10e5c9e1d59dfa9f1c0714ae709a0b8","modified":1643632417951},{"_id":"themes/solar/layout/_partial/banner.ejs","hash":"2611a9acb5392f425531610f5a12d396270041f7","modified":1643632417936},{"_id":"themes/solar/layout/_partial/comments.ejs","hash":"853a4500da515ef3facc51a055886eaf8efd080d","modified":1643632417936},{"_id":"themes/solar/layout/_partial/footer.ejs","hash":"7f6b3f126a58e6734b658ab57bc6b41822bc9342","modified":1643632417936},{"_id":"themes/solar/layout/_partial/head.ejs","hash":"5b6f73a4fb96edde3005f90063509bf851714f72","modified":1643632417936},{"_id":"themes/solar/layout/_partial/scripts.ejs","hash":"264e49c76744a2ce5be4cd69910cab8e0f517eda","modified":1643632417937},{"_id":"themes/solar/layout/_partial/header.ejs","hash":"889fe54bbfd1fb3357e8c0614d57a437a72f782a","modified":1643632417936},{"_id":"themes/solar/layout/layout/archive.ejs","hash":"f9c0434f023bdf2858aa8447137463c3224814be","modified":1643632417939},{"_id":"themes/solar/layout/layout/index.ejs","hash":"0ea23cf9f01820a7e1c86600110afa876041cd25","modified":1643632417940},{"_id":"themes/solar/layout/layout/layout.ejs","hash":"52b18d33641395aa85c1f099380ffe79eb8dd3e1","modified":1643632417940},{"_id":"source/images/2-col.png","hash":"2affaf2702f7313e6f5d288f8d977bf246f903eb","modified":1643448599931},{"_id":"themes/solar/layout/layout/post.ejs","hash":"2731e597b5d1714a6f5a775c432e99785f02a3e3","modified":1643632417940},{"_id":"themes/solar/layout/layout/page.ejs","hash":"b6b7b1e6dc856a0e62f35da0151f67ba41143e04","modified":1643632417940},{"_id":"source/images/date-first.png","hash":"ed69fc53b026dc3615900361b4511f08a1192e50","modified":1643448599934},{"_id":"source/images/3sum_2.jpeg","hash":"3ca9dd693e2ca0bc6a34a801383ee347d4d9f138","modified":1643448599932},{"_id":"source/images/leaf-node.png","hash":"5c140a89277b0d96fcaa314d78ebad8645274e7b","modified":1643448599937},{"_id":"source/images/test/test1.jpg","hash":"ce77bb301832f9e196bd6cd3afdde5cd107cc1f0","modified":1643636720111},{"_id":"source/images/test/test2.jpg","hash":"1b4bbcb97591ed371d72ff991bb89ae8b87f1b14","modified":1643636766832},{"_id":"source/images/test/test5.jpg","hash":"49b296698676728c5879ab925b329aacdc191320","modified":1643636785664},{"_id":"source/images/sub-first.png","hash":"fb193a6c105c3cdd487f5d6ccf435a1fc514c115","modified":1643448599968},{"_id":"source/images/thecon-thienthan.jpg","hash":"294c9a5fdb6c86620f535d3bec5ae82f56db9554","modified":1643448599969},{"_id":"source/images/vang-con-bi-om.jpeg","hash":"143015d2b0cc68f84dd805969e629f5117dd0068","modified":1643448599976},{"_id":"source/images/vangcon.jpeg","hash":"81d20645ed37382ea561ee93fb99f915879d25c4","modified":1643448599977},{"_id":"themes/solar/source/css/_partial/archive.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1643632417945},{"_id":"themes/solar/source/images/jupiter.png","hash":"4b7bc03b4cdf2fcde13e982aef340a1d385a3e7d","modified":1643632417949},{"_id":"themes/solar/source/images/sun.png","hash":"62be3d54471271a1e8adb348a3f021ef001b4668","modified":1643632417950},{"_id":"source/images/b-tree-sql.png","hash":"b615617f48a8fb45bbe1ac33360c73c5123b46b4","modified":1643448599934},{"_id":"source/images/meta2/1.png","hash":"2fa2eeecf403fa05a9624e2cb3feb8001ad2dba9","modified":1643448599939},{"_id":"source/images/vangcon-doi.jpeg","hash":"2fb39289023811885464b3488aa9a5f1046b87d4","modified":1643448599977},{"_id":"themes/solar/source/css/_highlight/agate.styl","hash":"601eb70448a16b918df132f6fc41e891ae053653","modified":1643632417941},{"_id":"themes/solar/source/css/_highlight/androidstudio.styl","hash":"65d09f1b0e81c6a182f549fd3de51e59823c97ae","modified":1643632417941},{"_id":"themes/solar/source/css/_highlight/atelier-dune-dark.styl","hash":"df50a85a4b14c7ca6e825d665594b91229d0e460","modified":1643632417942},{"_id":"themes/solar/source/css/_highlight/arta.styl","hash":"1a5accc115f41d1b669ed708ac6a29abac876599","modified":1643632417941},{"_id":"themes/solar/source/css/_highlight/atelier-cave-dark.styl","hash":"bc647b2c1d971d7cc947aa1ed66e9fd115261921","modified":1643632417942},{"_id":"themes/solar/source/css/_highlight/atelier-estuary-dark.styl","hash":"d84382bc8298f96730757391d3e761b7e640f406","modified":1643632417942},{"_id":"themes/solar/source/css/_highlight/atelier-forest-dark.styl","hash":"57c154c6045a038dc7df0a25927853e10bf48c4a","modified":1643632417942},{"_id":"themes/solar/source/css/_highlight/atelier-heath-dark.styl","hash":"b0cf13b2233e7bc38342032d2d7296591a4c2bcf","modified":1643632417942},{"_id":"themes/solar/source/css/_highlight/atelier-lakeside-dark.styl","hash":"bb0a8c4ad0dd8e3e7de7122ddf268fc42aa94acb","modified":1643632417942},{"_id":"themes/solar/source/css/_highlight/atelier-savanna-dark.styl","hash":"a16c919a1ccf2f845488078fb341381bec46b1f3","modified":1643632417942},{"_id":"themes/solar/source/css/_highlight/atelier-seaside-dark.styl","hash":"ce233a101daea7124cbfcd34add43ccfe2e1e1c7","modified":1643632417943},{"_id":"themes/solar/source/css/_highlight/dark.styl","hash":"71ce56d311cc2f3a605f6e2c495ccd7236878404","modified":1643632417943},{"_id":"themes/solar/source/css/_highlight/atelier-sulphurpool-dark.styl","hash":"414b0cfc142f70afe359c16450b651e28bf7325a","modified":1643632417943},{"_id":"themes/solar/source/css/_highlight/atelier-plateau-dark.styl","hash":"09c64f1a7052aec9070c36c0431df25216afaea1","modified":1643632417942},{"_id":"themes/solar/source/css/_highlight/codepen-embed.styl","hash":"f4dcc84d8e39f9831a5efe80e51923fc3054feb0","modified":1643632417943},{"_id":"themes/solar/source/css/_highlight/far.styl","hash":"d9928010ffe71e80b97a5afcba1a4975efdd7372","modified":1643632417943},{"_id":"themes/solar/source/css/_highlight/hybrid.styl","hash":"ea8d7ddc258b073308746385f5cb85aabb8bfb83","modified":1643632417943},{"_id":"themes/solar/source/css/_highlight/darkula.styl","hash":"ad0d5728d21645039c9f199e7a56814170ed3bab","modified":1643632417943},{"_id":"themes/solar/source/css/_highlight/hopscotch.styl","hash":"b374c6550b89b4751aedc8fbc3cf98d95bd70ead","modified":1643632417943},{"_id":"themes/solar/source/css/_highlight/ir-black.styl","hash":"693078bbd72a2091ed30f506cc55949600b717af","modified":1643632417943},{"_id":"themes/solar/source/css/_highlight/kimbie.styl","hash":"45dbb168f22d739d0109745d2decd66b5f94e786","modified":1643632417943},{"_id":"themes/solar/source/css/_highlight/lightcode.styl","hash":"6c61c481836f6cbc3a57be10fa3af21bee83eb09","modified":1643632417944},{"_id":"themes/solar/source/css/_highlight/monokai.styl","hash":"5a4fe9f957fd7a368c21b62a818403db4270452f","modified":1643632417944},{"_id":"themes/solar/source/css/_highlight/obsidian.styl","hash":"55572bbcfee1de6c31ac54681bb00336f5ae826d","modified":1643632417944},{"_id":"themes/solar/source/css/_highlight/paraiso.styl","hash":"f1537bd868579fa018ecdbfd2eb922dcf3ba2cac","modified":1643632417944},{"_id":"themes/solar/source/css/_highlight/monokai-sublime.styl","hash":"25aa2fc1dbe38593e7c7ebe525438a39574d9935","modified":1643632417944},{"_id":"themes/solar/source/css/_highlight/pojoaque.styl","hash":"77dae9dc41945359d17fe84dbd317f1b40b2ee33","modified":1643632417944},{"_id":"themes/solar/source/css/_highlight/railscasts.styl","hash":"acd620f8bb7ff0e3fe5f9a22b4433ceef93a05e6","modified":1643632417944},{"_id":"themes/solar/source/css/_highlight/rainbow.styl","hash":"ce73b858fc0aba0e57ef9fb136c083082746bc1d","modified":1643632417944},{"_id":"themes/solar/source/css/_highlight/solarized-dark.styl","hash":"702b9299a48c90124e3ac1d45f1591042f2beccc","modified":1643632417944},{"_id":"themes/solar/source/css/_highlight/tomorrow-night-blue.styl","hash":"8b3087d4422be6eb800935a22eb11e035341c4ba","modified":1643632417945},{"_id":"themes/solar/source/css/_highlight/sunburst.styl","hash":"a0b5b5129547a23865d400cfa562ea0ac1ee3958","modified":1643632417945},{"_id":"themes/solar/source/css/_highlight/tomorrow-night.styl","hash":"19b3080d4b066b40d50d7e7f297472482b5801fd","modified":1643632417945},{"_id":"themes/solar/source/css/_highlight/tomorrow-night-eighties.styl","hash":"fa57b3bb7857a160fc856dbe319b31e30cc5d771","modified":1643632417945},{"_id":"themes/solar/source/css/_highlight/tomorrow-night-bright.styl","hash":"0ac6af6ecb446b5b60d6226748e4a6532db34f57","modified":1643632417945},{"_id":"themes/solar/source/css/_partial/comments.styl","hash":"11fb41241a13971d23fc3f7e6d60315c7f248396","modified":1643632417945},{"_id":"themes/solar/source/css/_partial/article.styl","hash":"7bd68ecc8ebeb70daa74bfc179f984032eef18ae","modified":1643632417945},{"_id":"themes/solar/source/css/_highlight/zenburn.styl","hash":"fc5ec840435dad80964d04519d3f882ddc03746a","modified":1643632417945},{"_id":"themes/solar/source/css/_partial/footer.styl","hash":"b7570de60eaf9aa6b0192bf9c71b9172ff11bfbc","modified":1643632417946},{"_id":"themes/solar/source/css/_partial/header.styl","hash":"1545e8303fe36bbabb4da4a967c424de07d93dec","modified":1643632417946},{"_id":"themes/solar/source/css/_partial/index.styl","hash":"cf43702450ea1e5617541501886982a394cff8ec","modified":1643632417946},{"_id":"themes/solar/source/css/_partial/solar.styl","hash":"3af61c9b8033a4b804f0e1ba52525b55d6e16126","modified":1643632417946},{"_id":"themes/solar/source/lib/justified-gallery/justifiedGallery.min.css","hash":"13fbcba5e97aa88b748d94d3efc4718475279907","modified":1643632417958},{"_id":"themes/solar/source/lib/justified-gallery/jquery.justifiedGallery.min.js","hash":"b2683e7a872bc109b1756a65188a37cef7d0bd5c","modified":1643632417958},{"_id":"themes/solar/layout/_partial/post/actions_desktop.ejs","hash":"2319dea76f205c27dd59c994921f66350df8027a","modified":1643632417937},{"_id":"themes/solar/layout/_partial/post/actions_mobile.ejs","hash":"e7638a83e5aaa4bf5b24440ca76fec8eb563bed7","modified":1643632417937},{"_id":"themes/solar/source/lib/meslo-LG/styles.css","hash":"eb88d0b9f1bbef99070e9627e2c96d892036bf7e","modified":1643632417978},{"_id":"themes/solar/layout/_partial/post/date.ejs","hash":"12a4a7ba6334e3e5c03d9a9601d7779a27c2e082","modified":1643632417937},{"_id":"themes/solar/layout/_partial/post/share.ejs","hash":"25a3406f97e976ec13239f0d3f32f9e512511f50","modified":1643632417937},{"_id":"themes/solar/layout/_partial/post/tag.ejs","hash":"bfab03ef986d35ccad583f2d2b575db4a8d2789e","modified":1643632417937},{"_id":"themes/solar/layout/_partial/post/title.ejs","hash":"a060f1c6e3718494a6b1d0e1981ea0bf4e549828","modified":1643632417937},{"_id":"themes/solar/layout/_partial/post/gallery.ejs","hash":"9aecd8908e8a684f33dc20c02497c0f1774137c7","modified":1643632417937},{"_id":"themes/solar/layout/layout/_partial/banner.ejs","hash":"f4359350f4b79b14a9d669055911d50d7a3dfd89","modified":1643632417938},{"_id":"themes/solar/layout/layout/_partial/head.ejs","hash":"5b6f73a4fb96edde3005f90063509bf851714f72","modified":1643632417938},{"_id":"themes/solar/layout/layout/_partial/header.ejs","hash":"889fe54bbfd1fb3357e8c0614d57a437a72f782a","modified":1643632417938},{"_id":"themes/solar/layout/layout/_partial/comments.ejs","hash":"853a4500da515ef3facc51a055886eaf8efd080d","modified":1643632417938},{"_id":"themes/solar/layout/layout/_partial/scripts.ejs","hash":"264e49c76744a2ce5be4cd69910cab8e0f517eda","modified":1643632417939},{"_id":"themes/solar/layout/layout/_partial/footer.ejs","hash":"7f6b3f126a58e6734b658ab57bc6b41822bc9342","modified":1643632417938},{"_id":"source/images/meta2/2.png","hash":"acf16dbf3b15e3941acc63c4cbfc56aa4fb7449d","modified":1643448599940},{"_id":"source/images/srp.jpg","hash":"81710dc7159876b7164aa9bd7e77472f55e3a8ea","modified":1643448599967},{"_id":"source/images/test/test9.jpg","hash":"9b3b6204e11a5a6f525740dd8537ae38644e3063","modified":1643636807683},{"_id":"themes/solar/source/images/Solar.png","hash":"463dbb952527b3d35c6203575eec552f62fd9d8e","modified":1643632417948},{"_id":"themes/solar/source/lib/jquery/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1643632417957},{"_id":"source/images/meta2/5.png","hash":"bb982c8aed9c8e3f81e8d71bd6c2d01b894cafcc","modified":1643448599953},{"_id":"source/images/test/test7.jpg","hash":"8a7e05d349a3dcb07328e0a73647bd0cfb43b99f","modified":1643636797454},{"_id":"source/images/test/test8.jpg","hash":"dc21d4ad8bc3368a9f105f421b3d24947e9584ca","modified":1643636802879},{"_id":"themes/solar/source/css/_partial/post/actions_mobile.styl","hash":"9eb19c3063d300c9ca548d671770edc71e357eba","modified":1643632417946},{"_id":"themes/solar/source/css/_partial/post/actions_desktop.styl","hash":"bbbc23844a67dca3143cdb514781714cdf06e209","modified":1643632417946},{"_id":"themes/solar/source/lib/font-awesome/css/font-awesome.css","hash":"4eda182cbcc046dbf449aef97c02c230cf80a494","modified":1643632417951},{"_id":"themes/solar/source/lib/font-awesome/css/font-awesome.min.css","hash":"fb5b49426dee7f1508500e698d1b3c6b04c8fcce","modified":1643632417951},{"_id":"themes/solar/layout/layout/_partial/post/actions_desktop.ejs","hash":"2319dea76f205c27dd59c994921f66350df8027a","modified":1643632417938},{"_id":"themes/solar/layout/layout/_partial/post/actions_mobile.ejs","hash":"e7638a83e5aaa4bf5b24440ca76fec8eb563bed7","modified":1643632417939},{"_id":"themes/solar/layout/layout/_partial/post/date.ejs","hash":"12a4a7ba6334e3e5c03d9a9601d7779a27c2e082","modified":1643632417939},{"_id":"themes/solar/layout/layout/_partial/post/share.ejs","hash":"25a3406f97e976ec13239f0d3f32f9e512511f50","modified":1643632417939},{"_id":"themes/solar/layout/layout/_partial/post/gallery.ejs","hash":"9aecd8908e8a684f33dc20c02497c0f1774137c7","modified":1643632417939},{"_id":"themes/solar/layout/layout/_partial/post/tag.ejs","hash":"bfab03ef986d35ccad583f2d2b575db4a8d2789e","modified":1643632417939},{"_id":"themes/solar/layout/layout/_partial/post/title.ejs","hash":"a060f1c6e3718494a6b1d0e1981ea0bf4e549828","modified":1643632417939},{"_id":"themes/solar/source/lib/font-awesome/fonts/FontAwesome.otf","hash":"1b22f17fdc38070de50e6d1ab3a32da71aa2d819","modified":1643632417953},{"_id":"themes/solar/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"965ce8f688fedbeed504efd498bc9c1622d12362","modified":1643632417953},{"_id":"themes/solar/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"97e438cc545714309882fbceadbf344fcaddcec5","modified":1643632417957},{"_id":"themes/solar/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"6d7e6a5fc802b13694d8820fc0138037c0977d2e","modified":1643632417957},{"_id":"themes/solar/source/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"61d8d967807ef12598d81582fa95b9f600c3ee01","modified":1643632417956},{"_id":"source/images/meta2/3.png","hash":"0bd5f388f8660ab278e5e5b840bad6825e0745a1","modified":1643448599942},{"_id":"source/images/meta2/9.png","hash":"5e4a5eb7f3a8956dc2f215fd5e253965e9ed7d73","modified":1643448599964},{"_id":"source/images/test/test6.jpg","hash":"1acfcdf222b98629a279cfe72eabc8fdf054fc9c","modified":1643636791631},{"_id":"source/images/test/test4.jpg","hash":"6a5d11d06a0c15e1a20daf0fcdc64ecfe018b0ae","modified":1643636778198},{"_id":"themes/solar/source/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"c0522272bbaef2acb3d341912754d6ea2d0ecfc0","modified":1643632417955},{"_id":"source/images/meta2/7.png","hash":"b0a9c548892f127bec56bf2921f1e6e81786b186","modified":1643448599955},{"_id":"source/images/test/test3.jpg","hash":"ddaaaeb4fa04a05c83053c1f8149720d18c9c8de","modified":1643636772825},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGL-Italic.ttf","hash":"96c97a0a098ca40802f948ae56fa37aa6683d034","modified":1643632417967},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGM-Italic.ttf","hash":"68700db02debd4b922304134da83b829cbfddfc9","modified":1643632417975},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGS-Italic.ttf","hash":"7f7cdbdcc26279c04046632e22d872f111bc9399","modified":1643632417977},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGL-Bold.ttf","hash":"bfa1ed9a263ed78462f06d322de13bd5bd0906b2","modified":1643632417961},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGL-BoldItalic.ttf","hash":"a9a431fc7a6c3a67c98021d4035c12a07a4f1070","modified":1643632417964},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGM-Bold.ttf","hash":"a8a8df3393bccc365335fc5eb0a62a6b7ccd32b9","modified":1643632417970},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGM-BoldItalic.ttf","hash":"65ddb11e75ee93909e845ab912a36717c48f1c94","modified":1643632417973},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGL-Regular.ttf","hash":"2b912dd13f052f645ee19951604610bb350d50af","modified":1643632417970},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGM-Regular.ttf","hash":"5e220152adefe905b2197f873d7cee99eca50e91","modified":1643632417976},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGS-Bold.ttf","hash":"df202ce09cbdc70bc16b81983a13ef0f94e46f10","modified":1643632417976},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGS-BoldItalic.ttf","hash":"d895a1bd25e36c58b7f463ebe14de09f186d5ab4","modified":1643632417977},{"_id":"themes/solar/source/lib/meslo-LG/fonts/MesloLGS-Regular.ttf","hash":"56fa0e33a390b704afc56af93a31576ccdbbdd9e","modified":1643632417978},{"_id":"source/images/test/test10.jpg","hash":"df4f4c453b75dbce0d58b730053aef5068e4b3c3","modified":1643720524792},{"_id":"source/images/thecon-tuyetlo.gif","hash":"cab6a80c4530aeb097110a4265f95a2aa08817d8","modified":1643448599974},{"_id":"source/images/meta2/8.png","hash":"9f222f8dadd5976e00ed74dbdefd21debede4a5e","modified":1643448599962},{"_id":"source/images/meta2/4.png","hash":"a747f18f540a439daf4f7877801dd03917f25dbd","modified":1643448599951},{"_id":"public/about/index.html","hash":"37283147c0bc8ad73e6b3ff9b3cf043ba804f577","modified":1655541400361},{"_id":"public/speak/index.html","hash":"2089033161637b1155de8872810526aa0c2d5263","modified":1655541400361},{"_id":"public/projects/index.html","hash":"7eb73131f898be10648627546c8391acf266b04c","modified":1655541400361},{"_id":"public/2022/01/31/2022-01-31-put-images-in-the-header/index.html","hash":"4d169856f31360be0e6f47f7f3c9b369c466ee98","modified":1655541400361},{"_id":"public/2020/06/27/2020-06-27-viet-side-project/index.html","hash":"119cbda07d16291438daaa135de5016b52a18171","modified":1655541400361},{"_id":"public/2020/05/13/2020-05-13-linux-process-types-dirty-method/index.html","hash":"67e8a8e39cb10047f8b1c089eb4b5d2d812ab08d","modified":1655541400361},{"_id":"public/2020/05/14/2020-05-14-url-dash-vs-underscore/index.html","hash":"b85906de1a3dbc02721cc9c1fbf275b292d26e49","modified":1655541400361},{"_id":"public/2020/01/11/2020-01-10-method-and-function-notes/index.html","hash":"224170523c2dca3af916d61b2ae99c7d291dba0a","modified":1655541400361},{"_id":"public/2019/12/16/2019-12-16-search-in-array/index.html","hash":"9da4cf53b27d12965d6b1d2b52c11723c35ff312","modified":1655541400361},{"_id":"public/2019/11/12/2019-8-21-hello-hexo/index.html","hash":"5cfc71815688bdf22addb8904bd5a59ffa54c761","modified":1655541400361},{"_id":"public/2019/09/20/2019-09-20-vscode-extension/index.html","hash":"3162c99a36f1739c02b767d6b2297720d02c5324","modified":1655541400361},{"_id":"public/2019/04/10/2019-04-10-iaas-paas-saas/index.html","hash":"22c1f9dc853f531d8888c15b7edb436e79670a54","modified":1655541400361},{"_id":"public/2019/02/22/2019-02-22-quy-luat-80-20/index.html","hash":"c676baadf04b077b285e279ab77f34d503040335","modified":1655541400361},{"_id":"public/archives/2018/index.html","hash":"0406bcf71c9ae15fec81548d7af781899e5bb34a","modified":1655541400361},{"_id":"public/archives/2018/01/index.html","hash":"10a4413c8c8b6b73519e07b04bf8a99086a72e99","modified":1655541400361},{"_id":"public/archives/2018/12/index.html","hash":"79b0b2c0bca574cf6685fde7c754bcaf5bb1e03d","modified":1655541400361},{"_id":"public/archives/2019/index.html","hash":"a86e0b517f41f26cba4141cf9a4228e6f8328371","modified":1655541400361},{"_id":"public/archives/2019/02/index.html","hash":"7c19fef6ae4999c7b2a296aaf05ce3ee976e2e94","modified":1655541400361},{"_id":"public/archives/2019/04/index.html","hash":"5892a6e108c9dfac847c43bec18703216c2a05b2","modified":1655541400361},{"_id":"public/archives/2018/06/index.html","hash":"2e9eb4d5c20d1d383c181b5d6b4095179fdf3422","modified":1655541400361},{"_id":"public/archives/2019/05/index.html","hash":"7112fa21ca14859264573dedf0b4919081f443bf","modified":1655541400361},{"_id":"public/archives/2019/06/index.html","hash":"86f2303351b19a7cc7303a42e535274453137e22","modified":1655541400361},{"_id":"public/archives/2019/08/index.html","hash":"e60a8381e95d4f9a38538c7a1e8f436b21beb742","modified":1655541400361},{"_id":"public/archives/2019/09/index.html","hash":"c9f8dc05cd595aec6ed7c21832b307e2d917ba33","modified":1655541400361},{"_id":"public/archives/2019/11/index.html","hash":"5cc03f2461f80d8843e3a8f3d6244f1c2fb281e9","modified":1655541400361},{"_id":"public/archives/2019/12/index.html","hash":"33e97dc27e95493c67ebfdd0d00a3ee7f6295c51","modified":1655541400361},{"_id":"public/archives/2020/index.html","hash":"3bac4c045cd508ca9586c095672cacc063a183b4","modified":1655541400361},{"_id":"public/archives/2020/02/index.html","hash":"dfa05534bd53c37e39433bb15bc4c7ade358fae6","modified":1655541400361},{"_id":"public/archives/2020/03/index.html","hash":"dd901058c017a703f94af497b2634593f355ed32","modified":1655541400361},{"_id":"public/archives/2020/04/index.html","hash":"470996e8e35fd4e7088209b77b5eaa8717e99f59","modified":1655541400361},{"_id":"public/archives/2020/05/index.html","hash":"611f3b1078c5a4668c9c1b1fce1fe1a00d76f425","modified":1655541400361},{"_id":"public/archives/2020/01/index.html","hash":"21fb551a03e5f082d151a3ca1ce33718b077512d","modified":1655541400361},{"_id":"public/archives/2020/07/index.html","hash":"199cc5b254426efa5e4b8fb4f45f4313fbfd544d","modified":1655541400361},{"_id":"public/archives/2020/06/index.html","hash":"4694443a8abfd724f1b4ab91b7e619d49e72fd1e","modified":1655541400361},{"_id":"public/archives/2022/index.html","hash":"859a2fcad52e846b93215bb69cff91031586fbc0","modified":1655541400361},{"_id":"public/archives/2022/01/index.html","hash":"286731a824723c4bb6fec81435d9bfb8933ca66d","modified":1655541400361},{"_id":"public/archives/2022/06/index.html","hash":"e03f1fb99dad64373fb0063d3126233333f51940","modified":1655541400361},{"_id":"public/tags/UNIX/index.html","hash":"659bf1cb893f508949e677c2b9abeed6ccbb4f69","modified":1655541400361},{"_id":"public/tags/RUBY/index.html","hash":"9865a5c796bcd12bc76d534f8188556c498485d5","modified":1655541400361},{"_id":"public/tags/RAILS/index.html","hash":"878d879a4beb54c28e61d6fbcec75313775165d8","modified":1655541400361},{"_id":"public/tags/random/index.html","hash":"eaacb1ad950c044f0fe4724e158acc743149f98c","modified":1655541400361},{"_id":"public/tags/unix/index.html","hash":"7c9db7ef23b74c9008cd40b0160c311613efc95a","modified":1655541400361},{"_id":"public/tags/ruby/index.html","hash":"9a4e7462c91c951d493f3ba097d3ba486badd642","modified":1655541400361},{"_id":"public/tags/secure/index.html","hash":"9461780d2858e2c2f05f1f5bbf893a9dedcc07f4","modified":1655541400361},{"_id":"public/tags/rails/index.html","hash":"987fa4451354a2714a3116d92469581054ab2026","modified":1655541400361},{"_id":"public/tags/til/index.html","hash":"667571662d59db476a3477c1c365d4c6d31955f9","modified":1655541400361},{"_id":"public/tags/carrierwave/index.html","hash":"497e73d9f266bd1264c7202faa6859b4db748b69","modified":1655541400361},{"_id":"public/tags/aws/index.html","hash":"4c73e4d4439798d7ee8f9e95c761321af51207ac","modified":1655541400361},{"_id":"public/tags/https/index.html","hash":"53a854ebf6c0930af11a37c4ed7e54802eb31feb","modified":1655541400361},{"_id":"public/tags/SOLID/index.html","hash":"878d7addfc123ad20cc87f21bb20c3d7afdb81bd","modified":1655541400361},{"_id":"public/tags/SECURE/index.html","hash":"764072d449bc86cdd9942ff8953b8fad0a127f34","modified":1655541400361},{"_id":"public/tags/ORM/index.html","hash":"bd369f1a6c954c7bc40b4206c3ce946cfbd36c29","modified":1655541400361},{"_id":"public/tags/RACK/index.html","hash":"33a7a3ffad465a14939749298b71827bd214ac7c","modified":1655541400361},{"_id":"public/tags/TIl/index.html","hash":"f0c3212492f5f1d43ca095b99e03fb457b487164","modified":1655541400361},{"_id":"public/tags/TIL/index.html","hash":"68a1b0eca7c0ba2e5ebc73fa48016ef5fb8f2591","modified":1655541400361},{"_id":"public/tags/NOTES/index.html","hash":"4bbe4605090d8828d5bec092ab39211d4dbb2b74","modified":1655541400361},{"_id":"public/tags/JS/index.html","hash":"494fdbababa181f79c6e96837d1407e929203b0f","modified":1655541400361},{"_id":"public/categories/OS/index.html","hash":"1698034d165eb404972c8e7aa7e2099f7f73b6af","modified":1655541400361},{"_id":"public/categories/rails-notes/index.html","hash":"869e106016338d1d4bca5fc242944b1549bf202e","modified":1655541400361},{"_id":"public/categories/ruby-notes/index.html","hash":"4ed25e29cba2f6f4b6f7543a20209aba492d64d5","modified":1655541400361},{"_id":"public/categories/RUBY/index.html","hash":"55727b0d2ed49737514f795cb55c026fe8b6f7e6","modified":1655541400361},{"_id":"public/categories/RAILS/index.html","hash":"a6d6592f60c48f76faaf173bb5683a1815aadfae","modified":1655541400361},{"_id":"public/categories/RUBY/PROGRAMMING/index.html","hash":"1eddafa4b95e0071cd7ac8eaf90e9356d8d938fe","modified":1655541400361},{"_id":"public/categories/TIL/index.html","hash":"7c8f994eeb8163f38af996e3fe9be69665dcbd22","modified":1655541400361},{"_id":"public/categories/til/index.html","hash":"0c9dbf95772c9cc2c1c5534abc7e837be295f7da","modified":1655541400361},{"_id":"public/2022/06/18/2022-02-01-docker-2021/index.html","hash":"a1286647edb5365edf790ae0bbe9c68b44c3002d","modified":1655541400361},{"_id":"public/2020/07/03/2020-07-03-leetcode-track-list/index.html","hash":"611303bdf3d7c33a7d124d5c6a75abefe20303be","modified":1655541400361},{"_id":"public/2020/06/28/2020-06-28-goi-api-tu-fe/index.html","hash":"6c64f3bdbdf14b0c0b82efb8a205b702dad3107e","modified":1655541400361},{"_id":"public/2020/05/17/2020-05-17-lam-mini-app-cho-vo-phan-1/index.html","hash":"3012cc943628f8f792b1edf1e0d47065a0360639","modified":1655541400361},{"_id":"public/2020/05/12/2020-05-12-safe-navigation-operator/index.html","hash":"23854759c27f411afc9b95f4ed6c522d9c47b01c","modified":1655541400361},{"_id":"public/2020/04/23/2020-04-23-handle-exception-in-rails/index.html","hash":"e856187614ffa6beeb85af6f0eb9a48e3c5efe49","modified":1655541400361},{"_id":"public/2020/03/16/2020-03-16-new-project-notes-2/index.html","hash":"a28b3e2837fa5bc55de6278c6c522bea2c9cc582","modified":1655541400361},{"_id":"public/2020/02/05/2020-02-05-the-first-note-in-the-new-luna-year/index.html","hash":"beb202124a3d3ce03dce356585773aec3e7b294a","modified":1655541400361},{"_id":"public/2020/01/10/2020-01-11-this-in-javascript/index.html","hash":"46e2b1d648fe48192c8ebc355128818b8d750ccc","modified":1655541400361},{"_id":"public/2020/01/09/2020-03-8-redux-co-ban/index.html","hash":"4f577e0f33fa4884697561920c4019e62f90bf86","modified":1655541400361},{"_id":"public/2020/01/09/2020-01-09-callback-promise-anyc-await/index.html","hash":"b99ad9581b100b9135ab43e22eb7906cca0bd83b","modified":1655541400361},{"_id":"public/2020/01/05/2020-01-05-sql-performance-explained-notes/index.html","hash":"63929fa964d2c7e429ceb6e1cb00a90b3178a71b","modified":1655541400361},{"_id":"public/2020/01/08/2020-01-08-reactjs-notes/index.html","hash":"ef0b5a2856da58c82d1618b9120c2868347923fa","modified":1655541400361},{"_id":"public/2019/12/28/2019-12-28-clone-object-and-array-in-javascript/index.html","hash":"f8cfa3c7744a8ae91e58ebe584290b3101876c1f","modified":1655541400361},{"_id":"public/2019/12/20/2019-12-20-example-of-two-pointer/index.html","hash":"378f7a2440d43e91bdbc4200fb08feb08519c729","modified":1655541400361},{"_id":"public/2019/12/06/2019-12-06-linked-list-with-ruby/index.html","hash":"ee0d2272cc7be6493ab2fe1f94de780e2cd6aa50","modified":1655541400361},{"_id":"public/2019/12/05/2019-12-05-ruby-argument/index.html","hash":"47c75db0ba683e525bae5c196065fbe8b2b0a356","modified":1655541400361},{"_id":"public/2019/12/01/2019-12-01-basic-bash-file-to-deploy-my-blog/index.html","hash":"6e23b2e0d7c43a184109ad5d14f5e811d0c596ce","modified":1655541400361},{"_id":"public/2019/12/01/2019-12-01-how-to-use-multi-account-with-ssh/index.html","hash":"46a77182886e5e3168a57b8cb4dc701d415526cc","modified":1655541400361},{"_id":"public/2019/12/01/2019-12-01-simple-bst-in-ruby/index.html","hash":"4ed851100f3170fa89b4255d6ede7d54f01890fe","modified":1655541400361},{"_id":"public/2019/09/21/2019-8-10-meta-programming-ruby/index.html","hash":"540c9b4447c68252b1ee02fef52db9ca2092517f","modified":1655541400361},{"_id":"public/2019/09/20/2019-10-30-basic-vim-setup/index.html","hash":"0c03af16d0a5abc2a3b8e6e18434c7e37ca6a6e2","modified":1655541400361},{"_id":"public/2019/08/05/2019-08-05-setup-terminal-macos/index.html","hash":"cb2ea002972197b1c8ab85d4a889633c3f20dd18","modified":1655541400361},{"_id":"public/2019/06/26/2019-06-25-build-a-simple-orm-with-ruby/index.html","hash":"dfa9c70e78b019daa33b6112bbf6ba26791c218c","modified":1655541400361},{"_id":"public/2019/06/24/2019-06-24-simple-rack-application/index.html","hash":"131efe5f0ab76274dc6134111a63259d6ffde03b","modified":1655541400361},{"_id":"public/2019/06/16/2019-06-16-tu-khoa-super-trong-ruby/index.html","hash":"2d057a45e0ef4ab70ea7a3c44e0897685ffe7213","modified":1655541400361},{"_id":"public/2019/06/09/2019-06-09-so-sanh-symbol-va-string-trong-ruby/index.html","hash":"948118fa48d2926706b6d8aecc0e4ee2d49c2ea7","modified":1655541400361},{"_id":"public/2019/06/09/2019-06-09-luu-y-ngan-gon-ve-scope-va-class-method/index.html","hash":"8dad28495289878869dc709aecba37a4dd650484","modified":1655541400361},{"_id":"public/2019/06/08/2019-06-08-tan-cong-sql-injection-va-cach-phong-chong-trong-rails/index.html","hash":"73a7f632722345453f008e10321050127ccf771a","modified":1655541400361},{"_id":"public/2019/05/17/2019-05-17-nguyen-ly-solid-trong-code-ruby/index.html","hash":"8ab5f79c6b179c80b1982747c30899004731625c","modified":1655541400361},{"_id":"public/2019/06/11/2019-06-11-public-private-va-protected-method-trong-ruby/index.html","hash":"c607fb535e319f4974582a0f17a494e814408805","modified":1655541400361},{"_id":"public/2019/06/10/2019-06-10-xu-ly-ngoai-le-trong-rails/index.html","hash":"bc57b76003143d495da782e2f9c8aad0e9704b9c","modified":1655541400361},{"_id":"public/2019/05/15/2019-05-15-require-load-include-va-extend-trong-ruby/index.html","hash":"c751552d39f52f794a9899c0d9cf29e53fc96e4c","modified":1655541400361},{"_id":"public/2019/05/08/2019-05-08-phan-biet-update-update-column-va-update-attribute-trong-rails/index.html","hash":"80cb3537f8deb6ad809837129d6bb4d567ad25d1","modified":1655541400361},{"_id":"public/2019/05/04/2019-05-04-https-vai-dieu-can-nho/index.html","hash":"0bc64491bdc3076792afd2d7e483ba9925b0bfa3","modified":1655541400361},{"_id":"public/2019/04/17/2019-04-17-doi-dieu-ve-session-va-cookie-trong-rails/index.html","hash":"abdf8a2057060b6b37dd26f2563e94567d098b9c","modified":1655541400361},{"_id":"public/2019/04/11/2019-04-11-su-dung-carrierwave-voi-s3/index.html","hash":"03628e80800cff828920f6deb5abd630ecf3eaf4","modified":1655541400361},{"_id":"public/2019/04/17/2019-05-16-autoloading-va-reloading-constants-trong-rails/index.html","hash":"100aad24be0567e6f1a8936b62f6e93cbd0c892d","modified":1655541400361},{"_id":"public/2019/04/10/2019-04-10-upload-file-len-aws-s3-va-nhung-van-de-can-luu-y/index.html","hash":"1de7333b663a49c53839247be2a192b19d870be6","modified":1655541400361},{"_id":"public/2019/02/25/2019-02-25-van-de-n-1-trong-rails/index.html","hash":"df07650491b94ddf3000d02b705a1647a431f647","modified":1655541400361},{"_id":"public/2019/04/08/2019-04-08-immutable-va-mutable-trong-ruby/index.html","hash":"7b72775c39b8a6d8784e1cf4d2e23b8084238170","modified":1655541400361},{"_id":"public/2019/02/24/2019-02-24-ruby-method-lookup/index.html","hash":"53b0d3f90dcc5de5c4accda3152c855495d5b92e","modified":1655541400361},{"_id":"public/2019/02/20/2019-02-20-cac-trinh-thong-dich-trong-ruby/index.html","hash":"bf1f4783d4502989cfc0cca377b5d65f88bd1ca5","modified":1655541400361},{"_id":"public/2019/02/22/2019-02-22-xu-ly-thong-tin-quan-trong-trong-rails/index.html","hash":"ad8b09a2826a7712a1426d67bb11c41f1fb418ed","modified":1655541400361},{"_id":"public/2019/02/05/2019-02-05-root-sudo-and-package-management-system/index.html","hash":"8873e055f4e412585284242340bec6ff8d938e21","modified":1655541400361},{"_id":"public/2019/02/19/2019-02-19-truyen-tham-tri-va-truyen-tham-chieu/index.html","hash":"29a27f54ea95f298d8ea3cec223462d598f80583","modified":1655541400361},{"_id":"public/2018/01/23/2019-01-23-open-command-in-macos/index.html","hash":"9bc2b2846f7c45ee2f42bfbff68bb32a755d8acc","modified":1655541400361},{"_id":"public/2018/01/01/2018-01-01-file-permission-in-linux/index.html","hash":"813ad1fc740196a14b01ec69ab378a31dd850814","modified":1655541400361},{"_id":"public/archives/index.html","hash":"0379ce8dd23d9eac08a540be7361cfdb9124ef71","modified":1655541400361},{"_id":"public/2018/12/30/2019-01-30-bash-file-in-macos-and-linux/index.html","hash":"a67acfd0cd8340fa086c3c258725879607f02a51","modified":1655541400361},{"_id":"public/2018/06/28/2019-01-28-count-vs-length-size-in-ruby-and-ror/index.html","hash":"5f5ed0033ebd84bcdf2b471a860a5adc4e07ad8b","modified":1655541400361},{"_id":"public/index.html","hash":"343d536cfab17c12ec0d0d83c876a8d394836239","modified":1655541400361},{"_id":"public/images/7.gif","hash":"b85ec503cfc4a20438125cfdf351ef1047ee437b","modified":1655541400361},{"_id":"public/images/dip.jpg","hash":"3d4204d18b0b55499ff7e209f955456a90edc8fb","modified":1655541400361},{"_id":"public/images/lsp.jpg","hash":"65e9b6cae517487c256665e96e85d24efc597986","modified":1655541400361},{"_id":"public/images/ocp.jpg","hash":"2cf898d6f4747d7280f5ea94a46baf6070e2a48e","modified":1655541400361},{"_id":"public/images/orm.png","hash":"0c5c1839671d39b0ebe69609cc1849716ad4dfc8","modified":1655541400361},{"_id":"public/images/sexymeo.jpg","hash":"b184f24368abd09d5a11b9cbd612a9de3d0be01b","modified":1655541400361},{"_id":"public/images/question_11.jpg","hash":"e775d41977358490db76fca98876432928b2e076","modified":1655541400361},{"_id":"public/images/solid.png","hash":"85d377189186938860534c3a13ff9b55199ac388","modified":1655541400361},{"_id":"public/images/sshhhh_2.png","hash":"167cf91f4d3e0974fa2dd7cd2e9b4e17f4cf3b42","modified":1655541400361},{"_id":"public/images/sshhhh.png","hash":"289a4480f99d50b04fb0222d3f727c0d400f2567","modified":1655541400361},{"_id":"public/images/vangnau-matngu.jpg","hash":"7d94135737c5df8faccab6474098c4c985d20bd0","modified":1655541400361},{"_id":"public/images/favicon-192x192.png","hash":"4b07282018db1888c7bc707a3e1b576c5684eabb","modified":1655541400361},{"_id":"public/images/apple-touch-icon.png","hash":"bb91acbedda435287809e41148b1b255cdf957dc","modified":1655541400361},{"_id":"public/images/mars.png","hash":"4b33fb4ef0359cb401d4ed6d862caf55fb560802","modified":1655541400361},{"_id":"public/images/earth.png","hash":"2cdcc68e36457410c633a578bb7b30a803193ecb","modified":1655541400361},{"_id":"public/images/favicon.ico","hash":"54972e5dafeb73579b30c17232553c688d702448","modified":1655541400361},{"_id":"public/images/logo.png","hash":"2084e1813f7310d9543a37608f4e6690d600b9c3","modified":1655541400361},{"_id":"public/images/mercury.png","hash":"e5ecda952ae568b8890026c7ab02a175652535a2","modified":1655541400361},{"_id":"public/images/shadow.png","hash":"ec5cfff7997edd1b5e01516604daca7c7a4f3788","modified":1655541400361},{"_id":"public/images/venus.png","hash":"d45968836d952cd017439323135e6fad155c45ae","modified":1655541400361},{"_id":"public/images/hoptra.jpg","hash":"4b0a09ac3695f5ba09f3c92ae5b844c33a45ff9f","modified":1655541400361},{"_id":"public/images/dauto-nongxu.jpg","hash":"7c5d8af8371982a84f2bb69913d32d584fa9331b","modified":1655541400361},{"_id":"public/images/isp.png","hash":"8cb5c14b38c4396246f9202dacc29491936e380d","modified":1655541400361},{"_id":"public/images/ruby-exception.jpg","hash":"a8d929aac3fe8c1472f08ef1fe16081a716d906e","modified":1655541400361},{"_id":"public/images/ssl1.png","hash":"b1ceda2df1849ff840ccad660cdbd6aa984ff3f6","modified":1655541400361},{"_id":"public/images/theconnhinho.jpg","hash":"cbeeeca81e07cc4ff303d4465335a94e6629d7fd","modified":1655541400361},{"_id":"public/images/thanhcong.jpg","hash":"c84daf2145d5aa0d8aefc4d5c608539801f9b4c1","modified":1655541400361},{"_id":"public/images/rack.jpeg","hash":"f6e3a0bd75b58db47ac18d1eeb2b71727a5230e7","modified":1655541400361},{"_id":"public/images/vancon-tamnang.jpg","hash":"777b2b5707e40c1f89d5deb2dc000282ca75bb35","modified":1655541400361},{"_id":"public/images/test/test5.jpg","hash":"49b296698676728c5879ab925b329aacdc191320","modified":1655541400361},{"_id":"public/images/test/test1.jpg","hash":"ce77bb301832f9e196bd6cd3afdde5cd107cc1f0","modified":1655541400361},{"_id":"public/images/test/test2.jpg","hash":"1b4bbcb97591ed371d72ff991bb89ae8b87f1b14","modified":1655541400361},{"_id":"public/images/jupiter.png","hash":"4b7bc03b4cdf2fcde13e982aef340a1d385a3e7d","modified":1655541400361},{"_id":"public/images/sun.png","hash":"62be3d54471271a1e8adb348a3f021ef001b4668","modified":1655541400361},{"_id":"public/lib/font-awesome/fonts/FontAwesome.otf","hash":"1b22f17fdc38070de50e6d1ab3a32da71aa2d819","modified":1655541400361},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"965ce8f688fedbeed504efd498bc9c1622d12362","modified":1655541400361},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"97e438cc545714309882fbceadbf344fcaddcec5","modified":1655541400361},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"6d7e6a5fc802b13694d8820fc0138037c0977d2e","modified":1655541400361},{"_id":"public/js/main.js","hash":"481f730da10e5c9e1d59dfa9f1c0714ae709a0b8","modified":1655541400361},{"_id":"public/lib/justified-gallery/justifiedGallery.min.css","hash":"13fbcba5e97aa88b748d94d3efc4718475279907","modified":1655541400361},{"_id":"public/lib/meslo-LG/styles.css","hash":"eb88d0b9f1bbef99070e9627e2c96d892036bf7e","modified":1655541400361},{"_id":"public/css/style.css","hash":"cb16db544fef2e29bcd67ab1db6b883b481efb98","modified":1655541400361},{"_id":"public/lib/justified-gallery/jquery.justifiedGallery.min.js","hash":"b2683e7a872bc109b1756a65188a37cef7d0bd5c","modified":1655541400361},{"_id":"public/lib/jquery/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1655541400361},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"fb5b49426dee7f1508500e698d1b3c6b04c8fcce","modified":1655541400361},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"4eda182cbcc046dbf449aef97c02c230cf80a494","modified":1655541400361},{"_id":"public/images/file_permission.gif","hash":"7045495d2b775ec3c73765211edb06381d683daa","modified":1655541400361},{"_id":"public/images/thecon.jpg","hash":"272a340a5748fb56151f65386685c6d838386996","modified":1655541400361},{"_id":"public/images/like-query.png","hash":"d2b39a72ee62debfc6e5b33c0d532eeee190c4cf","modified":1655541400361},{"_id":"public/images/meta2/1.png","hash":"2fa2eeecf403fa05a9624e2cb3feb8001ad2dba9","modified":1655541400361},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.ttf","hash":"61d8d967807ef12598d81582fa95b9f600c3ee01","modified":1655541400361},{"_id":"public/images/2-col.png","hash":"2affaf2702f7313e6f5d288f8d977bf246f903eb","modified":1655541400361},{"_id":"public/images/leaf-node.png","hash":"5c140a89277b0d96fcaa314d78ebad8645274e7b","modified":1655541400361},{"_id":"public/images/3sum_2.jpeg","hash":"3ca9dd693e2ca0bc6a34a801383ee347d4d9f138","modified":1655541400361},{"_id":"public/images/date-first.png","hash":"ed69fc53b026dc3615900361b4511f08a1192e50","modified":1655541400361},{"_id":"public/images/thecon-thienthan.jpg","hash":"294c9a5fdb6c86620f535d3bec5ae82f56db9554","modified":1655541400361},{"_id":"public/images/sub-first.png","hash":"fb193a6c105c3cdd487f5d6ccf435a1fc514c115","modified":1655541400361},{"_id":"public/images/vang-con-bi-om.jpeg","hash":"143015d2b0cc68f84dd805969e629f5117dd0068","modified":1655541400361},{"_id":"public/images/vangcon.jpeg","hash":"81d20645ed37382ea561ee93fb99f915879d25c4","modified":1655541400361},{"_id":"public/images/meta2/2.png","hash":"acf16dbf3b15e3941acc63c4cbfc56aa4fb7449d","modified":1655541400361},{"_id":"public/images/Solar.png","hash":"463dbb952527b3d35c6203575eec552f62fd9d8e","modified":1655541400361},{"_id":"public/images/test/test9.jpg","hash":"9b3b6204e11a5a6f525740dd8537ae38644e3063","modified":1655541400361},{"_id":"public/images/b-tree-sql.png","hash":"b615617f48a8fb45bbe1ac33360c73c5123b46b4","modified":1655541400361},{"_id":"public/images/vangcon-doi.jpeg","hash":"2fb39289023811885464b3488aa9a5f1046b87d4","modified":1655541400361},{"_id":"public/images/meta2/5.png","hash":"bb982c8aed9c8e3f81e8d71bd6c2d01b894cafcc","modified":1655541400361},{"_id":"public/images/test/test7.jpg","hash":"8a7e05d349a3dcb07328e0a73647bd0cfb43b99f","modified":1655541400361},{"_id":"public/images/test/test8.jpg","hash":"dc21d4ad8bc3368a9f105f421b3d24947e9584ca","modified":1655541400361},{"_id":"public/images/srp.jpg","hash":"81710dc7159876b7164aa9bd7e77472f55e3a8ea","modified":1655541400361},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.svg","hash":"c0522272bbaef2acb3d341912754d6ea2d0ecfc0","modified":1655541400361},{"_id":"public/images/meta2/3.png","hash":"0bd5f388f8660ab278e5e5b840bad6825e0745a1","modified":1655541400361},{"_id":"public/images/meta2/9.png","hash":"5e4a5eb7f3a8956dc2f215fd5e253965e9ed7d73","modified":1655541400361},{"_id":"public/images/test/test6.jpg","hash":"1acfcdf222b98629a279cfe72eabc8fdf054fc9c","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGM-Italic.ttf","hash":"68700db02debd4b922304134da83b829cbfddfc9","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGL-Italic.ttf","hash":"96c97a0a098ca40802f948ae56fa37aa6683d034","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGS-Italic.ttf","hash":"7f7cdbdcc26279c04046632e22d872f111bc9399","modified":1655541400361},{"_id":"public/images/test/test4.jpg","hash":"6a5d11d06a0c15e1a20daf0fcdc64ecfe018b0ae","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGM-BoldItalic.ttf","hash":"65ddb11e75ee93909e845ab912a36717c48f1c94","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGM-Bold.ttf","hash":"a8a8df3393bccc365335fc5eb0a62a6b7ccd32b9","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGL-Bold.ttf","hash":"bfa1ed9a263ed78462f06d322de13bd5bd0906b2","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGL-Regular.ttf","hash":"2b912dd13f052f645ee19951604610bb350d50af","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGM-Regular.ttf","hash":"5e220152adefe905b2197f873d7cee99eca50e91","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGS-Regular.ttf","hash":"56fa0e33a390b704afc56af93a31576ccdbbdd9e","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGL-BoldItalic.ttf","hash":"a9a431fc7a6c3a67c98021d4035c12a07a4f1070","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGS-Bold.ttf","hash":"df202ce09cbdc70bc16b81983a13ef0f94e46f10","modified":1655541400361},{"_id":"public/lib/meslo-LG/fonts/MesloLGS-BoldItalic.ttf","hash":"d895a1bd25e36c58b7f463ebe14de09f186d5ab4","modified":1655541400361},{"_id":"public/images/meta2/7.png","hash":"b0a9c548892f127bec56bf2921f1e6e81786b186","modified":1655541400361},{"_id":"public/images/test/test3.jpg","hash":"ddaaaeb4fa04a05c83053c1f8149720d18c9c8de","modified":1655541400361},{"_id":"public/images/test/test10.jpg","hash":"df4f4c453b75dbce0d58b730053aef5068e4b3c3","modified":1655541400361},{"_id":"public/images/thecon-tuyetlo.gif","hash":"cab6a80c4530aeb097110a4265f95a2aa08817d8","modified":1655541400361},{"_id":"public/images/meta2/8.png","hash":"9f222f8dadd5976e00ed74dbdefd21debede4a5e","modified":1655541400361},{"_id":"public/images/meta2/4.png","hash":"a747f18f540a439daf4f7877801dd03917f25dbd","modified":1655541400361}],"Category":[{"name":"OS","_id":"cl4jmlsa50003p3m25k1d0bwd"},{"name":"ruby notes","_id":"cl4jmlsaf000np3m24nrshf9b"},{"name":"rails notes","_id":"cl4jmlsaj000up3m2h7hq2bif"},{"name":"RUBY","_id":"cl4jmlsb2001pp3m2e0763hdz"},{"name":"RAILS","_id":"cl4jmlsb60023p3m219lwa81e"},{"name":"PROGRAMMING","parent":"cl4jmlsb2001pp3m2e0763hdz","_id":"cl4jmlsb8002jp3m236853bx0"},{"name":"TIL","_id":"cl4jmlsba002xp3m23se00p4t"},{"name":"til","_id":"cl4jmlsbd003bp3m2hzuzf0ox"}],"Data":[],"Page":[{"title":"about","date":"2019-11-11T03:38:10.000Z","photos":["/../images/thecon.jpg","/../images/dauto-nongxu.jpg","/../images/vangnau-matngu.jpg","/../images/vangcon-doi.jpeg","/../images/vancon-tamnang.jpg","/../images/vang-con-bi-om.jpeg","/../images/theconnhinho.jpg","/../images/thecon-thienthan.jpg","/../images/thecon-tuyetlo.gif"],"_content":"\n> Nhìn mặt tui có giống người có thông tin để giới thiệu không?\n\n<!-- ![dau to nong xu](/../images/dauto-nongxu.jpg)\n\n![vang nau](/../images/vangnau-matngu.jpg)\n\n![vang con doi](/../images/vangcon-doi.jpeg)\n\n![van con tam nang](/../images/vancon-tamnang.jpg)\n\n![van con bi om](/../images/vang-con-bi-om.jpeg)\n\n![the con nhi nho](/../images/theconnhinho.jpg)\n\n![the con thien than](/../images/thecon-thienthan.jpg)\n\n![the con tuyet lo](/../images/thecon-tuyetlo.gif) -->\n","source":"about/index.md","raw":"---\ntitle: about\ndate: 2019-11-11 10:38:10\nphotos:\n- /../images/thecon.jpg\n- /../images/dauto-nongxu.jpg\n- /../images/vangnau-matngu.jpg\n- /../images/vangcon-doi.jpeg\n- /../images/vancon-tamnang.jpg\n- /../images/vang-con-bi-om.jpeg\n- /../images/theconnhinho.jpg\n- /../images/thecon-thienthan.jpg\n- /../images/thecon-tuyetlo.gif\n---\n\n> Nhìn mặt tui có giống người có thông tin để giới thiệu không?\n\n<!-- ![dau to nong xu](/../images/dauto-nongxu.jpg)\n\n![vang nau](/../images/vangnau-matngu.jpg)\n\n![vang con doi](/../images/vangcon-doi.jpeg)\n\n![van con tam nang](/../images/vancon-tamnang.jpg)\n\n![van con bi om](/../images/vang-con-bi-om.jpeg)\n\n![the con nhi nho](/../images/theconnhinho.jpg)\n\n![the con thien than](/../images/thecon-thienthan.jpg)\n\n![the con tuyet lo](/../images/thecon-tuyetlo.gif) -->\n","updated":"2022-02-01T13:05:36.679Z","path":"about/index.html","comments":1,"layout":"page","_id":"cl4jmlsa10001p3m26ir1fkvv","content":"<blockquote>\n<p>Nhìn mặt tui có giống người có thông tin để giới thiệu không?</p>\n</blockquote>\n<!-- ![dau to nong xu](/../images/dauto-nongxu.jpg)\n\n![vang nau](/../images/vangnau-matngu.jpg)\n\n![vang con doi](/../images/vangcon-doi.jpeg)\n\n![van con tam nang](/../images/vancon-tamnang.jpg)\n\n![van con bi om](/../images/vang-con-bi-om.jpeg)\n\n![the con nhi nho](/../images/theconnhinho.jpg)\n\n![the con thien than](/../images/thecon-thienthan.jpg)\n\n![the con tuyet lo](/../images/thecon-tuyetlo.gif) -->\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Nhìn mặt tui có giống người có thông tin để giới thiệu không?</p>\n</blockquote>\n<!-- ![dau to nong xu](/../images/dauto-nongxu.jpg)\n\n![vang nau](/../images/vangnau-matngu.jpg)\n\n![vang con doi](/../images/vangcon-doi.jpeg)\n\n![van con tam nang](/../images/vancon-tamnang.jpg)\n\n![van con bi om](/../images/vang-con-bi-om.jpeg)\n\n![the con nhi nho](/../images/theconnhinho.jpg)\n\n![the con thien than](/../images/thecon-thienthan.jpg)\n\n![the con tuyet lo](/../images/thecon-tuyetlo.gif) -->\n"},{"title":"Speak","date":"2019-11-11T17:00:00.000Z","_content":"\n1. The\n\nĐéo phải *đờ*, đéo phải là *dờ*, đọc là **dờờ** với sau kéo dài.\n\nKhi đọc nhanh thành **dì**\n\n```\nthe other\n\ndì o đờ (dì đọc nhanh)\n```\n\n2. Be\n\n3. To\n\nĐọc là **tu**, nhưng đọc nhanh thành gần như **đờ** quá vl\n\n```\ni go to the beach\n\nAi gâu đờ the bíts (gâu đờ đọc nhanh, không có T u tu đâu cả)\n```\n\n4. Of\n\nđọc nhanh cũng biến tướng nhưu to, không còn **ập** nữa. Ví dụ:\n\n```\ni'm kind of tired\n\nằm, kai đờ tai ờ. (very fast)\n```\n\n5. And\n\n**èn**\n\n6. A\n\n**ờ**\n\n32. An\n\n**ân**\n\n7. In\n\nKhông phải là \"i nờ in IN\" như phát âm tiếng việt mà là phát âm gần giống **ìn**\n\n```\nI fall in love\n\nAi phâu ìn lớp\n```\n\n8. That\n\n**rát**\n\n9. Have\n\n**háp** chớ đéo phải *he vờ*\n\nviết tắt:\n\nI have -> I've\n\nnghe gần tương tự **ỆP**\n\n```\nI've been married\n\nệp bin ma ri\n```\n\n10. I\n\n11. It\n**ịt** gần với địt đó :V, không phải là **ít**\n\n12. For\n\n**pho**, native đọc nhanh thì gần như **phơ**\n\n13. Not\n\n14. On\n\n15. With\n\n16. He\n\nĐọc nhanh hành **di**\n\n```\nwhat does he want?\n\nwhat đơ di want\n```\n\n17. As\n\n18. You\n\n19. Do\n\n20. At\n\n**Át/Ạt** không phải là *ất**\n","source":"speak/index.md","raw":"---\ntitle: Speak\ndate: 2019-11-12\n---\n\n1. The\n\nĐéo phải *đờ*, đéo phải là *dờ*, đọc là **dờờ** với sau kéo dài.\n\nKhi đọc nhanh thành **dì**\n\n```\nthe other\n\ndì o đờ (dì đọc nhanh)\n```\n\n2. Be\n\n3. To\n\nĐọc là **tu**, nhưng đọc nhanh thành gần như **đờ** quá vl\n\n```\ni go to the beach\n\nAi gâu đờ the bíts (gâu đờ đọc nhanh, không có T u tu đâu cả)\n```\n\n4. Of\n\nđọc nhanh cũng biến tướng nhưu to, không còn **ập** nữa. Ví dụ:\n\n```\ni'm kind of tired\n\nằm, kai đờ tai ờ. (very fast)\n```\n\n5. And\n\n**èn**\n\n6. A\n\n**ờ**\n\n32. An\n\n**ân**\n\n7. In\n\nKhông phải là \"i nờ in IN\" như phát âm tiếng việt mà là phát âm gần giống **ìn**\n\n```\nI fall in love\n\nAi phâu ìn lớp\n```\n\n8. That\n\n**rát**\n\n9. Have\n\n**háp** chớ đéo phải *he vờ*\n\nviết tắt:\n\nI have -> I've\n\nnghe gần tương tự **ỆP**\n\n```\nI've been married\n\nệp bin ma ri\n```\n\n10. I\n\n11. It\n**ịt** gần với địt đó :V, không phải là **ít**\n\n12. For\n\n**pho**, native đọc nhanh thì gần như **phơ**\n\n13. Not\n\n14. On\n\n15. With\n\n16. He\n\nĐọc nhanh hành **di**\n\n```\nwhat does he want?\n\nwhat đơ di want\n```\n\n17. As\n\n18. You\n\n19. Do\n\n20. At\n\n**Át/Ạt** không phải là *ất**\n","updated":"2022-01-29T09:29:59.978Z","path":"speak/index.html","comments":1,"layout":"page","_id":"cl4jmlsco005zp3m252bmb8hx","content":"<ol>\n<li>The</li>\n</ol>\n<p>Đéo phải <em>đờ</em>, đéo phải là <em>dờ</em>, đọc là <strong>dờờ</strong> với sau kéo dài.</p>\n<p>Khi đọc nhanh thành <strong>dì</strong></p>\n<figure class=\"highlight gcode\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">the other</span><br><span class=\"line\"></span><br><span class=\"line\">dì o đờ <span class=\"comment\">(dì đọc nhanh)</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>Be</p>\n</li>\n<li><p>To</p>\n</li>\n</ol>\n<p>Đọc là <strong>tu</strong>, nhưng đọc nhanh thành gần như <strong>đờ</strong> quá vl</p>\n<figure class=\"highlight llvm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i go <span class=\"keyword\">to</span> the beach</span><br><span class=\"line\"></span><br><span class=\"line\">Ai gâu đờ the bíts (gâu đờ đọ<span class=\"keyword\">c</span> nhanh, không <span class=\"keyword\">c</span>ó T u tu đâu <span class=\"keyword\">c</span>ả)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>Of</li>\n</ol>\n<p>đọc nhanh cũng biến tướng nhưu to, không còn <strong>ập</strong> nữa. Ví dụ:</p>\n<figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i<span class=\"symbol\">'m</span> kind <span class=\"keyword\">of</span> tired</span><br><span class=\"line\"></span><br><span class=\"line\">ằm, kai đờ tai ờ. (very fast)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>And</li>\n</ol>\n<p><strong>èn</strong></p>\n<ol start=\"6\">\n<li>A</li>\n</ol>\n<p><strong>ờ</strong></p>\n<ol start=\"32\">\n<li>An</li>\n</ol>\n<p><strong>ân</strong></p>\n<ol start=\"7\">\n<li>In</li>\n</ol>\n<p>Không phải là “i nờ in IN” như phát âm tiếng việt mà là phát âm gần giống <strong>ìn</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">I</span> <span class=\"string\">fall in love</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">Ai</span> <span class=\"string\">phâu ìn lớp</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"8\">\n<li>That</li>\n</ol>\n<p><strong>rát</strong></p>\n<ol start=\"9\">\n<li>Have</li>\n</ol>\n<p><strong>háp</strong> chớ đéo phải <em>he vờ</em></p>\n<p>viết tắt:</p>\n<p>I have -&gt; I’ve</p>\n<p>nghe gần tương tự <strong>ỆP</strong></p>\n<figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">I<span class=\"symbol\">'ve</span> been married</span><br><span class=\"line\"></span><br><span class=\"line\">ệp bin ma ri</span><br></pre></td></tr></table></figure>\n\n<ol start=\"10\">\n<li><p>I</p>\n</li>\n<li><p>It</p>\n</li>\n</ol>\n<p><strong>ịt</strong> gần với địt đó :V, không phải là <strong>ít</strong></p>\n<ol start=\"12\">\n<li>For</li>\n</ol>\n<p><strong>pho</strong>, native đọc nhanh thì gần như <strong>phơ</strong></p>\n<ol start=\"13\">\n<li><p>Not</p>\n</li>\n<li><p>On</p>\n</li>\n<li><p>With</p>\n</li>\n<li><p>He</p>\n</li>\n</ol>\n<p>Đọc nhanh hành <strong>di</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">what</span> <span class=\"string\">does he want?</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">what</span> <span class=\"string\">đơ di want</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"17\">\n<li><p>As</p>\n</li>\n<li><p>You</p>\n</li>\n<li><p>Do</p>\n</li>\n<li><p>At</p>\n</li>\n</ol>\n<p><strong>Át/Ạt</strong> không phải là <em>ất*</em></p>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li>The</li>\n</ol>\n<p>Đéo phải <em>đờ</em>, đéo phải là <em>dờ</em>, đọc là <strong>dờờ</strong> với sau kéo dài.</p>\n<p>Khi đọc nhanh thành <strong>dì</strong></p>\n<figure class=\"highlight gcode\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">the other</span><br><span class=\"line\"></span><br><span class=\"line\">dì o đờ <span class=\"comment\">(dì đọc nhanh)</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><p>Be</p>\n</li>\n<li><p>To</p>\n</li>\n</ol>\n<p>Đọc là <strong>tu</strong>, nhưng đọc nhanh thành gần như <strong>đờ</strong> quá vl</p>\n<figure class=\"highlight llvm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i go <span class=\"keyword\">to</span> the beach</span><br><span class=\"line\"></span><br><span class=\"line\">Ai gâu đờ the bíts (gâu đờ đọ<span class=\"keyword\">c</span> nhanh, không <span class=\"keyword\">c</span>ó T u tu đâu <span class=\"keyword\">c</span>ả)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li>Of</li>\n</ol>\n<p>đọc nhanh cũng biến tướng nhưu to, không còn <strong>ập</strong> nữa. Ví dụ:</p>\n<figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">i<span class=\"symbol\">'m</span> kind <span class=\"keyword\">of</span> tired</span><br><span class=\"line\"></span><br><span class=\"line\">ằm, kai đờ tai ờ. (very fast)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"5\">\n<li>And</li>\n</ol>\n<p><strong>èn</strong></p>\n<ol start=\"6\">\n<li>A</li>\n</ol>\n<p><strong>ờ</strong></p>\n<ol start=\"32\">\n<li>An</li>\n</ol>\n<p><strong>ân</strong></p>\n<ol start=\"7\">\n<li>In</li>\n</ol>\n<p>Không phải là “i nờ in IN” như phát âm tiếng việt mà là phát âm gần giống <strong>ìn</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">I</span> <span class=\"string\">fall in love</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">Ai</span> <span class=\"string\">phâu ìn lớp</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"8\">\n<li>That</li>\n</ol>\n<p><strong>rát</strong></p>\n<ol start=\"9\">\n<li>Have</li>\n</ol>\n<p><strong>háp</strong> chớ đéo phải <em>he vờ</em></p>\n<p>viết tắt:</p>\n<p>I have -&gt; I’ve</p>\n<p>nghe gần tương tự <strong>ỆP</strong></p>\n<figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">I<span class=\"symbol\">'ve</span> been married</span><br><span class=\"line\"></span><br><span class=\"line\">ệp bin ma ri</span><br></pre></td></tr></table></figure>\n\n<ol start=\"10\">\n<li><p>I</p>\n</li>\n<li><p>It</p>\n</li>\n</ol>\n<p><strong>ịt</strong> gần với địt đó :V, không phải là <strong>ít</strong></p>\n<ol start=\"12\">\n<li>For</li>\n</ol>\n<p><strong>pho</strong>, native đọc nhanh thì gần như <strong>phơ</strong></p>\n<ol start=\"13\">\n<li><p>Not</p>\n</li>\n<li><p>On</p>\n</li>\n<li><p>With</p>\n</li>\n<li><p>He</p>\n</li>\n</ol>\n<p>Đọc nhanh hành <strong>di</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">what</span> <span class=\"string\">does he want?</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">what</span> <span class=\"string\">đơ di want</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"17\">\n<li><p>As</p>\n</li>\n<li><p>You</p>\n</li>\n<li><p>Do</p>\n</li>\n<li><p>At</p>\n</li>\n</ol>\n<p><strong>Át/Ạt</strong> không phải là <em>ất*</em></p>\n"},{"title":"Projects","date":"2019-11-10T17:00:00.000Z","_content":"\n![the con](/../images/thecon.jpg)\n\n> Nhìn mặt tui có giống người có projects để khoe không?\n","source":"projects/index.md","raw":"---\ntitle: Projects\ndate: 2019-11-11\n---\n\n![the con](/../images/thecon.jpg)\n\n> Nhìn mặt tui có giống người có projects để khoe không?\n","updated":"2022-01-29T09:29:59.978Z","path":"projects/index.html","comments":1,"layout":"page","_id":"cl4jmlscq0060p3m2hmwi8dnw","content":"<p><img src=\"/../images/thecon.jpg\" alt=\"the con\"></p>\n<blockquote>\n<p>Nhìn mặt tui có giống người có projects để khoe không?</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/../images/thecon.jpg\" alt=\"the con\"></p>\n<blockquote>\n<p>Nhìn mặt tui có giống người có projects để khoe không?</p>\n</blockquote>\n"}],"Post":[{"title":"Permission Trong UNIX","date":"2017-12-31T17:00:00.000Z","draft":false,"_content":"\n## 1.File permission là gì?\n\nTương tự như ngôi nhà của bạn, bạn sống cùng gia đình và thi thoảng có những vị khách ghé thăm. Có những vật dụng trong nhà mà bạn chỉ muốn riêng mình bạn có thể sử dụng, cũng có những đồ vật khác, thứ mà chỉ bạn và gia đình được phép sử dụng, và cũng có những đồ vật mà bạn, gia đình và cả những vị khách đều có thể sử dụng.\n\nTài nguyên trong UNIX tương tự như vậy, mọi thứ trong UNIX đều là file. Vậy nên có những file quan trọng chỉ mình bạn có thể xài, cũng có những file mà bạn có thể chia sẻ thêm cho 1 nhóm nào đó. Còn những thứ không quá quan trọng bạn có thể mở cửa cho ai cũng có thể sử dụng.\n\n> Đó là lý do permission cần tồn tại. Cho 1 người được đụng vào thứ mà họ được phép đụng vào. Không hơn, mục tiêu cao cả là vậy.\n\n## 2.Sử dụng là sử dụng thế nào?\n\nHiểu đơn giản như thế này, nhà của bạn, bạn cho tôi vào và cho phép tôi ngồi ghế uống nước xem tivi, nhưng không đồng nghĩa với việc tôi muốn làm gì cái ghế hay cái tivi cũng được. Tôi chỉ có thể sử dụng chứ không được phép thay đổi hay đập phá đồ đạc của bạn.\n\nTrong UNIX có 3 quyền sử dụng:\n\n1. Quyền đọc (read).\n2. Quyền ghi (write).\n3. Quyền thực thi (excute).\n\n## 3.Các loại người dùng.\n\n1. Owner (người sở hữu file đó - người tạo ra file đó).\n2. Group (nhóm sở hữu file).\n3. Other (phần còn lại của hệ thống có thể là guest).\n\n> Ngoài ra trên UNIX thì còn 1 người dùng thứ 4 gọi là root. Đây là người dùng siêu quyền lực và không thể bị ảnh hưởng bởi mấy lệnh phân quyền của bạn\n\nHiểu cơ bản như việc bạn ở nhà của mình và nghĩ bạn có thể làm mọi việc với căn nhà đó mà không ai có thể can thiệp. Tuy nhiên khi mở sổ đỏ ra thì bạn sẽ thấy là bạn chỉ đang có quyền sử dụng đất chứ không phải sở hữu đất. Mọi đất đai đều thuộc quyền sở hữu của nhà nước.\n\nĐây chính là root trong trường hợp này.\n\n> Vì vậy hãy thật cẩn thận khi sử dụng quyền root trên máy tính. Trong trường hợp máy tính, thì chúng ta là chủ sở hữu nên chúng ta có thể enable hay disable root đi. Trên Mac thì mặc định là disable.\n\n## 4.Cách phân quyền\n\n```shell\nchmod xyz file/folder\n```\n\nVí dụ:  **chmod 007 duychinh.bin**\n\nGiải thích câu lệnh trên:\n- xyz là 3 số nguyên liền nhau (giá trị của ba số này có thể là 0,1,2,3,4,5,6,7).\nVới x ứng với quyền phân cho **owner**, y ứng với quyền phân cho **group** và z là cho **everyone**.\n\n**0:** không có quyền gì cả.\n\n**1:** quyền thực thi tập tin.\n\n**2:** quyền write only.\n\n**4:** quyền read only.\n\nThể hiện dưới dạng nhị phận:\n\n- **0:** 0000\n- **1:** 0001\n- **2:** 0010\n- **4:** 0100\n\nVới 4 số trên ta có thể cộng lại và ra 1 số mới với permission được cộng dồn:\n\nVí dụ: 7 = 4 + 2 + 1 => tất cả các quyền. Tính toán tương tự với cả tổ hợp khác.\nSuy ra với lệnh **chmod 777 file_name**:\n- Ta đã gán tất cả quyền cho cả 3 loại user (như liệt kê ở mục 3).\n\nHình ảnh minh hoạ:\n\n![Branching](http://www.macinstruct.com/images/permissions/permissions1.png)\n\nTrong nhiều trường hợp để có thể thực hiện được lệnh set permission kể trên, ta phải thêm câu lệnh **sudo**.\nvào phía trước. Trong các bài tiếp theo sẽ giải thích về ý nghĩa của câu lệnh này.\n\n## 5.Tham khảo\n\n[1] [https://www.guru99.com/file-permissions.html](https://www.guru99.com/file-permissions.html)\n","source":"_posts/2018-01-01-file-permission-in-linux.md","raw":"---\ntitle: \"Permission Trong UNIX\"\ndate: 2018-01-01\ndraft: false\ntags: [\"UNIX\"]\ncategories: [\"OS\"]\n\n---\n\n## 1.File permission là gì?\n\nTương tự như ngôi nhà của bạn, bạn sống cùng gia đình và thi thoảng có những vị khách ghé thăm. Có những vật dụng trong nhà mà bạn chỉ muốn riêng mình bạn có thể sử dụng, cũng có những đồ vật khác, thứ mà chỉ bạn và gia đình được phép sử dụng, và cũng có những đồ vật mà bạn, gia đình và cả những vị khách đều có thể sử dụng.\n\nTài nguyên trong UNIX tương tự như vậy, mọi thứ trong UNIX đều là file. Vậy nên có những file quan trọng chỉ mình bạn có thể xài, cũng có những file mà bạn có thể chia sẻ thêm cho 1 nhóm nào đó. Còn những thứ không quá quan trọng bạn có thể mở cửa cho ai cũng có thể sử dụng.\n\n> Đó là lý do permission cần tồn tại. Cho 1 người được đụng vào thứ mà họ được phép đụng vào. Không hơn, mục tiêu cao cả là vậy.\n\n## 2.Sử dụng là sử dụng thế nào?\n\nHiểu đơn giản như thế này, nhà của bạn, bạn cho tôi vào và cho phép tôi ngồi ghế uống nước xem tivi, nhưng không đồng nghĩa với việc tôi muốn làm gì cái ghế hay cái tivi cũng được. Tôi chỉ có thể sử dụng chứ không được phép thay đổi hay đập phá đồ đạc của bạn.\n\nTrong UNIX có 3 quyền sử dụng:\n\n1. Quyền đọc (read).\n2. Quyền ghi (write).\n3. Quyền thực thi (excute).\n\n## 3.Các loại người dùng.\n\n1. Owner (người sở hữu file đó - người tạo ra file đó).\n2. Group (nhóm sở hữu file).\n3. Other (phần còn lại của hệ thống có thể là guest).\n\n> Ngoài ra trên UNIX thì còn 1 người dùng thứ 4 gọi là root. Đây là người dùng siêu quyền lực và không thể bị ảnh hưởng bởi mấy lệnh phân quyền của bạn\n\nHiểu cơ bản như việc bạn ở nhà của mình và nghĩ bạn có thể làm mọi việc với căn nhà đó mà không ai có thể can thiệp. Tuy nhiên khi mở sổ đỏ ra thì bạn sẽ thấy là bạn chỉ đang có quyền sử dụng đất chứ không phải sở hữu đất. Mọi đất đai đều thuộc quyền sở hữu của nhà nước.\n\nĐây chính là root trong trường hợp này.\n\n> Vì vậy hãy thật cẩn thận khi sử dụng quyền root trên máy tính. Trong trường hợp máy tính, thì chúng ta là chủ sở hữu nên chúng ta có thể enable hay disable root đi. Trên Mac thì mặc định là disable.\n\n## 4.Cách phân quyền\n\n```shell\nchmod xyz file/folder\n```\n\nVí dụ:  **chmod 007 duychinh.bin**\n\nGiải thích câu lệnh trên:\n- xyz là 3 số nguyên liền nhau (giá trị của ba số này có thể là 0,1,2,3,4,5,6,7).\nVới x ứng với quyền phân cho **owner**, y ứng với quyền phân cho **group** và z là cho **everyone**.\n\n**0:** không có quyền gì cả.\n\n**1:** quyền thực thi tập tin.\n\n**2:** quyền write only.\n\n**4:** quyền read only.\n\nThể hiện dưới dạng nhị phận:\n\n- **0:** 0000\n- **1:** 0001\n- **2:** 0010\n- **4:** 0100\n\nVới 4 số trên ta có thể cộng lại và ra 1 số mới với permission được cộng dồn:\n\nVí dụ: 7 = 4 + 2 + 1 => tất cả các quyền. Tính toán tương tự với cả tổ hợp khác.\nSuy ra với lệnh **chmod 777 file_name**:\n- Ta đã gán tất cả quyền cho cả 3 loại user (như liệt kê ở mục 3).\n\nHình ảnh minh hoạ:\n\n![Branching](http://www.macinstruct.com/images/permissions/permissions1.png)\n\nTrong nhiều trường hợp để có thể thực hiện được lệnh set permission kể trên, ta phải thêm câu lệnh **sudo**.\nvào phía trước. Trong các bài tiếp theo sẽ giải thích về ý nghĩa của câu lệnh này.\n\n## 5.Tham khảo\n\n[1] [https://www.guru99.com/file-permissions.html](https://www.guru99.com/file-permissions.html)\n","slug":"2018-01-01-file-permission-in-linux","published":1,"updated":"2022-01-29T09:29:59.925Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmls9t0000p3m29zu12hwq","content":"<h2 id=\"1-File-permission-la-gi\"><a href=\"#1-File-permission-la-gi\" class=\"headerlink\" title=\"1.File permission là gì?\"></a>1.File permission là gì?</h2><p>Tương tự như ngôi nhà của bạn, bạn sống cùng gia đình và thi thoảng có những vị khách ghé thăm. Có những vật dụng trong nhà mà bạn chỉ muốn riêng mình bạn có thể sử dụng, cũng có những đồ vật khác, thứ mà chỉ bạn và gia đình được phép sử dụng, và cũng có những đồ vật mà bạn, gia đình và cả những vị khách đều có thể sử dụng.</p>\n<p>Tài nguyên trong UNIX tương tự như vậy, mọi thứ trong UNIX đều là file. Vậy nên có những file quan trọng chỉ mình bạn có thể xài, cũng có những file mà bạn có thể chia sẻ thêm cho 1 nhóm nào đó. Còn những thứ không quá quan trọng bạn có thể mở cửa cho ai cũng có thể sử dụng.</p>\n<blockquote>\n<p>Đó là lý do permission cần tồn tại. Cho 1 người được đụng vào thứ mà họ được phép đụng vào. Không hơn, mục tiêu cao cả là vậy.</p>\n</blockquote>\n<h2 id=\"2-Su-dung-la-su-dung-the-nao\"><a href=\"#2-Su-dung-la-su-dung-the-nao\" class=\"headerlink\" title=\"2.Sử dụng là sử dụng thế nào?\"></a>2.Sử dụng là sử dụng thế nào?</h2><p>Hiểu đơn giản như thế này, nhà của bạn, bạn cho tôi vào và cho phép tôi ngồi ghế uống nước xem tivi, nhưng không đồng nghĩa với việc tôi muốn làm gì cái ghế hay cái tivi cũng được. Tôi chỉ có thể sử dụng chứ không được phép thay đổi hay đập phá đồ đạc của bạn.</p>\n<p>Trong UNIX có 3 quyền sử dụng:</p>\n<ol>\n<li>Quyền đọc (read).</li>\n<li>Quyền ghi (write).</li>\n<li>Quyền thực thi (excute).</li>\n</ol>\n<h2 id=\"3-Cac-loai-nguoi-dung\"><a href=\"#3-Cac-loai-nguoi-dung\" class=\"headerlink\" title=\"3.Các loại người dùng.\"></a>3.Các loại người dùng.</h2><ol>\n<li>Owner (người sở hữu file đó - người tạo ra file đó).</li>\n<li>Group (nhóm sở hữu file).</li>\n<li>Other (phần còn lại của hệ thống có thể là guest).</li>\n</ol>\n<blockquote>\n<p>Ngoài ra trên UNIX thì còn 1 người dùng thứ 4 gọi là root. Đây là người dùng siêu quyền lực và không thể bị ảnh hưởng bởi mấy lệnh phân quyền của bạn</p>\n</blockquote>\n<p>Hiểu cơ bản như việc bạn ở nhà của mình và nghĩ bạn có thể làm mọi việc với căn nhà đó mà không ai có thể can thiệp. Tuy nhiên khi mở sổ đỏ ra thì bạn sẽ thấy là bạn chỉ đang có quyền sử dụng đất chứ không phải sở hữu đất. Mọi đất đai đều thuộc quyền sở hữu của nhà nước.</p>\n<p>Đây chính là root trong trường hợp này.</p>\n<blockquote>\n<p>Vì vậy hãy thật cẩn thận khi sử dụng quyền root trên máy tính. Trong trường hợp máy tính, thì chúng ta là chủ sở hữu nên chúng ta có thể enable hay disable root đi. Trên Mac thì mặc định là disable.</p>\n</blockquote>\n<h2 id=\"4-Cach-phan-quyen\"><a href=\"#4-Cach-phan-quyen\" class=\"headerlink\" title=\"4.Cách phân quyền\"></a>4.Cách phân quyền</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod xyz file/folder</span><br></pre></td></tr></table></figure>\n\n<p>Ví dụ:  <strong>chmod 007 duychinh.bin</strong></p>\n<p>Giải thích câu lệnh trên:</p>\n<ul>\n<li>xyz là 3 số nguyên liền nhau (giá trị của ba số này có thể là 0,1,2,3,4,5,6,7).<br>Với x ứng với quyền phân cho <strong>owner</strong>, y ứng với quyền phân cho <strong>group</strong> và z là cho <strong>everyone</strong>.</li>\n</ul>\n<p><strong>0:</strong> không có quyền gì cả.</p>\n<p><strong>1:</strong> quyền thực thi tập tin.</p>\n<p><strong>2:</strong> quyền write only.</p>\n<p><strong>4:</strong> quyền read only.</p>\n<p>Thể hiện dưới dạng nhị phận:</p>\n<ul>\n<li><strong>0:</strong> 0000</li>\n<li><strong>1:</strong> 0001</li>\n<li><strong>2:</strong> 0010</li>\n<li><strong>4:</strong> 0100</li>\n</ul>\n<p>Với 4 số trên ta có thể cộng lại và ra 1 số mới với permission được cộng dồn:</p>\n<p>Ví dụ: 7 = 4 + 2 + 1 =&gt; tất cả các quyền. Tính toán tương tự với cả tổ hợp khác.<br>Suy ra với lệnh <strong>chmod 777 file_name</strong>:</p>\n<ul>\n<li>Ta đã gán tất cả quyền cho cả 3 loại user (như liệt kê ở mục 3).</li>\n</ul>\n<p>Hình ảnh minh hoạ:</p>\n<p><img src=\"http://www.macinstruct.com/images/permissions/permissions1.png\" alt=\"Branching\"></p>\n<p>Trong nhiều trường hợp để có thể thực hiện được lệnh set permission kể trên, ta phải thêm câu lệnh <strong>sudo</strong>.<br>vào phía trước. Trong các bài tiếp theo sẽ giải thích về ý nghĩa của câu lệnh này.</p>\n<h2 id=\"5-Tham-khao\"><a href=\"#5-Tham-khao\" class=\"headerlink\" title=\"5.Tham khảo\"></a>5.Tham khảo</h2><p>[1] <a href=\"https://www.guru99.com/file-permissions.html\" target=\"_blank\" rel=\"noopener\">https://www.guru99.com/file-permissions.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-File-permission-la-gi\"><a href=\"#1-File-permission-la-gi\" class=\"headerlink\" title=\"1.File permission là gì?\"></a>1.File permission là gì?</h2><p>Tương tự như ngôi nhà của bạn, bạn sống cùng gia đình và thi thoảng có những vị khách ghé thăm. Có những vật dụng trong nhà mà bạn chỉ muốn riêng mình bạn có thể sử dụng, cũng có những đồ vật khác, thứ mà chỉ bạn và gia đình được phép sử dụng, và cũng có những đồ vật mà bạn, gia đình và cả những vị khách đều có thể sử dụng.</p>\n<p>Tài nguyên trong UNIX tương tự như vậy, mọi thứ trong UNIX đều là file. Vậy nên có những file quan trọng chỉ mình bạn có thể xài, cũng có những file mà bạn có thể chia sẻ thêm cho 1 nhóm nào đó. Còn những thứ không quá quan trọng bạn có thể mở cửa cho ai cũng có thể sử dụng.</p>\n<blockquote>\n<p>Đó là lý do permission cần tồn tại. Cho 1 người được đụng vào thứ mà họ được phép đụng vào. Không hơn, mục tiêu cao cả là vậy.</p>\n</blockquote>\n<h2 id=\"2-Su-dung-la-su-dung-the-nao\"><a href=\"#2-Su-dung-la-su-dung-the-nao\" class=\"headerlink\" title=\"2.Sử dụng là sử dụng thế nào?\"></a>2.Sử dụng là sử dụng thế nào?</h2><p>Hiểu đơn giản như thế này, nhà của bạn, bạn cho tôi vào và cho phép tôi ngồi ghế uống nước xem tivi, nhưng không đồng nghĩa với việc tôi muốn làm gì cái ghế hay cái tivi cũng được. Tôi chỉ có thể sử dụng chứ không được phép thay đổi hay đập phá đồ đạc của bạn.</p>\n<p>Trong UNIX có 3 quyền sử dụng:</p>\n<ol>\n<li>Quyền đọc (read).</li>\n<li>Quyền ghi (write).</li>\n<li>Quyền thực thi (excute).</li>\n</ol>\n<h2 id=\"3-Cac-loai-nguoi-dung\"><a href=\"#3-Cac-loai-nguoi-dung\" class=\"headerlink\" title=\"3.Các loại người dùng.\"></a>3.Các loại người dùng.</h2><ol>\n<li>Owner (người sở hữu file đó - người tạo ra file đó).</li>\n<li>Group (nhóm sở hữu file).</li>\n<li>Other (phần còn lại của hệ thống có thể là guest).</li>\n</ol>\n<blockquote>\n<p>Ngoài ra trên UNIX thì còn 1 người dùng thứ 4 gọi là root. Đây là người dùng siêu quyền lực và không thể bị ảnh hưởng bởi mấy lệnh phân quyền của bạn</p>\n</blockquote>\n<p>Hiểu cơ bản như việc bạn ở nhà của mình và nghĩ bạn có thể làm mọi việc với căn nhà đó mà không ai có thể can thiệp. Tuy nhiên khi mở sổ đỏ ra thì bạn sẽ thấy là bạn chỉ đang có quyền sử dụng đất chứ không phải sở hữu đất. Mọi đất đai đều thuộc quyền sở hữu của nhà nước.</p>\n<p>Đây chính là root trong trường hợp này.</p>\n<blockquote>\n<p>Vì vậy hãy thật cẩn thận khi sử dụng quyền root trên máy tính. Trong trường hợp máy tính, thì chúng ta là chủ sở hữu nên chúng ta có thể enable hay disable root đi. Trên Mac thì mặc định là disable.</p>\n</blockquote>\n<h2 id=\"4-Cach-phan-quyen\"><a href=\"#4-Cach-phan-quyen\" class=\"headerlink\" title=\"4.Cách phân quyền\"></a>4.Cách phân quyền</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod xyz file/folder</span><br></pre></td></tr></table></figure>\n\n<p>Ví dụ:  <strong>chmod 007 duychinh.bin</strong></p>\n<p>Giải thích câu lệnh trên:</p>\n<ul>\n<li>xyz là 3 số nguyên liền nhau (giá trị của ba số này có thể là 0,1,2,3,4,5,6,7).<br>Với x ứng với quyền phân cho <strong>owner</strong>, y ứng với quyền phân cho <strong>group</strong> và z là cho <strong>everyone</strong>.</li>\n</ul>\n<p><strong>0:</strong> không có quyền gì cả.</p>\n<p><strong>1:</strong> quyền thực thi tập tin.</p>\n<p><strong>2:</strong> quyền write only.</p>\n<p><strong>4:</strong> quyền read only.</p>\n<p>Thể hiện dưới dạng nhị phận:</p>\n<ul>\n<li><strong>0:</strong> 0000</li>\n<li><strong>1:</strong> 0001</li>\n<li><strong>2:</strong> 0010</li>\n<li><strong>4:</strong> 0100</li>\n</ul>\n<p>Với 4 số trên ta có thể cộng lại và ra 1 số mới với permission được cộng dồn:</p>\n<p>Ví dụ: 7 = 4 + 2 + 1 =&gt; tất cả các quyền. Tính toán tương tự với cả tổ hợp khác.<br>Suy ra với lệnh <strong>chmod 777 file_name</strong>:</p>\n<ul>\n<li>Ta đã gán tất cả quyền cho cả 3 loại user (như liệt kê ở mục 3).</li>\n</ul>\n<p>Hình ảnh minh hoạ:</p>\n<p><img src=\"http://www.macinstruct.com/images/permissions/permissions1.png\" alt=\"Branching\"></p>\n<p>Trong nhiều trường hợp để có thể thực hiện được lệnh set permission kể trên, ta phải thêm câu lệnh <strong>sudo</strong>.<br>vào phía trước. Trong các bài tiếp theo sẽ giải thích về ý nghĩa của câu lệnh này.</p>\n<h2 id=\"5-Tham-khao\"><a href=\"#5-Tham-khao\" class=\"headerlink\" title=\"5.Tham khảo\"></a>5.Tham khảo</h2><p>[1] <a href=\"https://www.guru99.com/file-permissions.html\" target=\"_blank\" rel=\"noopener\">https://www.guru99.com/file-permissions.html</a></p>\n"},{"title":"Lệnh Open Trên macOS","date":"2018-01-22T17:00:00.000Z","draft":false,"label":"#til","_content":"\n## 1.Folders\n\nNgoài việc có thể mở được thư mục bạn đang làm việc, nó có thể mở được các thư mục khác trong máy tính của bạn chỉ bằng việc bạn cung cấp đường dẫn phía sau câu lệnh open thay vì dấu chấm như chúng ta đã làm ở trên. Bạn cũng có thể mở các thư mục ẩn hay mở nhiều thư mục cùng một lúc.\nDưới đây là một vài ví dụ cho những gì chúng ta đã thảo luận ở trên:\n\n**open ~/**\n\n**open ~/etc ~/desktop ~/documents**\n\n## 2.File\n\nOpen cũng có thể mở tập tin, lại tiếp tục suy nghĩ đơn giản, chúng ta có thể thấy câu lệnh này giống như một cú click chuột double vào file hay folder thì đều có chức năng mở nó lên. Ví dụ:\n\n**open ~/desktop/meo.rb**\n\nNó sẽ mở file meo.rb. Bạn cũng có thể sử dụng điều này với nhiều tệp.\n\n**open ~/desktop/meo.rb ~/desktop/meo.jpg**\n\n## 3.Applications\n\nGiả sử tôi có file meo.rb, bây giờ file đó sẽ được mở mặc định bởi phần mềm Xcode trong máy của tôi. Khi đó, tôi có thể override lại phần mềm mặc định để mở file này bằng câu lệnh sau:\n\n**open -a Sublime ~/desktop/meo.rb**\n\n## 4.URLs\n\nOpen cũng có thể mở các đường dẫn URL với cú pháp đơn giản như sau:\n\n**open https://google.com.vn**\n\nVới câu lệnh này thì đường dẫn bạn cung cấp sẽ được mở bằng trình duyệt mặc định. Bạn cũng có thể sử dụng trình duyệt khác làm trình duyệt mặc định bằng tuỳ chọn –a như sau:\n\n**open -a Firefox https://google.com.vn**\n","source":"_posts/2019-01-23-open-command-in-macos.md","raw":"---\ntitle: \"Lệnh Open Trên macOS\"\ndate: 2018-01-23\ndraft: false\ntags: [\"UNIX\"]\nlabel: \"#til\"\ncategories: [\"OS\"]\n\n---\n\n## 1.Folders\n\nNgoài việc có thể mở được thư mục bạn đang làm việc, nó có thể mở được các thư mục khác trong máy tính của bạn chỉ bằng việc bạn cung cấp đường dẫn phía sau câu lệnh open thay vì dấu chấm như chúng ta đã làm ở trên. Bạn cũng có thể mở các thư mục ẩn hay mở nhiều thư mục cùng một lúc.\nDưới đây là một vài ví dụ cho những gì chúng ta đã thảo luận ở trên:\n\n**open ~/**\n\n**open ~/etc ~/desktop ~/documents**\n\n## 2.File\n\nOpen cũng có thể mở tập tin, lại tiếp tục suy nghĩ đơn giản, chúng ta có thể thấy câu lệnh này giống như một cú click chuột double vào file hay folder thì đều có chức năng mở nó lên. Ví dụ:\n\n**open ~/desktop/meo.rb**\n\nNó sẽ mở file meo.rb. Bạn cũng có thể sử dụng điều này với nhiều tệp.\n\n**open ~/desktop/meo.rb ~/desktop/meo.jpg**\n\n## 3.Applications\n\nGiả sử tôi có file meo.rb, bây giờ file đó sẽ được mở mặc định bởi phần mềm Xcode trong máy của tôi. Khi đó, tôi có thể override lại phần mềm mặc định để mở file này bằng câu lệnh sau:\n\n**open -a Sublime ~/desktop/meo.rb**\n\n## 4.URLs\n\nOpen cũng có thể mở các đường dẫn URL với cú pháp đơn giản như sau:\n\n**open https://google.com.vn**\n\nVới câu lệnh này thì đường dẫn bạn cung cấp sẽ được mở bằng trình duyệt mặc định. Bạn cũng có thể sử dụng trình duyệt khác làm trình duyệt mặc định bằng tuỳ chọn –a như sau:\n\n**open -a Firefox https://google.com.vn**\n","slug":"2019-01-23-open-command-in-macos","published":1,"updated":"2022-01-29T09:29:59.925Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsa20002p3m2dd183ajn","content":"<h2 id=\"1-Folders\"><a href=\"#1-Folders\" class=\"headerlink\" title=\"1.Folders\"></a>1.Folders</h2><p>Ngoài việc có thể mở được thư mục bạn đang làm việc, nó có thể mở được các thư mục khác trong máy tính của bạn chỉ bằng việc bạn cung cấp đường dẫn phía sau câu lệnh open thay vì dấu chấm như chúng ta đã làm ở trên. Bạn cũng có thể mở các thư mục ẩn hay mở nhiều thư mục cùng một lúc.<br>Dưới đây là một vài ví dụ cho những gì chúng ta đã thảo luận ở trên:</p>\n<p><strong>open ~/</strong></p>\n<p><strong>open ~/etc ~/desktop ~/documents</strong></p>\n<h2 id=\"2-File\"><a href=\"#2-File\" class=\"headerlink\" title=\"2.File\"></a>2.File</h2><p>Open cũng có thể mở tập tin, lại tiếp tục suy nghĩ đơn giản, chúng ta có thể thấy câu lệnh này giống như một cú click chuột double vào file hay folder thì đều có chức năng mở nó lên. Ví dụ:</p>\n<p><strong>open ~/desktop/meo.rb</strong></p>\n<p>Nó sẽ mở file meo.rb. Bạn cũng có thể sử dụng điều này với nhiều tệp.</p>\n<p><strong>open ~/desktop/meo.rb ~/desktop/meo.jpg</strong></p>\n<h2 id=\"3-Applications\"><a href=\"#3-Applications\" class=\"headerlink\" title=\"3.Applications\"></a>3.Applications</h2><p>Giả sử tôi có file meo.rb, bây giờ file đó sẽ được mở mặc định bởi phần mềm Xcode trong máy của tôi. Khi đó, tôi có thể override lại phần mềm mặc định để mở file này bằng câu lệnh sau:</p>\n<p><strong>open -a Sublime ~/desktop/meo.rb</strong></p>\n<h2 id=\"4-URLs\"><a href=\"#4-URLs\" class=\"headerlink\" title=\"4.URLs\"></a>4.URLs</h2><p>Open cũng có thể mở các đường dẫn URL với cú pháp đơn giản như sau:</p>\n<p><strong>open <a href=\"https://google.com.vn\" target=\"_blank\" rel=\"noopener\">https://google.com.vn</a></strong></p>\n<p>Với câu lệnh này thì đường dẫn bạn cung cấp sẽ được mở bằng trình duyệt mặc định. Bạn cũng có thể sử dụng trình duyệt khác làm trình duyệt mặc định bằng tuỳ chọn –a như sau:</p>\n<p><strong>open -a Firefox <a href=\"https://google.com.vn\" target=\"_blank\" rel=\"noopener\">https://google.com.vn</a></strong></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Folders\"><a href=\"#1-Folders\" class=\"headerlink\" title=\"1.Folders\"></a>1.Folders</h2><p>Ngoài việc có thể mở được thư mục bạn đang làm việc, nó có thể mở được các thư mục khác trong máy tính của bạn chỉ bằng việc bạn cung cấp đường dẫn phía sau câu lệnh open thay vì dấu chấm như chúng ta đã làm ở trên. Bạn cũng có thể mở các thư mục ẩn hay mở nhiều thư mục cùng một lúc.<br>Dưới đây là một vài ví dụ cho những gì chúng ta đã thảo luận ở trên:</p>\n<p><strong>open ~/</strong></p>\n<p><strong>open ~/etc ~/desktop ~/documents</strong></p>\n<h2 id=\"2-File\"><a href=\"#2-File\" class=\"headerlink\" title=\"2.File\"></a>2.File</h2><p>Open cũng có thể mở tập tin, lại tiếp tục suy nghĩ đơn giản, chúng ta có thể thấy câu lệnh này giống như một cú click chuột double vào file hay folder thì đều có chức năng mở nó lên. Ví dụ:</p>\n<p><strong>open ~/desktop/meo.rb</strong></p>\n<p>Nó sẽ mở file meo.rb. Bạn cũng có thể sử dụng điều này với nhiều tệp.</p>\n<p><strong>open ~/desktop/meo.rb ~/desktop/meo.jpg</strong></p>\n<h2 id=\"3-Applications\"><a href=\"#3-Applications\" class=\"headerlink\" title=\"3.Applications\"></a>3.Applications</h2><p>Giả sử tôi có file meo.rb, bây giờ file đó sẽ được mở mặc định bởi phần mềm Xcode trong máy của tôi. Khi đó, tôi có thể override lại phần mềm mặc định để mở file này bằng câu lệnh sau:</p>\n<p><strong>open -a Sublime ~/desktop/meo.rb</strong></p>\n<h2 id=\"4-URLs\"><a href=\"#4-URLs\" class=\"headerlink\" title=\"4.URLs\"></a>4.URLs</h2><p>Open cũng có thể mở các đường dẫn URL với cú pháp đơn giản như sau:</p>\n<p><strong>open <a href=\"https://google.com.vn\" target=\"_blank\" rel=\"noopener\">https://google.com.vn</a></strong></p>\n<p>Với câu lệnh này thì đường dẫn bạn cung cấp sẽ được mở bằng trình duyệt mặc định. Bạn cũng có thể sử dụng trình duyệt khác làm trình duyệt mặc định bằng tuỳ chọn –a như sau:</p>\n<p><strong>open -a Firefox <a href=\"https://google.com.vn\" target=\"_blank\" rel=\"noopener\">https://google.com.vn</a></strong></p>\n"},{"title":"Bash File Trên UNIX","date":"2018-12-29T17:00:00.000Z","draft":false,"mytag":"OS","_content":"\n## 1.Một số khái niệm cơ bản.\n\n**UNIX** là một hệ điều hành ra đời đã rất lâu, nó là tiền thân của hai nhánh hệ điều hành rất nổi tiếng khác, bản thương mại chính là **macOS** và bản mã nguồn mở chính là **GNU**. Cho đến những năm 90, có một sự kết hợp giữa các phần mềm của **GNU** và phần core của một dự án mã nguồn mở khác tên là **Linux** đã tạo thành một hệ điều hành hoàn chỉnh mang tên là **GNU/Linux**, ngày nay đa số chúng ta chỉ thường gọi tắt là **Linux**\n\nQua đó chúng ta có thể thấy, **Linux** và các hệ điều hành con cháu của **UNIX** có rất nhiều điểm chung.\n\n**Shell**: Đây cũng là một khái niệm quan trọng cần tìm hiểu. Trước khi đi vào chủ đề chính của bài viết, để tìm hiểu một cách sâu sắc về Shell, có lẽ sẽ cần đến một bài viết khác, nên ở đây tôi chỉ mô tả một cách bao quát về nó. **Shell** là phần nằm giữa ứng dụng và phần core của hệ điều hành.\n\nHãy tưởng tượng chúng ta có một chồng sách gồm ba quyển với quyển trên cùng là những ứng dụng đang chạy trên máy tính của bạn vì dụ như word, excel, cuốn ở dưới cùng chính là phần nhân của hệ điều hành. Để các ứng dụng của bạn có thể sử dụng các tài nguyên của máy tính như bộ nhớ, ram, IO... điều tất yếu phải xảy ra đó là ứng dụng của bạn phải giao tiếp được với hệ điều hành.\n\nTuy nhiên, vấn đề gặp phải đó là hệ điều hành chỉ hiểu mã máy, một thứ quá phức tạp để người dùng khi sử dụng ứng dụng có thể thao tác được. Đó là lý do ra đời của “quyển sách” ở giữa mà chúng ta gọi là **Shell**. Nhiệm vụ của nó là gì? Đó là chuyển đổi các lệnh từ “quyển sách” đầu tiên thành các lệnh mà “quyển sách” thứ ba có thể hiểu và thực hiện được (Thông dịch).\n\nVí dụ terminal được xem là một **Shell CLI**, mỗi khi bạn gõ một lệnh bất kỳ trên terminal, nó sẽ chuyển đổi câu lệnh bạn viết thành một câu lệnh khác mà phần nhân hệ điều hành có thể hiểu và thực hiện được.\n\n## 2.Điều gì xảy ra khi bạn gõ một lệnh trên terminal?\n\nĐã bao giờ bạn tự hỏi chuyện gì sẽ xảy ra tiếp theo khi ta gõ một lệnh trong terminal? Ví dụ:\n\n```\nls -a\n```\n\nChúng ta sẽ thường tự an ủi bản thân rằng những câu lệnh đó đã được hệ điều hành lưu lại như một cuốn từ điển để đến khi được gọi chúng sẽ biết tìm câu trả lời ở đâu. Thực tế suy nghĩ trên không hẳn đã sai, mọi thứ trong UNIX đều là file, nếu bạn gõ dòng lệnh:\n\n```\necho $PATH\n```\n\nKết quả bạn nhận được chính là một danh sách các thư mục mà terminal sẽ tìm kiếm câu lệnh bạn gõ theo thứ tự từ trái qua phải. Với một hệ điều hành thuần khiết chưa cài đặt thêm các phần mềm bên ngoài thì **PATH** sẽ có giá trị mặc định như sau:\n\n```\n/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin\n```\n\nCòn trên máy tính của tôi thì PATH lại có giá trị là:\n\n```\n/Users/admin/.rbenv/shims:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin\n```\n\nCó một sự khác biệt nhỏ, ta có thể thấy chuỗi **PATH** trên máy tính của tôi có phần đầu chuỗi được thêm bởi một thư mục .rbenv nào đó. Đây chính là mấu chốt của vấn đề, lý do xuất hiện của phần mở rộng nêu trên đó là tôi đã cài đặt thêm Ruby vào máy tính của mình bằng công cụ rbenv.\n\nHiển nhiên, khi hệ điều hành pure (chưa có cài đặt gì khác các ứng dụng mặc định), thì nó không thể hiểu được câu lệnh **ruby – v**. Việc cài đặt Ruby vào máy tính đồng nghĩa với việc tôi đã tải các file liên quan vào một thư mục nào đó, và để chỉ cho Terminal biết phải vào đâu để tìm kiếm các lệnh liên quan đến Ruby vừa cài đặt, chuỗi **PATH** sẽ được ghi đè bổ sung thêm đường dẫn vào thư mục chứa các file thực thi của Ruby. Từ đây, mỗi khi bạn gõ bất cứ một câu lệnh nào liên quan đến Ruby, terminal sẽ theo chuỗi **PATH** vào từng thư mục để tìm kiếm và thực thi câu lệnh đó.\n\nSuy ra, có một lỗi rất hay xảy ra cho những người mới sử dụng Ruby, đó là họ thêm và xoá Ruby khá thường xuyên dẫn đến đường dẫn (**PATH**) bị sai và Terminal không thể tìm được thư mục có thể thực thi câu lệnh một cách chính xác.\n\nTrong Terminal, bạn có thể nối thêm một thư mục vào chuỗi **PATH** bằng câu lệnh sau:\n\n**export PATH=\"$PATH:new_path\"**\n\n## 3.Một số file quan trọng trên Macos.\n\nKhi quá trình làm việc với terminal nhiều hơn và chúng ta cần cài đặt một số thứ cần thiết trong quá trình làm việc, chúng ta sử dụng các **dot file**. Nội dung của các **dot file** này là các câu lệnh shell script (chức năng của câu lệnh này có thể chúng ta sẽ tìm hiểu sau).\n\nKhi bạn mở một terminal mà nó đòi hỏi bạn phải login (ví dụ như khi bạn truy cập vào một máy tính khác thông qua SSH, bạn cần nhập tên đăng nhập và mật khẩu) thì đó là một **Login Shell**.\nVới trường hợp Login Shell thì **dot file** được load lên là file **.bash_profile** (hay là **.profile** ở trên Ubuntu).\nTrong một trường hợp khác, bạn mở một terminal mà không cần đăng nhập thì **dot file** được load là  **.bashrc**.\n\nNote: Khác với những người anh em khác, terminal trên Macos sẽ chạy **dot file** **.bash_profile** khi bạn mở một cửa sổ mới nên tôi thường đặt những cấu hình cần thiết vào một file duy nhất đó là **.bash_profile**. Tất nhiên, từ **.bash_profile** ta có thể load các **dot file** khác nếu cần thiết (chúng ta sẽ bàn về nó trong tương lai).\n\nThứ tự các **dot file** được khởi chạy trên macOS:\n\n```\n#=> etc/profile\n#=> etc/bashrc\n#=> ~/.bash_profile\n#=> ~/.bash_login (nếu ~/.bash_profile không tồn tại).\n#=> ~/.profile (nếu ~/.bash_profile và ~/.bash_login đều không tồn tại).\n```\n\n## 4.Các file quan trọng trên Linux\n\nNhư đã trình bày ở trên, có một sự giống nhau đáng kể giữa **macOS** và **Linux**. Vì vậy, tôi chỉ có một số điều bổ sung như sau: Trên Linux, thông thường chúng ta sẽ có các **dot file** sau đây:\n\n```\n#=> ~/.bash_login (chạy khi login shell)\n#=> ~/.bashrc (chạy khi không login)\n#=> ~/.bash_logout (chạy khi logout shell)\n#=> ~/bash_history (lịch sử trên shell)\n```\n","source":"_posts/2019-01-30-bash-file-in-macos-and-linux.md","raw":"---\ntitle: \"Bash File Trên UNIX\"\ndate: 2018-12-30\ndraft: false\ntags: [\"UNIX\"]\ncategories: [\"OS\"]\nmytag: \"OS\"\n\n---\n\n## 1.Một số khái niệm cơ bản.\n\n**UNIX** là một hệ điều hành ra đời đã rất lâu, nó là tiền thân của hai nhánh hệ điều hành rất nổi tiếng khác, bản thương mại chính là **macOS** và bản mã nguồn mở chính là **GNU**. Cho đến những năm 90, có một sự kết hợp giữa các phần mềm của **GNU** và phần core của một dự án mã nguồn mở khác tên là **Linux** đã tạo thành một hệ điều hành hoàn chỉnh mang tên là **GNU/Linux**, ngày nay đa số chúng ta chỉ thường gọi tắt là **Linux**\n\nQua đó chúng ta có thể thấy, **Linux** và các hệ điều hành con cháu của **UNIX** có rất nhiều điểm chung.\n\n**Shell**: Đây cũng là một khái niệm quan trọng cần tìm hiểu. Trước khi đi vào chủ đề chính của bài viết, để tìm hiểu một cách sâu sắc về Shell, có lẽ sẽ cần đến một bài viết khác, nên ở đây tôi chỉ mô tả một cách bao quát về nó. **Shell** là phần nằm giữa ứng dụng và phần core của hệ điều hành.\n\nHãy tưởng tượng chúng ta có một chồng sách gồm ba quyển với quyển trên cùng là những ứng dụng đang chạy trên máy tính của bạn vì dụ như word, excel, cuốn ở dưới cùng chính là phần nhân của hệ điều hành. Để các ứng dụng của bạn có thể sử dụng các tài nguyên của máy tính như bộ nhớ, ram, IO... điều tất yếu phải xảy ra đó là ứng dụng của bạn phải giao tiếp được với hệ điều hành.\n\nTuy nhiên, vấn đề gặp phải đó là hệ điều hành chỉ hiểu mã máy, một thứ quá phức tạp để người dùng khi sử dụng ứng dụng có thể thao tác được. Đó là lý do ra đời của “quyển sách” ở giữa mà chúng ta gọi là **Shell**. Nhiệm vụ của nó là gì? Đó là chuyển đổi các lệnh từ “quyển sách” đầu tiên thành các lệnh mà “quyển sách” thứ ba có thể hiểu và thực hiện được (Thông dịch).\n\nVí dụ terminal được xem là một **Shell CLI**, mỗi khi bạn gõ một lệnh bất kỳ trên terminal, nó sẽ chuyển đổi câu lệnh bạn viết thành một câu lệnh khác mà phần nhân hệ điều hành có thể hiểu và thực hiện được.\n\n## 2.Điều gì xảy ra khi bạn gõ một lệnh trên terminal?\n\nĐã bao giờ bạn tự hỏi chuyện gì sẽ xảy ra tiếp theo khi ta gõ một lệnh trong terminal? Ví dụ:\n\n```\nls -a\n```\n\nChúng ta sẽ thường tự an ủi bản thân rằng những câu lệnh đó đã được hệ điều hành lưu lại như một cuốn từ điển để đến khi được gọi chúng sẽ biết tìm câu trả lời ở đâu. Thực tế suy nghĩ trên không hẳn đã sai, mọi thứ trong UNIX đều là file, nếu bạn gõ dòng lệnh:\n\n```\necho $PATH\n```\n\nKết quả bạn nhận được chính là một danh sách các thư mục mà terminal sẽ tìm kiếm câu lệnh bạn gõ theo thứ tự từ trái qua phải. Với một hệ điều hành thuần khiết chưa cài đặt thêm các phần mềm bên ngoài thì **PATH** sẽ có giá trị mặc định như sau:\n\n```\n/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin\n```\n\nCòn trên máy tính của tôi thì PATH lại có giá trị là:\n\n```\n/Users/admin/.rbenv/shims:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin\n```\n\nCó một sự khác biệt nhỏ, ta có thể thấy chuỗi **PATH** trên máy tính của tôi có phần đầu chuỗi được thêm bởi một thư mục .rbenv nào đó. Đây chính là mấu chốt của vấn đề, lý do xuất hiện của phần mở rộng nêu trên đó là tôi đã cài đặt thêm Ruby vào máy tính của mình bằng công cụ rbenv.\n\nHiển nhiên, khi hệ điều hành pure (chưa có cài đặt gì khác các ứng dụng mặc định), thì nó không thể hiểu được câu lệnh **ruby – v**. Việc cài đặt Ruby vào máy tính đồng nghĩa với việc tôi đã tải các file liên quan vào một thư mục nào đó, và để chỉ cho Terminal biết phải vào đâu để tìm kiếm các lệnh liên quan đến Ruby vừa cài đặt, chuỗi **PATH** sẽ được ghi đè bổ sung thêm đường dẫn vào thư mục chứa các file thực thi của Ruby. Từ đây, mỗi khi bạn gõ bất cứ một câu lệnh nào liên quan đến Ruby, terminal sẽ theo chuỗi **PATH** vào từng thư mục để tìm kiếm và thực thi câu lệnh đó.\n\nSuy ra, có một lỗi rất hay xảy ra cho những người mới sử dụng Ruby, đó là họ thêm và xoá Ruby khá thường xuyên dẫn đến đường dẫn (**PATH**) bị sai và Terminal không thể tìm được thư mục có thể thực thi câu lệnh một cách chính xác.\n\nTrong Terminal, bạn có thể nối thêm một thư mục vào chuỗi **PATH** bằng câu lệnh sau:\n\n**export PATH=\"$PATH:new_path\"**\n\n## 3.Một số file quan trọng trên Macos.\n\nKhi quá trình làm việc với terminal nhiều hơn và chúng ta cần cài đặt một số thứ cần thiết trong quá trình làm việc, chúng ta sử dụng các **dot file**. Nội dung của các **dot file** này là các câu lệnh shell script (chức năng của câu lệnh này có thể chúng ta sẽ tìm hiểu sau).\n\nKhi bạn mở một terminal mà nó đòi hỏi bạn phải login (ví dụ như khi bạn truy cập vào một máy tính khác thông qua SSH, bạn cần nhập tên đăng nhập và mật khẩu) thì đó là một **Login Shell**.\nVới trường hợp Login Shell thì **dot file** được load lên là file **.bash_profile** (hay là **.profile** ở trên Ubuntu).\nTrong một trường hợp khác, bạn mở một terminal mà không cần đăng nhập thì **dot file** được load là  **.bashrc**.\n\nNote: Khác với những người anh em khác, terminal trên Macos sẽ chạy **dot file** **.bash_profile** khi bạn mở một cửa sổ mới nên tôi thường đặt những cấu hình cần thiết vào một file duy nhất đó là **.bash_profile**. Tất nhiên, từ **.bash_profile** ta có thể load các **dot file** khác nếu cần thiết (chúng ta sẽ bàn về nó trong tương lai).\n\nThứ tự các **dot file** được khởi chạy trên macOS:\n\n```\n#=> etc/profile\n#=> etc/bashrc\n#=> ~/.bash_profile\n#=> ~/.bash_login (nếu ~/.bash_profile không tồn tại).\n#=> ~/.profile (nếu ~/.bash_profile và ~/.bash_login đều không tồn tại).\n```\n\n## 4.Các file quan trọng trên Linux\n\nNhư đã trình bày ở trên, có một sự giống nhau đáng kể giữa **macOS** và **Linux**. Vì vậy, tôi chỉ có một số điều bổ sung như sau: Trên Linux, thông thường chúng ta sẽ có các **dot file** sau đây:\n\n```\n#=> ~/.bash_login (chạy khi login shell)\n#=> ~/.bashrc (chạy khi không login)\n#=> ~/.bash_logout (chạy khi logout shell)\n#=> ~/bash_history (lịch sử trên shell)\n```\n","slug":"2019-01-30-bash-file-in-macos-and-linux","published":1,"updated":"2022-01-29T09:29:59.925Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsa60005p3m2gcd2eidk","content":"<h2 id=\"1-Mot-so-khai-niem-co-ban\"><a href=\"#1-Mot-so-khai-niem-co-ban\" class=\"headerlink\" title=\"1.Một số khái niệm cơ bản.\"></a>1.Một số khái niệm cơ bản.</h2><p><strong>UNIX</strong> là một hệ điều hành ra đời đã rất lâu, nó là tiền thân của hai nhánh hệ điều hành rất nổi tiếng khác, bản thương mại chính là <strong>macOS</strong> và bản mã nguồn mở chính là <strong>GNU</strong>. Cho đến những năm 90, có một sự kết hợp giữa các phần mềm của <strong>GNU</strong> và phần core của một dự án mã nguồn mở khác tên là <strong>Linux</strong> đã tạo thành một hệ điều hành hoàn chỉnh mang tên là <strong>GNU/Linux</strong>, ngày nay đa số chúng ta chỉ thường gọi tắt là <strong>Linux</strong></p>\n<p>Qua đó chúng ta có thể thấy, <strong>Linux</strong> và các hệ điều hành con cháu của <strong>UNIX</strong> có rất nhiều điểm chung.</p>\n<p><strong>Shell</strong>: Đây cũng là một khái niệm quan trọng cần tìm hiểu. Trước khi đi vào chủ đề chính của bài viết, để tìm hiểu một cách sâu sắc về Shell, có lẽ sẽ cần đến một bài viết khác, nên ở đây tôi chỉ mô tả một cách bao quát về nó. <strong>Shell</strong> là phần nằm giữa ứng dụng và phần core của hệ điều hành.</p>\n<p>Hãy tưởng tượng chúng ta có một chồng sách gồm ba quyển với quyển trên cùng là những ứng dụng đang chạy trên máy tính của bạn vì dụ như word, excel, cuốn ở dưới cùng chính là phần nhân của hệ điều hành. Để các ứng dụng của bạn có thể sử dụng các tài nguyên của máy tính như bộ nhớ, ram, IO… điều tất yếu phải xảy ra đó là ứng dụng của bạn phải giao tiếp được với hệ điều hành.</p>\n<p>Tuy nhiên, vấn đề gặp phải đó là hệ điều hành chỉ hiểu mã máy, một thứ quá phức tạp để người dùng khi sử dụng ứng dụng có thể thao tác được. Đó là lý do ra đời của “quyển sách” ở giữa mà chúng ta gọi là <strong>Shell</strong>. Nhiệm vụ của nó là gì? Đó là chuyển đổi các lệnh từ “quyển sách” đầu tiên thành các lệnh mà “quyển sách” thứ ba có thể hiểu và thực hiện được (Thông dịch).</p>\n<p>Ví dụ terminal được xem là một <strong>Shell CLI</strong>, mỗi khi bạn gõ một lệnh bất kỳ trên terminal, nó sẽ chuyển đổi câu lệnh bạn viết thành một câu lệnh khác mà phần nhân hệ điều hành có thể hiểu và thực hiện được.</p>\n<h2 id=\"2-Dieu-gi-xay-ra-khi-ban-go-mot-lenh-tren-terminal\"><a href=\"#2-Dieu-gi-xay-ra-khi-ban-go-mot-lenh-tren-terminal\" class=\"headerlink\" title=\"2.Điều gì xảy ra khi bạn gõ một lệnh trên terminal?\"></a>2.Điều gì xảy ra khi bạn gõ một lệnh trên terminal?</h2><p>Đã bao giờ bạn tự hỏi chuyện gì sẽ xảy ra tiếp theo khi ta gõ một lệnh trong terminal? Ví dụ:</p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">ls -a</span></span><br></pre></td></tr></table></figure>\n\n<p>Chúng ta sẽ thường tự an ủi bản thân rằng những câu lệnh đó đã được hệ điều hành lưu lại như một cuốn từ điển để đến khi được gọi chúng sẽ biết tìm câu trả lời ở đâu. Thực tế suy nghĩ trên không hẳn đã sai, mọi thứ trong UNIX đều là file, nếu bạn gõ dòng lệnh:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$PATH</span></span><br></pre></td></tr></table></figure>\n\n<p>Kết quả bạn nhận được chính là một danh sách các thư mục mà terminal sẽ tìm kiếm câu lệnh bạn gõ theo thứ tự từ trái qua phải. Với một hệ điều hành thuần khiết chưa cài đặt thêm các phần mềm bên ngoài thì <strong>PATH</strong> sẽ có giá trị mặc định như sau:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/bin:/</span>usr<span class=\"regexp\">/bin:/</span><span class=\"string\">bin:</span><span class=\"regexp\">/usr/</span><span class=\"string\">sbin:</span>/sbin</span><br></pre></td></tr></table></figure>\n\n<p>Còn trên máy tính của tôi thì PATH lại có giá trị là:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"regexp\">/Users/</span>admin<span class=\"regexp\">/.rbenv/</span><span class=\"string\">shims:</span><span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/bin:/</span>usr<span class=\"regexp\">/bin:/</span><span class=\"string\">bin:</span><span class=\"regexp\">/usr/</span><span class=\"string\">sbin:</span>/sbin</span><br></pre></td></tr></table></figure>\n\n<p>Có một sự khác biệt nhỏ, ta có thể thấy chuỗi <strong>PATH</strong> trên máy tính của tôi có phần đầu chuỗi được thêm bởi một thư mục .rbenv nào đó. Đây chính là mấu chốt của vấn đề, lý do xuất hiện của phần mở rộng nêu trên đó là tôi đã cài đặt thêm Ruby vào máy tính của mình bằng công cụ rbenv.</p>\n<p>Hiển nhiên, khi hệ điều hành pure (chưa có cài đặt gì khác các ứng dụng mặc định), thì nó không thể hiểu được câu lệnh <strong>ruby – v</strong>. Việc cài đặt Ruby vào máy tính đồng nghĩa với việc tôi đã tải các file liên quan vào một thư mục nào đó, và để chỉ cho Terminal biết phải vào đâu để tìm kiếm các lệnh liên quan đến Ruby vừa cài đặt, chuỗi <strong>PATH</strong> sẽ được ghi đè bổ sung thêm đường dẫn vào thư mục chứa các file thực thi của Ruby. Từ đây, mỗi khi bạn gõ bất cứ một câu lệnh nào liên quan đến Ruby, terminal sẽ theo chuỗi <strong>PATH</strong> vào từng thư mục để tìm kiếm và thực thi câu lệnh đó.</p>\n<p>Suy ra, có một lỗi rất hay xảy ra cho những người mới sử dụng Ruby, đó là họ thêm và xoá Ruby khá thường xuyên dẫn đến đường dẫn (<strong>PATH</strong>) bị sai và Terminal không thể tìm được thư mục có thể thực thi câu lệnh một cách chính xác.</p>\n<p>Trong Terminal, bạn có thể nối thêm một thư mục vào chuỗi <strong>PATH</strong> bằng câu lệnh sau:</p>\n<p><strong>export PATH=”$PATH:new_path”</strong></p>\n<h2 id=\"3-Mot-so-file-quan-trong-tren-Macos\"><a href=\"#3-Mot-so-file-quan-trong-tren-Macos\" class=\"headerlink\" title=\"3.Một số file quan trọng trên Macos.\"></a>3.Một số file quan trọng trên Macos.</h2><p>Khi quá trình làm việc với terminal nhiều hơn và chúng ta cần cài đặt một số thứ cần thiết trong quá trình làm việc, chúng ta sử dụng các <strong>dot file</strong>. Nội dung của các <strong>dot file</strong> này là các câu lệnh shell script (chức năng của câu lệnh này có thể chúng ta sẽ tìm hiểu sau).</p>\n<p>Khi bạn mở một terminal mà nó đòi hỏi bạn phải login (ví dụ như khi bạn truy cập vào một máy tính khác thông qua SSH, bạn cần nhập tên đăng nhập và mật khẩu) thì đó là một <strong>Login Shell</strong>.<br>Với trường hợp Login Shell thì <strong>dot file</strong> được load lên là file <strong>.bash_profile</strong> (hay là <strong>.profile</strong> ở trên Ubuntu).<br>Trong một trường hợp khác, bạn mở một terminal mà không cần đăng nhập thì <strong>dot file</strong> được load là  <strong>.bashrc</strong>.</p>\n<p>Note: Khác với những người anh em khác, terminal trên Macos sẽ chạy <strong>dot file</strong> <strong>.bash_profile</strong> khi bạn mở một cửa sổ mới nên tôi thường đặt những cấu hình cần thiết vào một file duy nhất đó là <strong>.bash_profile</strong>. Tất nhiên, từ <strong>.bash_profile</strong> ta có thể load các <strong>dot file</strong> khác nếu cần thiết (chúng ta sẽ bàn về nó trong tương lai).</p>\n<p>Thứ tự các <strong>dot file</strong> được khởi chạy trên macOS:</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#=&gt; etc/profile</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; etc/bashrc</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/.bash_profile</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/.bash_login (nếu ~/.bash_profile không tồn tại).</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/.profile (nếu ~/.bash_profile và ~/.bash_login đều không tồn tại).</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Cac-file-quan-trong-tren-Linux\"><a href=\"#4-Cac-file-quan-trong-tren-Linux\" class=\"headerlink\" title=\"4.Các file quan trọng trên Linux\"></a>4.Các file quan trọng trên Linux</h2><p>Như đã trình bày ở trên, có một sự giống nhau đáng kể giữa <strong>macOS</strong> và <strong>Linux</strong>. Vì vậy, tôi chỉ có một số điều bổ sung như sau: Trên Linux, thông thường chúng ta sẽ có các <strong>dot file</strong> sau đây:</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#=&gt; ~/.bash_login (chạy khi login shell)</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/.bashrc (chạy khi không login)</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/.bash_logout (chạy khi logout shell)</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/bash_history (lịch sử trên shell)</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Mot-so-khai-niem-co-ban\"><a href=\"#1-Mot-so-khai-niem-co-ban\" class=\"headerlink\" title=\"1.Một số khái niệm cơ bản.\"></a>1.Một số khái niệm cơ bản.</h2><p><strong>UNIX</strong> là một hệ điều hành ra đời đã rất lâu, nó là tiền thân của hai nhánh hệ điều hành rất nổi tiếng khác, bản thương mại chính là <strong>macOS</strong> và bản mã nguồn mở chính là <strong>GNU</strong>. Cho đến những năm 90, có một sự kết hợp giữa các phần mềm của <strong>GNU</strong> và phần core của một dự án mã nguồn mở khác tên là <strong>Linux</strong> đã tạo thành một hệ điều hành hoàn chỉnh mang tên là <strong>GNU/Linux</strong>, ngày nay đa số chúng ta chỉ thường gọi tắt là <strong>Linux</strong></p>\n<p>Qua đó chúng ta có thể thấy, <strong>Linux</strong> và các hệ điều hành con cháu của <strong>UNIX</strong> có rất nhiều điểm chung.</p>\n<p><strong>Shell</strong>: Đây cũng là một khái niệm quan trọng cần tìm hiểu. Trước khi đi vào chủ đề chính của bài viết, để tìm hiểu một cách sâu sắc về Shell, có lẽ sẽ cần đến một bài viết khác, nên ở đây tôi chỉ mô tả một cách bao quát về nó. <strong>Shell</strong> là phần nằm giữa ứng dụng và phần core của hệ điều hành.</p>\n<p>Hãy tưởng tượng chúng ta có một chồng sách gồm ba quyển với quyển trên cùng là những ứng dụng đang chạy trên máy tính của bạn vì dụ như word, excel, cuốn ở dưới cùng chính là phần nhân của hệ điều hành. Để các ứng dụng của bạn có thể sử dụng các tài nguyên của máy tính như bộ nhớ, ram, IO… điều tất yếu phải xảy ra đó là ứng dụng của bạn phải giao tiếp được với hệ điều hành.</p>\n<p>Tuy nhiên, vấn đề gặp phải đó là hệ điều hành chỉ hiểu mã máy, một thứ quá phức tạp để người dùng khi sử dụng ứng dụng có thể thao tác được. Đó là lý do ra đời của “quyển sách” ở giữa mà chúng ta gọi là <strong>Shell</strong>. Nhiệm vụ của nó là gì? Đó là chuyển đổi các lệnh từ “quyển sách” đầu tiên thành các lệnh mà “quyển sách” thứ ba có thể hiểu và thực hiện được (Thông dịch).</p>\n<p>Ví dụ terminal được xem là một <strong>Shell CLI</strong>, mỗi khi bạn gõ một lệnh bất kỳ trên terminal, nó sẽ chuyển đổi câu lệnh bạn viết thành một câu lệnh khác mà phần nhân hệ điều hành có thể hiểu và thực hiện được.</p>\n<h2 id=\"2-Dieu-gi-xay-ra-khi-ban-go-mot-lenh-tren-terminal\"><a href=\"#2-Dieu-gi-xay-ra-khi-ban-go-mot-lenh-tren-terminal\" class=\"headerlink\" title=\"2.Điều gì xảy ra khi bạn gõ một lệnh trên terminal?\"></a>2.Điều gì xảy ra khi bạn gõ một lệnh trên terminal?</h2><p>Đã bao giờ bạn tự hỏi chuyện gì sẽ xảy ra tiếp theo khi ta gõ một lệnh trong terminal? Ví dụ:</p>\n<figure class=\"highlight ebnf\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">ls -a</span></span><br></pre></td></tr></table></figure>\n\n<p>Chúng ta sẽ thường tự an ủi bản thân rằng những câu lệnh đó đã được hệ điều hành lưu lại như một cuốn từ điển để đến khi được gọi chúng sẽ biết tìm câu trả lời ở đâu. Thực tế suy nghĩ trên không hẳn đã sai, mọi thứ trong UNIX đều là file, nếu bạn gõ dòng lệnh:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"variable\">$PATH</span></span><br></pre></td></tr></table></figure>\n\n<p>Kết quả bạn nhận được chính là một danh sách các thư mục mà terminal sẽ tìm kiếm câu lệnh bạn gõ theo thứ tự từ trái qua phải. Với một hệ điều hành thuần khiết chưa cài đặt thêm các phần mềm bên ngoài thì <strong>PATH</strong> sẽ có giá trị mặc định như sau:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/bin:/</span>usr<span class=\"regexp\">/bin:/</span><span class=\"string\">bin:</span><span class=\"regexp\">/usr/</span><span class=\"string\">sbin:</span>/sbin</span><br></pre></td></tr></table></figure>\n\n<p>Còn trên máy tính của tôi thì PATH lại có giá trị là:</p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"regexp\">/Users/</span>admin<span class=\"regexp\">/.rbenv/</span><span class=\"string\">shims:</span><span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/bin:/</span>usr<span class=\"regexp\">/bin:/</span><span class=\"string\">bin:</span><span class=\"regexp\">/usr/</span><span class=\"string\">sbin:</span>/sbin</span><br></pre></td></tr></table></figure>\n\n<p>Có một sự khác biệt nhỏ, ta có thể thấy chuỗi <strong>PATH</strong> trên máy tính của tôi có phần đầu chuỗi được thêm bởi một thư mục .rbenv nào đó. Đây chính là mấu chốt của vấn đề, lý do xuất hiện của phần mở rộng nêu trên đó là tôi đã cài đặt thêm Ruby vào máy tính của mình bằng công cụ rbenv.</p>\n<p>Hiển nhiên, khi hệ điều hành pure (chưa có cài đặt gì khác các ứng dụng mặc định), thì nó không thể hiểu được câu lệnh <strong>ruby – v</strong>. Việc cài đặt Ruby vào máy tính đồng nghĩa với việc tôi đã tải các file liên quan vào một thư mục nào đó, và để chỉ cho Terminal biết phải vào đâu để tìm kiếm các lệnh liên quan đến Ruby vừa cài đặt, chuỗi <strong>PATH</strong> sẽ được ghi đè bổ sung thêm đường dẫn vào thư mục chứa các file thực thi của Ruby. Từ đây, mỗi khi bạn gõ bất cứ một câu lệnh nào liên quan đến Ruby, terminal sẽ theo chuỗi <strong>PATH</strong> vào từng thư mục để tìm kiếm và thực thi câu lệnh đó.</p>\n<p>Suy ra, có một lỗi rất hay xảy ra cho những người mới sử dụng Ruby, đó là họ thêm và xoá Ruby khá thường xuyên dẫn đến đường dẫn (<strong>PATH</strong>) bị sai và Terminal không thể tìm được thư mục có thể thực thi câu lệnh một cách chính xác.</p>\n<p>Trong Terminal, bạn có thể nối thêm một thư mục vào chuỗi <strong>PATH</strong> bằng câu lệnh sau:</p>\n<p><strong>export PATH=”$PATH:new_path”</strong></p>\n<h2 id=\"3-Mot-so-file-quan-trong-tren-Macos\"><a href=\"#3-Mot-so-file-quan-trong-tren-Macos\" class=\"headerlink\" title=\"3.Một số file quan trọng trên Macos.\"></a>3.Một số file quan trọng trên Macos.</h2><p>Khi quá trình làm việc với terminal nhiều hơn và chúng ta cần cài đặt một số thứ cần thiết trong quá trình làm việc, chúng ta sử dụng các <strong>dot file</strong>. Nội dung của các <strong>dot file</strong> này là các câu lệnh shell script (chức năng của câu lệnh này có thể chúng ta sẽ tìm hiểu sau).</p>\n<p>Khi bạn mở một terminal mà nó đòi hỏi bạn phải login (ví dụ như khi bạn truy cập vào một máy tính khác thông qua SSH, bạn cần nhập tên đăng nhập và mật khẩu) thì đó là một <strong>Login Shell</strong>.<br>Với trường hợp Login Shell thì <strong>dot file</strong> được load lên là file <strong>.bash_profile</strong> (hay là <strong>.profile</strong> ở trên Ubuntu).<br>Trong một trường hợp khác, bạn mở một terminal mà không cần đăng nhập thì <strong>dot file</strong> được load là  <strong>.bashrc</strong>.</p>\n<p>Note: Khác với những người anh em khác, terminal trên Macos sẽ chạy <strong>dot file</strong> <strong>.bash_profile</strong> khi bạn mở một cửa sổ mới nên tôi thường đặt những cấu hình cần thiết vào một file duy nhất đó là <strong>.bash_profile</strong>. Tất nhiên, từ <strong>.bash_profile</strong> ta có thể load các <strong>dot file</strong> khác nếu cần thiết (chúng ta sẽ bàn về nó trong tương lai).</p>\n<p>Thứ tự các <strong>dot file</strong> được khởi chạy trên macOS:</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#=&gt; etc/profile</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; etc/bashrc</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/.bash_profile</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/.bash_login (nếu ~/.bash_profile không tồn tại).</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/.profile (nếu ~/.bash_profile và ~/.bash_login đều không tồn tại).</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Cac-file-quan-trong-tren-Linux\"><a href=\"#4-Cac-file-quan-trong-tren-Linux\" class=\"headerlink\" title=\"4.Các file quan trọng trên Linux\"></a>4.Các file quan trọng trên Linux</h2><p>Như đã trình bày ở trên, có một sự giống nhau đáng kể giữa <strong>macOS</strong> và <strong>Linux</strong>. Vì vậy, tôi chỉ có một số điều bổ sung như sau: Trên Linux, thông thường chúng ta sẽ có các <strong>dot file</strong> sau đây:</p>\n<figure class=\"highlight vala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#=&gt; ~/.bash_login (chạy khi login shell)</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/.bashrc (chạy khi không login)</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/.bash_logout (chạy khi logout shell)</span></span><br><span class=\"line\"><span class=\"meta\">#=&gt; ~/bash_history (lịch sử trên shell)</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Length, Count Và Size","date":"2018-06-27T17:00:00.000Z","_content":"\n## 1.Tổng quan\n\nVề cơ bản, đây là ba phương thức được Ruby cung cấp, và dĩ nhiên, nó hoàn toàn có thể sử dụng trong rails. Một cách thường xuyên nhất, bạn có thể thấy người ta sử dụng những phương thức này cho một mảng dữ liệu bất kì trong Ruby hay một mảng record trong Rails. Ý nghĩa của nó là trả về kích thước của mảng/hash. Ví dụ:\n\n```ruby\narray = Array.new(3,1)\n#=> Tạo 1 mảng tên array có 3 phần tử đều có giá trị là 1.\narray.size, array.length, array.count\n#=> Kết quả trả về cùng là 3.\n```\n\nNhưng mọi chuyện không dừng lại ở đấy, nếu chúng chỉ cùng có chung một chức năng thì không có lý do gì để chúng cùng tồn tại.\n\n## 2.Trong ruby\n\nNgoài chức năng tính kích thước của một mảng hay một hash như đã được đề cập ở trên, Size có thể được sử dụng với cả đối tượng dạng chuỗi và dạng số nguyên.\nVới chuỗi, Size sẽ trả về kết quả là số lượng ký tự của chuỗi. Còn với số nguyên, nó sẽ trả về số bite mà đối tượng đó nắm giữ trên bộ nhớ. Ví dụ:\n\n```ruby\nstr_temp = \"hduychinh\"\nstr_temp.size\n#=> Kết quả trả về độ dài chuỗi là 9.\nint_temp = 12\nint_temp.size\n#=> Kết quả trả về là 8, ứng với 8 bytes mà int_temp lưu trữ trên bộ nhớ.\n```\n\nLength kém hơn size một chút, Length chỉ có thể sử dụng thêm cho các đối tượng dạng chuỗi để trả về số lượng ký tự trong chuỗi, mà không thể sử dụng trên số nguyên.\n\nCuối cùng là Count, nó không có chức năng gì bổ sung so với phần đã đề cập. Tuy nhiên, một điểm mạnh của Count đó là khi sử dụng với mảng/hash thì nó có thể nhận tham số chuyển vào. Ví dụ:\n\n```ruby\nc = [1, 2, 3, 3]\nc.count 3\n#=> Kết quả trả về là 2.\nc.count { |i| i > 1 }\n#=> Kết quả trả về là 3.\n```\n\n## 3.Trong Active Record\n\nKhi sử dụng Count thực chất là bạn đang sử dụng lệnh sql **select count(*) from table_names** để truy vấn ra số lượng mà chúng ta đang cần tìm hiểu. Thứ hai, Count không được lưu trữ lại, điều đó có nghĩa mỗi lần bạn chạy hàm Count thì nó sẽ truy vấn vào cơ sở dữ liệu mà không hề quan tâm là bạn có gọi lệnh Count trước đó hay không. Thứ ba, Count là lệnh duy nhất trong ba lệnh trên có thể gọi trực tiếp thông qua một model class, ví dụ như: **Cat.count**.\n\nKhi sử dụng Length, điều đầu tiên đó là load toàn bộ record mà bạn đang định đếm số lượng vào bộ nhớ rồi tính toán. Từ lần gọi thứ hai, nó sẽ lấy lại kết quả cũ chứ không load dữ liệu lên nữa. Đây thực sự là một điều tồi tệ nếu bạn có một cơ sở dữ liệu lớn, nó có thể load hàng triệu record vào bộ nhớ.\n\n```ruby\nCat.all.length\n#=> Cat Load (0.2ms)  SELECT \"cats\".* FROM \"cats\"\n```\n\nKhi sử dụng Size, điều đầu tiên của nó là tìm xem kết quả của truy vấn đã có trong bộ nhớ hay chưa, nếu có rồi thì nó sẽ lấy ra và sử dụng, còn nếu chưa có, nó sẽ sử dụng một câu truy vấn SQL vào cơ sở dữ liệu để đếm số lượng. Điều này thật sự tuyệt vời, như một sự kết hợp giữa length và count.\n","source":"_posts/2019-01-28-count-vs-length-size-in-ruby-and-ror.md","raw":"---\ntitle: \"Length, Count Và Size\"\ndate: 2018-06-28\n# draft: false\ntags: [\"RUBY\", \"RAILS\"]\n# categories: [\"ruby notes\"]\n\n---\n\n## 1.Tổng quan\n\nVề cơ bản, đây là ba phương thức được Ruby cung cấp, và dĩ nhiên, nó hoàn toàn có thể sử dụng trong rails. Một cách thường xuyên nhất, bạn có thể thấy người ta sử dụng những phương thức này cho một mảng dữ liệu bất kì trong Ruby hay một mảng record trong Rails. Ý nghĩa của nó là trả về kích thước của mảng/hash. Ví dụ:\n\n```ruby\narray = Array.new(3,1)\n#=> Tạo 1 mảng tên array có 3 phần tử đều có giá trị là 1.\narray.size, array.length, array.count\n#=> Kết quả trả về cùng là 3.\n```\n\nNhưng mọi chuyện không dừng lại ở đấy, nếu chúng chỉ cùng có chung một chức năng thì không có lý do gì để chúng cùng tồn tại.\n\n## 2.Trong ruby\n\nNgoài chức năng tính kích thước của một mảng hay một hash như đã được đề cập ở trên, Size có thể được sử dụng với cả đối tượng dạng chuỗi và dạng số nguyên.\nVới chuỗi, Size sẽ trả về kết quả là số lượng ký tự của chuỗi. Còn với số nguyên, nó sẽ trả về số bite mà đối tượng đó nắm giữ trên bộ nhớ. Ví dụ:\n\n```ruby\nstr_temp = \"hduychinh\"\nstr_temp.size\n#=> Kết quả trả về độ dài chuỗi là 9.\nint_temp = 12\nint_temp.size\n#=> Kết quả trả về là 8, ứng với 8 bytes mà int_temp lưu trữ trên bộ nhớ.\n```\n\nLength kém hơn size một chút, Length chỉ có thể sử dụng thêm cho các đối tượng dạng chuỗi để trả về số lượng ký tự trong chuỗi, mà không thể sử dụng trên số nguyên.\n\nCuối cùng là Count, nó không có chức năng gì bổ sung so với phần đã đề cập. Tuy nhiên, một điểm mạnh của Count đó là khi sử dụng với mảng/hash thì nó có thể nhận tham số chuyển vào. Ví dụ:\n\n```ruby\nc = [1, 2, 3, 3]\nc.count 3\n#=> Kết quả trả về là 2.\nc.count { |i| i > 1 }\n#=> Kết quả trả về là 3.\n```\n\n## 3.Trong Active Record\n\nKhi sử dụng Count thực chất là bạn đang sử dụng lệnh sql **select count(*) from table_names** để truy vấn ra số lượng mà chúng ta đang cần tìm hiểu. Thứ hai, Count không được lưu trữ lại, điều đó có nghĩa mỗi lần bạn chạy hàm Count thì nó sẽ truy vấn vào cơ sở dữ liệu mà không hề quan tâm là bạn có gọi lệnh Count trước đó hay không. Thứ ba, Count là lệnh duy nhất trong ba lệnh trên có thể gọi trực tiếp thông qua một model class, ví dụ như: **Cat.count**.\n\nKhi sử dụng Length, điều đầu tiên đó là load toàn bộ record mà bạn đang định đếm số lượng vào bộ nhớ rồi tính toán. Từ lần gọi thứ hai, nó sẽ lấy lại kết quả cũ chứ không load dữ liệu lên nữa. Đây thực sự là một điều tồi tệ nếu bạn có một cơ sở dữ liệu lớn, nó có thể load hàng triệu record vào bộ nhớ.\n\n```ruby\nCat.all.length\n#=> Cat Load (0.2ms)  SELECT \"cats\".* FROM \"cats\"\n```\n\nKhi sử dụng Size, điều đầu tiên của nó là tìm xem kết quả của truy vấn đã có trong bộ nhớ hay chưa, nếu có rồi thì nó sẽ lấy ra và sử dụng, còn nếu chưa có, nó sẽ sử dụng một câu truy vấn SQL vào cơ sở dữ liệu để đếm số lượng. Điều này thật sự tuyệt vời, như một sự kết hợp giữa length và count.\n","slug":"2019-01-28-count-vs-length-size-in-ruby-and-ror","published":1,"updated":"2022-01-29T09:29:59.925Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsa70006p3m21i8zbbmd","content":"<h2 id=\"1-Tong-quan\"><a href=\"#1-Tong-quan\" class=\"headerlink\" title=\"1.Tổng quan\"></a>1.Tổng quan</h2><p>Về cơ bản, đây là ba phương thức được Ruby cung cấp, và dĩ nhiên, nó hoàn toàn có thể sử dụng trong rails. Một cách thường xuyên nhất, bạn có thể thấy người ta sử dụng những phương thức này cho một mảng dữ liệu bất kì trong Ruby hay một mảng record trong Rails. Ý nghĩa của nó là trả về kích thước của mảng/hash. Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">array = Array.new(<span class=\"number\">3</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Tạo 1 mảng tên array có 3 phần tử đều có giá trị là 1.</span></span><br><span class=\"line\">array.size, array.length, array.count</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Kết quả trả về cùng là 3.</span></span><br></pre></td></tr></table></figure>\n\n<p>Nhưng mọi chuyện không dừng lại ở đấy, nếu chúng chỉ cùng có chung một chức năng thì không có lý do gì để chúng cùng tồn tại.</p>\n<h2 id=\"2-Trong-ruby\"><a href=\"#2-Trong-ruby\" class=\"headerlink\" title=\"2.Trong ruby\"></a>2.Trong ruby</h2><p>Ngoài chức năng tính kích thước của một mảng hay một hash như đã được đề cập ở trên, Size có thể được sử dụng với cả đối tượng dạng chuỗi và dạng số nguyên.<br>Với chuỗi, Size sẽ trả về kết quả là số lượng ký tự của chuỗi. Còn với số nguyên, nó sẽ trả về số bite mà đối tượng đó nắm giữ trên bộ nhớ. Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str_temp = <span class=\"string\">\"hduychinh\"</span></span><br><span class=\"line\">str_temp.size</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Kết quả trả về độ dài chuỗi là 9.</span></span><br><span class=\"line\">int_temp = <span class=\"number\">12</span></span><br><span class=\"line\">int_temp.size</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Kết quả trả về là 8, ứng với 8 bytes mà int_temp lưu trữ trên bộ nhớ.</span></span><br></pre></td></tr></table></figure>\n\n<p>Length kém hơn size một chút, Length chỉ có thể sử dụng thêm cho các đối tượng dạng chuỗi để trả về số lượng ký tự trong chuỗi, mà không thể sử dụng trên số nguyên.</p>\n<p>Cuối cùng là Count, nó không có chức năng gì bổ sung so với phần đã đề cập. Tuy nhiên, một điểm mạnh của Count đó là khi sử dụng với mảng/hash thì nó có thể nhận tham số chuyển vào. Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">c = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">c.count <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Kết quả trả về là 2.</span></span><br><span class=\"line\">c.count &#123; <span class=\"params\">|i|</span> i &gt; <span class=\"number\">1</span> &#125;</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Kết quả trả về là 3.</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-Trong-Active-Record\"><a href=\"#3-Trong-Active-Record\" class=\"headerlink\" title=\"3.Trong Active Record\"></a>3.Trong Active Record</h2><p>Khi sử dụng Count thực chất là bạn đang sử dụng lệnh sql <strong>select count(*) from table_names</strong> để truy vấn ra số lượng mà chúng ta đang cần tìm hiểu. Thứ hai, Count không được lưu trữ lại, điều đó có nghĩa mỗi lần bạn chạy hàm Count thì nó sẽ truy vấn vào cơ sở dữ liệu mà không hề quan tâm là bạn có gọi lệnh Count trước đó hay không. Thứ ba, Count là lệnh duy nhất trong ba lệnh trên có thể gọi trực tiếp thông qua một model class, ví dụ như: <strong>Cat.count</strong>.</p>\n<p>Khi sử dụng Length, điều đầu tiên đó là load toàn bộ record mà bạn đang định đếm số lượng vào bộ nhớ rồi tính toán. Từ lần gọi thứ hai, nó sẽ lấy lại kết quả cũ chứ không load dữ liệu lên nữa. Đây thực sự là một điều tồi tệ nếu bạn có một cơ sở dữ liệu lớn, nó có thể load hàng triệu record vào bộ nhớ.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cat.all.length</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Cat Load (0.2ms)  SELECT \"cats\".* FROM \"cats\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Khi sử dụng Size, điều đầu tiên của nó là tìm xem kết quả của truy vấn đã có trong bộ nhớ hay chưa, nếu có rồi thì nó sẽ lấy ra và sử dụng, còn nếu chưa có, nó sẽ sử dụng một câu truy vấn SQL vào cơ sở dữ liệu để đếm số lượng. Điều này thật sự tuyệt vời, như một sự kết hợp giữa length và count.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Tong-quan\"><a href=\"#1-Tong-quan\" class=\"headerlink\" title=\"1.Tổng quan\"></a>1.Tổng quan</h2><p>Về cơ bản, đây là ba phương thức được Ruby cung cấp, và dĩ nhiên, nó hoàn toàn có thể sử dụng trong rails. Một cách thường xuyên nhất, bạn có thể thấy người ta sử dụng những phương thức này cho một mảng dữ liệu bất kì trong Ruby hay một mảng record trong Rails. Ý nghĩa của nó là trả về kích thước của mảng/hash. Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">array = Array.new(<span class=\"number\">3</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Tạo 1 mảng tên array có 3 phần tử đều có giá trị là 1.</span></span><br><span class=\"line\">array.size, array.length, array.count</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Kết quả trả về cùng là 3.</span></span><br></pre></td></tr></table></figure>\n\n<p>Nhưng mọi chuyện không dừng lại ở đấy, nếu chúng chỉ cùng có chung một chức năng thì không có lý do gì để chúng cùng tồn tại.</p>\n<h2 id=\"2-Trong-ruby\"><a href=\"#2-Trong-ruby\" class=\"headerlink\" title=\"2.Trong ruby\"></a>2.Trong ruby</h2><p>Ngoài chức năng tính kích thước của một mảng hay một hash như đã được đề cập ở trên, Size có thể được sử dụng với cả đối tượng dạng chuỗi và dạng số nguyên.<br>Với chuỗi, Size sẽ trả về kết quả là số lượng ký tự của chuỗi. Còn với số nguyên, nó sẽ trả về số bite mà đối tượng đó nắm giữ trên bộ nhớ. Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str_temp = <span class=\"string\">\"hduychinh\"</span></span><br><span class=\"line\">str_temp.size</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Kết quả trả về độ dài chuỗi là 9.</span></span><br><span class=\"line\">int_temp = <span class=\"number\">12</span></span><br><span class=\"line\">int_temp.size</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Kết quả trả về là 8, ứng với 8 bytes mà int_temp lưu trữ trên bộ nhớ.</span></span><br></pre></td></tr></table></figure>\n\n<p>Length kém hơn size một chút, Length chỉ có thể sử dụng thêm cho các đối tượng dạng chuỗi để trả về số lượng ký tự trong chuỗi, mà không thể sử dụng trên số nguyên.</p>\n<p>Cuối cùng là Count, nó không có chức năng gì bổ sung so với phần đã đề cập. Tuy nhiên, một điểm mạnh của Count đó là khi sử dụng với mảng/hash thì nó có thể nhận tham số chuyển vào. Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">c = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">c.count <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Kết quả trả về là 2.</span></span><br><span class=\"line\">c.count &#123; <span class=\"params\">|i|</span> i &gt; <span class=\"number\">1</span> &#125;</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Kết quả trả về là 3.</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-Trong-Active-Record\"><a href=\"#3-Trong-Active-Record\" class=\"headerlink\" title=\"3.Trong Active Record\"></a>3.Trong Active Record</h2><p>Khi sử dụng Count thực chất là bạn đang sử dụng lệnh sql <strong>select count(*) from table_names</strong> để truy vấn ra số lượng mà chúng ta đang cần tìm hiểu. Thứ hai, Count không được lưu trữ lại, điều đó có nghĩa mỗi lần bạn chạy hàm Count thì nó sẽ truy vấn vào cơ sở dữ liệu mà không hề quan tâm là bạn có gọi lệnh Count trước đó hay không. Thứ ba, Count là lệnh duy nhất trong ba lệnh trên có thể gọi trực tiếp thông qua một model class, ví dụ như: <strong>Cat.count</strong>.</p>\n<p>Khi sử dụng Length, điều đầu tiên đó là load toàn bộ record mà bạn đang định đếm số lượng vào bộ nhớ rồi tính toán. Từ lần gọi thứ hai, nó sẽ lấy lại kết quả cũ chứ không load dữ liệu lên nữa. Đây thực sự là một điều tồi tệ nếu bạn có một cơ sở dữ liệu lớn, nó có thể load hàng triệu record vào bộ nhớ.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cat.all.length</span><br><span class=\"line\"><span class=\"comment\">#=&gt; Cat Load (0.2ms)  SELECT \"cats\".* FROM \"cats\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Khi sử dụng Size, điều đầu tiên của nó là tìm xem kết quả của truy vấn đã có trong bộ nhớ hay chưa, nếu có rồi thì nó sẽ lấy ra và sử dụng, còn nếu chưa có, nó sẽ sử dụng một câu truy vấn SQL vào cơ sở dữ liệu để đếm số lượng. Điều này thật sự tuyệt vời, như một sự kết hợp giữa length và count.</p>\n"},{"title":"Pass Reference Vs Pass Value, Ruby!","date":"2019-02-18T17:00:00.000Z","draft":false,"_content":"\n## 1. Định nghĩa\n\n1. Không có một định nghĩa chung nào về **pass by value** và **pass by reference**, tuỳ thuộc vào từng ngôn ngữ, chúng lại có cách xử lý và những định nghĩa khác nhau về cách xử lý biến và vùng nhớ.\n\n2. **Pass value**: Hiểu một cách đơn giản nhất, đó là khi biến bạn truyền vào một method nào đó, dù trong đó logic là gì và nó hà hiếp cái biến bạn bỏ vào ra làm sao, thì khi ra ngoài hàm đó, biến bạn đã truyền ở trên vẫn còn nguyên seal, nguyên kiện, không hề si nhê (không hề thay đổi về giá trị).\n\n3. **Pass reference**: ngược lại với sự tử tế trong **Pass value**, khi bạn quyết định truyền tham số dưới dạng một reference, đồng nghĩa với việc bạn chấp nhận rằng cái biến bé bỏng, yếu ớt xinh xinh của bạn sẽ tha hồ bị logic trong hàm hành hạ, và khi ra khỏi hàng nó vẫn mang đầy đủ thương tích đã bị gây ra trong hàm (giá trị biến truyền vào sẽ bị thay đổi theo logic trong hàm).\n\nNote: khi còn đi học, tôi đã có một sự nhầm lẫn về value và reference trong C, khi đó tôi đã nghĩ truyền tên biến bình thường thôi là **Pass value**, còn truyền con trỏ là **Pass reference**. Nhưng thực ra đó là không đúng:\n\n>The C language is pass-by-value without exception. Passing a pointer as a parameter does not mean pass-by-reference.\n\n## 2. Pass value và reference trong ruby\n\n| Qua thời gian tìm hiểu thì tôi nhận thấy rằng trong ruby không hề có khái niệm rõ ràng về reference hay value, nên mọi kết luận ở đây chỉ là mang tính quy chiếu dựa vào những ý chúng ta đã nói trong mục 1.\n\nXem ví dụ sau đây:\n\n```ruby\ndef xinchao(a)\n  a = \"Nguyen Van A\"\nend\n\ntemp = \"Nguyen Van B\"\n\nputs \"Kq: Xin Chao #{xinchao(temp)}\"\n\n#=> \"Kq: Xin Chao Nguyen Van A\"\n```\n\nTừ ví dụ trên ta có thể rút ra kết luận là ruby **Pass reference**? Vì như bạn đã thấy kết quả là \"Nguyen Van A\", giá trị mà chúng ta gán trong hàm **xinchao**.\n\nCâu trả lời là không, đây là một ví dụ cạm bẫy nếu ta không cẩn thận, khác với một số ngôn ngữ khác bắt buộc phải sử dụng **return** để trả về kết quả trong function, ruby cho phép ta sử dụng giá trị cuối cùng bạn viết ra trong function đó. Tức kết quả trả về trên đơn giản là kết quả thực hiện của function xinchao, chứ còn việc biến temp có thay đổi giá trị hay không thì chúng ta phải thay thế lại một chút như dưới đây để kiểm chứng:\n\n```ruby\ndef xinchao(a)\n  a = \"Nguyen Van A\"\nend\n\ntemp = \"Nguyen Van B\"\n\nxinchao(temp)\n\nputs \"Kq: Xin Chao #{temp}\"\n\n#=> \"Kq: Xin Chao Nguyen Van B\"\n```\n\nOh, vậy ruby là **Pass by value**? Đúng, như đã từng đề cập, ruby không có 1 định nghĩa thuần tuý nào về hai khái niệm mà chúng ta đang thảo luận, nên dựa trên những ý chính mà chúng ta đã thống nhất trong mục 1, ta có thể gọi Ruby là 1 một ngôn ngữ **Pass by value**.\n\nVậy có trường hợp ngoại lệ nào không? Như C++ có cả **Pass by value** và **Pass by reference** đó thôi? Theo tôi đọc được thì là không @@.\n","source":"_posts/2019-02-19-truyen-tham-tri-va-truyen-tham-chieu.md","raw":"---\ntitle: \"Pass Reference Vs Pass Value, Ruby!\"\ndate: 2019-02-19\ndraft: false\ntags: [\"RUBY\"]\n---\n\n## 1. Định nghĩa\n\n1. Không có một định nghĩa chung nào về **pass by value** và **pass by reference**, tuỳ thuộc vào từng ngôn ngữ, chúng lại có cách xử lý và những định nghĩa khác nhau về cách xử lý biến và vùng nhớ.\n\n2. **Pass value**: Hiểu một cách đơn giản nhất, đó là khi biến bạn truyền vào một method nào đó, dù trong đó logic là gì và nó hà hiếp cái biến bạn bỏ vào ra làm sao, thì khi ra ngoài hàm đó, biến bạn đã truyền ở trên vẫn còn nguyên seal, nguyên kiện, không hề si nhê (không hề thay đổi về giá trị).\n\n3. **Pass reference**: ngược lại với sự tử tế trong **Pass value**, khi bạn quyết định truyền tham số dưới dạng một reference, đồng nghĩa với việc bạn chấp nhận rằng cái biến bé bỏng, yếu ớt xinh xinh của bạn sẽ tha hồ bị logic trong hàm hành hạ, và khi ra khỏi hàng nó vẫn mang đầy đủ thương tích đã bị gây ra trong hàm (giá trị biến truyền vào sẽ bị thay đổi theo logic trong hàm).\n\nNote: khi còn đi học, tôi đã có một sự nhầm lẫn về value và reference trong C, khi đó tôi đã nghĩ truyền tên biến bình thường thôi là **Pass value**, còn truyền con trỏ là **Pass reference**. Nhưng thực ra đó là không đúng:\n\n>The C language is pass-by-value without exception. Passing a pointer as a parameter does not mean pass-by-reference.\n\n## 2. Pass value và reference trong ruby\n\n| Qua thời gian tìm hiểu thì tôi nhận thấy rằng trong ruby không hề có khái niệm rõ ràng về reference hay value, nên mọi kết luận ở đây chỉ là mang tính quy chiếu dựa vào những ý chúng ta đã nói trong mục 1.\n\nXem ví dụ sau đây:\n\n```ruby\ndef xinchao(a)\n  a = \"Nguyen Van A\"\nend\n\ntemp = \"Nguyen Van B\"\n\nputs \"Kq: Xin Chao #{xinchao(temp)}\"\n\n#=> \"Kq: Xin Chao Nguyen Van A\"\n```\n\nTừ ví dụ trên ta có thể rút ra kết luận là ruby **Pass reference**? Vì như bạn đã thấy kết quả là \"Nguyen Van A\", giá trị mà chúng ta gán trong hàm **xinchao**.\n\nCâu trả lời là không, đây là một ví dụ cạm bẫy nếu ta không cẩn thận, khác với một số ngôn ngữ khác bắt buộc phải sử dụng **return** để trả về kết quả trong function, ruby cho phép ta sử dụng giá trị cuối cùng bạn viết ra trong function đó. Tức kết quả trả về trên đơn giản là kết quả thực hiện của function xinchao, chứ còn việc biến temp có thay đổi giá trị hay không thì chúng ta phải thay thế lại một chút như dưới đây để kiểm chứng:\n\n```ruby\ndef xinchao(a)\n  a = \"Nguyen Van A\"\nend\n\ntemp = \"Nguyen Van B\"\n\nxinchao(temp)\n\nputs \"Kq: Xin Chao #{temp}\"\n\n#=> \"Kq: Xin Chao Nguyen Van B\"\n```\n\nOh, vậy ruby là **Pass by value**? Đúng, như đã từng đề cập, ruby không có 1 định nghĩa thuần tuý nào về hai khái niệm mà chúng ta đang thảo luận, nên dựa trên những ý chính mà chúng ta đã thống nhất trong mục 1, ta có thể gọi Ruby là 1 một ngôn ngữ **Pass by value**.\n\nVậy có trường hợp ngoại lệ nào không? Như C++ có cả **Pass by value** và **Pass by reference** đó thôi? Theo tôi đọc được thì là không @@.\n","slug":"2019-02-19-truyen-tham-tri-va-truyen-tham-chieu","published":1,"updated":"2022-01-29T09:29:59.926Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsa80007p3m2842meocb","content":"<h2 id=\"1-Dinh-nghia\"><a href=\"#1-Dinh-nghia\" class=\"headerlink\" title=\"1. Định nghĩa\"></a>1. Định nghĩa</h2><ol>\n<li><p>Không có một định nghĩa chung nào về <strong>pass by value</strong> và <strong>pass by reference</strong>, tuỳ thuộc vào từng ngôn ngữ, chúng lại có cách xử lý và những định nghĩa khác nhau về cách xử lý biến và vùng nhớ.</p>\n</li>\n<li><p><strong>Pass value</strong>: Hiểu một cách đơn giản nhất, đó là khi biến bạn truyền vào một method nào đó, dù trong đó logic là gì và nó hà hiếp cái biến bạn bỏ vào ra làm sao, thì khi ra ngoài hàm đó, biến bạn đã truyền ở trên vẫn còn nguyên seal, nguyên kiện, không hề si nhê (không hề thay đổi về giá trị).</p>\n</li>\n<li><p><strong>Pass reference</strong>: ngược lại với sự tử tế trong <strong>Pass value</strong>, khi bạn quyết định truyền tham số dưới dạng một reference, đồng nghĩa với việc bạn chấp nhận rằng cái biến bé bỏng, yếu ớt xinh xinh của bạn sẽ tha hồ bị logic trong hàm hành hạ, và khi ra khỏi hàng nó vẫn mang đầy đủ thương tích đã bị gây ra trong hàm (giá trị biến truyền vào sẽ bị thay đổi theo logic trong hàm).</p>\n</li>\n</ol>\n<p>Note: khi còn đi học, tôi đã có một sự nhầm lẫn về value và reference trong C, khi đó tôi đã nghĩ truyền tên biến bình thường thôi là <strong>Pass value</strong>, còn truyền con trỏ là <strong>Pass reference</strong>. Nhưng thực ra đó là không đúng:</p>\n<blockquote>\n<p>The C language is pass-by-value without exception. Passing a pointer as a parameter does not mean pass-by-reference.</p>\n</blockquote>\n<h2 id=\"2-Pass-value-va-reference-trong-ruby\"><a href=\"#2-Pass-value-va-reference-trong-ruby\" class=\"headerlink\" title=\"2. Pass value và reference trong ruby\"></a>2. Pass value và reference trong ruby</h2><p>| Qua thời gian tìm hiểu thì tôi nhận thấy rằng trong ruby không hề có khái niệm rõ ràng về reference hay value, nên mọi kết luận ở đây chỉ là mang tính quy chiếu dựa vào những ý chúng ta đã nói trong mục 1.</p>\n<p>Xem ví dụ sau đây:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">xinchao</span><span class=\"params\">(a)</span></span></span><br><span class=\"line\">  a = <span class=\"string\">\"Nguyen Van A\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = <span class=\"string\">\"Nguyen Van B\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"Kq: Xin Chao <span class=\"subst\">#&#123;xinchao(temp)&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#=&gt; \"Kq: Xin Chao Nguyen Van A\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Từ ví dụ trên ta có thể rút ra kết luận là ruby <strong>Pass reference</strong>? Vì như bạn đã thấy kết quả là “Nguyen Van A”, giá trị mà chúng ta gán trong hàm <strong>xinchao</strong>.</p>\n<p>Câu trả lời là không, đây là một ví dụ cạm bẫy nếu ta không cẩn thận, khác với một số ngôn ngữ khác bắt buộc phải sử dụng <strong>return</strong> để trả về kết quả trong function, ruby cho phép ta sử dụng giá trị cuối cùng bạn viết ra trong function đó. Tức kết quả trả về trên đơn giản là kết quả thực hiện của function xinchao, chứ còn việc biến temp có thay đổi giá trị hay không thì chúng ta phải thay thế lại một chút như dưới đây để kiểm chứng:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">xinchao</span><span class=\"params\">(a)</span></span></span><br><span class=\"line\">  a = <span class=\"string\">\"Nguyen Van A\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = <span class=\"string\">\"Nguyen Van B\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">xinchao(temp)</span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"Kq: Xin Chao <span class=\"subst\">#&#123;temp&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#=&gt; \"Kq: Xin Chao Nguyen Van B\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Oh, vậy ruby là <strong>Pass by value</strong>? Đúng, như đã từng đề cập, ruby không có 1 định nghĩa thuần tuý nào về hai khái niệm mà chúng ta đang thảo luận, nên dựa trên những ý chính mà chúng ta đã thống nhất trong mục 1, ta có thể gọi Ruby là 1 một ngôn ngữ <strong>Pass by value</strong>.</p>\n<p>Vậy có trường hợp ngoại lệ nào không? Như C++ có cả <strong>Pass by value</strong> và <strong>Pass by reference</strong> đó thôi? Theo tôi đọc được thì là không @@.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Dinh-nghia\"><a href=\"#1-Dinh-nghia\" class=\"headerlink\" title=\"1. Định nghĩa\"></a>1. Định nghĩa</h2><ol>\n<li><p>Không có một định nghĩa chung nào về <strong>pass by value</strong> và <strong>pass by reference</strong>, tuỳ thuộc vào từng ngôn ngữ, chúng lại có cách xử lý và những định nghĩa khác nhau về cách xử lý biến và vùng nhớ.</p>\n</li>\n<li><p><strong>Pass value</strong>: Hiểu một cách đơn giản nhất, đó là khi biến bạn truyền vào một method nào đó, dù trong đó logic là gì và nó hà hiếp cái biến bạn bỏ vào ra làm sao, thì khi ra ngoài hàm đó, biến bạn đã truyền ở trên vẫn còn nguyên seal, nguyên kiện, không hề si nhê (không hề thay đổi về giá trị).</p>\n</li>\n<li><p><strong>Pass reference</strong>: ngược lại với sự tử tế trong <strong>Pass value</strong>, khi bạn quyết định truyền tham số dưới dạng một reference, đồng nghĩa với việc bạn chấp nhận rằng cái biến bé bỏng, yếu ớt xinh xinh của bạn sẽ tha hồ bị logic trong hàm hành hạ, và khi ra khỏi hàng nó vẫn mang đầy đủ thương tích đã bị gây ra trong hàm (giá trị biến truyền vào sẽ bị thay đổi theo logic trong hàm).</p>\n</li>\n</ol>\n<p>Note: khi còn đi học, tôi đã có một sự nhầm lẫn về value và reference trong C, khi đó tôi đã nghĩ truyền tên biến bình thường thôi là <strong>Pass value</strong>, còn truyền con trỏ là <strong>Pass reference</strong>. Nhưng thực ra đó là không đúng:</p>\n<blockquote>\n<p>The C language is pass-by-value without exception. Passing a pointer as a parameter does not mean pass-by-reference.</p>\n</blockquote>\n<h2 id=\"2-Pass-value-va-reference-trong-ruby\"><a href=\"#2-Pass-value-va-reference-trong-ruby\" class=\"headerlink\" title=\"2. Pass value và reference trong ruby\"></a>2. Pass value và reference trong ruby</h2><p>| Qua thời gian tìm hiểu thì tôi nhận thấy rằng trong ruby không hề có khái niệm rõ ràng về reference hay value, nên mọi kết luận ở đây chỉ là mang tính quy chiếu dựa vào những ý chúng ta đã nói trong mục 1.</p>\n<p>Xem ví dụ sau đây:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">xinchao</span><span class=\"params\">(a)</span></span></span><br><span class=\"line\">  a = <span class=\"string\">\"Nguyen Van A\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = <span class=\"string\">\"Nguyen Van B\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"Kq: Xin Chao <span class=\"subst\">#&#123;xinchao(temp)&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#=&gt; \"Kq: Xin Chao Nguyen Van A\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Từ ví dụ trên ta có thể rút ra kết luận là ruby <strong>Pass reference</strong>? Vì như bạn đã thấy kết quả là “Nguyen Van A”, giá trị mà chúng ta gán trong hàm <strong>xinchao</strong>.</p>\n<p>Câu trả lời là không, đây là một ví dụ cạm bẫy nếu ta không cẩn thận, khác với một số ngôn ngữ khác bắt buộc phải sử dụng <strong>return</strong> để trả về kết quả trong function, ruby cho phép ta sử dụng giá trị cuối cùng bạn viết ra trong function đó. Tức kết quả trả về trên đơn giản là kết quả thực hiện của function xinchao, chứ còn việc biến temp có thay đổi giá trị hay không thì chúng ta phải thay thế lại một chút như dưới đây để kiểm chứng:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">xinchao</span><span class=\"params\">(a)</span></span></span><br><span class=\"line\">  a = <span class=\"string\">\"Nguyen Van A\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = <span class=\"string\">\"Nguyen Van B\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">xinchao(temp)</span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"Kq: Xin Chao <span class=\"subst\">#&#123;temp&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#=&gt; \"Kq: Xin Chao Nguyen Van B\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Oh, vậy ruby là <strong>Pass by value</strong>? Đúng, như đã từng đề cập, ruby không có 1 định nghĩa thuần tuý nào về hai khái niệm mà chúng ta đang thảo luận, nên dựa trên những ý chính mà chúng ta đã thống nhất trong mục 1, ta có thể gọi Ruby là 1 một ngôn ngữ <strong>Pass by value</strong>.</p>\n<p>Vậy có trường hợp ngoại lệ nào không? Như C++ có cả <strong>Pass by value</strong> và <strong>Pass by reference</strong> đó thôi? Theo tôi đọc được thì là không @@.</p>\n"},{"title":"Quy Luật 80/20","date":"2019-02-21T17:00:00.000Z","draft":false,"label":"#til","_content":"\nMọi người hầu như ai cũng biết quy luật 80/20.\n\nVà cũng nhiều người ứng dụng triệt để. Họ cố gắng dùng 20% công sức của mình để đạt được 80% giá trị, và tự hào vì sự hiệu quả của mình.\n\nNhưng họ quên một điều.\n\nĐúng là 20% công sức đầu tiên tạo nên 80% giá trị, nhưng là 80% giá trị phổ thông.\n\nChính 20% giá trị còn lại mới tạo nên 80% khác biệt. Và cũng chính 20% khác biệt sau cùng đó mới là thứ tạo nên thành công.\n\nBạn có thể bỏ 20% công sức là đủ chơi thuần thục guitar 80%.\n\nNhưng chính 20% độ khó cuối cùng mới tạo nên một tay guitar thượng hạng.\n\nBạn có thể bỏ 20% công sức, thậm chí ít hơn, để tạo nên một trang mạng xã hội bằng 80% Facebook.\n\nNhưng chính 20% còn lại khiến Facebook là Facebook.\n\nBạn có thể bỏ chỉ 20% công sức để tập tành và giống người thành đạt 80%.\n\nNhưng chính 20% cuối cùng mới thực sự khiến bạn trở nên thành đạt.\n\nTrong nhiều trò chơi quan trọng nhất cuộc đời không có chỗ cho sự nửa vời. Hãy nhớ rằng 20% xao nhãng đủ để làm nên 80% thất bại.\n\nHãy nghĩ lại đi, tại sao con số 80 lại nằm trước? Đó là vì bản chất của nó nhấn mạnh rằng 80% gian khổ mới là thứ tạo nên 20% quý giá cuối cùng.\n\n> trích dẫn Ecoblader\n","source":"_posts/2019-02-22-quy-luat-80-20.md","raw":"---\ntitle: \"Quy Luật 80/20\"\ndate: 2019-02-22\ndraft: false\ntags: [\"random\"]\nlabel: \"#til\"\n---\n\nMọi người hầu như ai cũng biết quy luật 80/20.\n\nVà cũng nhiều người ứng dụng triệt để. Họ cố gắng dùng 20% công sức của mình để đạt được 80% giá trị, và tự hào vì sự hiệu quả của mình.\n\nNhưng họ quên một điều.\n\nĐúng là 20% công sức đầu tiên tạo nên 80% giá trị, nhưng là 80% giá trị phổ thông.\n\nChính 20% giá trị còn lại mới tạo nên 80% khác biệt. Và cũng chính 20% khác biệt sau cùng đó mới là thứ tạo nên thành công.\n\nBạn có thể bỏ 20% công sức là đủ chơi thuần thục guitar 80%.\n\nNhưng chính 20% độ khó cuối cùng mới tạo nên một tay guitar thượng hạng.\n\nBạn có thể bỏ 20% công sức, thậm chí ít hơn, để tạo nên một trang mạng xã hội bằng 80% Facebook.\n\nNhưng chính 20% còn lại khiến Facebook là Facebook.\n\nBạn có thể bỏ chỉ 20% công sức để tập tành và giống người thành đạt 80%.\n\nNhưng chính 20% cuối cùng mới thực sự khiến bạn trở nên thành đạt.\n\nTrong nhiều trò chơi quan trọng nhất cuộc đời không có chỗ cho sự nửa vời. Hãy nhớ rằng 20% xao nhãng đủ để làm nên 80% thất bại.\n\nHãy nghĩ lại đi, tại sao con số 80 lại nằm trước? Đó là vì bản chất của nó nhấn mạnh rằng 80% gian khổ mới là thứ tạo nên 20% quý giá cuối cùng.\n\n> trích dẫn Ecoblader\n","slug":"2019-02-22-quy-luat-80-20","published":1,"updated":"2022-01-29T09:29:59.926Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsab000bp3m2aucx0i58","content":"<p>Mọi người hầu như ai cũng biết quy luật 80/20.</p>\n<p>Và cũng nhiều người ứng dụng triệt để. Họ cố gắng dùng 20% công sức của mình để đạt được 80% giá trị, và tự hào vì sự hiệu quả của mình.</p>\n<p>Nhưng họ quên một điều.</p>\n<p>Đúng là 20% công sức đầu tiên tạo nên 80% giá trị, nhưng là 80% giá trị phổ thông.</p>\n<p>Chính 20% giá trị còn lại mới tạo nên 80% khác biệt. Và cũng chính 20% khác biệt sau cùng đó mới là thứ tạo nên thành công.</p>\n<p>Bạn có thể bỏ 20% công sức là đủ chơi thuần thục guitar 80%.</p>\n<p>Nhưng chính 20% độ khó cuối cùng mới tạo nên một tay guitar thượng hạng.</p>\n<p>Bạn có thể bỏ 20% công sức, thậm chí ít hơn, để tạo nên một trang mạng xã hội bằng 80% Facebook.</p>\n<p>Nhưng chính 20% còn lại khiến Facebook là Facebook.</p>\n<p>Bạn có thể bỏ chỉ 20% công sức để tập tành và giống người thành đạt 80%.</p>\n<p>Nhưng chính 20% cuối cùng mới thực sự khiến bạn trở nên thành đạt.</p>\n<p>Trong nhiều trò chơi quan trọng nhất cuộc đời không có chỗ cho sự nửa vời. Hãy nhớ rằng 20% xao nhãng đủ để làm nên 80% thất bại.</p>\n<p>Hãy nghĩ lại đi, tại sao con số 80 lại nằm trước? Đó là vì bản chất của nó nhấn mạnh rằng 80% gian khổ mới là thứ tạo nên 20% quý giá cuối cùng.</p>\n<blockquote>\n<p>trích dẫn Ecoblader</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<p>Mọi người hầu như ai cũng biết quy luật 80/20.</p>\n<p>Và cũng nhiều người ứng dụng triệt để. Họ cố gắng dùng 20% công sức của mình để đạt được 80% giá trị, và tự hào vì sự hiệu quả của mình.</p>\n<p>Nhưng họ quên một điều.</p>\n<p>Đúng là 20% công sức đầu tiên tạo nên 80% giá trị, nhưng là 80% giá trị phổ thông.</p>\n<p>Chính 20% giá trị còn lại mới tạo nên 80% khác biệt. Và cũng chính 20% khác biệt sau cùng đó mới là thứ tạo nên thành công.</p>\n<p>Bạn có thể bỏ 20% công sức là đủ chơi thuần thục guitar 80%.</p>\n<p>Nhưng chính 20% độ khó cuối cùng mới tạo nên một tay guitar thượng hạng.</p>\n<p>Bạn có thể bỏ 20% công sức, thậm chí ít hơn, để tạo nên một trang mạng xã hội bằng 80% Facebook.</p>\n<p>Nhưng chính 20% còn lại khiến Facebook là Facebook.</p>\n<p>Bạn có thể bỏ chỉ 20% công sức để tập tành và giống người thành đạt 80%.</p>\n<p>Nhưng chính 20% cuối cùng mới thực sự khiến bạn trở nên thành đạt.</p>\n<p>Trong nhiều trò chơi quan trọng nhất cuộc đời không có chỗ cho sự nửa vời. Hãy nhớ rằng 20% xao nhãng đủ để làm nên 80% thất bại.</p>\n<p>Hãy nghĩ lại đi, tại sao con số 80 lại nằm trước? Đó là vì bản chất của nó nhấn mạnh rằng 80% gian khổ mới là thứ tạo nên 20% quý giá cuối cùng.</p>\n<blockquote>\n<p>trích dẫn Ecoblader</p>\n</blockquote>\n"},{"title":"Vài Trình Thông Dịch Cho Ruby","date":"2019-02-19T17:00:00.000Z","draft":false,"label":"#til","_content":"\n## 1. Ruby chạy code của bạn như nào?\n\nTrước khi nói về các trình thông dịch, tôi xin nêu khái quát về quá trình ruby thực thi mã code của bạn.\nVới bất cứ đoạn mã ruby nào, mã nguồn bạn viết sẽ trải qua các bước sau để có thể tới được trình thông dịch (chủ đề mà ta đang tìm hiểu).\n\n**Token**: Chuyển đổi mã nguồn ruby thành một dạng keyword. Hiểu đơn giản, ruby sẽ quét qua mã nguồn bạn viết và so sánh với một symbol table nào đó (giả dụ như vậy), để xác định xem trong mã nguồn bạn viết gồm những thành phần nào (để xác định đâu là biến, đâu là keyword, đâu là từ khoá). Ví dụ việc từ **do** xuất hiện trong mã nguồn, có thể nó là một biến local, hoặc nó là một keyword trong một **block**, **Token** sẽ quét mã nguồn và đảm bảo xác định đúng **type** của từng thành phần trong code của bạn, chú ý là **type** nhé, ở bước này ruby chỉ quan tâm đến xác định **type**.\n\n**Parse**: Qua bước đầu tiên, ta đã có một token, đến bước thứ hai nó sẽ chuyển đổi token đó thành một AST (Abstract Syntax Tree).\n\n**Compile**: Đến bước này, ruby sẽ biên dịch kết quả ở bước 2 thành **bytecode** và truyền kết quả biên dịch được sang cho máy ảo ruby (là phần mà chúng ta đang tìm hiểu trong bài viết).\n\n## 2. CRuby, MRI, YARV, KRI\n\nĐể kiểm tra xem ruby trên máy tính của bạn đang sử dụng trình thông dịch nào, hãy mở **irb** và sử dụng lệnh sau:\n\n```ruby\nRbConfig::CONFIG[\"RUBY_INSTALL_NAME\"]\n#=> kết quả trả về trên máy của tôi là: ruby\n```\nĐiều này có nghĩa tôi đang sử dụng trình thông dịch mặc định trong ruby. Được gọi là **MRI**/**CRuby** hay phiên bản nâng cấp sau này là **YARV**/**KRI**. Giải thích về việc có nhiều tên gọi như trên, tôi xin trích dẫn các thông tin trên wiki và trình thông dịch này:\n\n>Matz's Ruby Interpreter or Ruby MRI (also called CRuby) was the reference implementation of the Ruby programming language named after Ruby creator Yukihiro Matsumoto (\"Matz\")\n\n>YARV (Yet another Ruby VM) is a bytecode interpreter that was developed for the Ruby programming language by Koichi Sasada. The goal of the project was to greatly reduce the execution time of Ruby programs.\n\n> Since YARV has become the official Ruby interpreter for Ruby 1.9, it is also named KRI (Koichi's Ruby Interpreter), in the same vein as the original Ruby MRI, named for Ruby's creator Yukihiro Matsumoto.\n\n> YARV was merged into the Ruby Subversion repository on January 1, 2007. It was released as part of Ruby 1.9.0 on December 26, 2007, replacing Ruby MRI.\n\nQua vài trích dẫn kể trên, chúng ta có thể thấy đơn giản những khái niệm **CRuby**, **YARV**, **MRI**, **KRI** đều nhằm mô tả về một trình thông dịch được sử dụng mặc định cho ruby (tuỳ phiên bản sẽ có khác nhau, hiểu theo nghĩa là một sự update thay vì là thay thế).\n\n## 3. JRuby\n\nCòn một vài trình thông dịch khác mà tôi đã đọc được, nhưng **JRuby** là phần cuối mà chúng ta sẽ tìm hiểu, vì những những trình thông dịch còn lại không được phổ biến cho lắm.\n\n**JRuby** = **Java** + **Ruby**\n\nTức là dùng phần java làm core để chạy máy ảo xử lý code ruby. Sự khác biệt với mục 2,chính là ở mục 2, dù dưới tên gọi hay phiên bản nào, thì những trình thông dịch đó đều sử dụng **C** làm ngôn ngữ xây dựng.\n\nMột số ý kiến xoay quanh **JRuby**\n\n1. JRuby nhanh hơn đáng kể với trình thông dịch mặc định trong ruby, có lợi thế mạnh mẽ khi xử lý đa luồng.\n\n2. Tuy nhiên đồng nghĩa với điều đó là việc **JRuby** chiếm dụng bộ nhớ nhiều hơn và mất thời gian hơn để khởi động.\n\nVậy sẽ là một thảm hoạ nếu sử dụng **JRuby** để làm trình thông dịch cho ruby trong những ứng dụng nhỏ, hoạt động đơn giản và không cần tốc độ quá cao.\n\n## 4. Tham khảo\n\n[1] [https://en.wikipedia.org/wiki/Ruby_MRI](https://en.wikipedia.org/wiki/Ruby_MRI)\n\n[2] [https://en.wikipedia.org/wiki/JRuby](https://en.wikipedia.org/wiki/JRuby)\n","source":"_posts/2019-02-20-cac-trinh-thong-dich-trong-ruby.md","raw":"---\ntitle: \"Vài Trình Thông Dịch Cho Ruby\"\ndate: 2019-02-20\ndraft: false\ntags: [\"RUBY\"]\nlabel: \"#til\"\n---\n\n## 1. Ruby chạy code của bạn như nào?\n\nTrước khi nói về các trình thông dịch, tôi xin nêu khái quát về quá trình ruby thực thi mã code của bạn.\nVới bất cứ đoạn mã ruby nào, mã nguồn bạn viết sẽ trải qua các bước sau để có thể tới được trình thông dịch (chủ đề mà ta đang tìm hiểu).\n\n**Token**: Chuyển đổi mã nguồn ruby thành một dạng keyword. Hiểu đơn giản, ruby sẽ quét qua mã nguồn bạn viết và so sánh với một symbol table nào đó (giả dụ như vậy), để xác định xem trong mã nguồn bạn viết gồm những thành phần nào (để xác định đâu là biến, đâu là keyword, đâu là từ khoá). Ví dụ việc từ **do** xuất hiện trong mã nguồn, có thể nó là một biến local, hoặc nó là một keyword trong một **block**, **Token** sẽ quét mã nguồn và đảm bảo xác định đúng **type** của từng thành phần trong code của bạn, chú ý là **type** nhé, ở bước này ruby chỉ quan tâm đến xác định **type**.\n\n**Parse**: Qua bước đầu tiên, ta đã có một token, đến bước thứ hai nó sẽ chuyển đổi token đó thành một AST (Abstract Syntax Tree).\n\n**Compile**: Đến bước này, ruby sẽ biên dịch kết quả ở bước 2 thành **bytecode** và truyền kết quả biên dịch được sang cho máy ảo ruby (là phần mà chúng ta đang tìm hiểu trong bài viết).\n\n## 2. CRuby, MRI, YARV, KRI\n\nĐể kiểm tra xem ruby trên máy tính của bạn đang sử dụng trình thông dịch nào, hãy mở **irb** và sử dụng lệnh sau:\n\n```ruby\nRbConfig::CONFIG[\"RUBY_INSTALL_NAME\"]\n#=> kết quả trả về trên máy của tôi là: ruby\n```\nĐiều này có nghĩa tôi đang sử dụng trình thông dịch mặc định trong ruby. Được gọi là **MRI**/**CRuby** hay phiên bản nâng cấp sau này là **YARV**/**KRI**. Giải thích về việc có nhiều tên gọi như trên, tôi xin trích dẫn các thông tin trên wiki và trình thông dịch này:\n\n>Matz's Ruby Interpreter or Ruby MRI (also called CRuby) was the reference implementation of the Ruby programming language named after Ruby creator Yukihiro Matsumoto (\"Matz\")\n\n>YARV (Yet another Ruby VM) is a bytecode interpreter that was developed for the Ruby programming language by Koichi Sasada. The goal of the project was to greatly reduce the execution time of Ruby programs.\n\n> Since YARV has become the official Ruby interpreter for Ruby 1.9, it is also named KRI (Koichi's Ruby Interpreter), in the same vein as the original Ruby MRI, named for Ruby's creator Yukihiro Matsumoto.\n\n> YARV was merged into the Ruby Subversion repository on January 1, 2007. It was released as part of Ruby 1.9.0 on December 26, 2007, replacing Ruby MRI.\n\nQua vài trích dẫn kể trên, chúng ta có thể thấy đơn giản những khái niệm **CRuby**, **YARV**, **MRI**, **KRI** đều nhằm mô tả về một trình thông dịch được sử dụng mặc định cho ruby (tuỳ phiên bản sẽ có khác nhau, hiểu theo nghĩa là một sự update thay vì là thay thế).\n\n## 3. JRuby\n\nCòn một vài trình thông dịch khác mà tôi đã đọc được, nhưng **JRuby** là phần cuối mà chúng ta sẽ tìm hiểu, vì những những trình thông dịch còn lại không được phổ biến cho lắm.\n\n**JRuby** = **Java** + **Ruby**\n\nTức là dùng phần java làm core để chạy máy ảo xử lý code ruby. Sự khác biệt với mục 2,chính là ở mục 2, dù dưới tên gọi hay phiên bản nào, thì những trình thông dịch đó đều sử dụng **C** làm ngôn ngữ xây dựng.\n\nMột số ý kiến xoay quanh **JRuby**\n\n1. JRuby nhanh hơn đáng kể với trình thông dịch mặc định trong ruby, có lợi thế mạnh mẽ khi xử lý đa luồng.\n\n2. Tuy nhiên đồng nghĩa với điều đó là việc **JRuby** chiếm dụng bộ nhớ nhiều hơn và mất thời gian hơn để khởi động.\n\nVậy sẽ là một thảm hoạ nếu sử dụng **JRuby** để làm trình thông dịch cho ruby trong những ứng dụng nhỏ, hoạt động đơn giản và không cần tốc độ quá cao.\n\n## 4. Tham khảo\n\n[1] [https://en.wikipedia.org/wiki/Ruby_MRI](https://en.wikipedia.org/wiki/Ruby_MRI)\n\n[2] [https://en.wikipedia.org/wiki/JRuby](https://en.wikipedia.org/wiki/JRuby)\n","slug":"2019-02-20-cac-trinh-thong-dich-trong-ruby","published":1,"updated":"2022-01-29T09:29:59.926Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsab000cp3m2dks73agw","content":"<h2 id=\"1-Ruby-chay-code-cua-ban-nhu-nao\"><a href=\"#1-Ruby-chay-code-cua-ban-nhu-nao\" class=\"headerlink\" title=\"1. Ruby chạy code của bạn như nào?\"></a>1. Ruby chạy code của bạn như nào?</h2><p>Trước khi nói về các trình thông dịch, tôi xin nêu khái quát về quá trình ruby thực thi mã code của bạn.<br>Với bất cứ đoạn mã ruby nào, mã nguồn bạn viết sẽ trải qua các bước sau để có thể tới được trình thông dịch (chủ đề mà ta đang tìm hiểu).</p>\n<p><strong>Token</strong>: Chuyển đổi mã nguồn ruby thành một dạng keyword. Hiểu đơn giản, ruby sẽ quét qua mã nguồn bạn viết và so sánh với một symbol table nào đó (giả dụ như vậy), để xác định xem trong mã nguồn bạn viết gồm những thành phần nào (để xác định đâu là biến, đâu là keyword, đâu là từ khoá). Ví dụ việc từ <strong>do</strong> xuất hiện trong mã nguồn, có thể nó là một biến local, hoặc nó là một keyword trong một <strong>block</strong>, <strong>Token</strong> sẽ quét mã nguồn và đảm bảo xác định đúng <strong>type</strong> của từng thành phần trong code của bạn, chú ý là <strong>type</strong> nhé, ở bước này ruby chỉ quan tâm đến xác định <strong>type</strong>.</p>\n<p><strong>Parse</strong>: Qua bước đầu tiên, ta đã có một token, đến bước thứ hai nó sẽ chuyển đổi token đó thành một AST (Abstract Syntax Tree).</p>\n<p><strong>Compile</strong>: Đến bước này, ruby sẽ biên dịch kết quả ở bước 2 thành <strong>bytecode</strong> và truyền kết quả biên dịch được sang cho máy ảo ruby (là phần mà chúng ta đang tìm hiểu trong bài viết).</p>\n<h2 id=\"2-CRuby-MRI-YARV-KRI\"><a href=\"#2-CRuby-MRI-YARV-KRI\" class=\"headerlink\" title=\"2. CRuby, MRI, YARV, KRI\"></a>2. CRuby, MRI, YARV, KRI</h2><p>Để kiểm tra xem ruby trên máy tính của bạn đang sử dụng trình thông dịch nào, hãy mở <strong>irb</strong> và sử dụng lệnh sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RbConfig::CONFIG[<span class=\"string\">\"RUBY_INSTALL_NAME\"</span>]</span><br><span class=\"line\"><span class=\"comment\">#=&gt; kết quả trả về trên máy của tôi là: ruby</span></span><br></pre></td></tr></table></figure>\n<p>Điều này có nghĩa tôi đang sử dụng trình thông dịch mặc định trong ruby. Được gọi là <strong>MRI</strong>/<strong>CRuby</strong> hay phiên bản nâng cấp sau này là <strong>YARV</strong>/<strong>KRI</strong>. Giải thích về việc có nhiều tên gọi như trên, tôi xin trích dẫn các thông tin trên wiki và trình thông dịch này:</p>\n<blockquote>\n<p>Matz’s Ruby Interpreter or Ruby MRI (also called CRuby) was the reference implementation of the Ruby programming language named after Ruby creator Yukihiro Matsumoto (“Matz”)</p>\n</blockquote>\n<blockquote>\n<p>YARV (Yet another Ruby VM) is a bytecode interpreter that was developed for the Ruby programming language by Koichi Sasada. The goal of the project was to greatly reduce the execution time of Ruby programs.</p>\n</blockquote>\n<blockquote>\n<p>Since YARV has become the official Ruby interpreter for Ruby 1.9, it is also named KRI (Koichi’s Ruby Interpreter), in the same vein as the original Ruby MRI, named for Ruby’s creator Yukihiro Matsumoto.</p>\n</blockquote>\n<blockquote>\n<p>YARV was merged into the Ruby Subversion repository on January 1, 2007. It was released as part of Ruby 1.9.0 on December 26, 2007, replacing Ruby MRI.</p>\n</blockquote>\n<p>Qua vài trích dẫn kể trên, chúng ta có thể thấy đơn giản những khái niệm <strong>CRuby</strong>, <strong>YARV</strong>, <strong>MRI</strong>, <strong>KRI</strong> đều nhằm mô tả về một trình thông dịch được sử dụng mặc định cho ruby (tuỳ phiên bản sẽ có khác nhau, hiểu theo nghĩa là một sự update thay vì là thay thế).</p>\n<h2 id=\"3-JRuby\"><a href=\"#3-JRuby\" class=\"headerlink\" title=\"3. JRuby\"></a>3. JRuby</h2><p>Còn một vài trình thông dịch khác mà tôi đã đọc được, nhưng <strong>JRuby</strong> là phần cuối mà chúng ta sẽ tìm hiểu, vì những những trình thông dịch còn lại không được phổ biến cho lắm.</p>\n<p><strong>JRuby</strong> = <strong>Java</strong> + <strong>Ruby</strong></p>\n<p>Tức là dùng phần java làm core để chạy máy ảo xử lý code ruby. Sự khác biệt với mục 2,chính là ở mục 2, dù dưới tên gọi hay phiên bản nào, thì những trình thông dịch đó đều sử dụng <strong>C</strong> làm ngôn ngữ xây dựng.</p>\n<p>Một số ý kiến xoay quanh <strong>JRuby</strong></p>\n<ol>\n<li><p>JRuby nhanh hơn đáng kể với trình thông dịch mặc định trong ruby, có lợi thế mạnh mẽ khi xử lý đa luồng.</p>\n</li>\n<li><p>Tuy nhiên đồng nghĩa với điều đó là việc <strong>JRuby</strong> chiếm dụng bộ nhớ nhiều hơn và mất thời gian hơn để khởi động.</p>\n</li>\n</ol>\n<p>Vậy sẽ là một thảm hoạ nếu sử dụng <strong>JRuby</strong> để làm trình thông dịch cho ruby trong những ứng dụng nhỏ, hoạt động đơn giản và không cần tốc độ quá cao.</p>\n<h2 id=\"4-Tham-khao\"><a href=\"#4-Tham-khao\" class=\"headerlink\" title=\"4. Tham khảo\"></a>4. Tham khảo</h2><p>[1] <a href=\"https://en.wikipedia.org/wiki/Ruby_MRI\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/Ruby_MRI</a></p>\n<p>[2] <a href=\"https://en.wikipedia.org/wiki/JRuby\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/JRuby</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Ruby-chay-code-cua-ban-nhu-nao\"><a href=\"#1-Ruby-chay-code-cua-ban-nhu-nao\" class=\"headerlink\" title=\"1. Ruby chạy code của bạn như nào?\"></a>1. Ruby chạy code của bạn như nào?</h2><p>Trước khi nói về các trình thông dịch, tôi xin nêu khái quát về quá trình ruby thực thi mã code của bạn.<br>Với bất cứ đoạn mã ruby nào, mã nguồn bạn viết sẽ trải qua các bước sau để có thể tới được trình thông dịch (chủ đề mà ta đang tìm hiểu).</p>\n<p><strong>Token</strong>: Chuyển đổi mã nguồn ruby thành một dạng keyword. Hiểu đơn giản, ruby sẽ quét qua mã nguồn bạn viết và so sánh với một symbol table nào đó (giả dụ như vậy), để xác định xem trong mã nguồn bạn viết gồm những thành phần nào (để xác định đâu là biến, đâu là keyword, đâu là từ khoá). Ví dụ việc từ <strong>do</strong> xuất hiện trong mã nguồn, có thể nó là một biến local, hoặc nó là một keyword trong một <strong>block</strong>, <strong>Token</strong> sẽ quét mã nguồn và đảm bảo xác định đúng <strong>type</strong> của từng thành phần trong code của bạn, chú ý là <strong>type</strong> nhé, ở bước này ruby chỉ quan tâm đến xác định <strong>type</strong>.</p>\n<p><strong>Parse</strong>: Qua bước đầu tiên, ta đã có một token, đến bước thứ hai nó sẽ chuyển đổi token đó thành một AST (Abstract Syntax Tree).</p>\n<p><strong>Compile</strong>: Đến bước này, ruby sẽ biên dịch kết quả ở bước 2 thành <strong>bytecode</strong> và truyền kết quả biên dịch được sang cho máy ảo ruby (là phần mà chúng ta đang tìm hiểu trong bài viết).</p>\n<h2 id=\"2-CRuby-MRI-YARV-KRI\"><a href=\"#2-CRuby-MRI-YARV-KRI\" class=\"headerlink\" title=\"2. CRuby, MRI, YARV, KRI\"></a>2. CRuby, MRI, YARV, KRI</h2><p>Để kiểm tra xem ruby trên máy tính của bạn đang sử dụng trình thông dịch nào, hãy mở <strong>irb</strong> và sử dụng lệnh sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RbConfig::CONFIG[<span class=\"string\">\"RUBY_INSTALL_NAME\"</span>]</span><br><span class=\"line\"><span class=\"comment\">#=&gt; kết quả trả về trên máy của tôi là: ruby</span></span><br></pre></td></tr></table></figure>\n<p>Điều này có nghĩa tôi đang sử dụng trình thông dịch mặc định trong ruby. Được gọi là <strong>MRI</strong>/<strong>CRuby</strong> hay phiên bản nâng cấp sau này là <strong>YARV</strong>/<strong>KRI</strong>. Giải thích về việc có nhiều tên gọi như trên, tôi xin trích dẫn các thông tin trên wiki và trình thông dịch này:</p>\n<blockquote>\n<p>Matz’s Ruby Interpreter or Ruby MRI (also called CRuby) was the reference implementation of the Ruby programming language named after Ruby creator Yukihiro Matsumoto (“Matz”)</p>\n</blockquote>\n<blockquote>\n<p>YARV (Yet another Ruby VM) is a bytecode interpreter that was developed for the Ruby programming language by Koichi Sasada. The goal of the project was to greatly reduce the execution time of Ruby programs.</p>\n</blockquote>\n<blockquote>\n<p>Since YARV has become the official Ruby interpreter for Ruby 1.9, it is also named KRI (Koichi’s Ruby Interpreter), in the same vein as the original Ruby MRI, named for Ruby’s creator Yukihiro Matsumoto.</p>\n</blockquote>\n<blockquote>\n<p>YARV was merged into the Ruby Subversion repository on January 1, 2007. It was released as part of Ruby 1.9.0 on December 26, 2007, replacing Ruby MRI.</p>\n</blockquote>\n<p>Qua vài trích dẫn kể trên, chúng ta có thể thấy đơn giản những khái niệm <strong>CRuby</strong>, <strong>YARV</strong>, <strong>MRI</strong>, <strong>KRI</strong> đều nhằm mô tả về một trình thông dịch được sử dụng mặc định cho ruby (tuỳ phiên bản sẽ có khác nhau, hiểu theo nghĩa là một sự update thay vì là thay thế).</p>\n<h2 id=\"3-JRuby\"><a href=\"#3-JRuby\" class=\"headerlink\" title=\"3. JRuby\"></a>3. JRuby</h2><p>Còn một vài trình thông dịch khác mà tôi đã đọc được, nhưng <strong>JRuby</strong> là phần cuối mà chúng ta sẽ tìm hiểu, vì những những trình thông dịch còn lại không được phổ biến cho lắm.</p>\n<p><strong>JRuby</strong> = <strong>Java</strong> + <strong>Ruby</strong></p>\n<p>Tức là dùng phần java làm core để chạy máy ảo xử lý code ruby. Sự khác biệt với mục 2,chính là ở mục 2, dù dưới tên gọi hay phiên bản nào, thì những trình thông dịch đó đều sử dụng <strong>C</strong> làm ngôn ngữ xây dựng.</p>\n<p>Một số ý kiến xoay quanh <strong>JRuby</strong></p>\n<ol>\n<li><p>JRuby nhanh hơn đáng kể với trình thông dịch mặc định trong ruby, có lợi thế mạnh mẽ khi xử lý đa luồng.</p>\n</li>\n<li><p>Tuy nhiên đồng nghĩa với điều đó là việc <strong>JRuby</strong> chiếm dụng bộ nhớ nhiều hơn và mất thời gian hơn để khởi động.</p>\n</li>\n</ol>\n<p>Vậy sẽ là một thảm hoạ nếu sử dụng <strong>JRuby</strong> để làm trình thông dịch cho ruby trong những ứng dụng nhỏ, hoạt động đơn giản và không cần tốc độ quá cao.</p>\n<h2 id=\"4-Tham-khao\"><a href=\"#4-Tham-khao\" class=\"headerlink\" title=\"4. Tham khảo\"></a>4. Tham khảo</h2><p>[1] <a href=\"https://en.wikipedia.org/wiki/Ruby_MRI\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/Ruby_MRI</a></p>\n<p>[2] <a href=\"https://en.wikipedia.org/wiki/JRuby\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/JRuby</a></p>\n"},{"title":"Root, Sudo Và Package Management","date":"2019-02-04T17:00:00.000Z","draft":false,"_content":"\n## 1.Root\n\nXin được nhắc lại một câu chuyện cũ tôi đã kể trong bài viết trước với ví dụ về mảnh đất nhà bạn, bạn sở hữu mảnh đất đó, vợ bạn sở hữu mảnh đất đó chung với bạn. Nhưng vợ chồng bạn không phải là những người sở hữu tối thượng của mảnh đất kể trên, mà quyền lực to lớn này thuộc về nhà nước, “người” thực ra là đang cho bạn thuê đất có thời hạn. Tương tự trọng Unix/Linux, sẽ có những user (như tài khoản bạn sử dụng để đăng nhập, hoặc tài khoản khách…).\n\nViệc những tài khoản này có thể đăng nhập vào hệ thống nhưng đặc quyền của chúng bị giới hạn. Khi login vào hệ thống, bạn có thể làm một số tác vụ nhất định chứ không thể thích làm gì thì làm, trong hệ thống của bạn chỉ có một user duy nhất được quyền làm bất cứ điều gì, đó là một super user.\n\nTrên windows, ta gọi đó là **administrator** (có lẽ quá quen thuộc, bạn còn nhớ những lúc cài phần mềm, bạn click vào file exe nhưng chương trình không chịu cài đặt, google một lát, bạn nhận được một hướng dẫn hãy click phải vào file exe đó và chọn **run as administrator**, đó chính là sức mạnh của super user trên windows), còn trên macOS hay Ubuntu(1 đại diện của Linux), nó được gọi là **root** (cuối cùng cũng chỉ là một cái tên gọi, nó có thể được đặt tên là mèo, là chó, nó có thể được đặt tên là bất cứ thứ gì, chúng ta không cần quan tâm, điều duy nhất chúng ta cần biết đó là trên các hệ điều hành con cháu của Unix sẽ luôn có một super user quyền lực như vậy).\n\nĐến lúc này, bạn sẽ tự hỏi tại sao phải thiết kế hệ thống phức tạp như vậy? Tại sao không chỉ dung duy nhất một loại user?\nCâu trả lời rất đơn giản, không phải ai sử dụng máy tính cũng là những người dung có hiểu biết sâu sắc về hệ điều hành. Vì vậy, nếu trao cho họ những quyền lực quá lớn, họ có thể vô tình gây ra những huỷ hoại nghiêm trọng cho hệ thống (quyền lực càng lớn thì trách nhiệm càng lớn).\n\nMột vấn đề phát sinh nếu việc sử dụng Root mang tính rủi ro quá cao nhưng những user bình thường lại không có các quyền để cài đặt một số phần mềm nâng cao thì phải làm sao? Vấn đề này sẽ được giải thích ở mục số 2.\n\nNote: Trên macOS và Ubuntu, **root** mặc định sẽ được disable, chúng có thể sẽ được enable trở lại và re-disable. Cách thực hiện thì có lẽ bạn nên tìm kiếm hướng dẫn từ trang chủ của những hệ điều hành này để câu lệnh của bạn đảm bảo chính xác và không bị lỗi thời.\n\n## 2.Sudo\n\nNhư vấn đề tôi đã nêu ở cuối mục 1, bây giờ tôi muốn cài đặt một số phần mềm đòi hỏi quyền của super user, về lý thuyết tôi đứng giữa hai lựa chọn hoặc chuyển sang **root** và cài đặt phần mềm bình thường (rất rủi ro), phương án 2 là tôi vẫn sử dụng user thường và nói lời tạm biệt với những phần mềm kể trên.\n\nQuá tệ, cả hai giải pháp trên đều không ổn, thật may, các nhà phát triển hệ thống đã cung cấp cho chúng ta một lựa chọn số 3, đó là bạn vẫn sử dụng user thường nhưng có thể triệu hồi quyền lực của super user để thực hiện những lệnh nào đó.\n\nCách sử dụng đó là bạn thêm câu lệnh **sudo** vào phía trước câu lệnh cần sử dụng quyền của super user. Ví dụ:\n\n**sudo apt-get update**\n\nMột nhầm lẫn thường xuyên với cả với tôi ngày mới tìm hiểu, đó là sau khi gõ những câu lệnh có **sudo**, hệ thống yêu cầu tôi nhập mật khẩu và tôi đã từng nghĩ đó là mật khẩu của **root** (nghe cũng hợp lý đấy chứ, ta mượn quyền của **root** thì phải sử dụng mật khẩu của **root** chứ nhỉ? Giống như khi tôi mượn nhà của bạn thì tôi phải có chìa khoá của bạn). Nhưng không phải như vậy, mật khẩu bạn nhập vào đơn thuần là chính mật khẩu của user thường bạn đang login trên máy.\n\nPhần đa các trường hợp khi bạn thêm **sudo**, các câu lệnh sẽ chạy một cách hoàn hảo. Tuy nhiên, cũng có những khi bạn không nhận được kết quả như mong đợi và lý do chính là không phải user nào cũng có thể triệu hồi quyền lực của super user. Điều bạn cần làm khi đó là \"nói\" với hệ điều hành rằng hãy cho user của tôi đang sử dụng được quyền triệu hồi sức mạnh của super user. Hãy xem ví dụ dưới đây:\n\n```ruby\n#=> /etc/sudoers (lưu trữ các user được quyền thực hiện đặc quyền của super user)\n#=> Ví dụ\nroot ALL=(ALL:ALL) ALL\n#=> user đang xét quyền tên là root\n#=> Chữ all đầu tiên chỉ ra rằng rule này được áp dụng cho tất cả các host\n#=> Chữ all thứ hai chỉ ra, account root có thể chạy lệnh với quyền của bất kỳ user nào.\n#=> Chữ all thứ ba chỉ ra, account root có thể chạy lệnh với quyền của bất kỳ group nào.\n#=> Chữ all cuối cùng chỉ ra, account root có thể chạy bất kỳ command nào.\n```\n\nNote: Kể từ khi bạn nhập mật khẩu sau khi gõ lệnh **sudo** lần đầu, thời gian có hiệu lực của mật khẩu này sẽ là 15 phút. Trong khoảng thời gian đó bạn có thể chạy các lệnh **sudo** khác mà hệ điều hành không yêu cầu bạn nhập lại mật khẩu.\n\n\n## 3.Package management system\n\nKhi sử dụng macOS, để cài đặt thêm các phần mềm phục vụ công việc (mà chúng không được support trên appstore), tôi sử dụng **homebrew**, một phần mềm giúp quản lý các phần mềm khác rất hiệu quả.\n\nVậy còn trên Linux chúng ta có gì?\n\nTrước hết cần phải làm rõ: Package management system là một công cụ hoặc một hệ thống các công cụ được sử dụng để handle các package.\n1.\tHandle là quản lý với đầy đủ các chức năng như thêm mới, gỡ bỏ, nâng cấp, tìm kiếm..v..v…\n2.\tPackage là một tiện ích hoặc những phần bổ trợ cho một tiện ích nào đó (thực sự cuối cùng nó cũng chỉ là tập hợp của các file).\n\nMột **Package Management System** nổi tiếng trên Linux đó là **DPKG**, nó là một công cụ để cài đặt các package có đuôi .deb (các package dành cho các hệ điều hành thuộc dòng debian).\nNhiệm vụ của **DPKG** là install hoặc remove một package (với điều kiện các file cần thiết đã có trên local).\n\nĐến đây nhiều bạn có thể thắc mắc rằng từ trước đến giờ bạn chưa hề sử dụng các dòng lệnh liên quan đến **DPKG**, vậy tại sao tôi lại bảo là nó rất phổ biến? Câu trả lời đó là bạn đang sử dụng các phần mềm package management system khác được xây dựng dựa trên phần core là **DPKG**, một trong số đó là **APT–GET/APT**.\n\nƯu điểm lớn nhất của **APT** so với **DPKG** đó là **DPKG** chỉ có thể cài đặt file khi mà file đó đã có trên local (tức là bằng cách nào đó bạn phải download hoặc copy file đó về máy của bạn). Còn với **APT**, nó sẽ tìm kiếm các package đó từ **remote repositories**, sau đó download chúng về máy.\n\nĐiểm mạnh thứ hai của **APT** so với **DPKG** đó là nó giải quyết được bài toán dependencies. Nếu package bạn cần cài đặt phụ thuộc vào một vài package khác, nếu sử dụng **DPKG** thì bạn sẽ phải cài đặt tất cả các package kể trên một cách thủ công.\nCòn với **APT**, nó sẽ tự hiểu được package đó cần thêm những phụ trợ nào và tự động cài đặt phần phụ trợ.\n\nĐiều thật sự diễn ra đó là trong **APT**, **DPKG** vẫn tồn tại. Nó tồn tại ở một cấp thấp hơn và thực hiện các chỉ thị của **APT**.\n\nNote: Các **remote repositories** để phần mềm package management của bạn tìm kiếm sẽ được lưu trữ trong file **/etc/apt/sources.list** (đa số là như vậy).\n\n## 4. Tham khảo\n\n[1] [https://www.quora.com/What-is-package-management](https://www.quora.com/What-is-package-management)\n\n[2] [https://www.tecmint.com/linux-package-management/](https://www.tecmint.com/linux-package-management/)\n","source":"_posts/2019-02-05-root-sudo-and-package-management-system.md","raw":"---\ntitle: \"Root, Sudo Và Package Management\"\ndate: 2019-02-05\ndraft: false\ntags: [\"unix\"]\ncategories: [\"OS\"]\n---\n\n## 1.Root\n\nXin được nhắc lại một câu chuyện cũ tôi đã kể trong bài viết trước với ví dụ về mảnh đất nhà bạn, bạn sở hữu mảnh đất đó, vợ bạn sở hữu mảnh đất đó chung với bạn. Nhưng vợ chồng bạn không phải là những người sở hữu tối thượng của mảnh đất kể trên, mà quyền lực to lớn này thuộc về nhà nước, “người” thực ra là đang cho bạn thuê đất có thời hạn. Tương tự trọng Unix/Linux, sẽ có những user (như tài khoản bạn sử dụng để đăng nhập, hoặc tài khoản khách…).\n\nViệc những tài khoản này có thể đăng nhập vào hệ thống nhưng đặc quyền của chúng bị giới hạn. Khi login vào hệ thống, bạn có thể làm một số tác vụ nhất định chứ không thể thích làm gì thì làm, trong hệ thống của bạn chỉ có một user duy nhất được quyền làm bất cứ điều gì, đó là một super user.\n\nTrên windows, ta gọi đó là **administrator** (có lẽ quá quen thuộc, bạn còn nhớ những lúc cài phần mềm, bạn click vào file exe nhưng chương trình không chịu cài đặt, google một lát, bạn nhận được một hướng dẫn hãy click phải vào file exe đó và chọn **run as administrator**, đó chính là sức mạnh của super user trên windows), còn trên macOS hay Ubuntu(1 đại diện của Linux), nó được gọi là **root** (cuối cùng cũng chỉ là một cái tên gọi, nó có thể được đặt tên là mèo, là chó, nó có thể được đặt tên là bất cứ thứ gì, chúng ta không cần quan tâm, điều duy nhất chúng ta cần biết đó là trên các hệ điều hành con cháu của Unix sẽ luôn có một super user quyền lực như vậy).\n\nĐến lúc này, bạn sẽ tự hỏi tại sao phải thiết kế hệ thống phức tạp như vậy? Tại sao không chỉ dung duy nhất một loại user?\nCâu trả lời rất đơn giản, không phải ai sử dụng máy tính cũng là những người dung có hiểu biết sâu sắc về hệ điều hành. Vì vậy, nếu trao cho họ những quyền lực quá lớn, họ có thể vô tình gây ra những huỷ hoại nghiêm trọng cho hệ thống (quyền lực càng lớn thì trách nhiệm càng lớn).\n\nMột vấn đề phát sinh nếu việc sử dụng Root mang tính rủi ro quá cao nhưng những user bình thường lại không có các quyền để cài đặt một số phần mềm nâng cao thì phải làm sao? Vấn đề này sẽ được giải thích ở mục số 2.\n\nNote: Trên macOS và Ubuntu, **root** mặc định sẽ được disable, chúng có thể sẽ được enable trở lại và re-disable. Cách thực hiện thì có lẽ bạn nên tìm kiếm hướng dẫn từ trang chủ của những hệ điều hành này để câu lệnh của bạn đảm bảo chính xác và không bị lỗi thời.\n\n## 2.Sudo\n\nNhư vấn đề tôi đã nêu ở cuối mục 1, bây giờ tôi muốn cài đặt một số phần mềm đòi hỏi quyền của super user, về lý thuyết tôi đứng giữa hai lựa chọn hoặc chuyển sang **root** và cài đặt phần mềm bình thường (rất rủi ro), phương án 2 là tôi vẫn sử dụng user thường và nói lời tạm biệt với những phần mềm kể trên.\n\nQuá tệ, cả hai giải pháp trên đều không ổn, thật may, các nhà phát triển hệ thống đã cung cấp cho chúng ta một lựa chọn số 3, đó là bạn vẫn sử dụng user thường nhưng có thể triệu hồi quyền lực của super user để thực hiện những lệnh nào đó.\n\nCách sử dụng đó là bạn thêm câu lệnh **sudo** vào phía trước câu lệnh cần sử dụng quyền của super user. Ví dụ:\n\n**sudo apt-get update**\n\nMột nhầm lẫn thường xuyên với cả với tôi ngày mới tìm hiểu, đó là sau khi gõ những câu lệnh có **sudo**, hệ thống yêu cầu tôi nhập mật khẩu và tôi đã từng nghĩ đó là mật khẩu của **root** (nghe cũng hợp lý đấy chứ, ta mượn quyền của **root** thì phải sử dụng mật khẩu của **root** chứ nhỉ? Giống như khi tôi mượn nhà của bạn thì tôi phải có chìa khoá của bạn). Nhưng không phải như vậy, mật khẩu bạn nhập vào đơn thuần là chính mật khẩu của user thường bạn đang login trên máy.\n\nPhần đa các trường hợp khi bạn thêm **sudo**, các câu lệnh sẽ chạy một cách hoàn hảo. Tuy nhiên, cũng có những khi bạn không nhận được kết quả như mong đợi và lý do chính là không phải user nào cũng có thể triệu hồi quyền lực của super user. Điều bạn cần làm khi đó là \"nói\" với hệ điều hành rằng hãy cho user của tôi đang sử dụng được quyền triệu hồi sức mạnh của super user. Hãy xem ví dụ dưới đây:\n\n```ruby\n#=> /etc/sudoers (lưu trữ các user được quyền thực hiện đặc quyền của super user)\n#=> Ví dụ\nroot ALL=(ALL:ALL) ALL\n#=> user đang xét quyền tên là root\n#=> Chữ all đầu tiên chỉ ra rằng rule này được áp dụng cho tất cả các host\n#=> Chữ all thứ hai chỉ ra, account root có thể chạy lệnh với quyền của bất kỳ user nào.\n#=> Chữ all thứ ba chỉ ra, account root có thể chạy lệnh với quyền của bất kỳ group nào.\n#=> Chữ all cuối cùng chỉ ra, account root có thể chạy bất kỳ command nào.\n```\n\nNote: Kể từ khi bạn nhập mật khẩu sau khi gõ lệnh **sudo** lần đầu, thời gian có hiệu lực của mật khẩu này sẽ là 15 phút. Trong khoảng thời gian đó bạn có thể chạy các lệnh **sudo** khác mà hệ điều hành không yêu cầu bạn nhập lại mật khẩu.\n\n\n## 3.Package management system\n\nKhi sử dụng macOS, để cài đặt thêm các phần mềm phục vụ công việc (mà chúng không được support trên appstore), tôi sử dụng **homebrew**, một phần mềm giúp quản lý các phần mềm khác rất hiệu quả.\n\nVậy còn trên Linux chúng ta có gì?\n\nTrước hết cần phải làm rõ: Package management system là một công cụ hoặc một hệ thống các công cụ được sử dụng để handle các package.\n1.\tHandle là quản lý với đầy đủ các chức năng như thêm mới, gỡ bỏ, nâng cấp, tìm kiếm..v..v…\n2.\tPackage là một tiện ích hoặc những phần bổ trợ cho một tiện ích nào đó (thực sự cuối cùng nó cũng chỉ là tập hợp của các file).\n\nMột **Package Management System** nổi tiếng trên Linux đó là **DPKG**, nó là một công cụ để cài đặt các package có đuôi .deb (các package dành cho các hệ điều hành thuộc dòng debian).\nNhiệm vụ của **DPKG** là install hoặc remove một package (với điều kiện các file cần thiết đã có trên local).\n\nĐến đây nhiều bạn có thể thắc mắc rằng từ trước đến giờ bạn chưa hề sử dụng các dòng lệnh liên quan đến **DPKG**, vậy tại sao tôi lại bảo là nó rất phổ biến? Câu trả lời đó là bạn đang sử dụng các phần mềm package management system khác được xây dựng dựa trên phần core là **DPKG**, một trong số đó là **APT–GET/APT**.\n\nƯu điểm lớn nhất của **APT** so với **DPKG** đó là **DPKG** chỉ có thể cài đặt file khi mà file đó đã có trên local (tức là bằng cách nào đó bạn phải download hoặc copy file đó về máy của bạn). Còn với **APT**, nó sẽ tìm kiếm các package đó từ **remote repositories**, sau đó download chúng về máy.\n\nĐiểm mạnh thứ hai của **APT** so với **DPKG** đó là nó giải quyết được bài toán dependencies. Nếu package bạn cần cài đặt phụ thuộc vào một vài package khác, nếu sử dụng **DPKG** thì bạn sẽ phải cài đặt tất cả các package kể trên một cách thủ công.\nCòn với **APT**, nó sẽ tự hiểu được package đó cần thêm những phụ trợ nào và tự động cài đặt phần phụ trợ.\n\nĐiều thật sự diễn ra đó là trong **APT**, **DPKG** vẫn tồn tại. Nó tồn tại ở một cấp thấp hơn và thực hiện các chỉ thị của **APT**.\n\nNote: Các **remote repositories** để phần mềm package management của bạn tìm kiếm sẽ được lưu trữ trong file **/etc/apt/sources.list** (đa số là như vậy).\n\n## 4. Tham khảo\n\n[1] [https://www.quora.com/What-is-package-management](https://www.quora.com/What-is-package-management)\n\n[2] [https://www.tecmint.com/linux-package-management/](https://www.tecmint.com/linux-package-management/)\n","slug":"2019-02-05-root-sudo-and-package-management-system","published":1,"updated":"2022-01-29T09:29:59.926Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsad000hp3m20u4h4iwp","content":"<h2 id=\"1-Root\"><a href=\"#1-Root\" class=\"headerlink\" title=\"1.Root\"></a>1.Root</h2><p>Xin được nhắc lại một câu chuyện cũ tôi đã kể trong bài viết trước với ví dụ về mảnh đất nhà bạn, bạn sở hữu mảnh đất đó, vợ bạn sở hữu mảnh đất đó chung với bạn. Nhưng vợ chồng bạn không phải là những người sở hữu tối thượng của mảnh đất kể trên, mà quyền lực to lớn này thuộc về nhà nước, “người” thực ra là đang cho bạn thuê đất có thời hạn. Tương tự trọng Unix/Linux, sẽ có những user (như tài khoản bạn sử dụng để đăng nhập, hoặc tài khoản khách…).</p>\n<p>Việc những tài khoản này có thể đăng nhập vào hệ thống nhưng đặc quyền của chúng bị giới hạn. Khi login vào hệ thống, bạn có thể làm một số tác vụ nhất định chứ không thể thích làm gì thì làm, trong hệ thống của bạn chỉ có một user duy nhất được quyền làm bất cứ điều gì, đó là một super user.</p>\n<p>Trên windows, ta gọi đó là <strong>administrator</strong> (có lẽ quá quen thuộc, bạn còn nhớ những lúc cài phần mềm, bạn click vào file exe nhưng chương trình không chịu cài đặt, google một lát, bạn nhận được một hướng dẫn hãy click phải vào file exe đó và chọn <strong>run as administrator</strong>, đó chính là sức mạnh của super user trên windows), còn trên macOS hay Ubuntu(1 đại diện của Linux), nó được gọi là <strong>root</strong> (cuối cùng cũng chỉ là một cái tên gọi, nó có thể được đặt tên là mèo, là chó, nó có thể được đặt tên là bất cứ thứ gì, chúng ta không cần quan tâm, điều duy nhất chúng ta cần biết đó là trên các hệ điều hành con cháu của Unix sẽ luôn có một super user quyền lực như vậy).</p>\n<p>Đến lúc này, bạn sẽ tự hỏi tại sao phải thiết kế hệ thống phức tạp như vậy? Tại sao không chỉ dung duy nhất một loại user?<br>Câu trả lời rất đơn giản, không phải ai sử dụng máy tính cũng là những người dung có hiểu biết sâu sắc về hệ điều hành. Vì vậy, nếu trao cho họ những quyền lực quá lớn, họ có thể vô tình gây ra những huỷ hoại nghiêm trọng cho hệ thống (quyền lực càng lớn thì trách nhiệm càng lớn).</p>\n<p>Một vấn đề phát sinh nếu việc sử dụng Root mang tính rủi ro quá cao nhưng những user bình thường lại không có các quyền để cài đặt một số phần mềm nâng cao thì phải làm sao? Vấn đề này sẽ được giải thích ở mục số 2.</p>\n<p>Note: Trên macOS và Ubuntu, <strong>root</strong> mặc định sẽ được disable, chúng có thể sẽ được enable trở lại và re-disable. Cách thực hiện thì có lẽ bạn nên tìm kiếm hướng dẫn từ trang chủ của những hệ điều hành này để câu lệnh của bạn đảm bảo chính xác và không bị lỗi thời.</p>\n<h2 id=\"2-Sudo\"><a href=\"#2-Sudo\" class=\"headerlink\" title=\"2.Sudo\"></a>2.Sudo</h2><p>Như vấn đề tôi đã nêu ở cuối mục 1, bây giờ tôi muốn cài đặt một số phần mềm đòi hỏi quyền của super user, về lý thuyết tôi đứng giữa hai lựa chọn hoặc chuyển sang <strong>root</strong> và cài đặt phần mềm bình thường (rất rủi ro), phương án 2 là tôi vẫn sử dụng user thường và nói lời tạm biệt với những phần mềm kể trên.</p>\n<p>Quá tệ, cả hai giải pháp trên đều không ổn, thật may, các nhà phát triển hệ thống đã cung cấp cho chúng ta một lựa chọn số 3, đó là bạn vẫn sử dụng user thường nhưng có thể triệu hồi quyền lực của super user để thực hiện những lệnh nào đó.</p>\n<p>Cách sử dụng đó là bạn thêm câu lệnh <strong>sudo</strong> vào phía trước câu lệnh cần sử dụng quyền của super user. Ví dụ:</p>\n<p><strong>sudo apt-get update</strong></p>\n<p>Một nhầm lẫn thường xuyên với cả với tôi ngày mới tìm hiểu, đó là sau khi gõ những câu lệnh có <strong>sudo</strong>, hệ thống yêu cầu tôi nhập mật khẩu và tôi đã từng nghĩ đó là mật khẩu của <strong>root</strong> (nghe cũng hợp lý đấy chứ, ta mượn quyền của <strong>root</strong> thì phải sử dụng mật khẩu của <strong>root</strong> chứ nhỉ? Giống như khi tôi mượn nhà của bạn thì tôi phải có chìa khoá của bạn). Nhưng không phải như vậy, mật khẩu bạn nhập vào đơn thuần là chính mật khẩu của user thường bạn đang login trên máy.</p>\n<p>Phần đa các trường hợp khi bạn thêm <strong>sudo</strong>, các câu lệnh sẽ chạy một cách hoàn hảo. Tuy nhiên, cũng có những khi bạn không nhận được kết quả như mong đợi và lý do chính là không phải user nào cũng có thể triệu hồi quyền lực của super user. Điều bạn cần làm khi đó là “nói” với hệ điều hành rằng hãy cho user của tôi đang sử dụng được quyền triệu hồi sức mạnh của super user. Hãy xem ví dụ dưới đây:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#=&gt; /etc/sudoers (lưu trữ các user được quyền thực hiện đặc quyền của super user)</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Ví dụ</span></span><br><span class=\"line\">root ALL=(<span class=\"symbol\">ALL:</span>ALL) ALL</span><br><span class=\"line\"><span class=\"comment\">#=&gt; user đang xét quyền tên là root</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Chữ all đầu tiên chỉ ra rằng rule này được áp dụng cho tất cả các host</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Chữ all thứ hai chỉ ra, account root có thể chạy lệnh với quyền của bất kỳ user nào.</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Chữ all thứ ba chỉ ra, account root có thể chạy lệnh với quyền của bất kỳ group nào.</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Chữ all cuối cùng chỉ ra, account root có thể chạy bất kỳ command nào.</span></span><br></pre></td></tr></table></figure>\n\n<p>Note: Kể từ khi bạn nhập mật khẩu sau khi gõ lệnh <strong>sudo</strong> lần đầu, thời gian có hiệu lực của mật khẩu này sẽ là 15 phút. Trong khoảng thời gian đó bạn có thể chạy các lệnh <strong>sudo</strong> khác mà hệ điều hành không yêu cầu bạn nhập lại mật khẩu.</p>\n<h2 id=\"3-Package-management-system\"><a href=\"#3-Package-management-system\" class=\"headerlink\" title=\"3.Package management system\"></a>3.Package management system</h2><p>Khi sử dụng macOS, để cài đặt thêm các phần mềm phục vụ công việc (mà chúng không được support trên appstore), tôi sử dụng <strong>homebrew</strong>, một phần mềm giúp quản lý các phần mềm khác rất hiệu quả.</p>\n<p>Vậy còn trên Linux chúng ta có gì?</p>\n<p>Trước hết cần phải làm rõ: Package management system là một công cụ hoặc một hệ thống các công cụ được sử dụng để handle các package.</p>\n<ol>\n<li>Handle là quản lý với đầy đủ các chức năng như thêm mới, gỡ bỏ, nâng cấp, tìm kiếm..v..v…</li>\n<li>Package là một tiện ích hoặc những phần bổ trợ cho một tiện ích nào đó (thực sự cuối cùng nó cũng chỉ là tập hợp của các file).</li>\n</ol>\n<p>Một <strong>Package Management System</strong> nổi tiếng trên Linux đó là <strong>DPKG</strong>, nó là một công cụ để cài đặt các package có đuôi .deb (các package dành cho các hệ điều hành thuộc dòng debian).<br>Nhiệm vụ của <strong>DPKG</strong> là install hoặc remove một package (với điều kiện các file cần thiết đã có trên local).</p>\n<p>Đến đây nhiều bạn có thể thắc mắc rằng từ trước đến giờ bạn chưa hề sử dụng các dòng lệnh liên quan đến <strong>DPKG</strong>, vậy tại sao tôi lại bảo là nó rất phổ biến? Câu trả lời đó là bạn đang sử dụng các phần mềm package management system khác được xây dựng dựa trên phần core là <strong>DPKG</strong>, một trong số đó là <strong>APT–GET/APT</strong>.</p>\n<p>Ưu điểm lớn nhất của <strong>APT</strong> so với <strong>DPKG</strong> đó là <strong>DPKG</strong> chỉ có thể cài đặt file khi mà file đó đã có trên local (tức là bằng cách nào đó bạn phải download hoặc copy file đó về máy của bạn). Còn với <strong>APT</strong>, nó sẽ tìm kiếm các package đó từ <strong>remote repositories</strong>, sau đó download chúng về máy.</p>\n<p>Điểm mạnh thứ hai của <strong>APT</strong> so với <strong>DPKG</strong> đó là nó giải quyết được bài toán dependencies. Nếu package bạn cần cài đặt phụ thuộc vào một vài package khác, nếu sử dụng <strong>DPKG</strong> thì bạn sẽ phải cài đặt tất cả các package kể trên một cách thủ công.<br>Còn với <strong>APT</strong>, nó sẽ tự hiểu được package đó cần thêm những phụ trợ nào và tự động cài đặt phần phụ trợ.</p>\n<p>Điều thật sự diễn ra đó là trong <strong>APT</strong>, <strong>DPKG</strong> vẫn tồn tại. Nó tồn tại ở một cấp thấp hơn và thực hiện các chỉ thị của <strong>APT</strong>.</p>\n<p>Note: Các <strong>remote repositories</strong> để phần mềm package management của bạn tìm kiếm sẽ được lưu trữ trong file <strong>/etc/apt/sources.list</strong> (đa số là như vậy).</p>\n<h2 id=\"4-Tham-khao\"><a href=\"#4-Tham-khao\" class=\"headerlink\" title=\"4. Tham khảo\"></a>4. Tham khảo</h2><p>[1] <a href=\"https://www.quora.com/What-is-package-management\" target=\"_blank\" rel=\"noopener\">https://www.quora.com/What-is-package-management</a></p>\n<p>[2] <a href=\"https://www.tecmint.com/linux-package-management/\" target=\"_blank\" rel=\"noopener\">https://www.tecmint.com/linux-package-management/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Root\"><a href=\"#1-Root\" class=\"headerlink\" title=\"1.Root\"></a>1.Root</h2><p>Xin được nhắc lại một câu chuyện cũ tôi đã kể trong bài viết trước với ví dụ về mảnh đất nhà bạn, bạn sở hữu mảnh đất đó, vợ bạn sở hữu mảnh đất đó chung với bạn. Nhưng vợ chồng bạn không phải là những người sở hữu tối thượng của mảnh đất kể trên, mà quyền lực to lớn này thuộc về nhà nước, “người” thực ra là đang cho bạn thuê đất có thời hạn. Tương tự trọng Unix/Linux, sẽ có những user (như tài khoản bạn sử dụng để đăng nhập, hoặc tài khoản khách…).</p>\n<p>Việc những tài khoản này có thể đăng nhập vào hệ thống nhưng đặc quyền của chúng bị giới hạn. Khi login vào hệ thống, bạn có thể làm một số tác vụ nhất định chứ không thể thích làm gì thì làm, trong hệ thống của bạn chỉ có một user duy nhất được quyền làm bất cứ điều gì, đó là một super user.</p>\n<p>Trên windows, ta gọi đó là <strong>administrator</strong> (có lẽ quá quen thuộc, bạn còn nhớ những lúc cài phần mềm, bạn click vào file exe nhưng chương trình không chịu cài đặt, google một lát, bạn nhận được một hướng dẫn hãy click phải vào file exe đó và chọn <strong>run as administrator</strong>, đó chính là sức mạnh của super user trên windows), còn trên macOS hay Ubuntu(1 đại diện của Linux), nó được gọi là <strong>root</strong> (cuối cùng cũng chỉ là một cái tên gọi, nó có thể được đặt tên là mèo, là chó, nó có thể được đặt tên là bất cứ thứ gì, chúng ta không cần quan tâm, điều duy nhất chúng ta cần biết đó là trên các hệ điều hành con cháu của Unix sẽ luôn có một super user quyền lực như vậy).</p>\n<p>Đến lúc này, bạn sẽ tự hỏi tại sao phải thiết kế hệ thống phức tạp như vậy? Tại sao không chỉ dung duy nhất một loại user?<br>Câu trả lời rất đơn giản, không phải ai sử dụng máy tính cũng là những người dung có hiểu biết sâu sắc về hệ điều hành. Vì vậy, nếu trao cho họ những quyền lực quá lớn, họ có thể vô tình gây ra những huỷ hoại nghiêm trọng cho hệ thống (quyền lực càng lớn thì trách nhiệm càng lớn).</p>\n<p>Một vấn đề phát sinh nếu việc sử dụng Root mang tính rủi ro quá cao nhưng những user bình thường lại không có các quyền để cài đặt một số phần mềm nâng cao thì phải làm sao? Vấn đề này sẽ được giải thích ở mục số 2.</p>\n<p>Note: Trên macOS và Ubuntu, <strong>root</strong> mặc định sẽ được disable, chúng có thể sẽ được enable trở lại và re-disable. Cách thực hiện thì có lẽ bạn nên tìm kiếm hướng dẫn từ trang chủ của những hệ điều hành này để câu lệnh của bạn đảm bảo chính xác và không bị lỗi thời.</p>\n<h2 id=\"2-Sudo\"><a href=\"#2-Sudo\" class=\"headerlink\" title=\"2.Sudo\"></a>2.Sudo</h2><p>Như vấn đề tôi đã nêu ở cuối mục 1, bây giờ tôi muốn cài đặt một số phần mềm đòi hỏi quyền của super user, về lý thuyết tôi đứng giữa hai lựa chọn hoặc chuyển sang <strong>root</strong> và cài đặt phần mềm bình thường (rất rủi ro), phương án 2 là tôi vẫn sử dụng user thường và nói lời tạm biệt với những phần mềm kể trên.</p>\n<p>Quá tệ, cả hai giải pháp trên đều không ổn, thật may, các nhà phát triển hệ thống đã cung cấp cho chúng ta một lựa chọn số 3, đó là bạn vẫn sử dụng user thường nhưng có thể triệu hồi quyền lực của super user để thực hiện những lệnh nào đó.</p>\n<p>Cách sử dụng đó là bạn thêm câu lệnh <strong>sudo</strong> vào phía trước câu lệnh cần sử dụng quyền của super user. Ví dụ:</p>\n<p><strong>sudo apt-get update</strong></p>\n<p>Một nhầm lẫn thường xuyên với cả với tôi ngày mới tìm hiểu, đó là sau khi gõ những câu lệnh có <strong>sudo</strong>, hệ thống yêu cầu tôi nhập mật khẩu và tôi đã từng nghĩ đó là mật khẩu của <strong>root</strong> (nghe cũng hợp lý đấy chứ, ta mượn quyền của <strong>root</strong> thì phải sử dụng mật khẩu của <strong>root</strong> chứ nhỉ? Giống như khi tôi mượn nhà của bạn thì tôi phải có chìa khoá của bạn). Nhưng không phải như vậy, mật khẩu bạn nhập vào đơn thuần là chính mật khẩu của user thường bạn đang login trên máy.</p>\n<p>Phần đa các trường hợp khi bạn thêm <strong>sudo</strong>, các câu lệnh sẽ chạy một cách hoàn hảo. Tuy nhiên, cũng có những khi bạn không nhận được kết quả như mong đợi và lý do chính là không phải user nào cũng có thể triệu hồi quyền lực của super user. Điều bạn cần làm khi đó là “nói” với hệ điều hành rằng hãy cho user của tôi đang sử dụng được quyền triệu hồi sức mạnh của super user. Hãy xem ví dụ dưới đây:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#=&gt; /etc/sudoers (lưu trữ các user được quyền thực hiện đặc quyền của super user)</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Ví dụ</span></span><br><span class=\"line\">root ALL=(<span class=\"symbol\">ALL:</span>ALL) ALL</span><br><span class=\"line\"><span class=\"comment\">#=&gt; user đang xét quyền tên là root</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Chữ all đầu tiên chỉ ra rằng rule này được áp dụng cho tất cả các host</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Chữ all thứ hai chỉ ra, account root có thể chạy lệnh với quyền của bất kỳ user nào.</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Chữ all thứ ba chỉ ra, account root có thể chạy lệnh với quyền của bất kỳ group nào.</span></span><br><span class=\"line\"><span class=\"comment\">#=&gt; Chữ all cuối cùng chỉ ra, account root có thể chạy bất kỳ command nào.</span></span><br></pre></td></tr></table></figure>\n\n<p>Note: Kể từ khi bạn nhập mật khẩu sau khi gõ lệnh <strong>sudo</strong> lần đầu, thời gian có hiệu lực của mật khẩu này sẽ là 15 phút. Trong khoảng thời gian đó bạn có thể chạy các lệnh <strong>sudo</strong> khác mà hệ điều hành không yêu cầu bạn nhập lại mật khẩu.</p>\n<h2 id=\"3-Package-management-system\"><a href=\"#3-Package-management-system\" class=\"headerlink\" title=\"3.Package management system\"></a>3.Package management system</h2><p>Khi sử dụng macOS, để cài đặt thêm các phần mềm phục vụ công việc (mà chúng không được support trên appstore), tôi sử dụng <strong>homebrew</strong>, một phần mềm giúp quản lý các phần mềm khác rất hiệu quả.</p>\n<p>Vậy còn trên Linux chúng ta có gì?</p>\n<p>Trước hết cần phải làm rõ: Package management system là một công cụ hoặc một hệ thống các công cụ được sử dụng để handle các package.</p>\n<ol>\n<li>Handle là quản lý với đầy đủ các chức năng như thêm mới, gỡ bỏ, nâng cấp, tìm kiếm..v..v…</li>\n<li>Package là một tiện ích hoặc những phần bổ trợ cho một tiện ích nào đó (thực sự cuối cùng nó cũng chỉ là tập hợp của các file).</li>\n</ol>\n<p>Một <strong>Package Management System</strong> nổi tiếng trên Linux đó là <strong>DPKG</strong>, nó là một công cụ để cài đặt các package có đuôi .deb (các package dành cho các hệ điều hành thuộc dòng debian).<br>Nhiệm vụ của <strong>DPKG</strong> là install hoặc remove một package (với điều kiện các file cần thiết đã có trên local).</p>\n<p>Đến đây nhiều bạn có thể thắc mắc rằng từ trước đến giờ bạn chưa hề sử dụng các dòng lệnh liên quan đến <strong>DPKG</strong>, vậy tại sao tôi lại bảo là nó rất phổ biến? Câu trả lời đó là bạn đang sử dụng các phần mềm package management system khác được xây dựng dựa trên phần core là <strong>DPKG</strong>, một trong số đó là <strong>APT–GET/APT</strong>.</p>\n<p>Ưu điểm lớn nhất của <strong>APT</strong> so với <strong>DPKG</strong> đó là <strong>DPKG</strong> chỉ có thể cài đặt file khi mà file đó đã có trên local (tức là bằng cách nào đó bạn phải download hoặc copy file đó về máy của bạn). Còn với <strong>APT</strong>, nó sẽ tìm kiếm các package đó từ <strong>remote repositories</strong>, sau đó download chúng về máy.</p>\n<p>Điểm mạnh thứ hai của <strong>APT</strong> so với <strong>DPKG</strong> đó là nó giải quyết được bài toán dependencies. Nếu package bạn cần cài đặt phụ thuộc vào một vài package khác, nếu sử dụng <strong>DPKG</strong> thì bạn sẽ phải cài đặt tất cả các package kể trên một cách thủ công.<br>Còn với <strong>APT</strong>, nó sẽ tự hiểu được package đó cần thêm những phụ trợ nào và tự động cài đặt phần phụ trợ.</p>\n<p>Điều thật sự diễn ra đó là trong <strong>APT</strong>, <strong>DPKG</strong> vẫn tồn tại. Nó tồn tại ở một cấp thấp hơn và thực hiện các chỉ thị của <strong>APT</strong>.</p>\n<p>Note: Các <strong>remote repositories</strong> để phần mềm package management của bạn tìm kiếm sẽ được lưu trữ trong file <strong>/etc/apt/sources.list</strong> (đa số là như vậy).</p>\n<h2 id=\"4-Tham-khao\"><a href=\"#4-Tham-khao\" class=\"headerlink\" title=\"4. Tham khảo\"></a>4. Tham khảo</h2><p>[1] <a href=\"https://www.quora.com/What-is-package-management\" target=\"_blank\" rel=\"noopener\">https://www.quora.com/What-is-package-management</a></p>\n<p>[2] <a href=\"https://www.tecmint.com/linux-package-management/\" target=\"_blank\" rel=\"noopener\">https://www.tecmint.com/linux-package-management/</a></p>\n"},{"title":"Method Lookup Trong Ruby","date":"2019-02-23T17:00:00.000Z","draft":false,"mytag":"#TIL","_content":"\n## 1. Method Lookup\n\nĐã khi nào bạn tự hỏi, giả sử nếu bạn có một class A, và class này include thêm hai module vào nữa, nếu trong hai module đó cùng định nghĩa một phương thức, vậy khi instance của A gọi đến phương thức đó, điều gì sẽ xảy ra? Phương thức trong module nào được chạy?\n\n\nCâu trả lời là thứ tự các phương thức được ruby tìm kiếm như sau:\n\n1. Phương thức được định nghĩa trong **object's singleton class**.\n\n2. Phương thức trong **module** được mixin trong **singleton class**(Theo thứ tự đảo ngược, vào sau sẽ tìm kiếm trước).\n\n3. Phương thức được định nghĩa trong **class** của đối tượng ta đang xét.\n\n4. Phương thức trong các **module** được **include** vào class ta đang xét (Cũng theo tứ tự đảo ngược).\n\n5. Phương thức trong **Super class** của class ta đang xét.\n\nĐể làm rõ điều đã nói hãy xét ví dụ dưới đây:\n\n```ruby\nmodule One\n  def hello\n    \"I'm one (include in class Test)\"\n  end\nend\n\nmodule Two\n  def hello\n    \"I'm two (include in class Test)\"\n  end\nend\n\nmodule Three\n  def hello\n    \"I'm three (extend)\"\n  end\nend\n\nmodule Four\n  def hello\n    \"I'm four (extend)\"\n  end\nend\n\nclass FatherOfTest\n  def hello\n   \"I'm father of test class\"\n  end\nend\n\nclass Test < FatherOfTest\n  include One\n  include Two\n\n  def hello\n    \"It's my hello - Test class\"\n  end\nend\n\nm = Test.new\n\ndef m.hello\n  \"I'm object m\"\nend\n\nm.extend(Three)\nm.extend(Four)\n\nm.hello\n```\n\nTất nhiên đoạn mã trên sẽ có output là:\n\n**\"I'm object m\"**\n\nTheo thứ tự tìm kiếm đã liệt kê ở trên, khi ruby tìm thấy phương thức lần đầu nó sẽ dừng tìm kiếm và khi đi hết các thứ tự và vẫn không tìm được thì nó sẽ gọi đến một phương thức mặc đinh là **method_missing**.\n\nBỏ đoạn code:\n\n```ruby\ndef m.hello\n  \"I'm object m\"\nend\n```\n\nChạy lại ta nhận được kết quả:\n\n**\"I'm four (extend)\"**\n\nLàm tương tự rồi ta sẽ tìm ra thứ tự ưu tiên kết quả như sau:\n\n``` ruby\n# phương thức hello cho riêng instance m\n\"I'm object m\"\n# phương thức được extend riêng cho m\n\"I'm four (extend)\"\n\"I'm three (extend)\"\n# phương thức trong chính class Test, class của m\n\"It's my hello - Test class\"\n# phương thức trong module được include vào Class Test\n\"I'm two (include in class Test)\"\n\"I'm one (include in class Test)\"\n# phương thức trong lớp cha của Class Test\n\"I'm father of test class\"\n```\n\nNếu bạn đang còn một chút bối rối vì những từ khoá và cách sử dụng **extend** và **include** hãy đọc tiếp mục dưới.\n\n## 2. Extend, Include trong Ruby\n\nTrong ruby không có đa kế thừa, thay vào đó ruby sử dụng **mixin**.\n\nMột class chỉ được kế thừa từ một class khác. Tuy nhiên nó được **mixin** nhiều **module** bằng hai phương thức là **include** và **extend**.\n\n**include:** với việc bạn include moudle A vào trong class B, đồng nghĩa với việc instance của class B có thể sử dụng tất cả các **instance method** trong moudle A. Vậy còn **module method** trong A thì sao? Câu trả lời là những **module method** trong A thì A sử dụng thôi.\n\n**extend:** đúng với ngữ nghĩa của nó, **mở rộng**, **extend** có thể dùng để mở rộng một class hoặc cũng có thể dùng để mở rộng một instance.  Trong ví dụ trên mục 1, tôi **extend** object **m**, từ đó giúp m được mở rộng thêm các phương thức ứng với tất cả các **instance method** trong module nó extend (đây là \"mở rộng\" cho một đối tượng). Nếu tôi muốn mở rộng cho một class, tôi sẽ extend moudle trong class đó, và sau đó tất cả các **instance method** trong module sẽ trở thành như các **class method** cho class (đây là sự \"mở rộng\" cho một lớp). Vậy còn **module method** trong moudle thì sao?Câu trả lời vẫn như trên, những phương thức module thì để module đó sử dụng.\n","source":"_posts/2019-02-24-ruby-method-lookup.md","raw":"---\ntitle: \"Method Lookup Trong Ruby\"\ndate: 2019-02-24\ndraft: false\ntags: [\"ruby\"]\ncategories: [\"ruby notes\"]\nmytag: \"#TIL\"\n---\n\n## 1. Method Lookup\n\nĐã khi nào bạn tự hỏi, giả sử nếu bạn có một class A, và class này include thêm hai module vào nữa, nếu trong hai module đó cùng định nghĩa một phương thức, vậy khi instance của A gọi đến phương thức đó, điều gì sẽ xảy ra? Phương thức trong module nào được chạy?\n\n\nCâu trả lời là thứ tự các phương thức được ruby tìm kiếm như sau:\n\n1. Phương thức được định nghĩa trong **object's singleton class**.\n\n2. Phương thức trong **module** được mixin trong **singleton class**(Theo thứ tự đảo ngược, vào sau sẽ tìm kiếm trước).\n\n3. Phương thức được định nghĩa trong **class** của đối tượng ta đang xét.\n\n4. Phương thức trong các **module** được **include** vào class ta đang xét (Cũng theo tứ tự đảo ngược).\n\n5. Phương thức trong **Super class** của class ta đang xét.\n\nĐể làm rõ điều đã nói hãy xét ví dụ dưới đây:\n\n```ruby\nmodule One\n  def hello\n    \"I'm one (include in class Test)\"\n  end\nend\n\nmodule Two\n  def hello\n    \"I'm two (include in class Test)\"\n  end\nend\n\nmodule Three\n  def hello\n    \"I'm three (extend)\"\n  end\nend\n\nmodule Four\n  def hello\n    \"I'm four (extend)\"\n  end\nend\n\nclass FatherOfTest\n  def hello\n   \"I'm father of test class\"\n  end\nend\n\nclass Test < FatherOfTest\n  include One\n  include Two\n\n  def hello\n    \"It's my hello - Test class\"\n  end\nend\n\nm = Test.new\n\ndef m.hello\n  \"I'm object m\"\nend\n\nm.extend(Three)\nm.extend(Four)\n\nm.hello\n```\n\nTất nhiên đoạn mã trên sẽ có output là:\n\n**\"I'm object m\"**\n\nTheo thứ tự tìm kiếm đã liệt kê ở trên, khi ruby tìm thấy phương thức lần đầu nó sẽ dừng tìm kiếm và khi đi hết các thứ tự và vẫn không tìm được thì nó sẽ gọi đến một phương thức mặc đinh là **method_missing**.\n\nBỏ đoạn code:\n\n```ruby\ndef m.hello\n  \"I'm object m\"\nend\n```\n\nChạy lại ta nhận được kết quả:\n\n**\"I'm four (extend)\"**\n\nLàm tương tự rồi ta sẽ tìm ra thứ tự ưu tiên kết quả như sau:\n\n``` ruby\n# phương thức hello cho riêng instance m\n\"I'm object m\"\n# phương thức được extend riêng cho m\n\"I'm four (extend)\"\n\"I'm three (extend)\"\n# phương thức trong chính class Test, class của m\n\"It's my hello - Test class\"\n# phương thức trong module được include vào Class Test\n\"I'm two (include in class Test)\"\n\"I'm one (include in class Test)\"\n# phương thức trong lớp cha của Class Test\n\"I'm father of test class\"\n```\n\nNếu bạn đang còn một chút bối rối vì những từ khoá và cách sử dụng **extend** và **include** hãy đọc tiếp mục dưới.\n\n## 2. Extend, Include trong Ruby\n\nTrong ruby không có đa kế thừa, thay vào đó ruby sử dụng **mixin**.\n\nMột class chỉ được kế thừa từ một class khác. Tuy nhiên nó được **mixin** nhiều **module** bằng hai phương thức là **include** và **extend**.\n\n**include:** với việc bạn include moudle A vào trong class B, đồng nghĩa với việc instance của class B có thể sử dụng tất cả các **instance method** trong moudle A. Vậy còn **module method** trong A thì sao? Câu trả lời là những **module method** trong A thì A sử dụng thôi.\n\n**extend:** đúng với ngữ nghĩa của nó, **mở rộng**, **extend** có thể dùng để mở rộng một class hoặc cũng có thể dùng để mở rộng một instance.  Trong ví dụ trên mục 1, tôi **extend** object **m**, từ đó giúp m được mở rộng thêm các phương thức ứng với tất cả các **instance method** trong module nó extend (đây là \"mở rộng\" cho một đối tượng). Nếu tôi muốn mở rộng cho một class, tôi sẽ extend moudle trong class đó, và sau đó tất cả các **instance method** trong module sẽ trở thành như các **class method** cho class (đây là sự \"mở rộng\" cho một lớp). Vậy còn **module method** trong moudle thì sao?Câu trả lời vẫn như trên, những phương thức module thì để module đó sử dụng.\n","slug":"2019-02-24-ruby-method-lookup","published":1,"updated":"2022-01-29T09:29:59.926Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsae000ip3m25gc82b75","content":"<h2 id=\"1-Method-Lookup\"><a href=\"#1-Method-Lookup\" class=\"headerlink\" title=\"1. Method Lookup\"></a>1. Method Lookup</h2><p>Đã khi nào bạn tự hỏi, giả sử nếu bạn có một class A, và class này include thêm hai module vào nữa, nếu trong hai module đó cùng định nghĩa một phương thức, vậy khi instance của A gọi đến phương thức đó, điều gì sẽ xảy ra? Phương thức trong module nào được chạy?</p>\n<p>Câu trả lời là thứ tự các phương thức được ruby tìm kiếm như sau:</p>\n<ol>\n<li><p>Phương thức được định nghĩa trong <strong>object’s singleton class</strong>.</p>\n</li>\n<li><p>Phương thức trong <strong>module</strong> được mixin trong <strong>singleton class</strong>(Theo thứ tự đảo ngược, vào sau sẽ tìm kiếm trước).</p>\n</li>\n<li><p>Phương thức được định nghĩa trong <strong>class</strong> của đối tượng ta đang xét.</p>\n</li>\n<li><p>Phương thức trong các <strong>module</strong> được <strong>include</strong> vào class ta đang xét (Cũng theo tứ tự đảo ngược).</p>\n</li>\n<li><p>Phương thức trong <strong>Super class</strong> của class ta đang xét.</p>\n</li>\n</ol>\n<p>Để làm rõ điều đã nói hãy xét ví dụ dưới đây:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">One</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    <span class=\"string\">\"I'm one (include in class Test)\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">Two</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    <span class=\"string\">\"I'm two (include in class Test)\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">Three</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    <span class=\"string\">\"I'm three (extend)\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">Four</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    <span class=\"string\">\"I'm four (extend)\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FatherOfTest</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">   <span class=\"string\">\"I'm father of test class\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test</span> &lt; FatherOfTest</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> One</span><br><span class=\"line\">  <span class=\"keyword\">include</span> Two</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    <span class=\"string\">\"It's my hello - Test class\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">m = Test.new</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">m</span>.<span class=\"title\">hello</span></span></span><br><span class=\"line\">  <span class=\"string\">\"I'm object m\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">m.extend(Three)</span><br><span class=\"line\">m.extend(Four)</span><br><span class=\"line\"></span><br><span class=\"line\">m.hello</span><br></pre></td></tr></table></figure>\n\n<p>Tất nhiên đoạn mã trên sẽ có output là:</p>\n<p><strong>“I’m object m”</strong></p>\n<p>Theo thứ tự tìm kiếm đã liệt kê ở trên, khi ruby tìm thấy phương thức lần đầu nó sẽ dừng tìm kiếm và khi đi hết các thứ tự và vẫn không tìm được thì nó sẽ gọi đến một phương thức mặc đinh là <strong>method_missing</strong>.</p>\n<p>Bỏ đoạn code:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">m</span>.<span class=\"title\">hello</span></span></span><br><span class=\"line\">  <span class=\"string\">\"I'm object m\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Chạy lại ta nhận được kết quả:</p>\n<p><strong>“I’m four (extend)”</strong></p>\n<p>Làm tương tự rồi ta sẽ tìm ra thứ tự ưu tiên kết quả như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># phương thức hello cho riêng instance m</span></span><br><span class=\"line\"><span class=\"string\">\"I'm object m\"</span></span><br><span class=\"line\"><span class=\"comment\"># phương thức được extend riêng cho m</span></span><br><span class=\"line\"><span class=\"string\">\"I'm four (extend)\"</span></span><br><span class=\"line\"><span class=\"string\">\"I'm three (extend)\"</span></span><br><span class=\"line\"><span class=\"comment\"># phương thức trong chính class Test, class của m</span></span><br><span class=\"line\"><span class=\"string\">\"It's my hello - Test class\"</span></span><br><span class=\"line\"><span class=\"comment\"># phương thức trong module được include vào Class Test</span></span><br><span class=\"line\"><span class=\"string\">\"I'm two (include in class Test)\"</span></span><br><span class=\"line\"><span class=\"string\">\"I'm one (include in class Test)\"</span></span><br><span class=\"line\"><span class=\"comment\"># phương thức trong lớp cha của Class Test</span></span><br><span class=\"line\"><span class=\"string\">\"I'm father of test class\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Nếu bạn đang còn một chút bối rối vì những từ khoá và cách sử dụng <strong>extend</strong> và <strong>include</strong> hãy đọc tiếp mục dưới.</p>\n<h2 id=\"2-Extend-Include-trong-Ruby\"><a href=\"#2-Extend-Include-trong-Ruby\" class=\"headerlink\" title=\"2. Extend, Include trong Ruby\"></a>2. Extend, Include trong Ruby</h2><p>Trong ruby không có đa kế thừa, thay vào đó ruby sử dụng <strong>mixin</strong>.</p>\n<p>Một class chỉ được kế thừa từ một class khác. Tuy nhiên nó được <strong>mixin</strong> nhiều <strong>module</strong> bằng hai phương thức là <strong>include</strong> và <strong>extend</strong>.</p>\n<p><strong>include:</strong> với việc bạn include moudle A vào trong class B, đồng nghĩa với việc instance của class B có thể sử dụng tất cả các <strong>instance method</strong> trong moudle A. Vậy còn <strong>module method</strong> trong A thì sao? Câu trả lời là những <strong>module method</strong> trong A thì A sử dụng thôi.</p>\n<p><strong>extend:</strong> đúng với ngữ nghĩa của nó, <strong>mở rộng</strong>, <strong>extend</strong> có thể dùng để mở rộng một class hoặc cũng có thể dùng để mở rộng một instance.  Trong ví dụ trên mục 1, tôi <strong>extend</strong> object <strong>m</strong>, từ đó giúp m được mở rộng thêm các phương thức ứng với tất cả các <strong>instance method</strong> trong module nó extend (đây là “mở rộng” cho một đối tượng). Nếu tôi muốn mở rộng cho một class, tôi sẽ extend moudle trong class đó, và sau đó tất cả các <strong>instance method</strong> trong module sẽ trở thành như các <strong>class method</strong> cho class (đây là sự “mở rộng” cho một lớp). Vậy còn <strong>module method</strong> trong moudle thì sao?Câu trả lời vẫn như trên, những phương thức module thì để module đó sử dụng.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Method-Lookup\"><a href=\"#1-Method-Lookup\" class=\"headerlink\" title=\"1. Method Lookup\"></a>1. Method Lookup</h2><p>Đã khi nào bạn tự hỏi, giả sử nếu bạn có một class A, và class này include thêm hai module vào nữa, nếu trong hai module đó cùng định nghĩa một phương thức, vậy khi instance của A gọi đến phương thức đó, điều gì sẽ xảy ra? Phương thức trong module nào được chạy?</p>\n<p>Câu trả lời là thứ tự các phương thức được ruby tìm kiếm như sau:</p>\n<ol>\n<li><p>Phương thức được định nghĩa trong <strong>object’s singleton class</strong>.</p>\n</li>\n<li><p>Phương thức trong <strong>module</strong> được mixin trong <strong>singleton class</strong>(Theo thứ tự đảo ngược, vào sau sẽ tìm kiếm trước).</p>\n</li>\n<li><p>Phương thức được định nghĩa trong <strong>class</strong> của đối tượng ta đang xét.</p>\n</li>\n<li><p>Phương thức trong các <strong>module</strong> được <strong>include</strong> vào class ta đang xét (Cũng theo tứ tự đảo ngược).</p>\n</li>\n<li><p>Phương thức trong <strong>Super class</strong> của class ta đang xét.</p>\n</li>\n</ol>\n<p>Để làm rõ điều đã nói hãy xét ví dụ dưới đây:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">One</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    <span class=\"string\">\"I'm one (include in class Test)\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">Two</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    <span class=\"string\">\"I'm two (include in class Test)\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">Three</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    <span class=\"string\">\"I'm three (extend)\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">Four</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    <span class=\"string\">\"I'm four (extend)\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FatherOfTest</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">   <span class=\"string\">\"I'm father of test class\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Test</span> &lt; FatherOfTest</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> One</span><br><span class=\"line\">  <span class=\"keyword\">include</span> Two</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    <span class=\"string\">\"It's my hello - Test class\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">m = Test.new</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">m</span>.<span class=\"title\">hello</span></span></span><br><span class=\"line\">  <span class=\"string\">\"I'm object m\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">m.extend(Three)</span><br><span class=\"line\">m.extend(Four)</span><br><span class=\"line\"></span><br><span class=\"line\">m.hello</span><br></pre></td></tr></table></figure>\n\n<p>Tất nhiên đoạn mã trên sẽ có output là:</p>\n<p><strong>“I’m object m”</strong></p>\n<p>Theo thứ tự tìm kiếm đã liệt kê ở trên, khi ruby tìm thấy phương thức lần đầu nó sẽ dừng tìm kiếm và khi đi hết các thứ tự và vẫn không tìm được thì nó sẽ gọi đến một phương thức mặc đinh là <strong>method_missing</strong>.</p>\n<p>Bỏ đoạn code:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">m</span>.<span class=\"title\">hello</span></span></span><br><span class=\"line\">  <span class=\"string\">\"I'm object m\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Chạy lại ta nhận được kết quả:</p>\n<p><strong>“I’m four (extend)”</strong></p>\n<p>Làm tương tự rồi ta sẽ tìm ra thứ tự ưu tiên kết quả như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># phương thức hello cho riêng instance m</span></span><br><span class=\"line\"><span class=\"string\">\"I'm object m\"</span></span><br><span class=\"line\"><span class=\"comment\"># phương thức được extend riêng cho m</span></span><br><span class=\"line\"><span class=\"string\">\"I'm four (extend)\"</span></span><br><span class=\"line\"><span class=\"string\">\"I'm three (extend)\"</span></span><br><span class=\"line\"><span class=\"comment\"># phương thức trong chính class Test, class của m</span></span><br><span class=\"line\"><span class=\"string\">\"It's my hello - Test class\"</span></span><br><span class=\"line\"><span class=\"comment\"># phương thức trong module được include vào Class Test</span></span><br><span class=\"line\"><span class=\"string\">\"I'm two (include in class Test)\"</span></span><br><span class=\"line\"><span class=\"string\">\"I'm one (include in class Test)\"</span></span><br><span class=\"line\"><span class=\"comment\"># phương thức trong lớp cha của Class Test</span></span><br><span class=\"line\"><span class=\"string\">\"I'm father of test class\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Nếu bạn đang còn một chút bối rối vì những từ khoá và cách sử dụng <strong>extend</strong> và <strong>include</strong> hãy đọc tiếp mục dưới.</p>\n<h2 id=\"2-Extend-Include-trong-Ruby\"><a href=\"#2-Extend-Include-trong-Ruby\" class=\"headerlink\" title=\"2. Extend, Include trong Ruby\"></a>2. Extend, Include trong Ruby</h2><p>Trong ruby không có đa kế thừa, thay vào đó ruby sử dụng <strong>mixin</strong>.</p>\n<p>Một class chỉ được kế thừa từ một class khác. Tuy nhiên nó được <strong>mixin</strong> nhiều <strong>module</strong> bằng hai phương thức là <strong>include</strong> và <strong>extend</strong>.</p>\n<p><strong>include:</strong> với việc bạn include moudle A vào trong class B, đồng nghĩa với việc instance của class B có thể sử dụng tất cả các <strong>instance method</strong> trong moudle A. Vậy còn <strong>module method</strong> trong A thì sao? Câu trả lời là những <strong>module method</strong> trong A thì A sử dụng thôi.</p>\n<p><strong>extend:</strong> đúng với ngữ nghĩa của nó, <strong>mở rộng</strong>, <strong>extend</strong> có thể dùng để mở rộng một class hoặc cũng có thể dùng để mở rộng một instance.  Trong ví dụ trên mục 1, tôi <strong>extend</strong> object <strong>m</strong>, từ đó giúp m được mở rộng thêm các phương thức ứng với tất cả các <strong>instance method</strong> trong module nó extend (đây là “mở rộng” cho một đối tượng). Nếu tôi muốn mở rộng cho một class, tôi sẽ extend moudle trong class đó, và sau đó tất cả các <strong>instance method</strong> trong module sẽ trở thành như các <strong>class method</strong> cho class (đây là sự “mở rộng” cho một lớp). Vậy còn <strong>module method</strong> trong moudle thì sao?Câu trả lời vẫn như trên, những phương thức module thì để module đó sử dụng.</p>\n"},{"title":"Lưu Trữ Thông Tin Bảo Mật Trong Rails?","date":"2019-02-21T17:00:00.000Z","draft":false,"mytag":"Rails","mytrend":"COOL","_content":"\n## 1. Khái quát\n\nBài toán này đơn giản hiểu như sau: Một project bất kỳ sẽ luôn có những thông tin cấu hình vô cùng quan trọng, bắt buộc phải luôn giữ chúng private, còn làm cách nào để giữ chúng private trong rails?\nCâu trả lời là tuỳ vào mỗi phiên bản rails, sẽ có (có thể có) những cách khác nhau để xử lý vấn đề này. Hãy đi đến các dấu mốc cụ thể dưới đây.\n\n## 2. Rails 4.1\n\nPhiên bản rails này sử dụng một file có tên **secrets.yml**, đây là file sẽ lưu toàn bộ các thông tin nhạy cảm chúng ta đã nói ở trên.\nVới thiết kế như này ta có hai lựa chọn cho ứng dụng của mình:\n1. Đem hết thông tin nhạy cảm dưới đạng text bỏ vào file này, tuy nhiên file này phải được bỏ vào trong danh mục của **gitignore** để đảm bảo thông tin trong đó không bị bạn vô tình hay hữu ý commit đi đâu đó.\n\n2. Thông tin nhạy cảm lưu trong file này thay vì được lưu dưới dạng text thì sẽ được lưu trong máy của bạn dứoi dạng **biến môi trường** và trong file **secrets.yml** chỉ sử dụng phương thức **ENV** mà rails cung cấp để gọi lại các thông tin đó lên, với lựa chọn này bạn có thể commit file này thoải mái, ở các máy tính đồng nghiệp, để có thể sử dụng được những config này thì buộc họ phải thiết lập biến môi trường trên máy tính của họ cho phù hợp.\n\nNhược điểm: dù sử dụng cách nào, thì để ứng dụng hoạt động được thì vẫn phải truyền giá trị các thông tin nhạy cảm này từ máy của bạn lên một con vps khi triển khai chẳng hạn, không còn cách nào khác. Có thể bạn phải copy từng dòng thông tin nhạy cảm rồi paste qua remote shell để thiết lập (với những dự án lớn có rất nhiều thông tin quan trọng thì đây là 1 công việc vất vả tiềm tàng nguy cơ sai sót).\n\nNote: Thay vì sử dụng file **secrets.yml**, ta có thể sử dụng một file khác như **application.yml**, mục đích và chức năng của chúng là tương đương.\n\n## 3. Rails 5.1\n\nSang đến phiên bản rails 5.1, một thay đổi lớn đã tới. Thay vì lưu thông tin dạng text hoặc triệu hồi thông qua biến môi trường, rails khi này cung cấp khả năng mã hoá cho các thông tin nhạy cảm này.\nCách chúng hoạt động như sau:\n\nMột file tên **secrets.yml.key** sẽ chứa giá trị của một biến tên **RAILS_MASTER_KEY**, biến này có giá trị là một chuỗi, có chức năng được sử dụng để mã hoá và giải mã các thông tin quan trọng.\n\nNội dung thông tin **sau** mã hoá sẽ được lưu tại file **secrets.yml.enc**\n\nVậy còn file **secrets.yml** trong rails 4 giờ còn không? Câu trả lời là bạn vẫn có thể sử dụng file này, tuy nhiên trên cùng một môi trường, nếu có cả file **secrets.yml** và **secrets.yml.enc** thì hai file này sẽ được merge.\n\nĐể có thể sử dụng tính năng encypt này của rails 5.1 ta setup như sau:\n\n```ruby\nrails secrets:setup\n```\nSau câu lệnh này hai file **secrets.yml.key** và **secrets.yml.enc** sẽ được tạo ra. Để thêm xoá sửa nội dung trong **secrets.yml.enc** ta sử dụng lệnh sau:\n\n```ruby\nrails secrets:edit\n```\n\nCâu lệnh này sẽ mở nội dung file **secrets.yml.enc** dưới dạng đã giải mã. Bạn có thể thoải mái thêm xoá, sửa các thông tin nhạy cảm, sau đó khi bạn save lại và tắt editor thì file **secrets.yml.enc** sẽ tự động được cập nhập phần mã hoá mới nhất khi có thêm thông tin.\n\nTôi thích dùng **vim** để chỉnh sửa, và tôi không muốn set mặc định editor nên tôi sử dụng câu lệnh sau: **EDITOR=vi rails secrets:edit**.\n\nƯu điểm:\n\n1. Thay vì phải quản lý nhiều biến môi trường, giờ đây mọi thứ đều nằm trong một file.\n\n2. Việc có thể commit **secrets.yml.enc** giúp chúng ta nắm được lịch sử thay đổi của file này.\n\nNote: Một điểm quan trọng bạn cần lưu ý, đó là tới khi viết bài viết này thì tôi vẫn chưa thấy rails sẽ giải mã thông tin mã hoá trong file **secrets.yml.enc**, chúng ta buộc phải làm thủ công để nhắc rails làm điều đó bằng cách thêm vào config file của bạn **config.read_encrypted_secrets = true**. Với câu lệnh setup bên trên, dòng config trên đã được add vào file config của production. Nếu bạn muốn sử dụng tính năng này cho môi trường development thì hãy thêm dòng config này vào file **config/environments/development.rb**.\n\n## 3. Rails 5.2\n\nÝ tưởng trong rails 5.2 không thay đổi nhiều so với rails 5.1. Nhưng thay vì lưu key để encrypt/decrypt trong file secrets.yml.key giờ nó được lưu trong file **master.key** (tuy nhiên nếu không sử dụng file thì cả rails 5.2 và 5.1 đều có thể gọi biến môi trường RAILS_MASTER_KEY để sử dụng).\n\nFile lưu thông tin đã được mã hoá cũng được thay đổi từ secrets.yml.enc thành **credentials.yml.enc**.  Đó là những điểm khác biệt duy nhất.\n\nĐể chỉnh sửa thông tin trong file mã hoá ta sử dụng lệnh:\n\n```ruby\nEDITOR=vi rails credentials:edit\n```\nKhông cần dùng lệnh setup như trên, vì trong rails 5.2, hai file key và mã hoá được sinh ra cùng project.\n\nTa có thể truy xuất giá trị được giải mã trong file **credentials.yml.enc** như sau:\n\n```ruby\nRails.application.credentials.ten_bien_trong_credentials\n```\n\nLàm gì khi bạn muốn thay thế **master.key**?\n\n1. **rails credentials:show** dùng lệnh này để hiển thị thông tin dạng giải mã ra editor, copy chúng.\n\n2. Xoá hai file **master.key** và **credentials.yml.enc** đi.\n\n3. **EDITOR=vim rails credentials:edit** với lệnh sau bạn sẽ generate lại hai file mới. Việc cần làm bây giờ là paste thông tin ở bước 1 vào editor khi này rồi save lại.\n\n## 4. secret_key_base\n\nNếu làm theo hướng dẫn bên trên, ta sẽ thu được một file mã hoá ví dụ: **credentials.yml.enc** có chứa nội dung ngay cả khi ta mới vừa khởi tạo project. Điều gì đã xảy ra? Tôi còn chưa kịp edit thì nó lấy thông tin gì mà mã hoá ra nội dung đó vậy? Câu trả lời là một thứ được tạo kèm project của bạn có tên là **secret_key_base** sẽ là thứ đầu tiên được tự động lưu mã hoá vào file **credentials.yml.enc**.\n\nSao lại phức tạp như vậy? nó với **RAILS_MASTER_KEY** ở trên có quan hệ gì không? Câu trả lời là không? **secret_key_base** được rails sinh ra khi tạo project, nó đảm bảo rằng không thể có hai ứng dụng rails có chung một **secet_key_base**, cái key sẽ được sử dụng để đảo bảo thứ đánh dấu tính duy nhất của một project và nó còn được dùng làm nhiều việc hay ho khác tôi sẽ trình bày trong các bài viết sắp tới.\n\nĐể tạo ra một secret_key_base bạn có thể sử dụng lệnh sau:\n\n```ruby\nrails secret\n```\n","source":"_posts/2019-02-22-xu-ly-thong-tin-quan-trong-trong-rails.md","raw":"---\ntitle: \"Lưu Trữ Thông Tin Bảo Mật Trong Rails?\"\ndate: 2019-02-22\ndraft: false\ntags: [\"secure\", \"rails\"]\ncategories: [\"rails notes\"]\nmytag: \"Rails\"\nmytrend: \"COOL\"\n---\n\n## 1. Khái quát\n\nBài toán này đơn giản hiểu như sau: Một project bất kỳ sẽ luôn có những thông tin cấu hình vô cùng quan trọng, bắt buộc phải luôn giữ chúng private, còn làm cách nào để giữ chúng private trong rails?\nCâu trả lời là tuỳ vào mỗi phiên bản rails, sẽ có (có thể có) những cách khác nhau để xử lý vấn đề này. Hãy đi đến các dấu mốc cụ thể dưới đây.\n\n## 2. Rails 4.1\n\nPhiên bản rails này sử dụng một file có tên **secrets.yml**, đây là file sẽ lưu toàn bộ các thông tin nhạy cảm chúng ta đã nói ở trên.\nVới thiết kế như này ta có hai lựa chọn cho ứng dụng của mình:\n1. Đem hết thông tin nhạy cảm dưới đạng text bỏ vào file này, tuy nhiên file này phải được bỏ vào trong danh mục của **gitignore** để đảm bảo thông tin trong đó không bị bạn vô tình hay hữu ý commit đi đâu đó.\n\n2. Thông tin nhạy cảm lưu trong file này thay vì được lưu dưới dạng text thì sẽ được lưu trong máy của bạn dứoi dạng **biến môi trường** và trong file **secrets.yml** chỉ sử dụng phương thức **ENV** mà rails cung cấp để gọi lại các thông tin đó lên, với lựa chọn này bạn có thể commit file này thoải mái, ở các máy tính đồng nghiệp, để có thể sử dụng được những config này thì buộc họ phải thiết lập biến môi trường trên máy tính của họ cho phù hợp.\n\nNhược điểm: dù sử dụng cách nào, thì để ứng dụng hoạt động được thì vẫn phải truyền giá trị các thông tin nhạy cảm này từ máy của bạn lên một con vps khi triển khai chẳng hạn, không còn cách nào khác. Có thể bạn phải copy từng dòng thông tin nhạy cảm rồi paste qua remote shell để thiết lập (với những dự án lớn có rất nhiều thông tin quan trọng thì đây là 1 công việc vất vả tiềm tàng nguy cơ sai sót).\n\nNote: Thay vì sử dụng file **secrets.yml**, ta có thể sử dụng một file khác như **application.yml**, mục đích và chức năng của chúng là tương đương.\n\n## 3. Rails 5.1\n\nSang đến phiên bản rails 5.1, một thay đổi lớn đã tới. Thay vì lưu thông tin dạng text hoặc triệu hồi thông qua biến môi trường, rails khi này cung cấp khả năng mã hoá cho các thông tin nhạy cảm này.\nCách chúng hoạt động như sau:\n\nMột file tên **secrets.yml.key** sẽ chứa giá trị của một biến tên **RAILS_MASTER_KEY**, biến này có giá trị là một chuỗi, có chức năng được sử dụng để mã hoá và giải mã các thông tin quan trọng.\n\nNội dung thông tin **sau** mã hoá sẽ được lưu tại file **secrets.yml.enc**\n\nVậy còn file **secrets.yml** trong rails 4 giờ còn không? Câu trả lời là bạn vẫn có thể sử dụng file này, tuy nhiên trên cùng một môi trường, nếu có cả file **secrets.yml** và **secrets.yml.enc** thì hai file này sẽ được merge.\n\nĐể có thể sử dụng tính năng encypt này của rails 5.1 ta setup như sau:\n\n```ruby\nrails secrets:setup\n```\nSau câu lệnh này hai file **secrets.yml.key** và **secrets.yml.enc** sẽ được tạo ra. Để thêm xoá sửa nội dung trong **secrets.yml.enc** ta sử dụng lệnh sau:\n\n```ruby\nrails secrets:edit\n```\n\nCâu lệnh này sẽ mở nội dung file **secrets.yml.enc** dưới dạng đã giải mã. Bạn có thể thoải mái thêm xoá, sửa các thông tin nhạy cảm, sau đó khi bạn save lại và tắt editor thì file **secrets.yml.enc** sẽ tự động được cập nhập phần mã hoá mới nhất khi có thêm thông tin.\n\nTôi thích dùng **vim** để chỉnh sửa, và tôi không muốn set mặc định editor nên tôi sử dụng câu lệnh sau: **EDITOR=vi rails secrets:edit**.\n\nƯu điểm:\n\n1. Thay vì phải quản lý nhiều biến môi trường, giờ đây mọi thứ đều nằm trong một file.\n\n2. Việc có thể commit **secrets.yml.enc** giúp chúng ta nắm được lịch sử thay đổi của file này.\n\nNote: Một điểm quan trọng bạn cần lưu ý, đó là tới khi viết bài viết này thì tôi vẫn chưa thấy rails sẽ giải mã thông tin mã hoá trong file **secrets.yml.enc**, chúng ta buộc phải làm thủ công để nhắc rails làm điều đó bằng cách thêm vào config file của bạn **config.read_encrypted_secrets = true**. Với câu lệnh setup bên trên, dòng config trên đã được add vào file config của production. Nếu bạn muốn sử dụng tính năng này cho môi trường development thì hãy thêm dòng config này vào file **config/environments/development.rb**.\n\n## 3. Rails 5.2\n\nÝ tưởng trong rails 5.2 không thay đổi nhiều so với rails 5.1. Nhưng thay vì lưu key để encrypt/decrypt trong file secrets.yml.key giờ nó được lưu trong file **master.key** (tuy nhiên nếu không sử dụng file thì cả rails 5.2 và 5.1 đều có thể gọi biến môi trường RAILS_MASTER_KEY để sử dụng).\n\nFile lưu thông tin đã được mã hoá cũng được thay đổi từ secrets.yml.enc thành **credentials.yml.enc**.  Đó là những điểm khác biệt duy nhất.\n\nĐể chỉnh sửa thông tin trong file mã hoá ta sử dụng lệnh:\n\n```ruby\nEDITOR=vi rails credentials:edit\n```\nKhông cần dùng lệnh setup như trên, vì trong rails 5.2, hai file key và mã hoá được sinh ra cùng project.\n\nTa có thể truy xuất giá trị được giải mã trong file **credentials.yml.enc** như sau:\n\n```ruby\nRails.application.credentials.ten_bien_trong_credentials\n```\n\nLàm gì khi bạn muốn thay thế **master.key**?\n\n1. **rails credentials:show** dùng lệnh này để hiển thị thông tin dạng giải mã ra editor, copy chúng.\n\n2. Xoá hai file **master.key** và **credentials.yml.enc** đi.\n\n3. **EDITOR=vim rails credentials:edit** với lệnh sau bạn sẽ generate lại hai file mới. Việc cần làm bây giờ là paste thông tin ở bước 1 vào editor khi này rồi save lại.\n\n## 4. secret_key_base\n\nNếu làm theo hướng dẫn bên trên, ta sẽ thu được một file mã hoá ví dụ: **credentials.yml.enc** có chứa nội dung ngay cả khi ta mới vừa khởi tạo project. Điều gì đã xảy ra? Tôi còn chưa kịp edit thì nó lấy thông tin gì mà mã hoá ra nội dung đó vậy? Câu trả lời là một thứ được tạo kèm project của bạn có tên là **secret_key_base** sẽ là thứ đầu tiên được tự động lưu mã hoá vào file **credentials.yml.enc**.\n\nSao lại phức tạp như vậy? nó với **RAILS_MASTER_KEY** ở trên có quan hệ gì không? Câu trả lời là không? **secret_key_base** được rails sinh ra khi tạo project, nó đảm bảo rằng không thể có hai ứng dụng rails có chung một **secet_key_base**, cái key sẽ được sử dụng để đảo bảo thứ đánh dấu tính duy nhất của một project và nó còn được dùng làm nhiều việc hay ho khác tôi sẽ trình bày trong các bài viết sắp tới.\n\nĐể tạo ra một secret_key_base bạn có thể sử dụng lệnh sau:\n\n```ruby\nrails secret\n```\n","slug":"2019-02-22-xu-ly-thong-tin-quan-trong-trong-rails","published":1,"updated":"2022-01-29T09:29:59.926Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsaf000mp3m2fmqielb1","content":"<h2 id=\"1-Khai-quat\"><a href=\"#1-Khai-quat\" class=\"headerlink\" title=\"1. Khái quát\"></a>1. Khái quát</h2><p>Bài toán này đơn giản hiểu như sau: Một project bất kỳ sẽ luôn có những thông tin cấu hình vô cùng quan trọng, bắt buộc phải luôn giữ chúng private, còn làm cách nào để giữ chúng private trong rails?<br>Câu trả lời là tuỳ vào mỗi phiên bản rails, sẽ có (có thể có) những cách khác nhau để xử lý vấn đề này. Hãy đi đến các dấu mốc cụ thể dưới đây.</p>\n<h2 id=\"2-Rails-4-1\"><a href=\"#2-Rails-4-1\" class=\"headerlink\" title=\"2. Rails 4.1\"></a>2. Rails 4.1</h2><p>Phiên bản rails này sử dụng một file có tên <strong>secrets.yml</strong>, đây là file sẽ lưu toàn bộ các thông tin nhạy cảm chúng ta đã nói ở trên.<br>Với thiết kế như này ta có hai lựa chọn cho ứng dụng của mình:</p>\n<ol>\n<li><p>Đem hết thông tin nhạy cảm dưới đạng text bỏ vào file này, tuy nhiên file này phải được bỏ vào trong danh mục của <strong>gitignore</strong> để đảm bảo thông tin trong đó không bị bạn vô tình hay hữu ý commit đi đâu đó.</p>\n</li>\n<li><p>Thông tin nhạy cảm lưu trong file này thay vì được lưu dưới dạng text thì sẽ được lưu trong máy của bạn dứoi dạng <strong>biến môi trường</strong> và trong file <strong>secrets.yml</strong> chỉ sử dụng phương thức <strong>ENV</strong> mà rails cung cấp để gọi lại các thông tin đó lên, với lựa chọn này bạn có thể commit file này thoải mái, ở các máy tính đồng nghiệp, để có thể sử dụng được những config này thì buộc họ phải thiết lập biến môi trường trên máy tính của họ cho phù hợp.</p>\n</li>\n</ol>\n<p>Nhược điểm: dù sử dụng cách nào, thì để ứng dụng hoạt động được thì vẫn phải truyền giá trị các thông tin nhạy cảm này từ máy của bạn lên một con vps khi triển khai chẳng hạn, không còn cách nào khác. Có thể bạn phải copy từng dòng thông tin nhạy cảm rồi paste qua remote shell để thiết lập (với những dự án lớn có rất nhiều thông tin quan trọng thì đây là 1 công việc vất vả tiềm tàng nguy cơ sai sót).</p>\n<p>Note: Thay vì sử dụng file <strong>secrets.yml</strong>, ta có thể sử dụng một file khác như <strong>application.yml</strong>, mục đích và chức năng của chúng là tương đương.</p>\n<h2 id=\"3-Rails-5-1\"><a href=\"#3-Rails-5-1\" class=\"headerlink\" title=\"3. Rails 5.1\"></a>3. Rails 5.1</h2><p>Sang đến phiên bản rails 5.1, một thay đổi lớn đã tới. Thay vì lưu thông tin dạng text hoặc triệu hồi thông qua biến môi trường, rails khi này cung cấp khả năng mã hoá cho các thông tin nhạy cảm này.<br>Cách chúng hoạt động như sau:</p>\n<p>Một file tên <strong>secrets.yml.key</strong> sẽ chứa giá trị của một biến tên <strong>RAILS_MASTER_KEY</strong>, biến này có giá trị là một chuỗi, có chức năng được sử dụng để mã hoá và giải mã các thông tin quan trọng.</p>\n<p>Nội dung thông tin <strong>sau</strong> mã hoá sẽ được lưu tại file <strong>secrets.yml.enc</strong></p>\n<p>Vậy còn file <strong>secrets.yml</strong> trong rails 4 giờ còn không? Câu trả lời là bạn vẫn có thể sử dụng file này, tuy nhiên trên cùng một môi trường, nếu có cả file <strong>secrets.yml</strong> và <strong>secrets.yml.enc</strong> thì hai file này sẽ được merge.</p>\n<p>Để có thể sử dụng tính năng encypt này của rails 5.1 ta setup như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rails <span class=\"symbol\">secrets:</span>setup</span><br></pre></td></tr></table></figure>\n<p>Sau câu lệnh này hai file <strong>secrets.yml.key</strong> và <strong>secrets.yml.enc</strong> sẽ được tạo ra. Để thêm xoá sửa nội dung trong <strong>secrets.yml.enc</strong> ta sử dụng lệnh sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rails <span class=\"symbol\">secrets:</span>edit</span><br></pre></td></tr></table></figure>\n\n<p>Câu lệnh này sẽ mở nội dung file <strong>secrets.yml.enc</strong> dưới dạng đã giải mã. Bạn có thể thoải mái thêm xoá, sửa các thông tin nhạy cảm, sau đó khi bạn save lại và tắt editor thì file <strong>secrets.yml.enc</strong> sẽ tự động được cập nhập phần mã hoá mới nhất khi có thêm thông tin.</p>\n<p>Tôi thích dùng <strong>vim</strong> để chỉnh sửa, và tôi không muốn set mặc định editor nên tôi sử dụng câu lệnh sau: <strong>EDITOR=vi rails secrets:edit</strong>.</p>\n<p>Ưu điểm:</p>\n<ol>\n<li><p>Thay vì phải quản lý nhiều biến môi trường, giờ đây mọi thứ đều nằm trong một file.</p>\n</li>\n<li><p>Việc có thể commit <strong>secrets.yml.enc</strong> giúp chúng ta nắm được lịch sử thay đổi của file này.</p>\n</li>\n</ol>\n<p>Note: Một điểm quan trọng bạn cần lưu ý, đó là tới khi viết bài viết này thì tôi vẫn chưa thấy rails sẽ giải mã thông tin mã hoá trong file <strong>secrets.yml.enc</strong>, chúng ta buộc phải làm thủ công để nhắc rails làm điều đó bằng cách thêm vào config file của bạn <strong>config.read_encrypted_secrets = true</strong>. Với câu lệnh setup bên trên, dòng config trên đã được add vào file config của production. Nếu bạn muốn sử dụng tính năng này cho môi trường development thì hãy thêm dòng config này vào file <strong>config/environments/development.rb</strong>.</p>\n<h2 id=\"3-Rails-5-2\"><a href=\"#3-Rails-5-2\" class=\"headerlink\" title=\"3. Rails 5.2\"></a>3. Rails 5.2</h2><p>Ý tưởng trong rails 5.2 không thay đổi nhiều so với rails 5.1. Nhưng thay vì lưu key để encrypt/decrypt trong file secrets.yml.key giờ nó được lưu trong file <strong>master.key</strong> (tuy nhiên nếu không sử dụng file thì cả rails 5.2 và 5.1 đều có thể gọi biến môi trường RAILS_MASTER_KEY để sử dụng).</p>\n<p>File lưu thông tin đã được mã hoá cũng được thay đổi từ secrets.yml.enc thành <strong>credentials.yml.enc</strong>.  Đó là những điểm khác biệt duy nhất.</p>\n<p>Để chỉnh sửa thông tin trong file mã hoá ta sử dụng lệnh:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EDITOR=vi rails <span class=\"symbol\">credentials:</span>edit</span><br></pre></td></tr></table></figure>\n<p>Không cần dùng lệnh setup như trên, vì trong rails 5.2, hai file key và mã hoá được sinh ra cùng project.</p>\n<p>Ta có thể truy xuất giá trị được giải mã trong file <strong>credentials.yml.enc</strong> như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Rails.application.credentials.ten_bien_trong_credentials</span><br></pre></td></tr></table></figure>\n\n<p>Làm gì khi bạn muốn thay thế <strong>master.key</strong>?</p>\n<ol>\n<li><p><strong>rails credentials:show</strong> dùng lệnh này để hiển thị thông tin dạng giải mã ra editor, copy chúng.</p>\n</li>\n<li><p>Xoá hai file <strong>master.key</strong> và <strong>credentials.yml.enc</strong> đi.</p>\n</li>\n<li><p><strong>EDITOR=vim rails credentials:edit</strong> với lệnh sau bạn sẽ generate lại hai file mới. Việc cần làm bây giờ là paste thông tin ở bước 1 vào editor khi này rồi save lại.</p>\n</li>\n</ol>\n<h2 id=\"4-secret-key-base\"><a href=\"#4-secret-key-base\" class=\"headerlink\" title=\"4. secret_key_base\"></a>4. secret_key_base</h2><p>Nếu làm theo hướng dẫn bên trên, ta sẽ thu được một file mã hoá ví dụ: <strong>credentials.yml.enc</strong> có chứa nội dung ngay cả khi ta mới vừa khởi tạo project. Điều gì đã xảy ra? Tôi còn chưa kịp edit thì nó lấy thông tin gì mà mã hoá ra nội dung đó vậy? Câu trả lời là một thứ được tạo kèm project của bạn có tên là <strong>secret_key_base</strong> sẽ là thứ đầu tiên được tự động lưu mã hoá vào file <strong>credentials.yml.enc</strong>.</p>\n<p>Sao lại phức tạp như vậy? nó với <strong>RAILS_MASTER_KEY</strong> ở trên có quan hệ gì không? Câu trả lời là không? <strong>secret_key_base</strong> được rails sinh ra khi tạo project, nó đảm bảo rằng không thể có hai ứng dụng rails có chung một <strong>secet_key_base</strong>, cái key sẽ được sử dụng để đảo bảo thứ đánh dấu tính duy nhất của một project và nó còn được dùng làm nhiều việc hay ho khác tôi sẽ trình bày trong các bài viết sắp tới.</p>\n<p>Để tạo ra một secret_key_base bạn có thể sử dụng lệnh sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rails secret</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Khai-quat\"><a href=\"#1-Khai-quat\" class=\"headerlink\" title=\"1. Khái quát\"></a>1. Khái quát</h2><p>Bài toán này đơn giản hiểu như sau: Một project bất kỳ sẽ luôn có những thông tin cấu hình vô cùng quan trọng, bắt buộc phải luôn giữ chúng private, còn làm cách nào để giữ chúng private trong rails?<br>Câu trả lời là tuỳ vào mỗi phiên bản rails, sẽ có (có thể có) những cách khác nhau để xử lý vấn đề này. Hãy đi đến các dấu mốc cụ thể dưới đây.</p>\n<h2 id=\"2-Rails-4-1\"><a href=\"#2-Rails-4-1\" class=\"headerlink\" title=\"2. Rails 4.1\"></a>2. Rails 4.1</h2><p>Phiên bản rails này sử dụng một file có tên <strong>secrets.yml</strong>, đây là file sẽ lưu toàn bộ các thông tin nhạy cảm chúng ta đã nói ở trên.<br>Với thiết kế như này ta có hai lựa chọn cho ứng dụng của mình:</p>\n<ol>\n<li><p>Đem hết thông tin nhạy cảm dưới đạng text bỏ vào file này, tuy nhiên file này phải được bỏ vào trong danh mục của <strong>gitignore</strong> để đảm bảo thông tin trong đó không bị bạn vô tình hay hữu ý commit đi đâu đó.</p>\n</li>\n<li><p>Thông tin nhạy cảm lưu trong file này thay vì được lưu dưới dạng text thì sẽ được lưu trong máy của bạn dứoi dạng <strong>biến môi trường</strong> và trong file <strong>secrets.yml</strong> chỉ sử dụng phương thức <strong>ENV</strong> mà rails cung cấp để gọi lại các thông tin đó lên, với lựa chọn này bạn có thể commit file này thoải mái, ở các máy tính đồng nghiệp, để có thể sử dụng được những config này thì buộc họ phải thiết lập biến môi trường trên máy tính của họ cho phù hợp.</p>\n</li>\n</ol>\n<p>Nhược điểm: dù sử dụng cách nào, thì để ứng dụng hoạt động được thì vẫn phải truyền giá trị các thông tin nhạy cảm này từ máy của bạn lên một con vps khi triển khai chẳng hạn, không còn cách nào khác. Có thể bạn phải copy từng dòng thông tin nhạy cảm rồi paste qua remote shell để thiết lập (với những dự án lớn có rất nhiều thông tin quan trọng thì đây là 1 công việc vất vả tiềm tàng nguy cơ sai sót).</p>\n<p>Note: Thay vì sử dụng file <strong>secrets.yml</strong>, ta có thể sử dụng một file khác như <strong>application.yml</strong>, mục đích và chức năng của chúng là tương đương.</p>\n<h2 id=\"3-Rails-5-1\"><a href=\"#3-Rails-5-1\" class=\"headerlink\" title=\"3. Rails 5.1\"></a>3. Rails 5.1</h2><p>Sang đến phiên bản rails 5.1, một thay đổi lớn đã tới. Thay vì lưu thông tin dạng text hoặc triệu hồi thông qua biến môi trường, rails khi này cung cấp khả năng mã hoá cho các thông tin nhạy cảm này.<br>Cách chúng hoạt động như sau:</p>\n<p>Một file tên <strong>secrets.yml.key</strong> sẽ chứa giá trị của một biến tên <strong>RAILS_MASTER_KEY</strong>, biến này có giá trị là một chuỗi, có chức năng được sử dụng để mã hoá và giải mã các thông tin quan trọng.</p>\n<p>Nội dung thông tin <strong>sau</strong> mã hoá sẽ được lưu tại file <strong>secrets.yml.enc</strong></p>\n<p>Vậy còn file <strong>secrets.yml</strong> trong rails 4 giờ còn không? Câu trả lời là bạn vẫn có thể sử dụng file này, tuy nhiên trên cùng một môi trường, nếu có cả file <strong>secrets.yml</strong> và <strong>secrets.yml.enc</strong> thì hai file này sẽ được merge.</p>\n<p>Để có thể sử dụng tính năng encypt này của rails 5.1 ta setup như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rails <span class=\"symbol\">secrets:</span>setup</span><br></pre></td></tr></table></figure>\n<p>Sau câu lệnh này hai file <strong>secrets.yml.key</strong> và <strong>secrets.yml.enc</strong> sẽ được tạo ra. Để thêm xoá sửa nội dung trong <strong>secrets.yml.enc</strong> ta sử dụng lệnh sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rails <span class=\"symbol\">secrets:</span>edit</span><br></pre></td></tr></table></figure>\n\n<p>Câu lệnh này sẽ mở nội dung file <strong>secrets.yml.enc</strong> dưới dạng đã giải mã. Bạn có thể thoải mái thêm xoá, sửa các thông tin nhạy cảm, sau đó khi bạn save lại và tắt editor thì file <strong>secrets.yml.enc</strong> sẽ tự động được cập nhập phần mã hoá mới nhất khi có thêm thông tin.</p>\n<p>Tôi thích dùng <strong>vim</strong> để chỉnh sửa, và tôi không muốn set mặc định editor nên tôi sử dụng câu lệnh sau: <strong>EDITOR=vi rails secrets:edit</strong>.</p>\n<p>Ưu điểm:</p>\n<ol>\n<li><p>Thay vì phải quản lý nhiều biến môi trường, giờ đây mọi thứ đều nằm trong một file.</p>\n</li>\n<li><p>Việc có thể commit <strong>secrets.yml.enc</strong> giúp chúng ta nắm được lịch sử thay đổi của file này.</p>\n</li>\n</ol>\n<p>Note: Một điểm quan trọng bạn cần lưu ý, đó là tới khi viết bài viết này thì tôi vẫn chưa thấy rails sẽ giải mã thông tin mã hoá trong file <strong>secrets.yml.enc</strong>, chúng ta buộc phải làm thủ công để nhắc rails làm điều đó bằng cách thêm vào config file của bạn <strong>config.read_encrypted_secrets = true</strong>. Với câu lệnh setup bên trên, dòng config trên đã được add vào file config của production. Nếu bạn muốn sử dụng tính năng này cho môi trường development thì hãy thêm dòng config này vào file <strong>config/environments/development.rb</strong>.</p>\n<h2 id=\"3-Rails-5-2\"><a href=\"#3-Rails-5-2\" class=\"headerlink\" title=\"3. Rails 5.2\"></a>3. Rails 5.2</h2><p>Ý tưởng trong rails 5.2 không thay đổi nhiều so với rails 5.1. Nhưng thay vì lưu key để encrypt/decrypt trong file secrets.yml.key giờ nó được lưu trong file <strong>master.key</strong> (tuy nhiên nếu không sử dụng file thì cả rails 5.2 và 5.1 đều có thể gọi biến môi trường RAILS_MASTER_KEY để sử dụng).</p>\n<p>File lưu thông tin đã được mã hoá cũng được thay đổi từ secrets.yml.enc thành <strong>credentials.yml.enc</strong>.  Đó là những điểm khác biệt duy nhất.</p>\n<p>Để chỉnh sửa thông tin trong file mã hoá ta sử dụng lệnh:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EDITOR=vi rails <span class=\"symbol\">credentials:</span>edit</span><br></pre></td></tr></table></figure>\n<p>Không cần dùng lệnh setup như trên, vì trong rails 5.2, hai file key và mã hoá được sinh ra cùng project.</p>\n<p>Ta có thể truy xuất giá trị được giải mã trong file <strong>credentials.yml.enc</strong> như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Rails.application.credentials.ten_bien_trong_credentials</span><br></pre></td></tr></table></figure>\n\n<p>Làm gì khi bạn muốn thay thế <strong>master.key</strong>?</p>\n<ol>\n<li><p><strong>rails credentials:show</strong> dùng lệnh này để hiển thị thông tin dạng giải mã ra editor, copy chúng.</p>\n</li>\n<li><p>Xoá hai file <strong>master.key</strong> và <strong>credentials.yml.enc</strong> đi.</p>\n</li>\n<li><p><strong>EDITOR=vim rails credentials:edit</strong> với lệnh sau bạn sẽ generate lại hai file mới. Việc cần làm bây giờ là paste thông tin ở bước 1 vào editor khi này rồi save lại.</p>\n</li>\n</ol>\n<h2 id=\"4-secret-key-base\"><a href=\"#4-secret-key-base\" class=\"headerlink\" title=\"4. secret_key_base\"></a>4. secret_key_base</h2><p>Nếu làm theo hướng dẫn bên trên, ta sẽ thu được một file mã hoá ví dụ: <strong>credentials.yml.enc</strong> có chứa nội dung ngay cả khi ta mới vừa khởi tạo project. Điều gì đã xảy ra? Tôi còn chưa kịp edit thì nó lấy thông tin gì mà mã hoá ra nội dung đó vậy? Câu trả lời là một thứ được tạo kèm project của bạn có tên là <strong>secret_key_base</strong> sẽ là thứ đầu tiên được tự động lưu mã hoá vào file <strong>credentials.yml.enc</strong>.</p>\n<p>Sao lại phức tạp như vậy? nó với <strong>RAILS_MASTER_KEY</strong> ở trên có quan hệ gì không? Câu trả lời là không? <strong>secret_key_base</strong> được rails sinh ra khi tạo project, nó đảm bảo rằng không thể có hai ứng dụng rails có chung một <strong>secet_key_base</strong>, cái key sẽ được sử dụng để đảo bảo thứ đánh dấu tính duy nhất của một project và nó còn được dùng làm nhiều việc hay ho khác tôi sẽ trình bày trong các bài viết sắp tới.</p>\n<p>Để tạo ra một secret_key_base bạn có thể sử dụng lệnh sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rails secret</span><br></pre></td></tr></table></figure>\n"},{"title":"Vấn Đề N + 1 Và Hướng Xử Lý","date":"2019-02-24T17:00:00.000Z","draft":false,"_content":"\n## N+1 query\n\nXét một ví dụ:\n\nTôi có một ứng dụng đơn giản, với hai bảng csdl, bảng thứ nhất là bảng users, bảng thứ hai là bảng articles, một user có thể có nhiều articles nhưng một article chỉ thuộc về user. Hãy xem đoạn mã dưới đây:\n\n```ruby\nUser.all.each do |user|\n  user.articles\nend\n```\nĐoạn code trên sẽ duyệt qua tất cả user có trong csdl rồi lấy tất cả các articles ứng với từng user. Rất tường minh và dễ hiểu.\n\nTối có 5 user mẫu trong csdl nên các câu lệnh sql sinh ra sau đoạn code trên như sau:\n\n```ruby\n# câu lệnh lấy hết users lên\nSELECT \"users\".* FROM \"users\"\n# ứng với mỗi user query lấy tất cả articles lên\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" = ? LIMIT ?  [[\"user_id\", 1], [\"LIMIT\", 11]]\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" = ? LIMIT ?  [[\"user_id\", 2], [\"LIMIT\", 11]]\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" = ? LIMIT ?  [[\"user_id\", 3], [\"LIMIT\", 11]]\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" = ? LIMIT ?  [[\"user_id\", 4], [\"LIMIT\", 11]]\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" = ? LIMIT ?  [[\"user_id\", 5], [\"LIMIT\", 11]]\n```\n\nĐây chính là ví dụ điển hình về **N+1**, **N**ở đây là 5 (số lượng user có trong csdl) và **1** chính là câu lệnh sql đầu tiên dùng để lấy tất cả user lên.\n\nNhìn như vô hại, mà thực ra ở ví dụ này cũng vô hại thật vì chỉ có 5 record user, nên thời gian load cũng không thấm tháp gì, tuy nhiên trong thực tế thì dữ liệu có thể rất lớn, lên đến hàng triệu record và nếu load dữ liệu như này thì đây là một vấn đề lớn cho hiệu năng của trang web. Hãy đọc tiếp mục 2 để tìm về giải pháp cho tình huống này.\n\n## 2. Giải pháp\n\nVấn đề đã có, giờ chúng ta cần tìm một giải pháp làm sao để kết quả trả về không đổi, nhưng lượng truy vấn sql trong csdl phải nhỏ hơn.\n\nCác phương án:\n\n1. Sử dụng **select in()**.\n\n2. Sử dụng **joins**. Để đọc kỹ hơn về joins, thì nên xem ở [đây](https://www.w3schools.com/sql/sql_join.asp)\n\nSử dụng select in() sẽ tiết kiệm truy vấn đi rất nhiều, nếu ví dụ bên trên ta sử dụng select in() thì các sql query cần thiết sẽ là như sau:\n\n```ruby\n# lấy tất cả query\nSELECT \"users\".* FROM \"users\"\n# lấy articles ứng với từng user\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" IN (1, 2, 3, 4, 5)\n```\n\nTuyệt vời, từ 6(N + 1) truy vấn giờ đã trở thành còn 2.\n\nVới cách thứ 2 là sử dụng **joins**:\n\njoins hiểu đơn giản là ghép hai bảng lại với nhau (lấy một số field cần thiết ở bảng này, gộp với vài field cần thiết ở bảng kia khi mà record ở hai bên thoả mãn một điều kiện nào đó), rồi từ đó thành một bảng tạm dùng trong quá trình bạn sử dụng.\n\nQuay trở về ví dụ ban đầu, câu truy vấn bây giờ sẽ trở thành:\n\n```ruby\nSELECT User.name, Article.title\n      FROM User\n      INNER JOIN Article ON User.id = Article.user_id\n```\n\nLấy vài field cần thiết(name của user và title của Article).\nBằng cách thoả mãn điều kiện nào đó(id của user bằng với user_id của article).\n\nVậy từ N+1 query ban đầu, đã trở thành một query duy nhất.\n\nĐến lúc này đã có thể kết luận là joins tốt hơn select in() được chưa? Chưa, câu trả lời sẽ là như vậy. Sang mục 3 chúng ta sẽ tìm hiểu về cách xử lý N+1 thông qua ActiveRecord\n\n## 3. Xử lý N+1 query trong ActiveRecord\n\nTrong ActiveRecord cung cấp 3 phương thức để loại bỏ N+1,\n\n1. Sử dụng **preload**\n\n```ruby\nUser.preload(:articles)\n# sql sinh ra\nUser Load (0.2ms)  SELECT  \"users\".* FROM \"users\" LIMIT ?  [[\"LIMIT\", 11]]\nArticle Load (0.4ms)  SELECT \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" IN (?, ?, ?)  [[\"user_id\", 1], [\"user_id\", 2], [\"user_id\", 3]]\n```\nPreload sẽ luôn sử dụng **select in()**\n\n2. Sử dụng **Eagerload**\n\n```ruby\nUser.eager_load(:articles)\n# sql sinh ra\nSELECT  DISTINCT \"users\".\"id\" FROM \"users\" LEFT OUTER JOIN \"articles\" ON \"articles\".\"user_id\" = \"users\".\"id\" LIMIT ?  [[\"LIMIT\", 11]]\n\nSELECT \"users\".\"id\" AS t0_r0, \"users\".\"name\" AS t0_r1, \"users\".\"created_at\" AS t0_r2,\n\"users\".\"updated_at\" AS t0_r3, \"articles\".\"id\" AS t1_r0, \"articles\".\"name\" AS t1_r1,\n\"articles\".\"user_id\" AS t1_r2, \"articles\".\"created_at\" AS t1_r3, \"articles\".\"updated_at\" AS t1_r4\nFROM \"users\" LEFT OUTER JOIN \"articles\" ON \"articles\".\"user_id\" = \"users\".\"id\"\nWHERE \"users\".\"id\" IN (?, ?, ?)  [[\"id\", 1], [\"id\", 2], [\"id\", 3]]\n```\n\neager_load luôn sử dụng **joins**\n\n3. Sử dụng **Inludes**\n\n```ruby\n# cách 1\nUser.includes(:articles)\n# sql sinh ra\nSELECT  \"users\".* FROM \"users\" LIMIT ?  [[\"LIMIT\", 11]]\nSELECT \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" IN (?, ?, ?)  [[\"user_id\", 1], [\"user_id\", 2], [\"user_id\", 3]]\n#=> giống preload\n\n# cách 2\nUser.includes(:articles).references(:articles)\n# sql sinh ra\nSELECT  DISTINCT \"users\".\"id\" FROM \"users\" LEFT OUTER JOIN \"articles\"\nON \"articles\".\"user_id\" = \"users\".\"id\" LIMIT ?  [[\"LIMIT\", 11]]\nSELECT \"users\".\"id\" AS t0_r0, \"users\".\"name\" AS t0_r1, \"users\".\"created_at\" AS t0_r2,\n\"users\".\"updated_at\" AS t0_r3, \"articles\".\"id\" AS t1_r0, \"articles\".\"name\" AS t1_r1,\n\"articles\".\"user_id\" AS t1_r2, \"articles\".\"created_at\" AS t1_r3, \"articles\".\"updated_at\" AS t1_r4\nFROM \"users\" LEFT OUTER JOIN \"articles\" ON \"articles\".\"user_id\" = \"users\".\"id\"\nWHERE \"users\".\"id\" IN (?, ?, ?)  [[\"id\", 1], [\"id\", 2], [\"id\", 3]]\n#=> giống eager_load\n```\nVậy mặc định thì **includes** sử dụng select in(), nhưng cũng có thể chuyển qua sử dụng joins nếu thêm method references phía sau.\n","source":"_posts/2019-02-25-van-de-n-1-trong-rails.md","raw":"---\ntitle: \"Vấn Đề N + 1 Và Hướng Xử Lý\"\ndate: 2019-02-25\ndraft: false\ntags: [\"RAILS\"]\n---\n\n## N+1 query\n\nXét một ví dụ:\n\nTôi có một ứng dụng đơn giản, với hai bảng csdl, bảng thứ nhất là bảng users, bảng thứ hai là bảng articles, một user có thể có nhiều articles nhưng một article chỉ thuộc về user. Hãy xem đoạn mã dưới đây:\n\n```ruby\nUser.all.each do |user|\n  user.articles\nend\n```\nĐoạn code trên sẽ duyệt qua tất cả user có trong csdl rồi lấy tất cả các articles ứng với từng user. Rất tường minh và dễ hiểu.\n\nTối có 5 user mẫu trong csdl nên các câu lệnh sql sinh ra sau đoạn code trên như sau:\n\n```ruby\n# câu lệnh lấy hết users lên\nSELECT \"users\".* FROM \"users\"\n# ứng với mỗi user query lấy tất cả articles lên\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" = ? LIMIT ?  [[\"user_id\", 1], [\"LIMIT\", 11]]\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" = ? LIMIT ?  [[\"user_id\", 2], [\"LIMIT\", 11]]\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" = ? LIMIT ?  [[\"user_id\", 3], [\"LIMIT\", 11]]\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" = ? LIMIT ?  [[\"user_id\", 4], [\"LIMIT\", 11]]\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" = ? LIMIT ?  [[\"user_id\", 5], [\"LIMIT\", 11]]\n```\n\nĐây chính là ví dụ điển hình về **N+1**, **N**ở đây là 5 (số lượng user có trong csdl) và **1** chính là câu lệnh sql đầu tiên dùng để lấy tất cả user lên.\n\nNhìn như vô hại, mà thực ra ở ví dụ này cũng vô hại thật vì chỉ có 5 record user, nên thời gian load cũng không thấm tháp gì, tuy nhiên trong thực tế thì dữ liệu có thể rất lớn, lên đến hàng triệu record và nếu load dữ liệu như này thì đây là một vấn đề lớn cho hiệu năng của trang web. Hãy đọc tiếp mục 2 để tìm về giải pháp cho tình huống này.\n\n## 2. Giải pháp\n\nVấn đề đã có, giờ chúng ta cần tìm một giải pháp làm sao để kết quả trả về không đổi, nhưng lượng truy vấn sql trong csdl phải nhỏ hơn.\n\nCác phương án:\n\n1. Sử dụng **select in()**.\n\n2. Sử dụng **joins**. Để đọc kỹ hơn về joins, thì nên xem ở [đây](https://www.w3schools.com/sql/sql_join.asp)\n\nSử dụng select in() sẽ tiết kiệm truy vấn đi rất nhiều, nếu ví dụ bên trên ta sử dụng select in() thì các sql query cần thiết sẽ là như sau:\n\n```ruby\n# lấy tất cả query\nSELECT \"users\".* FROM \"users\"\n# lấy articles ứng với từng user\nSELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" IN (1, 2, 3, 4, 5)\n```\n\nTuyệt vời, từ 6(N + 1) truy vấn giờ đã trở thành còn 2.\n\nVới cách thứ 2 là sử dụng **joins**:\n\njoins hiểu đơn giản là ghép hai bảng lại với nhau (lấy một số field cần thiết ở bảng này, gộp với vài field cần thiết ở bảng kia khi mà record ở hai bên thoả mãn một điều kiện nào đó), rồi từ đó thành một bảng tạm dùng trong quá trình bạn sử dụng.\n\nQuay trở về ví dụ ban đầu, câu truy vấn bây giờ sẽ trở thành:\n\n```ruby\nSELECT User.name, Article.title\n      FROM User\n      INNER JOIN Article ON User.id = Article.user_id\n```\n\nLấy vài field cần thiết(name của user và title của Article).\nBằng cách thoả mãn điều kiện nào đó(id của user bằng với user_id của article).\n\nVậy từ N+1 query ban đầu, đã trở thành một query duy nhất.\n\nĐến lúc này đã có thể kết luận là joins tốt hơn select in() được chưa? Chưa, câu trả lời sẽ là như vậy. Sang mục 3 chúng ta sẽ tìm hiểu về cách xử lý N+1 thông qua ActiveRecord\n\n## 3. Xử lý N+1 query trong ActiveRecord\n\nTrong ActiveRecord cung cấp 3 phương thức để loại bỏ N+1,\n\n1. Sử dụng **preload**\n\n```ruby\nUser.preload(:articles)\n# sql sinh ra\nUser Load (0.2ms)  SELECT  \"users\".* FROM \"users\" LIMIT ?  [[\"LIMIT\", 11]]\nArticle Load (0.4ms)  SELECT \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" IN (?, ?, ?)  [[\"user_id\", 1], [\"user_id\", 2], [\"user_id\", 3]]\n```\nPreload sẽ luôn sử dụng **select in()**\n\n2. Sử dụng **Eagerload**\n\n```ruby\nUser.eager_load(:articles)\n# sql sinh ra\nSELECT  DISTINCT \"users\".\"id\" FROM \"users\" LEFT OUTER JOIN \"articles\" ON \"articles\".\"user_id\" = \"users\".\"id\" LIMIT ?  [[\"LIMIT\", 11]]\n\nSELECT \"users\".\"id\" AS t0_r0, \"users\".\"name\" AS t0_r1, \"users\".\"created_at\" AS t0_r2,\n\"users\".\"updated_at\" AS t0_r3, \"articles\".\"id\" AS t1_r0, \"articles\".\"name\" AS t1_r1,\n\"articles\".\"user_id\" AS t1_r2, \"articles\".\"created_at\" AS t1_r3, \"articles\".\"updated_at\" AS t1_r4\nFROM \"users\" LEFT OUTER JOIN \"articles\" ON \"articles\".\"user_id\" = \"users\".\"id\"\nWHERE \"users\".\"id\" IN (?, ?, ?)  [[\"id\", 1], [\"id\", 2], [\"id\", 3]]\n```\n\neager_load luôn sử dụng **joins**\n\n3. Sử dụng **Inludes**\n\n```ruby\n# cách 1\nUser.includes(:articles)\n# sql sinh ra\nSELECT  \"users\".* FROM \"users\" LIMIT ?  [[\"LIMIT\", 11]]\nSELECT \"articles\".* FROM \"articles\" WHERE \"articles\".\"user_id\" IN (?, ?, ?)  [[\"user_id\", 1], [\"user_id\", 2], [\"user_id\", 3]]\n#=> giống preload\n\n# cách 2\nUser.includes(:articles).references(:articles)\n# sql sinh ra\nSELECT  DISTINCT \"users\".\"id\" FROM \"users\" LEFT OUTER JOIN \"articles\"\nON \"articles\".\"user_id\" = \"users\".\"id\" LIMIT ?  [[\"LIMIT\", 11]]\nSELECT \"users\".\"id\" AS t0_r0, \"users\".\"name\" AS t0_r1, \"users\".\"created_at\" AS t0_r2,\n\"users\".\"updated_at\" AS t0_r3, \"articles\".\"id\" AS t1_r0, \"articles\".\"name\" AS t1_r1,\n\"articles\".\"user_id\" AS t1_r2, \"articles\".\"created_at\" AS t1_r3, \"articles\".\"updated_at\" AS t1_r4\nFROM \"users\" LEFT OUTER JOIN \"articles\" ON \"articles\".\"user_id\" = \"users\".\"id\"\nWHERE \"users\".\"id\" IN (?, ?, ?)  [[\"id\", 1], [\"id\", 2], [\"id\", 3]]\n#=> giống eager_load\n```\nVậy mặc định thì **includes** sử dụng select in(), nhưng cũng có thể chuyển qua sử dụng joins nếu thêm method references phía sau.\n","slug":"2019-02-25-van-de-n-1-trong-rails","published":1,"updated":"2022-01-29T09:29:59.926Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsaf000op3m24zkz5xb7","content":"<h2 id=\"N-1-query\"><a href=\"#N-1-query\" class=\"headerlink\" title=\"N+1 query\"></a>N+1 query</h2><p>Xét một ví dụ:</p>\n<p>Tôi có một ứng dụng đơn giản, với hai bảng csdl, bảng thứ nhất là bảng users, bảng thứ hai là bảng articles, một user có thể có nhiều articles nhưng một article chỉ thuộc về user. Hãy xem đoạn mã dưới đây:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User.all.each <span class=\"keyword\">do</span> <span class=\"params\">|user|</span></span><br><span class=\"line\">  user.articles</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>Đoạn code trên sẽ duyệt qua tất cả user có trong csdl rồi lấy tất cả các articles ứng với từng user. Rất tường minh và dễ hiểu.</p>\n<p>Tối có 5 user mẫu trong csdl nên các câu lệnh sql sinh ra sau đoạn code trên như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># câu lệnh lấy hết users lên</span></span><br><span class=\"line\">SELECT <span class=\"string\">\"users\"</span>.* FROM <span class=\"string\">\"users\"</span></span><br><span class=\"line\"><span class=\"comment\"># ứng với mỗi user query lấy tất cả articles lên</span></span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = ? LIMIT ?  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">1</span>], [<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = ? LIMIT ?  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">2</span>], [<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = ? LIMIT ?  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">3</span>], [<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = ? LIMIT ?  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">4</span>], [<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = ? LIMIT ?  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">5</span>], [<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>Đây chính là ví dụ điển hình về <strong>N+1</strong>, <strong>N</strong>ở đây là 5 (số lượng user có trong csdl) và <strong>1</strong> chính là câu lệnh sql đầu tiên dùng để lấy tất cả user lên.</p>\n<p>Nhìn như vô hại, mà thực ra ở ví dụ này cũng vô hại thật vì chỉ có 5 record user, nên thời gian load cũng không thấm tháp gì, tuy nhiên trong thực tế thì dữ liệu có thể rất lớn, lên đến hàng triệu record và nếu load dữ liệu như này thì đây là một vấn đề lớn cho hiệu năng của trang web. Hãy đọc tiếp mục 2 để tìm về giải pháp cho tình huống này.</p>\n<h2 id=\"2-Giai-phap\"><a href=\"#2-Giai-phap\" class=\"headerlink\" title=\"2. Giải pháp\"></a>2. Giải pháp</h2><p>Vấn đề đã có, giờ chúng ta cần tìm một giải pháp làm sao để kết quả trả về không đổi, nhưng lượng truy vấn sql trong csdl phải nhỏ hơn.</p>\n<p>Các phương án:</p>\n<ol>\n<li><p>Sử dụng <strong>select in()</strong>.</p>\n</li>\n<li><p>Sử dụng <strong>joins</strong>. Để đọc kỹ hơn về joins, thì nên xem ở <a href=\"https://www.w3schools.com/sql/sql_join.asp\" target=\"_blank\" rel=\"noopener\">đây</a></p>\n</li>\n</ol>\n<p>Sử dụng select in() sẽ tiết kiệm truy vấn đi rất nhiều, nếu ví dụ bên trên ta sử dụng select in() thì các sql query cần thiết sẽ là như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># lấy tất cả query</span></span><br><span class=\"line\">SELECT <span class=\"string\">\"users\"</span>.* FROM <span class=\"string\">\"users\"</span></span><br><span class=\"line\"><span class=\"comment\"># lấy articles ứng với từng user</span></span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> IN (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Tuyệt vời, từ 6(N + 1) truy vấn giờ đã trở thành còn 2.</p>\n<p>Với cách thứ 2 là sử dụng <strong>joins</strong>:</p>\n<p>joins hiểu đơn giản là ghép hai bảng lại với nhau (lấy một số field cần thiết ở bảng này, gộp với vài field cần thiết ở bảng kia khi mà record ở hai bên thoả mãn một điều kiện nào đó), rồi từ đó thành một bảng tạm dùng trong quá trình bạn sử dụng.</p>\n<p>Quay trở về ví dụ ban đầu, câu truy vấn bây giờ sẽ trở thành:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT User.name, Article.title</span><br><span class=\"line\">      FROM User</span><br><span class=\"line\">      INNER JOIN Article ON User.id = Article.user_id</span><br></pre></td></tr></table></figure>\n\n<p>Lấy vài field cần thiết(name của user và title của Article).<br>Bằng cách thoả mãn điều kiện nào đó(id của user bằng với user_id của article).</p>\n<p>Vậy từ N+1 query ban đầu, đã trở thành một query duy nhất.</p>\n<p>Đến lúc này đã có thể kết luận là joins tốt hơn select in() được chưa? Chưa, câu trả lời sẽ là như vậy. Sang mục 3 chúng ta sẽ tìm hiểu về cách xử lý N+1 thông qua ActiveRecord</p>\n<h2 id=\"3-Xu-ly-N-1-query-trong-ActiveRecord\"><a href=\"#3-Xu-ly-N-1-query-trong-ActiveRecord\" class=\"headerlink\" title=\"3. Xử lý N+1 query trong ActiveRecord\"></a>3. Xử lý N+1 query trong ActiveRecord</h2><p>Trong ActiveRecord cung cấp 3 phương thức để loại bỏ N+1,</p>\n<ol>\n<li>Sử dụng <strong>preload</strong></li>\n</ol>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User.preload(<span class=\"symbol\">:articles</span>)</span><br><span class=\"line\"><span class=\"comment\"># sql sinh ra</span></span><br><span class=\"line\">User Load (<span class=\"number\">0</span>.<span class=\"number\">2</span>ms)  SELECT  <span class=\"string\">\"users\"</span>.* FROM <span class=\"string\">\"users\"</span> LIMIT ?  [[<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">Article Load (<span class=\"number\">0</span>.<span class=\"number\">4</span>ms)  SELECT <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> IN (?, ?, ?)  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">1</span>], [<span class=\"string\">\"user_id\"</span>, <span class=\"number\">2</span>], [<span class=\"string\">\"user_id\"</span>, <span class=\"number\">3</span>]]</span><br></pre></td></tr></table></figure>\n<p>Preload sẽ luôn sử dụng <strong>select in()</strong></p>\n<ol start=\"2\">\n<li>Sử dụng <strong>Eagerload</strong></li>\n</ol>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User.eager_load(<span class=\"symbol\">:articles</span>)</span><br><span class=\"line\"><span class=\"comment\"># sql sinh ra</span></span><br><span class=\"line\">SELECT  DISTINCT <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> FROM <span class=\"string\">\"users\"</span> LEFT OUTER JOIN <span class=\"string\">\"articles\"</span> ON <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> LIMIT ?  [[<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">SELECT <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> AS t0_r<span class=\"number\">0</span>, <span class=\"string\">\"users\"</span>.<span class=\"string\">\"name\"</span> AS t0_r1, <span class=\"string\">\"users\"</span>.<span class=\"string\">\"created_at\"</span> AS t0_r2,</span><br><span class=\"line\"><span class=\"string\">\"users\"</span>.<span class=\"string\">\"updated_at\"</span> AS t0_r3, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"id\"</span> AS t1_r<span class=\"number\">0</span>, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"name\"</span> AS t1_r1,</span><br><span class=\"line\"><span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> AS t1_r2, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"created_at\"</span> AS t1_r3, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"updated_at\"</span> AS t1_r4</span><br><span class=\"line\">FROM <span class=\"string\">\"users\"</span> LEFT OUTER JOIN <span class=\"string\">\"articles\"</span> ON <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span></span><br><span class=\"line\">WHERE <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> IN (?, ?, ?)  [[<span class=\"string\">\"id\"</span>, <span class=\"number\">1</span>], [<span class=\"string\">\"id\"</span>, <span class=\"number\">2</span>], [<span class=\"string\">\"id\"</span>, <span class=\"number\">3</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>eager_load luôn sử dụng <strong>joins</strong></p>\n<ol start=\"3\">\n<li>Sử dụng <strong>Inludes</strong></li>\n</ol>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cách 1</span></span><br><span class=\"line\">User.includes(<span class=\"symbol\">:articles</span>)</span><br><span class=\"line\"><span class=\"comment\"># sql sinh ra</span></span><br><span class=\"line\">SELECT  <span class=\"string\">\"users\"</span>.* FROM <span class=\"string\">\"users\"</span> LIMIT ?  [[<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> IN (?, ?, ?)  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">1</span>], [<span class=\"string\">\"user_id\"</span>, <span class=\"number\">2</span>], [<span class=\"string\">\"user_id\"</span>, <span class=\"number\">3</span>]]</span><br><span class=\"line\"><span class=\"comment\">#=&gt; giống preload</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># cách 2</span></span><br><span class=\"line\">User.includes(<span class=\"symbol\">:articles</span>).references(<span class=\"symbol\">:articles</span>)</span><br><span class=\"line\"><span class=\"comment\"># sql sinh ra</span></span><br><span class=\"line\">SELECT  DISTINCT <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> FROM <span class=\"string\">\"users\"</span> LEFT OUTER JOIN <span class=\"string\">\"articles\"</span></span><br><span class=\"line\">ON <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> LIMIT ?  [[<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> AS t0_r<span class=\"number\">0</span>, <span class=\"string\">\"users\"</span>.<span class=\"string\">\"name\"</span> AS t0_r1, <span class=\"string\">\"users\"</span>.<span class=\"string\">\"created_at\"</span> AS t0_r2,</span><br><span class=\"line\"><span class=\"string\">\"users\"</span>.<span class=\"string\">\"updated_at\"</span> AS t0_r3, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"id\"</span> AS t1_r<span class=\"number\">0</span>, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"name\"</span> AS t1_r1,</span><br><span class=\"line\"><span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> AS t1_r2, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"created_at\"</span> AS t1_r3, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"updated_at\"</span> AS t1_r4</span><br><span class=\"line\">FROM <span class=\"string\">\"users\"</span> LEFT OUTER JOIN <span class=\"string\">\"articles\"</span> ON <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span></span><br><span class=\"line\">WHERE <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> IN (?, ?, ?)  [[<span class=\"string\">\"id\"</span>, <span class=\"number\">1</span>], [<span class=\"string\">\"id\"</span>, <span class=\"number\">2</span>], [<span class=\"string\">\"id\"</span>, <span class=\"number\">3</span>]]</span><br><span class=\"line\"><span class=\"comment\">#=&gt; giống eager_load</span></span><br></pre></td></tr></table></figure>\n<p>Vậy mặc định thì <strong>includes</strong> sử dụng select in(), nhưng cũng có thể chuyển qua sử dụng joins nếu thêm method references phía sau.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"N-1-query\"><a href=\"#N-1-query\" class=\"headerlink\" title=\"N+1 query\"></a>N+1 query</h2><p>Xét một ví dụ:</p>\n<p>Tôi có một ứng dụng đơn giản, với hai bảng csdl, bảng thứ nhất là bảng users, bảng thứ hai là bảng articles, một user có thể có nhiều articles nhưng một article chỉ thuộc về user. Hãy xem đoạn mã dưới đây:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User.all.each <span class=\"keyword\">do</span> <span class=\"params\">|user|</span></span><br><span class=\"line\">  user.articles</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n<p>Đoạn code trên sẽ duyệt qua tất cả user có trong csdl rồi lấy tất cả các articles ứng với từng user. Rất tường minh và dễ hiểu.</p>\n<p>Tối có 5 user mẫu trong csdl nên các câu lệnh sql sinh ra sau đoạn code trên như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># câu lệnh lấy hết users lên</span></span><br><span class=\"line\">SELECT <span class=\"string\">\"users\"</span>.* FROM <span class=\"string\">\"users\"</span></span><br><span class=\"line\"><span class=\"comment\"># ứng với mỗi user query lấy tất cả articles lên</span></span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = ? LIMIT ?  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">1</span>], [<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = ? LIMIT ?  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">2</span>], [<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = ? LIMIT ?  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">3</span>], [<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = ? LIMIT ?  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">4</span>], [<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = ? LIMIT ?  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">5</span>], [<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>Đây chính là ví dụ điển hình về <strong>N+1</strong>, <strong>N</strong>ở đây là 5 (số lượng user có trong csdl) và <strong>1</strong> chính là câu lệnh sql đầu tiên dùng để lấy tất cả user lên.</p>\n<p>Nhìn như vô hại, mà thực ra ở ví dụ này cũng vô hại thật vì chỉ có 5 record user, nên thời gian load cũng không thấm tháp gì, tuy nhiên trong thực tế thì dữ liệu có thể rất lớn, lên đến hàng triệu record và nếu load dữ liệu như này thì đây là một vấn đề lớn cho hiệu năng của trang web. Hãy đọc tiếp mục 2 để tìm về giải pháp cho tình huống này.</p>\n<h2 id=\"2-Giai-phap\"><a href=\"#2-Giai-phap\" class=\"headerlink\" title=\"2. Giải pháp\"></a>2. Giải pháp</h2><p>Vấn đề đã có, giờ chúng ta cần tìm một giải pháp làm sao để kết quả trả về không đổi, nhưng lượng truy vấn sql trong csdl phải nhỏ hơn.</p>\n<p>Các phương án:</p>\n<ol>\n<li><p>Sử dụng <strong>select in()</strong>.</p>\n</li>\n<li><p>Sử dụng <strong>joins</strong>. Để đọc kỹ hơn về joins, thì nên xem ở <a href=\"https://www.w3schools.com/sql/sql_join.asp\" target=\"_blank\" rel=\"noopener\">đây</a></p>\n</li>\n</ol>\n<p>Sử dụng select in() sẽ tiết kiệm truy vấn đi rất nhiều, nếu ví dụ bên trên ta sử dụng select in() thì các sql query cần thiết sẽ là như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># lấy tất cả query</span></span><br><span class=\"line\">SELECT <span class=\"string\">\"users\"</span>.* FROM <span class=\"string\">\"users\"</span></span><br><span class=\"line\"><span class=\"comment\"># lấy articles ứng với từng user</span></span><br><span class=\"line\">SELECT  <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> IN (<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Tuyệt vời, từ 6(N + 1) truy vấn giờ đã trở thành còn 2.</p>\n<p>Với cách thứ 2 là sử dụng <strong>joins</strong>:</p>\n<p>joins hiểu đơn giản là ghép hai bảng lại với nhau (lấy một số field cần thiết ở bảng này, gộp với vài field cần thiết ở bảng kia khi mà record ở hai bên thoả mãn một điều kiện nào đó), rồi từ đó thành một bảng tạm dùng trong quá trình bạn sử dụng.</p>\n<p>Quay trở về ví dụ ban đầu, câu truy vấn bây giờ sẽ trở thành:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT User.name, Article.title</span><br><span class=\"line\">      FROM User</span><br><span class=\"line\">      INNER JOIN Article ON User.id = Article.user_id</span><br></pre></td></tr></table></figure>\n\n<p>Lấy vài field cần thiết(name của user và title của Article).<br>Bằng cách thoả mãn điều kiện nào đó(id của user bằng với user_id của article).</p>\n<p>Vậy từ N+1 query ban đầu, đã trở thành một query duy nhất.</p>\n<p>Đến lúc này đã có thể kết luận là joins tốt hơn select in() được chưa? Chưa, câu trả lời sẽ là như vậy. Sang mục 3 chúng ta sẽ tìm hiểu về cách xử lý N+1 thông qua ActiveRecord</p>\n<h2 id=\"3-Xu-ly-N-1-query-trong-ActiveRecord\"><a href=\"#3-Xu-ly-N-1-query-trong-ActiveRecord\" class=\"headerlink\" title=\"3. Xử lý N+1 query trong ActiveRecord\"></a>3. Xử lý N+1 query trong ActiveRecord</h2><p>Trong ActiveRecord cung cấp 3 phương thức để loại bỏ N+1,</p>\n<ol>\n<li>Sử dụng <strong>preload</strong></li>\n</ol>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User.preload(<span class=\"symbol\">:articles</span>)</span><br><span class=\"line\"><span class=\"comment\"># sql sinh ra</span></span><br><span class=\"line\">User Load (<span class=\"number\">0</span>.<span class=\"number\">2</span>ms)  SELECT  <span class=\"string\">\"users\"</span>.* FROM <span class=\"string\">\"users\"</span> LIMIT ?  [[<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">Article Load (<span class=\"number\">0</span>.<span class=\"number\">4</span>ms)  SELECT <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> IN (?, ?, ?)  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">1</span>], [<span class=\"string\">\"user_id\"</span>, <span class=\"number\">2</span>], [<span class=\"string\">\"user_id\"</span>, <span class=\"number\">3</span>]]</span><br></pre></td></tr></table></figure>\n<p>Preload sẽ luôn sử dụng <strong>select in()</strong></p>\n<ol start=\"2\">\n<li>Sử dụng <strong>Eagerload</strong></li>\n</ol>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User.eager_load(<span class=\"symbol\">:articles</span>)</span><br><span class=\"line\"><span class=\"comment\"># sql sinh ra</span></span><br><span class=\"line\">SELECT  DISTINCT <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> FROM <span class=\"string\">\"users\"</span> LEFT OUTER JOIN <span class=\"string\">\"articles\"</span> ON <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> LIMIT ?  [[<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\"></span><br><span class=\"line\">SELECT <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> AS t0_r<span class=\"number\">0</span>, <span class=\"string\">\"users\"</span>.<span class=\"string\">\"name\"</span> AS t0_r1, <span class=\"string\">\"users\"</span>.<span class=\"string\">\"created_at\"</span> AS t0_r2,</span><br><span class=\"line\"><span class=\"string\">\"users\"</span>.<span class=\"string\">\"updated_at\"</span> AS t0_r3, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"id\"</span> AS t1_r<span class=\"number\">0</span>, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"name\"</span> AS t1_r1,</span><br><span class=\"line\"><span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> AS t1_r2, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"created_at\"</span> AS t1_r3, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"updated_at\"</span> AS t1_r4</span><br><span class=\"line\">FROM <span class=\"string\">\"users\"</span> LEFT OUTER JOIN <span class=\"string\">\"articles\"</span> ON <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span></span><br><span class=\"line\">WHERE <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> IN (?, ?, ?)  [[<span class=\"string\">\"id\"</span>, <span class=\"number\">1</span>], [<span class=\"string\">\"id\"</span>, <span class=\"number\">2</span>], [<span class=\"string\">\"id\"</span>, <span class=\"number\">3</span>]]</span><br></pre></td></tr></table></figure>\n\n<p>eager_load luôn sử dụng <strong>joins</strong></p>\n<ol start=\"3\">\n<li>Sử dụng <strong>Inludes</strong></li>\n</ol>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># cách 1</span></span><br><span class=\"line\">User.includes(<span class=\"symbol\">:articles</span>)</span><br><span class=\"line\"><span class=\"comment\"># sql sinh ra</span></span><br><span class=\"line\">SELECT  <span class=\"string\">\"users\"</span>.* FROM <span class=\"string\">\"users\"</span> LIMIT ?  [[<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT <span class=\"string\">\"articles\"</span>.* FROM <span class=\"string\">\"articles\"</span> WHERE <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> IN (?, ?, ?)  [[<span class=\"string\">\"user_id\"</span>, <span class=\"number\">1</span>], [<span class=\"string\">\"user_id\"</span>, <span class=\"number\">2</span>], [<span class=\"string\">\"user_id\"</span>, <span class=\"number\">3</span>]]</span><br><span class=\"line\"><span class=\"comment\">#=&gt; giống preload</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># cách 2</span></span><br><span class=\"line\">User.includes(<span class=\"symbol\">:articles</span>).references(<span class=\"symbol\">:articles</span>)</span><br><span class=\"line\"><span class=\"comment\"># sql sinh ra</span></span><br><span class=\"line\">SELECT  DISTINCT <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> FROM <span class=\"string\">\"users\"</span> LEFT OUTER JOIN <span class=\"string\">\"articles\"</span></span><br><span class=\"line\">ON <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> LIMIT ?  [[<span class=\"string\">\"LIMIT\"</span>, <span class=\"number\">11</span>]]</span><br><span class=\"line\">SELECT <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> AS t0_r<span class=\"number\">0</span>, <span class=\"string\">\"users\"</span>.<span class=\"string\">\"name\"</span> AS t0_r1, <span class=\"string\">\"users\"</span>.<span class=\"string\">\"created_at\"</span> AS t0_r2,</span><br><span class=\"line\"><span class=\"string\">\"users\"</span>.<span class=\"string\">\"updated_at\"</span> AS t0_r3, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"id\"</span> AS t1_r<span class=\"number\">0</span>, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"name\"</span> AS t1_r1,</span><br><span class=\"line\"><span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> AS t1_r2, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"created_at\"</span> AS t1_r3, <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"updated_at\"</span> AS t1_r4</span><br><span class=\"line\">FROM <span class=\"string\">\"users\"</span> LEFT OUTER JOIN <span class=\"string\">\"articles\"</span> ON <span class=\"string\">\"articles\"</span>.<span class=\"string\">\"user_id\"</span> = <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span></span><br><span class=\"line\">WHERE <span class=\"string\">\"users\"</span>.<span class=\"string\">\"id\"</span> IN (?, ?, ?)  [[<span class=\"string\">\"id\"</span>, <span class=\"number\">1</span>], [<span class=\"string\">\"id\"</span>, <span class=\"number\">2</span>], [<span class=\"string\">\"id\"</span>, <span class=\"number\">3</span>]]</span><br><span class=\"line\"><span class=\"comment\">#=&gt; giống eager_load</span></span><br></pre></td></tr></table></figure>\n<p>Vậy mặc định thì <strong>includes</strong> sử dụng select in(), nhưng cũng có thể chuyển qua sử dụng joins nếu thêm method references phía sau.</p>\n"},{"title":"Immutable Và Mutable Trong Ruby","date":"2019-04-07T17:00:00.000Z","draft":false,"_content":"\n## 1. Khái niệm mutable, immutable và ruby\n\nĐi thẳng vào vấn đề, chúng ta cần đề cập đến ba vấn đề: **mutable**, **immutable** và cách ruby xử lý hai khái niệm đó. Trước hết nếu bạn đã quên, thì tôi xin được nhắc lại định nghĩa của chúng.\n\nXin trích dẫn [wiki](https://en.wikipedia.org/wiki/Immutable_object):\n\n> In object-oriented and functional programming, an immutable object (unchangeable[1] object) is an object whose state cannot be modified after it is created.[2] This is in contrast to a mutable object (changeable object), which can be modified after it is created.\n\nTranslate:\n\n> Trong lập trình hướng đối tượng và lập trình hàm, một đối tượng được coi immutable, là một đối tượng **không thể thay đổi** trạng thái sau khi nó được tạo lần đầu, ngược lại với một đối tượng được coi là mutable nó có thể **thay đổi** trạng thái sau khi được khởi tạo lần đầu.\n\nDùng từ quá khó hiểu, what the hell is \"trạng thái\"? Theo một cách hàn lâm và đầy đủ, trạng thái của một đối tượng ngoài đời thật được thiết lập bởi tất cả những gì tạo nên chúng.\n\nTương tự, các trạng thái của một đối tượng trong lập trình cũng được thiết lập bằng tất cả những gì tạo nên chúng. Ví dụ:\n\nVới 1 biến integer cơ bản **x = 10** thì trạng thái của nó được tạo ra bởi tên biến và giá trị, ở đây tên biến là **x** và giá trị là **10**, đâu đó trong vùng nhớ (Ram) của bạn sẽ lưu trữ cái chữ **x** kèm số **10** này.\n\nĐồng nghĩa với đó nếu tôi thay đổi được giá trị 10 của biến x thì x là một đối tượng mutable và ngược lại nó là một đối tượng immutable.\n\nTôi gán **x = 11** và thành công\n\nTừ đó có thể đưa ra kết luận x là một mutable?\n\nCâu trả lời là không, một số khái niệm rối rắm làm khó ta lúc đầu. Như đã biết, thứ mà CPU làm việc là địa chỉ vùng nhớ và chỉ địa chỉ vùng nhớ mà thôi. Những thứ khác nó không quan tâm.\n\nVới câu lệnh gán **x = 10**. Nó được hệ điều hành phiên dịch thành \"có một biến tên **x** được gán giá trị bằng **10**, Ram, mày hãy bố trí thêm hai slot để lưu trữ **x** và **10**\". Vậy lúc đó:\n\n**x**(tên biến) được lưu ở vị trí AAA\n**10**(giá trị) được lưu ở vị trí BBB\n\nVới lệnh gán tiếp theo **x = 11**:\n\n**x** vẫn yên vị nằm ở vị trí AAA\n**10** cũng vẫn yên trí nằm ở vị trí BBB\n**11** giá trị mới gán cho biến x thì lúc này nằm ở vị trí CCC\n\nVậy khi chạy một lệnh gán mới thì biến x đã được gán bằng giá trị trên một vùng nhớ khác, còn vùng nhớ ban đầu **không thay đổi giá trị** nên ta có thể kết luận x là một immutable.\n\nChứng minh bằng ví dụ sau trong ruby, chú ý là ruby là một ngôn ngữ script, với trình thông dịch VM bên dưới để xử lý của nó được viết bằng C, nên ở lớp cơ sở của ruby ta không thể truy xuất vị trí vùng nhớ đến từng thanh ghi như trong C được (việc đó được làm ở lớp core YARV). Tuy nhiên, ta có thể kiếm tra được vị trí tượng trưng trên bộ nhớ của nó thông qua **object_id**.\n\n```ruby\nx = 10\nx.object_id\n#=> 21\nx = 11\nx.object_id\n#=> 23\n```\n\nNote: Nếu bạn gán tiếp x = 12 và kiểm tra lại object_id, lúc này bạn sẽ thấy nó bằng 25. Giá trị 10, 11, 12 tương đương với object_id là 21, 23, 25. Liệu có một quy luật nào ở đây? Câu trả lời là có, nhưng vấn đề này sẽ được đề cập đến trong một bài viết tiếp theo.\n\nTừ ví dụ trên bạn đã hiểu về immutable, vậy còn mutable? Đơn giản nhất là hãy hiểu ngược lại với immutable, nêu gán x = 11 và x có object_id không đổi thì x chính là mutable.\n\n```\nTất cả các loại dữ liệu nguyên thuỷ trong ruby đều là immutable.\n```\n\nInteger, float, string, boolean chúng đều là immutable.\n\n## 2. Liệu đây có phải là một kiến thức cần thiết?\n\nChắc chắn là có.\n\nThứ nhất: Nếu trong công việc bạn không bao giờ phải dùng đến nó, bạn có thể nói về nó như một kiến thức hàn lâm để thể hiện khả năng với sếp và yêu cầu tăng lương :worried:\n\nThứ hai: Xét ví dụ sau\n\n```ruby\nstr = \"\"\n[\"Hoang\", \"Duy\", \"Chinh\"].each do |i|\n  str += i\nend\n```\n\nTư tưởng của đoạn mã này là cộng tất cả các phần tử trong một mảng string và cho ra kết quả cuối cùng là một chuỗi tổng hợp tất cả các phần tử.\nCó điều gì bất thường trong đoạn mã này không nhỉ? Câu trả lời là có. Như những gì chúng ta đã nói ở trên có hai điều cần lưu ý:\n\n> 1. Các kiểu dữ liệu nguyên thuỷ trong ruby đều là immutable và hiển nhiên string không ngoại lệ.\n\n> 2. Khi một object là immutable, thì việc bạn gán nó bằng một giá trị khác đồng nghĩa với việc vùng nhớ cũ sẽ không được dùng đến, mà nó sẽ ra một vùng nhớ mới rồi ghi kết quả mới lên đó, cứ lặp lại như vậy mãi mãi.\n\nTừ hai điều trên ta rút ra được kết luận:\n\n1. Trong lần gán đầu tiên str có giá trị là chuỗi rỗng và được khởi tạo tại ví trí A1\n2. Trong lần lặp **each** đầu tiên, str có giá trị là \"Hoang\" và nó lưu ở vị trí A2\n3. Trong lần lặp **each** thứ hai, str có giá trị mới là \"HoangDuy\" và nó lưu ở vị trí mới là A3\n4. Trong lần lặp cuối cùng thì str có giá trị chúng ta mong đợi là \"HoangDuyChinh\" và nó lưu ở vị trí A4\n\nChứng minh:\n\n```ruby\nstr = \"\"\nputs \"First location: #{str.object_id}\"\n[\"Hoang\", \"Duy\", \"Chinh\"].each do |i|\n  str += i\n  puts \"value: #{str} | location: #{str.object_id}\"\nend\n\nputs \"Final value: #{str} | location: #{str.object_id}\"\n```\n\nKết quả:\n```\nFirst location: 47434608564740\nvalue: Hoang | location: 47434608564520\nvalue: HoangDuy | location: 47434608564440\nvalue: HoangDuyChinh | location: 47434608564360\nFinal value: HoangDuyChinh | location: 47434608564360\n```\n\nVà thứ chúng ta quan tâm từ đó về sau là vị trí A4 này. Vậy còn A1, A2, A3 cũng đang mang giá trị? Chúng đi đâu về đâu? Chính xác, nó trở thành một vùng nhớ rác và sẽ được GC dọn dẹp nhưng không phải ngay lập tức, vậy trong khoảng thời gian đó nó vẫn nắm giữ các vùng nhớ của chúng ta. Đó cũng là một trong các lý do việc bạn muốn chạy ruby on rails trên một chiếc máy tính sinh viên 2GB là vô cùng khó khăn. Ruby ăn Ram như uống nước lã vậy.\n\nVí dụ trên mảng ta có ba phần tử và ta có 3 giá trị rác trên bộ nhớ, hãy tưởng tượng bạn có một mảng một triệu phần tử :worried:\n\nGiải pháp trong trường hợp này là gì? Đó là duyệt mảng như một **object reference** chứ không phải một biến giá trị:\n\n```ruby\nstr = \"\"\n[\"Hoang\", \"Duy\", \"Chinh\"].each do |i|\n  str << i\nend\n```\n\nNhư vậy str sẽ ở đúng một vùng nhớ và ta không có một đống biến rác không mong đợi.\n\nChứng minh:\n\n```ruby\nstr = \"\"\nputs \"First location: #{str.object_id}\"\n[\"Hoang\", \"Duy\", \"Chinh\"].each do |i|\n  str << i\n  puts \"value: #{str} | location: #{str.object_id}\"\nend\n\nputs \"Final value: #{str} | location: #{str.object_id}\"\n```\n\nKết quả:\n\n```\nFirst location: 47196120971580\nvalue: Hoang | location: 47196120971580\nvalue: HoangDuy | location: 47196120971580\nvalue: HoangDuyChinh | location: 47196120971580\nFinal value: HoangDuyChinh | location: 47196120971580\n```\n\n## 3. Tham khảo\n\n[1] [https://en.wikipedia.org/wiki/Immutable_object](https://en.wikipedia.org/wiki/Immutable_object)\n","source":"_posts/2019-04-08-immutable-va-mutable-trong-ruby.md","raw":"---\ntitle: \"Immutable Và Mutable Trong Ruby\"\ndate: 2019-04-08\ndraft: false\ntags: [\"RUBY\"]\n---\n\n## 1. Khái niệm mutable, immutable và ruby\n\nĐi thẳng vào vấn đề, chúng ta cần đề cập đến ba vấn đề: **mutable**, **immutable** và cách ruby xử lý hai khái niệm đó. Trước hết nếu bạn đã quên, thì tôi xin được nhắc lại định nghĩa của chúng.\n\nXin trích dẫn [wiki](https://en.wikipedia.org/wiki/Immutable_object):\n\n> In object-oriented and functional programming, an immutable object (unchangeable[1] object) is an object whose state cannot be modified after it is created.[2] This is in contrast to a mutable object (changeable object), which can be modified after it is created.\n\nTranslate:\n\n> Trong lập trình hướng đối tượng và lập trình hàm, một đối tượng được coi immutable, là một đối tượng **không thể thay đổi** trạng thái sau khi nó được tạo lần đầu, ngược lại với một đối tượng được coi là mutable nó có thể **thay đổi** trạng thái sau khi được khởi tạo lần đầu.\n\nDùng từ quá khó hiểu, what the hell is \"trạng thái\"? Theo một cách hàn lâm và đầy đủ, trạng thái của một đối tượng ngoài đời thật được thiết lập bởi tất cả những gì tạo nên chúng.\n\nTương tự, các trạng thái của một đối tượng trong lập trình cũng được thiết lập bằng tất cả những gì tạo nên chúng. Ví dụ:\n\nVới 1 biến integer cơ bản **x = 10** thì trạng thái của nó được tạo ra bởi tên biến và giá trị, ở đây tên biến là **x** và giá trị là **10**, đâu đó trong vùng nhớ (Ram) của bạn sẽ lưu trữ cái chữ **x** kèm số **10** này.\n\nĐồng nghĩa với đó nếu tôi thay đổi được giá trị 10 của biến x thì x là một đối tượng mutable và ngược lại nó là một đối tượng immutable.\n\nTôi gán **x = 11** và thành công\n\nTừ đó có thể đưa ra kết luận x là một mutable?\n\nCâu trả lời là không, một số khái niệm rối rắm làm khó ta lúc đầu. Như đã biết, thứ mà CPU làm việc là địa chỉ vùng nhớ và chỉ địa chỉ vùng nhớ mà thôi. Những thứ khác nó không quan tâm.\n\nVới câu lệnh gán **x = 10**. Nó được hệ điều hành phiên dịch thành \"có một biến tên **x** được gán giá trị bằng **10**, Ram, mày hãy bố trí thêm hai slot để lưu trữ **x** và **10**\". Vậy lúc đó:\n\n**x**(tên biến) được lưu ở vị trí AAA\n**10**(giá trị) được lưu ở vị trí BBB\n\nVới lệnh gán tiếp theo **x = 11**:\n\n**x** vẫn yên vị nằm ở vị trí AAA\n**10** cũng vẫn yên trí nằm ở vị trí BBB\n**11** giá trị mới gán cho biến x thì lúc này nằm ở vị trí CCC\n\nVậy khi chạy một lệnh gán mới thì biến x đã được gán bằng giá trị trên một vùng nhớ khác, còn vùng nhớ ban đầu **không thay đổi giá trị** nên ta có thể kết luận x là một immutable.\n\nChứng minh bằng ví dụ sau trong ruby, chú ý là ruby là một ngôn ngữ script, với trình thông dịch VM bên dưới để xử lý của nó được viết bằng C, nên ở lớp cơ sở của ruby ta không thể truy xuất vị trí vùng nhớ đến từng thanh ghi như trong C được (việc đó được làm ở lớp core YARV). Tuy nhiên, ta có thể kiếm tra được vị trí tượng trưng trên bộ nhớ của nó thông qua **object_id**.\n\n```ruby\nx = 10\nx.object_id\n#=> 21\nx = 11\nx.object_id\n#=> 23\n```\n\nNote: Nếu bạn gán tiếp x = 12 và kiểm tra lại object_id, lúc này bạn sẽ thấy nó bằng 25. Giá trị 10, 11, 12 tương đương với object_id là 21, 23, 25. Liệu có một quy luật nào ở đây? Câu trả lời là có, nhưng vấn đề này sẽ được đề cập đến trong một bài viết tiếp theo.\n\nTừ ví dụ trên bạn đã hiểu về immutable, vậy còn mutable? Đơn giản nhất là hãy hiểu ngược lại với immutable, nêu gán x = 11 và x có object_id không đổi thì x chính là mutable.\n\n```\nTất cả các loại dữ liệu nguyên thuỷ trong ruby đều là immutable.\n```\n\nInteger, float, string, boolean chúng đều là immutable.\n\n## 2. Liệu đây có phải là một kiến thức cần thiết?\n\nChắc chắn là có.\n\nThứ nhất: Nếu trong công việc bạn không bao giờ phải dùng đến nó, bạn có thể nói về nó như một kiến thức hàn lâm để thể hiện khả năng với sếp và yêu cầu tăng lương :worried:\n\nThứ hai: Xét ví dụ sau\n\n```ruby\nstr = \"\"\n[\"Hoang\", \"Duy\", \"Chinh\"].each do |i|\n  str += i\nend\n```\n\nTư tưởng của đoạn mã này là cộng tất cả các phần tử trong một mảng string và cho ra kết quả cuối cùng là một chuỗi tổng hợp tất cả các phần tử.\nCó điều gì bất thường trong đoạn mã này không nhỉ? Câu trả lời là có. Như những gì chúng ta đã nói ở trên có hai điều cần lưu ý:\n\n> 1. Các kiểu dữ liệu nguyên thuỷ trong ruby đều là immutable và hiển nhiên string không ngoại lệ.\n\n> 2. Khi một object là immutable, thì việc bạn gán nó bằng một giá trị khác đồng nghĩa với việc vùng nhớ cũ sẽ không được dùng đến, mà nó sẽ ra một vùng nhớ mới rồi ghi kết quả mới lên đó, cứ lặp lại như vậy mãi mãi.\n\nTừ hai điều trên ta rút ra được kết luận:\n\n1. Trong lần gán đầu tiên str có giá trị là chuỗi rỗng và được khởi tạo tại ví trí A1\n2. Trong lần lặp **each** đầu tiên, str có giá trị là \"Hoang\" và nó lưu ở vị trí A2\n3. Trong lần lặp **each** thứ hai, str có giá trị mới là \"HoangDuy\" và nó lưu ở vị trí mới là A3\n4. Trong lần lặp cuối cùng thì str có giá trị chúng ta mong đợi là \"HoangDuyChinh\" và nó lưu ở vị trí A4\n\nChứng minh:\n\n```ruby\nstr = \"\"\nputs \"First location: #{str.object_id}\"\n[\"Hoang\", \"Duy\", \"Chinh\"].each do |i|\n  str += i\n  puts \"value: #{str} | location: #{str.object_id}\"\nend\n\nputs \"Final value: #{str} | location: #{str.object_id}\"\n```\n\nKết quả:\n```\nFirst location: 47434608564740\nvalue: Hoang | location: 47434608564520\nvalue: HoangDuy | location: 47434608564440\nvalue: HoangDuyChinh | location: 47434608564360\nFinal value: HoangDuyChinh | location: 47434608564360\n```\n\nVà thứ chúng ta quan tâm từ đó về sau là vị trí A4 này. Vậy còn A1, A2, A3 cũng đang mang giá trị? Chúng đi đâu về đâu? Chính xác, nó trở thành một vùng nhớ rác và sẽ được GC dọn dẹp nhưng không phải ngay lập tức, vậy trong khoảng thời gian đó nó vẫn nắm giữ các vùng nhớ của chúng ta. Đó cũng là một trong các lý do việc bạn muốn chạy ruby on rails trên một chiếc máy tính sinh viên 2GB là vô cùng khó khăn. Ruby ăn Ram như uống nước lã vậy.\n\nVí dụ trên mảng ta có ba phần tử và ta có 3 giá trị rác trên bộ nhớ, hãy tưởng tượng bạn có một mảng một triệu phần tử :worried:\n\nGiải pháp trong trường hợp này là gì? Đó là duyệt mảng như một **object reference** chứ không phải một biến giá trị:\n\n```ruby\nstr = \"\"\n[\"Hoang\", \"Duy\", \"Chinh\"].each do |i|\n  str << i\nend\n```\n\nNhư vậy str sẽ ở đúng một vùng nhớ và ta không có một đống biến rác không mong đợi.\n\nChứng minh:\n\n```ruby\nstr = \"\"\nputs \"First location: #{str.object_id}\"\n[\"Hoang\", \"Duy\", \"Chinh\"].each do |i|\n  str << i\n  puts \"value: #{str} | location: #{str.object_id}\"\nend\n\nputs \"Final value: #{str} | location: #{str.object_id}\"\n```\n\nKết quả:\n\n```\nFirst location: 47196120971580\nvalue: Hoang | location: 47196120971580\nvalue: HoangDuy | location: 47196120971580\nvalue: HoangDuyChinh | location: 47196120971580\nFinal value: HoangDuyChinh | location: 47196120971580\n```\n\n## 3. Tham khảo\n\n[1] [https://en.wikipedia.org/wiki/Immutable_object](https://en.wikipedia.org/wiki/Immutable_object)\n","slug":"2019-04-08-immutable-va-mutable-trong-ruby","published":1,"updated":"2022-01-29T09:29:59.926Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsai000rp3m241tx0xdg","content":"<h2 id=\"1-Khai-niem-mutable-immutable-va-ruby\"><a href=\"#1-Khai-niem-mutable-immutable-va-ruby\" class=\"headerlink\" title=\"1. Khái niệm mutable, immutable và ruby\"></a>1. Khái niệm mutable, immutable và ruby</h2><p>Đi thẳng vào vấn đề, chúng ta cần đề cập đến ba vấn đề: <strong>mutable</strong>, <strong>immutable</strong> và cách ruby xử lý hai khái niệm đó. Trước hết nếu bạn đã quên, thì tôi xin được nhắc lại định nghĩa của chúng.</p>\n<p>Xin trích dẫn <a href=\"https://en.wikipedia.org/wiki/Immutable_object\" target=\"_blank\" rel=\"noopener\">wiki</a>:</p>\n<blockquote>\n<p>In object-oriented and functional programming, an immutable object (unchangeable[1] object) is an object whose state cannot be modified after it is created.[2] This is in contrast to a mutable object (changeable object), which can be modified after it is created.</p>\n</blockquote>\n<p>Translate:</p>\n<blockquote>\n<p>Trong lập trình hướng đối tượng và lập trình hàm, một đối tượng được coi immutable, là một đối tượng <strong>không thể thay đổi</strong> trạng thái sau khi nó được tạo lần đầu, ngược lại với một đối tượng được coi là mutable nó có thể <strong>thay đổi</strong> trạng thái sau khi được khởi tạo lần đầu.</p>\n</blockquote>\n<p>Dùng từ quá khó hiểu, what the hell is “trạng thái”? Theo một cách hàn lâm và đầy đủ, trạng thái của một đối tượng ngoài đời thật được thiết lập bởi tất cả những gì tạo nên chúng.</p>\n<p>Tương tự, các trạng thái của một đối tượng trong lập trình cũng được thiết lập bằng tất cả những gì tạo nên chúng. Ví dụ:</p>\n<p>Với 1 biến integer cơ bản <strong>x = 10</strong> thì trạng thái của nó được tạo ra bởi tên biến và giá trị, ở đây tên biến là <strong>x</strong> và giá trị là <strong>10</strong>, đâu đó trong vùng nhớ (Ram) của bạn sẽ lưu trữ cái chữ <strong>x</strong> kèm số <strong>10</strong> này.</p>\n<p>Đồng nghĩa với đó nếu tôi thay đổi được giá trị 10 của biến x thì x là một đối tượng mutable và ngược lại nó là một đối tượng immutable.</p>\n<p>Tôi gán <strong>x = 11</strong> và thành công</p>\n<p>Từ đó có thể đưa ra kết luận x là một mutable?</p>\n<p>Câu trả lời là không, một số khái niệm rối rắm làm khó ta lúc đầu. Như đã biết, thứ mà CPU làm việc là địa chỉ vùng nhớ và chỉ địa chỉ vùng nhớ mà thôi. Những thứ khác nó không quan tâm.</p>\n<p>Với câu lệnh gán <strong>x = 10</strong>. Nó được hệ điều hành phiên dịch thành “có một biến tên <strong>x</strong> được gán giá trị bằng <strong>10</strong>, Ram, mày hãy bố trí thêm hai slot để lưu trữ <strong>x</strong> và <strong>10</strong>“. Vậy lúc đó:</p>\n<p><strong>x</strong>(tên biến) được lưu ở vị trí AAA<br><strong>10</strong>(giá trị) được lưu ở vị trí BBB</p>\n<p>Với lệnh gán tiếp theo <strong>x = 11</strong>:</p>\n<p><strong>x</strong> vẫn yên vị nằm ở vị trí AAA<br><strong>10</strong> cũng vẫn yên trí nằm ở vị trí BBB<br><strong>11</strong> giá trị mới gán cho biến x thì lúc này nằm ở vị trí CCC</p>\n<p>Vậy khi chạy một lệnh gán mới thì biến x đã được gán bằng giá trị trên một vùng nhớ khác, còn vùng nhớ ban đầu <strong>không thay đổi giá trị</strong> nên ta có thể kết luận x là một immutable.</p>\n<p>Chứng minh bằng ví dụ sau trong ruby, chú ý là ruby là một ngôn ngữ script, với trình thông dịch VM bên dưới để xử lý của nó được viết bằng C, nên ở lớp cơ sở của ruby ta không thể truy xuất vị trí vùng nhớ đến từng thanh ghi như trong C được (việc đó được làm ở lớp core YARV). Tuy nhiên, ta có thể kiếm tra được vị trí tượng trưng trên bộ nhớ của nó thông qua <strong>object_id</strong>.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = <span class=\"number\">10</span></span><br><span class=\"line\">x.object_id</span><br><span class=\"line\"><span class=\"comment\">#=&gt; 21</span></span><br><span class=\"line\">x = <span class=\"number\">11</span></span><br><span class=\"line\">x.object_id</span><br><span class=\"line\"><span class=\"comment\">#=&gt; 23</span></span><br></pre></td></tr></table></figure>\n\n<p>Note: Nếu bạn gán tiếp x = 12 và kiểm tra lại object_id, lúc này bạn sẽ thấy nó bằng 25. Giá trị 10, 11, 12 tương đương với object_id là 21, 23, 25. Liệu có một quy luật nào ở đây? Câu trả lời là có, nhưng vấn đề này sẽ được đề cập đến trong một bài viết tiếp theo.</p>\n<p>Từ ví dụ trên bạn đã hiểu về immutable, vậy còn mutable? Đơn giản nhất là hãy hiểu ngược lại với immutable, nêu gán x = 11 và x có object_id không đổi thì x chính là mutable.</p>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">T</span>ấ<span class=\"built_in\">t</span> cả các loại dữ liệu nguyê<span class=\"built_in\">n</span> thuỷ trong ruby đều là immutable.</span><br></pre></td></tr></table></figure>\n\n<p>Integer, float, string, boolean chúng đều là immutable.</p>\n<h2 id=\"2-Lieu-day-co-phai-la-mot-kien-thuc-can-thiet\"><a href=\"#2-Lieu-day-co-phai-la-mot-kien-thuc-can-thiet\" class=\"headerlink\" title=\"2. Liệu đây có phải là một kiến thức cần thiết?\"></a>2. Liệu đây có phải là một kiến thức cần thiết?</h2><p>Chắc chắn là có.</p>\n<p>Thứ nhất: Nếu trong công việc bạn không bao giờ phải dùng đến nó, bạn có thể nói về nó như một kiến thức hàn lâm để thể hiện khả năng với sếp và yêu cầu tăng lương :worried:</p>\n<p>Thứ hai: Xét ví dụ sau</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str = <span class=\"string\">\"\"</span></span><br><span class=\"line\">[<span class=\"string\">\"Hoang\"</span>, <span class=\"string\">\"Duy\"</span>, <span class=\"string\">\"Chinh\"</span>].each <span class=\"keyword\">do</span> <span class=\"params\">|i|</span></span><br><span class=\"line\">  str += i</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Tư tưởng của đoạn mã này là cộng tất cả các phần tử trong một mảng string và cho ra kết quả cuối cùng là một chuỗi tổng hợp tất cả các phần tử.<br>Có điều gì bất thường trong đoạn mã này không nhỉ? Câu trả lời là có. Như những gì chúng ta đã nói ở trên có hai điều cần lưu ý:</p>\n<blockquote>\n<ol>\n<li>Các kiểu dữ liệu nguyên thuỷ trong ruby đều là immutable và hiển nhiên string không ngoại lệ.</li>\n</ol>\n</blockquote>\n<blockquote>\n<ol start=\"2\">\n<li>Khi một object là immutable, thì việc bạn gán nó bằng một giá trị khác đồng nghĩa với việc vùng nhớ cũ sẽ không được dùng đến, mà nó sẽ ra một vùng nhớ mới rồi ghi kết quả mới lên đó, cứ lặp lại như vậy mãi mãi.</li>\n</ol>\n</blockquote>\n<p>Từ hai điều trên ta rút ra được kết luận:</p>\n<ol>\n<li>Trong lần gán đầu tiên str có giá trị là chuỗi rỗng và được khởi tạo tại ví trí A1</li>\n<li>Trong lần lặp <strong>each</strong> đầu tiên, str có giá trị là “Hoang” và nó lưu ở vị trí A2</li>\n<li>Trong lần lặp <strong>each</strong> thứ hai, str có giá trị mới là “HoangDuy” và nó lưu ở vị trí mới là A3</li>\n<li>Trong lần lặp cuối cùng thì str có giá trị chúng ta mong đợi là “HoangDuyChinh” và nó lưu ở vị trí A4</li>\n</ol>\n<p>Chứng minh:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str = <span class=\"string\">\"\"</span></span><br><span class=\"line\">puts <span class=\"string\">\"First location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br><span class=\"line\">[<span class=\"string\">\"Hoang\"</span>, <span class=\"string\">\"Duy\"</span>, <span class=\"string\">\"Chinh\"</span>].each <span class=\"keyword\">do</span> <span class=\"params\">|i|</span></span><br><span class=\"line\">  str += i</span><br><span class=\"line\">  puts <span class=\"string\">\"value: <span class=\"subst\">#&#123;str&#125;</span> | location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"Final value: <span class=\"subst\">#&#123;str&#125;</span> | location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Kết quả:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">First location:</span> <span class=\"number\">47434608564740</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">Hoang</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47434608564520</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">HoangDuy</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47434608564440</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">HoangDuyChinh</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47434608564360</span></span><br><span class=\"line\"><span class=\"attr\">Final value:</span> <span class=\"string\">HoangDuyChinh</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47434608564360</span></span><br></pre></td></tr></table></figure>\n\n<p>Và thứ chúng ta quan tâm từ đó về sau là vị trí A4 này. Vậy còn A1, A2, A3 cũng đang mang giá trị? Chúng đi đâu về đâu? Chính xác, nó trở thành một vùng nhớ rác và sẽ được GC dọn dẹp nhưng không phải ngay lập tức, vậy trong khoảng thời gian đó nó vẫn nắm giữ các vùng nhớ của chúng ta. Đó cũng là một trong các lý do việc bạn muốn chạy ruby on rails trên một chiếc máy tính sinh viên 2GB là vô cùng khó khăn. Ruby ăn Ram như uống nước lã vậy.</p>\n<p>Ví dụ trên mảng ta có ba phần tử và ta có 3 giá trị rác trên bộ nhớ, hãy tưởng tượng bạn có một mảng một triệu phần tử :worried:</p>\n<p>Giải pháp trong trường hợp này là gì? Đó là duyệt mảng như một <strong>object reference</strong> chứ không phải một biến giá trị:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str = <span class=\"string\">\"\"</span></span><br><span class=\"line\">[<span class=\"string\">\"Hoang\"</span>, <span class=\"string\">\"Duy\"</span>, <span class=\"string\">\"Chinh\"</span>].each <span class=\"keyword\">do</span> <span class=\"params\">|i|</span></span><br><span class=\"line\">  str &lt;&lt; i</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Như vậy str sẽ ở đúng một vùng nhớ và ta không có một đống biến rác không mong đợi.</p>\n<p>Chứng minh:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str = <span class=\"string\">\"\"</span></span><br><span class=\"line\">puts <span class=\"string\">\"First location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br><span class=\"line\">[<span class=\"string\">\"Hoang\"</span>, <span class=\"string\">\"Duy\"</span>, <span class=\"string\">\"Chinh\"</span>].each <span class=\"keyword\">do</span> <span class=\"params\">|i|</span></span><br><span class=\"line\">  str &lt;&lt; i</span><br><span class=\"line\">  puts <span class=\"string\">\"value: <span class=\"subst\">#&#123;str&#125;</span> | location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"Final value: <span class=\"subst\">#&#123;str&#125;</span> | location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Kết quả:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">First location:</span> <span class=\"number\">47196120971580</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">Hoang</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47196120971580</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">HoangDuy</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47196120971580</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">HoangDuyChinh</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47196120971580</span></span><br><span class=\"line\"><span class=\"attr\">Final value:</span> <span class=\"string\">HoangDuyChinh</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47196120971580</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-Tham-khao\"><a href=\"#3-Tham-khao\" class=\"headerlink\" title=\"3. Tham khảo\"></a>3. Tham khảo</h2><p>[1] <a href=\"https://en.wikipedia.org/wiki/Immutable_object\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/Immutable_object</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Khai-niem-mutable-immutable-va-ruby\"><a href=\"#1-Khai-niem-mutable-immutable-va-ruby\" class=\"headerlink\" title=\"1. Khái niệm mutable, immutable và ruby\"></a>1. Khái niệm mutable, immutable và ruby</h2><p>Đi thẳng vào vấn đề, chúng ta cần đề cập đến ba vấn đề: <strong>mutable</strong>, <strong>immutable</strong> và cách ruby xử lý hai khái niệm đó. Trước hết nếu bạn đã quên, thì tôi xin được nhắc lại định nghĩa của chúng.</p>\n<p>Xin trích dẫn <a href=\"https://en.wikipedia.org/wiki/Immutable_object\" target=\"_blank\" rel=\"noopener\">wiki</a>:</p>\n<blockquote>\n<p>In object-oriented and functional programming, an immutable object (unchangeable[1] object) is an object whose state cannot be modified after it is created.[2] This is in contrast to a mutable object (changeable object), which can be modified after it is created.</p>\n</blockquote>\n<p>Translate:</p>\n<blockquote>\n<p>Trong lập trình hướng đối tượng và lập trình hàm, một đối tượng được coi immutable, là một đối tượng <strong>không thể thay đổi</strong> trạng thái sau khi nó được tạo lần đầu, ngược lại với một đối tượng được coi là mutable nó có thể <strong>thay đổi</strong> trạng thái sau khi được khởi tạo lần đầu.</p>\n</blockquote>\n<p>Dùng từ quá khó hiểu, what the hell is “trạng thái”? Theo một cách hàn lâm và đầy đủ, trạng thái của một đối tượng ngoài đời thật được thiết lập bởi tất cả những gì tạo nên chúng.</p>\n<p>Tương tự, các trạng thái của một đối tượng trong lập trình cũng được thiết lập bằng tất cả những gì tạo nên chúng. Ví dụ:</p>\n<p>Với 1 biến integer cơ bản <strong>x = 10</strong> thì trạng thái của nó được tạo ra bởi tên biến và giá trị, ở đây tên biến là <strong>x</strong> và giá trị là <strong>10</strong>, đâu đó trong vùng nhớ (Ram) của bạn sẽ lưu trữ cái chữ <strong>x</strong> kèm số <strong>10</strong> này.</p>\n<p>Đồng nghĩa với đó nếu tôi thay đổi được giá trị 10 của biến x thì x là một đối tượng mutable và ngược lại nó là một đối tượng immutable.</p>\n<p>Tôi gán <strong>x = 11</strong> và thành công</p>\n<p>Từ đó có thể đưa ra kết luận x là một mutable?</p>\n<p>Câu trả lời là không, một số khái niệm rối rắm làm khó ta lúc đầu. Như đã biết, thứ mà CPU làm việc là địa chỉ vùng nhớ và chỉ địa chỉ vùng nhớ mà thôi. Những thứ khác nó không quan tâm.</p>\n<p>Với câu lệnh gán <strong>x = 10</strong>. Nó được hệ điều hành phiên dịch thành “có một biến tên <strong>x</strong> được gán giá trị bằng <strong>10</strong>, Ram, mày hãy bố trí thêm hai slot để lưu trữ <strong>x</strong> và <strong>10</strong>“. Vậy lúc đó:</p>\n<p><strong>x</strong>(tên biến) được lưu ở vị trí AAA<br><strong>10</strong>(giá trị) được lưu ở vị trí BBB</p>\n<p>Với lệnh gán tiếp theo <strong>x = 11</strong>:</p>\n<p><strong>x</strong> vẫn yên vị nằm ở vị trí AAA<br><strong>10</strong> cũng vẫn yên trí nằm ở vị trí BBB<br><strong>11</strong> giá trị mới gán cho biến x thì lúc này nằm ở vị trí CCC</p>\n<p>Vậy khi chạy một lệnh gán mới thì biến x đã được gán bằng giá trị trên một vùng nhớ khác, còn vùng nhớ ban đầu <strong>không thay đổi giá trị</strong> nên ta có thể kết luận x là một immutable.</p>\n<p>Chứng minh bằng ví dụ sau trong ruby, chú ý là ruby là một ngôn ngữ script, với trình thông dịch VM bên dưới để xử lý của nó được viết bằng C, nên ở lớp cơ sở của ruby ta không thể truy xuất vị trí vùng nhớ đến từng thanh ghi như trong C được (việc đó được làm ở lớp core YARV). Tuy nhiên, ta có thể kiếm tra được vị trí tượng trưng trên bộ nhớ của nó thông qua <strong>object_id</strong>.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">x = <span class=\"number\">10</span></span><br><span class=\"line\">x.object_id</span><br><span class=\"line\"><span class=\"comment\">#=&gt; 21</span></span><br><span class=\"line\">x = <span class=\"number\">11</span></span><br><span class=\"line\">x.object_id</span><br><span class=\"line\"><span class=\"comment\">#=&gt; 23</span></span><br></pre></td></tr></table></figure>\n\n<p>Note: Nếu bạn gán tiếp x = 12 và kiểm tra lại object_id, lúc này bạn sẽ thấy nó bằng 25. Giá trị 10, 11, 12 tương đương với object_id là 21, 23, 25. Liệu có một quy luật nào ở đây? Câu trả lời là có, nhưng vấn đề này sẽ được đề cập đến trong một bài viết tiếp theo.</p>\n<p>Từ ví dụ trên bạn đã hiểu về immutable, vậy còn mutable? Đơn giản nhất là hãy hiểu ngược lại với immutable, nêu gán x = 11 và x có object_id không đổi thì x chính là mutable.</p>\n<figure class=\"highlight excel\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">T</span>ấ<span class=\"built_in\">t</span> cả các loại dữ liệu nguyê<span class=\"built_in\">n</span> thuỷ trong ruby đều là immutable.</span><br></pre></td></tr></table></figure>\n\n<p>Integer, float, string, boolean chúng đều là immutable.</p>\n<h2 id=\"2-Lieu-day-co-phai-la-mot-kien-thuc-can-thiet\"><a href=\"#2-Lieu-day-co-phai-la-mot-kien-thuc-can-thiet\" class=\"headerlink\" title=\"2. Liệu đây có phải là một kiến thức cần thiết?\"></a>2. Liệu đây có phải là một kiến thức cần thiết?</h2><p>Chắc chắn là có.</p>\n<p>Thứ nhất: Nếu trong công việc bạn không bao giờ phải dùng đến nó, bạn có thể nói về nó như một kiến thức hàn lâm để thể hiện khả năng với sếp và yêu cầu tăng lương :worried:</p>\n<p>Thứ hai: Xét ví dụ sau</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str = <span class=\"string\">\"\"</span></span><br><span class=\"line\">[<span class=\"string\">\"Hoang\"</span>, <span class=\"string\">\"Duy\"</span>, <span class=\"string\">\"Chinh\"</span>].each <span class=\"keyword\">do</span> <span class=\"params\">|i|</span></span><br><span class=\"line\">  str += i</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Tư tưởng của đoạn mã này là cộng tất cả các phần tử trong một mảng string và cho ra kết quả cuối cùng là một chuỗi tổng hợp tất cả các phần tử.<br>Có điều gì bất thường trong đoạn mã này không nhỉ? Câu trả lời là có. Như những gì chúng ta đã nói ở trên có hai điều cần lưu ý:</p>\n<blockquote>\n<ol>\n<li>Các kiểu dữ liệu nguyên thuỷ trong ruby đều là immutable và hiển nhiên string không ngoại lệ.</li>\n</ol>\n</blockquote>\n<blockquote>\n<ol start=\"2\">\n<li>Khi một object là immutable, thì việc bạn gán nó bằng một giá trị khác đồng nghĩa với việc vùng nhớ cũ sẽ không được dùng đến, mà nó sẽ ra một vùng nhớ mới rồi ghi kết quả mới lên đó, cứ lặp lại như vậy mãi mãi.</li>\n</ol>\n</blockquote>\n<p>Từ hai điều trên ta rút ra được kết luận:</p>\n<ol>\n<li>Trong lần gán đầu tiên str có giá trị là chuỗi rỗng và được khởi tạo tại ví trí A1</li>\n<li>Trong lần lặp <strong>each</strong> đầu tiên, str có giá trị là “Hoang” và nó lưu ở vị trí A2</li>\n<li>Trong lần lặp <strong>each</strong> thứ hai, str có giá trị mới là “HoangDuy” và nó lưu ở vị trí mới là A3</li>\n<li>Trong lần lặp cuối cùng thì str có giá trị chúng ta mong đợi là “HoangDuyChinh” và nó lưu ở vị trí A4</li>\n</ol>\n<p>Chứng minh:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str = <span class=\"string\">\"\"</span></span><br><span class=\"line\">puts <span class=\"string\">\"First location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br><span class=\"line\">[<span class=\"string\">\"Hoang\"</span>, <span class=\"string\">\"Duy\"</span>, <span class=\"string\">\"Chinh\"</span>].each <span class=\"keyword\">do</span> <span class=\"params\">|i|</span></span><br><span class=\"line\">  str += i</span><br><span class=\"line\">  puts <span class=\"string\">\"value: <span class=\"subst\">#&#123;str&#125;</span> | location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"Final value: <span class=\"subst\">#&#123;str&#125;</span> | location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Kết quả:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">First location:</span> <span class=\"number\">47434608564740</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">Hoang</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47434608564520</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">HoangDuy</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47434608564440</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">HoangDuyChinh</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47434608564360</span></span><br><span class=\"line\"><span class=\"attr\">Final value:</span> <span class=\"string\">HoangDuyChinh</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47434608564360</span></span><br></pre></td></tr></table></figure>\n\n<p>Và thứ chúng ta quan tâm từ đó về sau là vị trí A4 này. Vậy còn A1, A2, A3 cũng đang mang giá trị? Chúng đi đâu về đâu? Chính xác, nó trở thành một vùng nhớ rác và sẽ được GC dọn dẹp nhưng không phải ngay lập tức, vậy trong khoảng thời gian đó nó vẫn nắm giữ các vùng nhớ của chúng ta. Đó cũng là một trong các lý do việc bạn muốn chạy ruby on rails trên một chiếc máy tính sinh viên 2GB là vô cùng khó khăn. Ruby ăn Ram như uống nước lã vậy.</p>\n<p>Ví dụ trên mảng ta có ba phần tử và ta có 3 giá trị rác trên bộ nhớ, hãy tưởng tượng bạn có một mảng một triệu phần tử :worried:</p>\n<p>Giải pháp trong trường hợp này là gì? Đó là duyệt mảng như một <strong>object reference</strong> chứ không phải một biến giá trị:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str = <span class=\"string\">\"\"</span></span><br><span class=\"line\">[<span class=\"string\">\"Hoang\"</span>, <span class=\"string\">\"Duy\"</span>, <span class=\"string\">\"Chinh\"</span>].each <span class=\"keyword\">do</span> <span class=\"params\">|i|</span></span><br><span class=\"line\">  str &lt;&lt; i</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Như vậy str sẽ ở đúng một vùng nhớ và ta không có một đống biến rác không mong đợi.</p>\n<p>Chứng minh:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">str = <span class=\"string\">\"\"</span></span><br><span class=\"line\">puts <span class=\"string\">\"First location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br><span class=\"line\">[<span class=\"string\">\"Hoang\"</span>, <span class=\"string\">\"Duy\"</span>, <span class=\"string\">\"Chinh\"</span>].each <span class=\"keyword\">do</span> <span class=\"params\">|i|</span></span><br><span class=\"line\">  str &lt;&lt; i</span><br><span class=\"line\">  puts <span class=\"string\">\"value: <span class=\"subst\">#&#123;str&#125;</span> | location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"Final value: <span class=\"subst\">#&#123;str&#125;</span> | location: <span class=\"subst\">#&#123;str.object_id&#125;</span>\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Kết quả:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">First location:</span> <span class=\"number\">47196120971580</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">Hoang</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47196120971580</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">HoangDuy</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47196120971580</span></span><br><span class=\"line\"><span class=\"attr\">value:</span> <span class=\"string\">HoangDuyChinh</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47196120971580</span></span><br><span class=\"line\"><span class=\"attr\">Final value:</span> <span class=\"string\">HoangDuyChinh</span> <span class=\"string\">|</span> <span class=\"attr\">location:</span> <span class=\"number\">47196120971580</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-Tham-khao\"><a href=\"#3-Tham-khao\" class=\"headerlink\" title=\"3. Tham khảo\"></a>3. Tham khảo</h2><p>[1] <a href=\"https://en.wikipedia.org/wiki/Immutable_object\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/Immutable_object</a></p>\n"},{"title":"SaaS, PaaS và IaaS","date":"2019-04-09T17:00:00.000Z","draft":false,"mytag":"#TIL","label":"#til","_content":"\n**SaaS:  Software as a Service**\nVí dụ như: TFS, Github.\nMua một căn nhà và mua xong thì vào đó ở luôn chứ không cần vất vả xây dựng gì thêm.\nƯu: Nhanh, tiện.\nNhược: không có tính tuỳ chỉnh, vì dịch vụ sẽ phổ thông và không thể cover hết được nhu cầu của  chúng ta.\n\n**PaaS:  Platform as a Service**\nVí dụ như: Heroku, AWS Elastic Beanstalk.\nMua một căn nhà đã có một số tiện ích cơ bản để sống, mình chỉ cần dọn thêm đồ đạc của mình(source code) vào là sống được.\nƯu: Tuỳ chỉnh dễ dàng hơn SaaS, làm nhanh và đơn giản hơn IaaS\nNhược: Vẫn không thể tự thiết lập các cài đặt nâng cao hơn.\n\n**IaaS: Infrastructure as a Service**\nVí dụ như: EC2, DigitalOcean\nMua một mảnh đất sau đó thì tự xây nhà, sắm đồ...\nƯu: Được tự chủ hệ thống và có thể tuỳ ý cấu hình(trong giới hạn của cloud cho phép).\nNhược: Phức tạp nhất trong 3 loại.\n","source":"_posts/2019-04-10-iaas-paas-saas.md","raw":"---\ntitle: \"SaaS, PaaS và IaaS\"\ndate: 2019-04-10\ndraft: false\ntags: [\"til\"]\ncategories: [\"rails notes\"]\nmytag: \"#TIL\"\nlabel: \"#til\"\n---\n\n**SaaS:  Software as a Service**\nVí dụ như: TFS, Github.\nMua một căn nhà và mua xong thì vào đó ở luôn chứ không cần vất vả xây dựng gì thêm.\nƯu: Nhanh, tiện.\nNhược: không có tính tuỳ chỉnh, vì dịch vụ sẽ phổ thông và không thể cover hết được nhu cầu của  chúng ta.\n\n**PaaS:  Platform as a Service**\nVí dụ như: Heroku, AWS Elastic Beanstalk.\nMua một căn nhà đã có một số tiện ích cơ bản để sống, mình chỉ cần dọn thêm đồ đạc của mình(source code) vào là sống được.\nƯu: Tuỳ chỉnh dễ dàng hơn SaaS, làm nhanh và đơn giản hơn IaaS\nNhược: Vẫn không thể tự thiết lập các cài đặt nâng cao hơn.\n\n**IaaS: Infrastructure as a Service**\nVí dụ như: EC2, DigitalOcean\nMua một mảnh đất sau đó thì tự xây nhà, sắm đồ...\nƯu: Được tự chủ hệ thống và có thể tuỳ ý cấu hình(trong giới hạn của cloud cho phép).\nNhược: Phức tạp nhất trong 3 loại.\n","slug":"2019-04-10-iaas-paas-saas","published":1,"updated":"2022-01-29T09:29:59.926Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsaj000tp3m24olxbr6z","content":"<p><strong>SaaS:  Software as a Service</strong><br>Ví dụ như: TFS, Github.<br>Mua một căn nhà và mua xong thì vào đó ở luôn chứ không cần vất vả xây dựng gì thêm.<br>Ưu: Nhanh, tiện.<br>Nhược: không có tính tuỳ chỉnh, vì dịch vụ sẽ phổ thông và không thể cover hết được nhu cầu của  chúng ta.</p>\n<p><strong>PaaS:  Platform as a Service</strong><br>Ví dụ như: Heroku, AWS Elastic Beanstalk.<br>Mua một căn nhà đã có một số tiện ích cơ bản để sống, mình chỉ cần dọn thêm đồ đạc của mình(source code) vào là sống được.<br>Ưu: Tuỳ chỉnh dễ dàng hơn SaaS, làm nhanh và đơn giản hơn IaaS<br>Nhược: Vẫn không thể tự thiết lập các cài đặt nâng cao hơn.</p>\n<p><strong>IaaS: Infrastructure as a Service</strong><br>Ví dụ như: EC2, DigitalOcean<br>Mua một mảnh đất sau đó thì tự xây nhà, sắm đồ…<br>Ưu: Được tự chủ hệ thống và có thể tuỳ ý cấu hình(trong giới hạn của cloud cho phép).<br>Nhược: Phức tạp nhất trong 3 loại.</p>\n","site":{"data":{}},"excerpt":"","more":"<p><strong>SaaS:  Software as a Service</strong><br>Ví dụ như: TFS, Github.<br>Mua một căn nhà và mua xong thì vào đó ở luôn chứ không cần vất vả xây dựng gì thêm.<br>Ưu: Nhanh, tiện.<br>Nhược: không có tính tuỳ chỉnh, vì dịch vụ sẽ phổ thông và không thể cover hết được nhu cầu của  chúng ta.</p>\n<p><strong>PaaS:  Platform as a Service</strong><br>Ví dụ như: Heroku, AWS Elastic Beanstalk.<br>Mua một căn nhà đã có một số tiện ích cơ bản để sống, mình chỉ cần dọn thêm đồ đạc của mình(source code) vào là sống được.<br>Ưu: Tuỳ chỉnh dễ dàng hơn SaaS, làm nhanh và đơn giản hơn IaaS<br>Nhược: Vẫn không thể tự thiết lập các cài đặt nâng cao hơn.</p>\n<p><strong>IaaS: Infrastructure as a Service</strong><br>Ví dụ như: EC2, DigitalOcean<br>Mua một mảnh đất sau đó thì tự xây nhà, sắm đồ…<br>Ưu: Được tự chủ hệ thống và có thể tuỳ ý cấu hình(trong giới hạn của cloud cho phép).<br>Nhược: Phức tạp nhất trong 3 loại.</p>\n"},{"title":"Upload Với S3 Trong Rails","date":"2019-04-09T17:00:00.000Z","draft":false,"mytag":"#TIL","_content":"\nGhi chú này được tham khảo từ bài viết [Lưu trữ file trên Amazon S3](https://viblo.asia/p/ror-luu-tru-file-tren-amazon-s3-BMvRpNXEzwY#_cau-hinh-connect-toi-dich-vu-s3-trong-ung-dung-rails-3) của tác giả **@duyth1993** trên website **viblo.com**.\n\nBài toán: Hiện tại tôi đang cần tìm một dịch vụ lưu trữ file, trước giờ tôi không sử dụng vì chưa có nhu cầu. Tìm kiếm một lúc thì tôi quyết định sử dụng S3 vì sẵn cũng đang còn tài khoản free của của AWS, tham khảo bài viết bên trên một số lưu ý khi sử dụng này mà tôi rút ra như sau:\n\n1. Bài viết trên của tác giả viết rất chi tiết, tuy nhiên hướng dẫn đó là trên rails 4 và cần chú ý thay đổi một số config để phù hợp với rails 5 mà tôi đang sử dụng. Đó là về việc sử dụng **credentials** thay thế cho **secret**, thông tin đầy hơn có thể tham khảo tại bài viết [Rails và bảo mật thông tin quan trọng](http://hdchinh.com/2019/02/22/2019-02-22-xu-ly-thong-tin-quan-trong-trong-rails/).\n\n2. Có 4 thông tin quan trọng để cấu hình đến S3 đó là: **access_key_id**, **secret_access_key**, **region** và **bucket_name**.\n\n3. Một số config để connect tới server S3 là do thư viện **aws-sdk-rails** quy định vì vậy đơn giản là làm theo và không thắc mắc tại sao.\n\n4. Cần chú ý bước config cho file trước khi upload với các thông tin như: **content_type**(định dạng file, việc sử dụng định dạng file dạng không tương thích với ảnh bạn upload lên dẫn để việc không thể hiển thị view bức ảnh đó.), **acl**(access control list: quy định về việc ai có thể access khi có url của file) và **server_side_encryption**(lựa chọn này để mã hóa file bạn tải lên, đi kèm đó là giảm hiệu năng vì thêm 1 bước cần xử lý.)\n\nSource demo xem tại [đây](https://github.com/hdchinh/S3_with_rails_5.2)\n","source":"_posts/2019-04-10-upload-file-len-aws-s3-va-nhung-van-de-can-luu-y.md","raw":"---\ntitle: \"Upload Với S3 Trong Rails\"\ndate: 2019-04-10\ndraft: false\ntags: [\"aws\", \"rails\", \"til\"]\ncategories: [\"rails notes\"]\nmytag: \"#TIL\"\n---\n\nGhi chú này được tham khảo từ bài viết [Lưu trữ file trên Amazon S3](https://viblo.asia/p/ror-luu-tru-file-tren-amazon-s3-BMvRpNXEzwY#_cau-hinh-connect-toi-dich-vu-s3-trong-ung-dung-rails-3) của tác giả **@duyth1993** trên website **viblo.com**.\n\nBài toán: Hiện tại tôi đang cần tìm một dịch vụ lưu trữ file, trước giờ tôi không sử dụng vì chưa có nhu cầu. Tìm kiếm một lúc thì tôi quyết định sử dụng S3 vì sẵn cũng đang còn tài khoản free của của AWS, tham khảo bài viết bên trên một số lưu ý khi sử dụng này mà tôi rút ra như sau:\n\n1. Bài viết trên của tác giả viết rất chi tiết, tuy nhiên hướng dẫn đó là trên rails 4 và cần chú ý thay đổi một số config để phù hợp với rails 5 mà tôi đang sử dụng. Đó là về việc sử dụng **credentials** thay thế cho **secret**, thông tin đầy hơn có thể tham khảo tại bài viết [Rails và bảo mật thông tin quan trọng](http://hdchinh.com/2019/02/22/2019-02-22-xu-ly-thong-tin-quan-trong-trong-rails/).\n\n2. Có 4 thông tin quan trọng để cấu hình đến S3 đó là: **access_key_id**, **secret_access_key**, **region** và **bucket_name**.\n\n3. Một số config để connect tới server S3 là do thư viện **aws-sdk-rails** quy định vì vậy đơn giản là làm theo và không thắc mắc tại sao.\n\n4. Cần chú ý bước config cho file trước khi upload với các thông tin như: **content_type**(định dạng file, việc sử dụng định dạng file dạng không tương thích với ảnh bạn upload lên dẫn để việc không thể hiển thị view bức ảnh đó.), **acl**(access control list: quy định về việc ai có thể access khi có url của file) và **server_side_encryption**(lựa chọn này để mã hóa file bạn tải lên, đi kèm đó là giảm hiệu năng vì thêm 1 bước cần xử lý.)\n\nSource demo xem tại [đây](https://github.com/hdchinh/S3_with_rails_5.2)\n","slug":"2019-04-10-upload-file-len-aws-s3-va-nhung-van-de-can-luu-y","published":1,"updated":"2022-01-29T09:29:59.926Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsak000xp3m2egka1dhz","content":"<p>Ghi chú này được tham khảo từ bài viết <a href=\"https://viblo.asia/p/ror-luu-tru-file-tren-amazon-s3-BMvRpNXEzwY#_cau-hinh-connect-toi-dich-vu-s3-trong-ung-dung-rails-3\" target=\"_blank\" rel=\"noopener\">Lưu trữ file trên Amazon S3</a> của tác giả <strong>@duyth1993</strong> trên website <strong>viblo.com</strong>.</p>\n<p>Bài toán: Hiện tại tôi đang cần tìm một dịch vụ lưu trữ file, trước giờ tôi không sử dụng vì chưa có nhu cầu. Tìm kiếm một lúc thì tôi quyết định sử dụng S3 vì sẵn cũng đang còn tài khoản free của của AWS, tham khảo bài viết bên trên một số lưu ý khi sử dụng này mà tôi rút ra như sau:</p>\n<ol>\n<li><p>Bài viết trên của tác giả viết rất chi tiết, tuy nhiên hướng dẫn đó là trên rails 4 và cần chú ý thay đổi một số config để phù hợp với rails 5 mà tôi đang sử dụng. Đó là về việc sử dụng <strong>credentials</strong> thay thế cho <strong>secret</strong>, thông tin đầy hơn có thể tham khảo tại bài viết <a href=\"http://hdchinh.com/2019/02/22/2019-02-22-xu-ly-thong-tin-quan-trong-trong-rails/\" target=\"_blank\" rel=\"noopener\">Rails và bảo mật thông tin quan trọng</a>.</p>\n</li>\n<li><p>Có 4 thông tin quan trọng để cấu hình đến S3 đó là: <strong>access_key_id</strong>, <strong>secret_access_key</strong>, <strong>region</strong> và <strong>bucket_name</strong>.</p>\n</li>\n<li><p>Một số config để connect tới server S3 là do thư viện <strong>aws-sdk-rails</strong> quy định vì vậy đơn giản là làm theo và không thắc mắc tại sao.</p>\n</li>\n<li><p>Cần chú ý bước config cho file trước khi upload với các thông tin như: <strong>content_type</strong>(định dạng file, việc sử dụng định dạng file dạng không tương thích với ảnh bạn upload lên dẫn để việc không thể hiển thị view bức ảnh đó.), <strong>acl</strong>(access control list: quy định về việc ai có thể access khi có url của file) và <strong>server_side_encryption</strong>(lựa chọn này để mã hóa file bạn tải lên, đi kèm đó là giảm hiệu năng vì thêm 1 bước cần xử lý.)</p>\n</li>\n</ol>\n<p>Source demo xem tại <a href=\"https://github.com/hdchinh/S3_with_rails_5.2\" target=\"_blank\" rel=\"noopener\">đây</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Ghi chú này được tham khảo từ bài viết <a href=\"https://viblo.asia/p/ror-luu-tru-file-tren-amazon-s3-BMvRpNXEzwY#_cau-hinh-connect-toi-dich-vu-s3-trong-ung-dung-rails-3\" target=\"_blank\" rel=\"noopener\">Lưu trữ file trên Amazon S3</a> của tác giả <strong>@duyth1993</strong> trên website <strong>viblo.com</strong>.</p>\n<p>Bài toán: Hiện tại tôi đang cần tìm một dịch vụ lưu trữ file, trước giờ tôi không sử dụng vì chưa có nhu cầu. Tìm kiếm một lúc thì tôi quyết định sử dụng S3 vì sẵn cũng đang còn tài khoản free của của AWS, tham khảo bài viết bên trên một số lưu ý khi sử dụng này mà tôi rút ra như sau:</p>\n<ol>\n<li><p>Bài viết trên của tác giả viết rất chi tiết, tuy nhiên hướng dẫn đó là trên rails 4 và cần chú ý thay đổi một số config để phù hợp với rails 5 mà tôi đang sử dụng. Đó là về việc sử dụng <strong>credentials</strong> thay thế cho <strong>secret</strong>, thông tin đầy hơn có thể tham khảo tại bài viết <a href=\"http://hdchinh.com/2019/02/22/2019-02-22-xu-ly-thong-tin-quan-trong-trong-rails/\" target=\"_blank\" rel=\"noopener\">Rails và bảo mật thông tin quan trọng</a>.</p>\n</li>\n<li><p>Có 4 thông tin quan trọng để cấu hình đến S3 đó là: <strong>access_key_id</strong>, <strong>secret_access_key</strong>, <strong>region</strong> và <strong>bucket_name</strong>.</p>\n</li>\n<li><p>Một số config để connect tới server S3 là do thư viện <strong>aws-sdk-rails</strong> quy định vì vậy đơn giản là làm theo và không thắc mắc tại sao.</p>\n</li>\n<li><p>Cần chú ý bước config cho file trước khi upload với các thông tin như: <strong>content_type</strong>(định dạng file, việc sử dụng định dạng file dạng không tương thích với ảnh bạn upload lên dẫn để việc không thể hiển thị view bức ảnh đó.), <strong>acl</strong>(access control list: quy định về việc ai có thể access khi có url của file) và <strong>server_side_encryption</strong>(lựa chọn này để mã hóa file bạn tải lên, đi kèm đó là giảm hiệu năng vì thêm 1 bước cần xử lý.)</p>\n</li>\n</ol>\n<p>Source demo xem tại <a href=\"https://github.com/hdchinh/S3_with_rails_5.2\" target=\"_blank\" rel=\"noopener\">đây</a></p>\n"},{"title":"Sử Dụng Carrierwave Với S3","date":"2019-04-10T17:00:00.000Z","draft":false,"mytag":"#TIL","label":"#til","_content":"\n# Gemfile\n\n```ruby\ngem 'fog', require: 'fog/aws'\ngem 'carrierwave'\n```\n# Class Uploader\n\n```ruby\nstorage :fog\n```\n\n# File cấu hình config/initializers/carrierwave.rb\n\n```ruby\nrequire 'carrierwave/storage/fog'\n\nCarrierWave.configure do |config|\n  config.fog_credentials = {\n    :provider              => 'AWS',\n    :aws_access_key_id     => Rails.application.credentials.access_key_id,\n    :aws_secret_access_key => Rails.application.credentials.secret_access_key,\n    :region                => Rails.application.credentials.s3_region,\n    :path_style            => true,\n    :host                  => 's3.us-east-2.amazonaws.com',\n    :endpoint              => 'https://s3.us-east-2.amazonaws.com'\n  }\n  config.cache_dir = \"#{Rails.root}/tmp/uploads\"\n  config.fog_directory  = Rails.application.credentials.s3_bucket\n  config.fog_public     = true\n  config.fog_attributes = { 'Cache-Control' => \"max-age=#{10.day.to_i}\" }\n  config.storage = :fog\nend\n```\n\n# Acess File uploaded\n\n`Instance.field_name_image.url` (get link s3)\n\n# Source demo\n\n[Tại đây](https://github.com/hdchinh/s3_carrierwave)\n","source":"_posts/2019-04-11-su-dung-carrierwave-voi-s3.md","raw":"---\ntitle: \"Sử Dụng Carrierwave Với S3\"\ndate: 2019-04-11\ndraft: false\ntags: [\"rails\", \"aws\", \"carrierwave\", \"til\"]\ncategories: [\"rails notes\"]\nmytag: \"#TIL\"\nlabel: \"#til\"\n---\n\n# Gemfile\n\n```ruby\ngem 'fog', require: 'fog/aws'\ngem 'carrierwave'\n```\n# Class Uploader\n\n```ruby\nstorage :fog\n```\n\n# File cấu hình config/initializers/carrierwave.rb\n\n```ruby\nrequire 'carrierwave/storage/fog'\n\nCarrierWave.configure do |config|\n  config.fog_credentials = {\n    :provider              => 'AWS',\n    :aws_access_key_id     => Rails.application.credentials.access_key_id,\n    :aws_secret_access_key => Rails.application.credentials.secret_access_key,\n    :region                => Rails.application.credentials.s3_region,\n    :path_style            => true,\n    :host                  => 's3.us-east-2.amazonaws.com',\n    :endpoint              => 'https://s3.us-east-2.amazonaws.com'\n  }\n  config.cache_dir = \"#{Rails.root}/tmp/uploads\"\n  config.fog_directory  = Rails.application.credentials.s3_bucket\n  config.fog_public     = true\n  config.fog_attributes = { 'Cache-Control' => \"max-age=#{10.day.to_i}\" }\n  config.storage = :fog\nend\n```\n\n# Acess File uploaded\n\n`Instance.field_name_image.url` (get link s3)\n\n# Source demo\n\n[Tại đây](https://github.com/hdchinh/s3_carrierwave)\n","slug":"2019-04-11-su-dung-carrierwave-voi-s3","published":1,"updated":"2022-01-29T09:29:59.926Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsak000zp3m2bsz05h09","content":"<h1 id=\"Gemfile\"><a href=\"#Gemfile\" class=\"headerlink\" title=\"Gemfile\"></a>Gemfile</h1><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gem <span class=\"string\">'fog'</span>, <span class=\"symbol\">require:</span> <span class=\"string\">'fog/aws'</span></span><br><span class=\"line\">gem <span class=\"string\">'carrierwave'</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"Class-Uploader\"><a href=\"#Class-Uploader\" class=\"headerlink\" title=\"Class Uploader\"></a>Class Uploader</h1><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">storage <span class=\"symbol\">:fog</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"File-cau-hinh-config-initializers-carrierwave-rb\"><a href=\"#File-cau-hinh-config-initializers-carrierwave-rb\" class=\"headerlink\" title=\"File cấu hình config/initializers/carrierwave.rb\"></a>File cấu hình config/initializers/carrierwave.rb</h1><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'carrierwave/storage/fog'</span></span><br><span class=\"line\"></span><br><span class=\"line\">CarrierWave.configure <span class=\"keyword\">do</span> <span class=\"params\">|config|</span></span><br><span class=\"line\">  config.fog_credentials = &#123;</span><br><span class=\"line\">    <span class=\"symbol\">:provider</span>              =&gt; <span class=\"string\">'AWS'</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:aws_access_key_id</span>     =&gt; Rails.application.credentials.access_key_id,</span><br><span class=\"line\">    <span class=\"symbol\">:aws_secret_access_key</span> =&gt; Rails.application.credentials.secret_access_key,</span><br><span class=\"line\">    <span class=\"symbol\">:region</span>                =&gt; Rails.application.credentials.s3_region,</span><br><span class=\"line\">    <span class=\"symbol\">:path_style</span>            =&gt; <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:host</span>                  =&gt; <span class=\"string\">'s3.us-east-2.amazonaws.com'</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:endpoint</span>              =&gt; <span class=\"string\">'https://s3.us-east-2.amazonaws.com'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  config.cache_dir = <span class=\"string\">\"<span class=\"subst\">#&#123;Rails.root&#125;</span>/tmp/uploads\"</span></span><br><span class=\"line\">  config.fog_directory  = Rails.application.credentials.s3_bucket</span><br><span class=\"line\">  config.fog_public     = <span class=\"literal\">true</span></span><br><span class=\"line\">  config.fog_attributes = &#123; <span class=\"string\">'Cache-Control'</span> =&gt; <span class=\"string\">\"max-age=<span class=\"subst\">#&#123;<span class=\"number\">10</span>.day.to_i&#125;</span>\"</span> &#125;</span><br><span class=\"line\">  config.storage = <span class=\"symbol\">:fog</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"Acess-File-uploaded\"><a href=\"#Acess-File-uploaded\" class=\"headerlink\" title=\"Acess File uploaded\"></a>Acess File uploaded</h1><p><code>Instance.field_name_image.url</code> (get link s3)</p>\n<h1 id=\"Source-demo\"><a href=\"#Source-demo\" class=\"headerlink\" title=\"Source demo\"></a>Source demo</h1><p><a href=\"https://github.com/hdchinh/s3_carrierwave\" target=\"_blank\" rel=\"noopener\">Tại đây</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"Gemfile\"><a href=\"#Gemfile\" class=\"headerlink\" title=\"Gemfile\"></a>Gemfile</h1><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gem <span class=\"string\">'fog'</span>, <span class=\"symbol\">require:</span> <span class=\"string\">'fog/aws'</span></span><br><span class=\"line\">gem <span class=\"string\">'carrierwave'</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"Class-Uploader\"><a href=\"#Class-Uploader\" class=\"headerlink\" title=\"Class Uploader\"></a>Class Uploader</h1><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">storage <span class=\"symbol\">:fog</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"File-cau-hinh-config-initializers-carrierwave-rb\"><a href=\"#File-cau-hinh-config-initializers-carrierwave-rb\" class=\"headerlink\" title=\"File cấu hình config/initializers/carrierwave.rb\"></a>File cấu hình config/initializers/carrierwave.rb</h1><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'carrierwave/storage/fog'</span></span><br><span class=\"line\"></span><br><span class=\"line\">CarrierWave.configure <span class=\"keyword\">do</span> <span class=\"params\">|config|</span></span><br><span class=\"line\">  config.fog_credentials = &#123;</span><br><span class=\"line\">    <span class=\"symbol\">:provider</span>              =&gt; <span class=\"string\">'AWS'</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:aws_access_key_id</span>     =&gt; Rails.application.credentials.access_key_id,</span><br><span class=\"line\">    <span class=\"symbol\">:aws_secret_access_key</span> =&gt; Rails.application.credentials.secret_access_key,</span><br><span class=\"line\">    <span class=\"symbol\">:region</span>                =&gt; Rails.application.credentials.s3_region,</span><br><span class=\"line\">    <span class=\"symbol\">:path_style</span>            =&gt; <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:host</span>                  =&gt; <span class=\"string\">'s3.us-east-2.amazonaws.com'</span>,</span><br><span class=\"line\">    <span class=\"symbol\">:endpoint</span>              =&gt; <span class=\"string\">'https://s3.us-east-2.amazonaws.com'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  config.cache_dir = <span class=\"string\">\"<span class=\"subst\">#&#123;Rails.root&#125;</span>/tmp/uploads\"</span></span><br><span class=\"line\">  config.fog_directory  = Rails.application.credentials.s3_bucket</span><br><span class=\"line\">  config.fog_public     = <span class=\"literal\">true</span></span><br><span class=\"line\">  config.fog_attributes = &#123; <span class=\"string\">'Cache-Control'</span> =&gt; <span class=\"string\">\"max-age=<span class=\"subst\">#&#123;<span class=\"number\">10</span>.day.to_i&#125;</span>\"</span> &#125;</span><br><span class=\"line\">  config.storage = <span class=\"symbol\">:fog</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h1 id=\"Acess-File-uploaded\"><a href=\"#Acess-File-uploaded\" class=\"headerlink\" title=\"Acess File uploaded\"></a>Acess File uploaded</h1><p><code>Instance.field_name_image.url</code> (get link s3)</p>\n<h1 id=\"Source-demo\"><a href=\"#Source-demo\" class=\"headerlink\" title=\"Source demo\"></a>Source demo</h1><p><a href=\"https://github.com/hdchinh/s3_carrierwave\" target=\"_blank\" rel=\"noopener\">Tại đây</a></p>\n"},{"title":"Tìm Hiểu Về Chữ S Trong Https","date":"2019-05-03T17:00:00.000Z","draft":false,"mytag":"Secure","mytrend":"COOL","_content":"\n## Đặt vấn đề\n\nĐi luôn vào chủ đề, khi mới bắt đầu với môn mạng máy tính ở trường đại học, sự mập mờ khi còn ngồi trên ghế nhà trường khiến chúng ta đôi khi đã nhầm lẫn về **http** và **https**, nhớ ngày đó tôi đã từng nghĩ chúng là 2 giao thức khác nhau, à mà ngày đó tôi có hiểu giao thức là gì không nhỉ :fearful: thôi dẹp qua một bên, bản chất của **https** cũng là giao thức **http** nhưng thêm được chữ **s** ứng với **secure**. Nghe thôi đã thấy bảo mật rồi, **https** ra đời nhằm mục đích làm cho giao thức **http** trở nên an toàn hơn, vậy nó làm cho **http** trở nên an toàn hơn như thế nào?\n\n## Luận bàn\n\n## 1. Http hiểu đơn giản thì hoạt động thế nào?\n\nMục đích cuối cùng của mớ hỗn độn rối rắm này cũng là truyền nhận thông tin, tôi có một website tôi muốn gửi nó lên mạng internet để bạn, một ai đó mà tôi không quen có thể vô tình lướt qua đọc được.\nHttp là một giao thức, hiểu đơn giản là một bộ quy tắc để chung để người sử dụng dùng trình duyệt có thể truy cập tới 1 trang web, và trang web đó hiểu được yêu cầu đó rồi trả về nội dung mà trình duyệt có thể hiểu được, ví như có nhiều ngôn ngữ trên thế giới, vậy giữa 2 người có 2 tiếng nói khác nhau để giao tiếp được họ phải cùng nhau sử dụng một bộ ngôn ngữ chung mà cả hai cùng hiểu được.\n\nMột đặc điểm cơ bản của **http** là nó truyền nhận thông tin dưới dạng **text** thông thường, không hề mã hoã, điều này dẫn tới vấn đề đó là thông tin được truyền nhận nhanh chóng, nhẹ nhàng, nội dung rất thân thiện với người dùng (vì nó là text mà).\n\nMọi thứ có vẻ good? không hẳn như vậy, việc dữ liệu truyền gửi được lưu dưới dạng text khiến nó quá thân thiện với người dùng, mà người dùng thì không phải ai cũng tốt :smirk: . Có những người dùng mà mục đích họ tới với website của bạn là để phá hoại, họ sẽ dễ dàng tấn công bằng cách nào đó lấy được request của bạn rồi đọc được nội dung trong request đó 1 cách dễ dàng.\n\nBài học: Không phải lúc nào cũng nên quá thân thiện với người dùng cuối :worried:\n\n## 2. Https khắc phục vấn đề của http như thế nào?\n\nChúng ta đã nắm được khái quát vấn đề bảo mật gặp phải khi sử dụng **http**. Với những website giải trí thuần tuý với nội dung chủ yếu là hình ảnh, âm thanh và không có thông tin cần bảo mật thì sử dụng https hình như cũng chỉ để tốt cho SEO, ngoài ra cũng không còn giá trị gì. Nhưng nếu bạn sử dụng **Internet Banking** với http, rồi bạn đăng nhập với tài khoản ngân hàng của mình trên đó, mọi thông tin bạn gửi đi đều dưới dạng những gói tin có nội dung plain/text trần trụi, vậy điều gì bảo vệ được tài khoản của bạn nếu request kể trên bị những kẻ xấu dùng những thủ thuật hay phần mềm chuyên dụng để bắt được?\n\nHttps giải bài toán trên bằng cách rất đơn giản, nội dung dạng plain/text giúp kẻ gian có thể bắt và đọc dễ dàng, vậy chúng ta hãy mã hoá nội dung để kẻ gian đó không thể hiểu được, và có bắt được gói tin cũng vô dụng?.\n\n## 3. Https và vấn đề mã hoá dữ liệu\n\nTrước tiên phải làm rõ là:\n\n**https = http + ssl**\n\nTrong đó:\n\n1. http là giao thức tryền tải.\n\n2. ssl là cơ chế bảo mật thông tin.\n\n![tam the tu tin](/images/7.gif)\n\nFlow tối thiểu của **https** sẽ như sau:\n\n1. **Client hello**, người dùng sử dụng trình duyệt sẽ request tới google.com.\n\n2. **Server hello**, request ở bước một đã tới nơi, server sẽ gửi trả client 2 thông tin quan trọng đó là **ssl certificate** (Để chứng minh \"Ê, tao là google.com thật nha, not fake\") và 1 **Public key** (Gọi là Public-key-1. *Vậy ta có thể hiểu là ở Server google.com nó đang giữ Private key 1 ứng với Public key 1 kia*).\n\n3. Browser sẽ xác minh **ssl certificate** nhận được để xem nó có phải là hàng real hay không. Vậy còn làm sao mà browser có thể phân định thật giả? Chúng ta sẽ tìm hiểu trong 1 bài viết khác.\n\n4. Sau khi browser xác minh và đã tin tưởng máy chủ google.com, browser sẽ tạo 1 cặp khoá bảo mật RSA thứ 2, ta gọi là **Public key 2 và Private key 2**.\n\n5. Browser dùng **Public key 1** đã nhận được từ bước 3, để mã hoá *Public key 2 và Private key 2* sinh ra trong bước 4, rồi gửi cặp khoá này dưới dạng đã mã hoá tới máy chủ google.com.\n\n6. Như bạn nhớ, thì máy chủ google.com đang giữ **Private key 1** và thế là nó có thể giải mã và lấy được cặp key ở bước 5.\n\n7. Vậy là cả máy chủ google.com và client đều có cặp khoá RSA thứ 2, mọi thông tin truyền gửi từ cả 2 phía bây giờ đều được mã hoá bằng Public key 2.\n\nNote: Nhờ cơ chế mã hoá RSA (Chỉ có thể mã hoá bằng public key và giải mã nội dung bằng private key) kể trên. Server và client đã có thể liên lạc với nhau một cách an toàn. Trong quá trình trên, kể cả kẻ thủ ác có bắt được gói tin ở bước 2, bên trong có public key 1, thì cũng không phải vấn đề, bởi vì với public key đó thì hắn không thể đọc được thông tin mà client gửi ở bước 5.\n\n# Kết luận\n\nKhông có kết luận :)\n","source":"_posts/2019-05-04-https-vai-dieu-can-nho.md","raw":"---\ntitle: \"Tìm Hiểu Về Chữ S Trong Https\"\ndate: 2019-05-04\ndraft: false\ntags: [\"https\", \"secure\"]\ncategories: [\"rails notes\"]\nmytag: \"Secure\"\nmytrend: \"COOL\"\n\n---\n\n## Đặt vấn đề\n\nĐi luôn vào chủ đề, khi mới bắt đầu với môn mạng máy tính ở trường đại học, sự mập mờ khi còn ngồi trên ghế nhà trường khiến chúng ta đôi khi đã nhầm lẫn về **http** và **https**, nhớ ngày đó tôi đã từng nghĩ chúng là 2 giao thức khác nhau, à mà ngày đó tôi có hiểu giao thức là gì không nhỉ :fearful: thôi dẹp qua một bên, bản chất của **https** cũng là giao thức **http** nhưng thêm được chữ **s** ứng với **secure**. Nghe thôi đã thấy bảo mật rồi, **https** ra đời nhằm mục đích làm cho giao thức **http** trở nên an toàn hơn, vậy nó làm cho **http** trở nên an toàn hơn như thế nào?\n\n## Luận bàn\n\n## 1. Http hiểu đơn giản thì hoạt động thế nào?\n\nMục đích cuối cùng của mớ hỗn độn rối rắm này cũng là truyền nhận thông tin, tôi có một website tôi muốn gửi nó lên mạng internet để bạn, một ai đó mà tôi không quen có thể vô tình lướt qua đọc được.\nHttp là một giao thức, hiểu đơn giản là một bộ quy tắc để chung để người sử dụng dùng trình duyệt có thể truy cập tới 1 trang web, và trang web đó hiểu được yêu cầu đó rồi trả về nội dung mà trình duyệt có thể hiểu được, ví như có nhiều ngôn ngữ trên thế giới, vậy giữa 2 người có 2 tiếng nói khác nhau để giao tiếp được họ phải cùng nhau sử dụng một bộ ngôn ngữ chung mà cả hai cùng hiểu được.\n\nMột đặc điểm cơ bản của **http** là nó truyền nhận thông tin dưới dạng **text** thông thường, không hề mã hoã, điều này dẫn tới vấn đề đó là thông tin được truyền nhận nhanh chóng, nhẹ nhàng, nội dung rất thân thiện với người dùng (vì nó là text mà).\n\nMọi thứ có vẻ good? không hẳn như vậy, việc dữ liệu truyền gửi được lưu dưới dạng text khiến nó quá thân thiện với người dùng, mà người dùng thì không phải ai cũng tốt :smirk: . Có những người dùng mà mục đích họ tới với website của bạn là để phá hoại, họ sẽ dễ dàng tấn công bằng cách nào đó lấy được request của bạn rồi đọc được nội dung trong request đó 1 cách dễ dàng.\n\nBài học: Không phải lúc nào cũng nên quá thân thiện với người dùng cuối :worried:\n\n## 2. Https khắc phục vấn đề của http như thế nào?\n\nChúng ta đã nắm được khái quát vấn đề bảo mật gặp phải khi sử dụng **http**. Với những website giải trí thuần tuý với nội dung chủ yếu là hình ảnh, âm thanh và không có thông tin cần bảo mật thì sử dụng https hình như cũng chỉ để tốt cho SEO, ngoài ra cũng không còn giá trị gì. Nhưng nếu bạn sử dụng **Internet Banking** với http, rồi bạn đăng nhập với tài khoản ngân hàng của mình trên đó, mọi thông tin bạn gửi đi đều dưới dạng những gói tin có nội dung plain/text trần trụi, vậy điều gì bảo vệ được tài khoản của bạn nếu request kể trên bị những kẻ xấu dùng những thủ thuật hay phần mềm chuyên dụng để bắt được?\n\nHttps giải bài toán trên bằng cách rất đơn giản, nội dung dạng plain/text giúp kẻ gian có thể bắt và đọc dễ dàng, vậy chúng ta hãy mã hoá nội dung để kẻ gian đó không thể hiểu được, và có bắt được gói tin cũng vô dụng?.\n\n## 3. Https và vấn đề mã hoá dữ liệu\n\nTrước tiên phải làm rõ là:\n\n**https = http + ssl**\n\nTrong đó:\n\n1. http là giao thức tryền tải.\n\n2. ssl là cơ chế bảo mật thông tin.\n\n![tam the tu tin](/images/7.gif)\n\nFlow tối thiểu của **https** sẽ như sau:\n\n1. **Client hello**, người dùng sử dụng trình duyệt sẽ request tới google.com.\n\n2. **Server hello**, request ở bước một đã tới nơi, server sẽ gửi trả client 2 thông tin quan trọng đó là **ssl certificate** (Để chứng minh \"Ê, tao là google.com thật nha, not fake\") và 1 **Public key** (Gọi là Public-key-1. *Vậy ta có thể hiểu là ở Server google.com nó đang giữ Private key 1 ứng với Public key 1 kia*).\n\n3. Browser sẽ xác minh **ssl certificate** nhận được để xem nó có phải là hàng real hay không. Vậy còn làm sao mà browser có thể phân định thật giả? Chúng ta sẽ tìm hiểu trong 1 bài viết khác.\n\n4. Sau khi browser xác minh và đã tin tưởng máy chủ google.com, browser sẽ tạo 1 cặp khoá bảo mật RSA thứ 2, ta gọi là **Public key 2 và Private key 2**.\n\n5. Browser dùng **Public key 1** đã nhận được từ bước 3, để mã hoá *Public key 2 và Private key 2* sinh ra trong bước 4, rồi gửi cặp khoá này dưới dạng đã mã hoá tới máy chủ google.com.\n\n6. Như bạn nhớ, thì máy chủ google.com đang giữ **Private key 1** và thế là nó có thể giải mã và lấy được cặp key ở bước 5.\n\n7. Vậy là cả máy chủ google.com và client đều có cặp khoá RSA thứ 2, mọi thông tin truyền gửi từ cả 2 phía bây giờ đều được mã hoá bằng Public key 2.\n\nNote: Nhờ cơ chế mã hoá RSA (Chỉ có thể mã hoá bằng public key và giải mã nội dung bằng private key) kể trên. Server và client đã có thể liên lạc với nhau một cách an toàn. Trong quá trình trên, kể cả kẻ thủ ác có bắt được gói tin ở bước 2, bên trong có public key 1, thì cũng không phải vấn đề, bởi vì với public key đó thì hắn không thể đọc được thông tin mà client gửi ở bước 5.\n\n# Kết luận\n\nKhông có kết luận :)\n","slug":"2019-05-04-https-vai-dieu-can-nho","published":1,"updated":"2022-01-29T09:29:59.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsan0014p3m2afkldx31","content":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Đi luôn vào chủ đề, khi mới bắt đầu với môn mạng máy tính ở trường đại học, sự mập mờ khi còn ngồi trên ghế nhà trường khiến chúng ta đôi khi đã nhầm lẫn về <strong>http</strong> và <strong>https</strong>, nhớ ngày đó tôi đã từng nghĩ chúng là 2 giao thức khác nhau, à mà ngày đó tôi có hiểu giao thức là gì không nhỉ :fearful: thôi dẹp qua một bên, bản chất của <strong>https</strong> cũng là giao thức <strong>http</strong> nhưng thêm được chữ <strong>s</strong> ứng với <strong>secure</strong>. Nghe thôi đã thấy bảo mật rồi, <strong>https</strong> ra đời nhằm mục đích làm cho giao thức <strong>http</strong> trở nên an toàn hơn, vậy nó làm cho <strong>http</strong> trở nên an toàn hơn như thế nào?</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Http-hieu-don-gian-thi-hoat-dong-the-nao\"><a href=\"#1-Http-hieu-don-gian-thi-hoat-dong-the-nao\" class=\"headerlink\" title=\"1. Http hiểu đơn giản thì hoạt động thế nào?\"></a>1. Http hiểu đơn giản thì hoạt động thế nào?</h2><p>Mục đích cuối cùng của mớ hỗn độn rối rắm này cũng là truyền nhận thông tin, tôi có một website tôi muốn gửi nó lên mạng internet để bạn, một ai đó mà tôi không quen có thể vô tình lướt qua đọc được.<br>Http là một giao thức, hiểu đơn giản là một bộ quy tắc để chung để người sử dụng dùng trình duyệt có thể truy cập tới 1 trang web, và trang web đó hiểu được yêu cầu đó rồi trả về nội dung mà trình duyệt có thể hiểu được, ví như có nhiều ngôn ngữ trên thế giới, vậy giữa 2 người có 2 tiếng nói khác nhau để giao tiếp được họ phải cùng nhau sử dụng một bộ ngôn ngữ chung mà cả hai cùng hiểu được.</p>\n<p>Một đặc điểm cơ bản của <strong>http</strong> là nó truyền nhận thông tin dưới dạng <strong>text</strong> thông thường, không hề mã hoã, điều này dẫn tới vấn đề đó là thông tin được truyền nhận nhanh chóng, nhẹ nhàng, nội dung rất thân thiện với người dùng (vì nó là text mà).</p>\n<p>Mọi thứ có vẻ good? không hẳn như vậy, việc dữ liệu truyền gửi được lưu dưới dạng text khiến nó quá thân thiện với người dùng, mà người dùng thì không phải ai cũng tốt :smirk: . Có những người dùng mà mục đích họ tới với website của bạn là để phá hoại, họ sẽ dễ dàng tấn công bằng cách nào đó lấy được request của bạn rồi đọc được nội dung trong request đó 1 cách dễ dàng.</p>\n<p>Bài học: Không phải lúc nào cũng nên quá thân thiện với người dùng cuối :worried:</p>\n<h2 id=\"2-Https-khac-phuc-van-de-cua-http-nhu-the-nao\"><a href=\"#2-Https-khac-phuc-van-de-cua-http-nhu-the-nao\" class=\"headerlink\" title=\"2. Https khắc phục vấn đề của http như thế nào?\"></a>2. Https khắc phục vấn đề của http như thế nào?</h2><p>Chúng ta đã nắm được khái quát vấn đề bảo mật gặp phải khi sử dụng <strong>http</strong>. Với những website giải trí thuần tuý với nội dung chủ yếu là hình ảnh, âm thanh và không có thông tin cần bảo mật thì sử dụng https hình như cũng chỉ để tốt cho SEO, ngoài ra cũng không còn giá trị gì. Nhưng nếu bạn sử dụng <strong>Internet Banking</strong> với http, rồi bạn đăng nhập với tài khoản ngân hàng của mình trên đó, mọi thông tin bạn gửi đi đều dưới dạng những gói tin có nội dung plain/text trần trụi, vậy điều gì bảo vệ được tài khoản của bạn nếu request kể trên bị những kẻ xấu dùng những thủ thuật hay phần mềm chuyên dụng để bắt được?</p>\n<p>Https giải bài toán trên bằng cách rất đơn giản, nội dung dạng plain/text giúp kẻ gian có thể bắt và đọc dễ dàng, vậy chúng ta hãy mã hoá nội dung để kẻ gian đó không thể hiểu được, và có bắt được gói tin cũng vô dụng?.</p>\n<h2 id=\"3-Https-va-van-de-ma-hoa-du-lieu\"><a href=\"#3-Https-va-van-de-ma-hoa-du-lieu\" class=\"headerlink\" title=\"3. Https và vấn đề mã hoá dữ liệu\"></a>3. Https và vấn đề mã hoá dữ liệu</h2><p>Trước tiên phải làm rõ là:</p>\n<p><strong>https = http + ssl</strong></p>\n<p>Trong đó:</p>\n<ol>\n<li><p>http là giao thức tryền tải.</p>\n</li>\n<li><p>ssl là cơ chế bảo mật thông tin.</p>\n</li>\n</ol>\n<p><img src=\"/images/7.gif\" alt=\"tam the tu tin\"></p>\n<p>Flow tối thiểu của <strong>https</strong> sẽ như sau:</p>\n<ol>\n<li><p><strong>Client hello</strong>, người dùng sử dụng trình duyệt sẽ request tới google.com.</p>\n</li>\n<li><p><strong>Server hello</strong>, request ở bước một đã tới nơi, server sẽ gửi trả client 2 thông tin quan trọng đó là <strong>ssl certificate</strong> (Để chứng minh “Ê, tao là google.com thật nha, not fake”) và 1 <strong>Public key</strong> (Gọi là Public-key-1. <em>Vậy ta có thể hiểu là ở Server google.com nó đang giữ Private key 1 ứng với Public key 1 kia</em>).</p>\n</li>\n<li><p>Browser sẽ xác minh <strong>ssl certificate</strong> nhận được để xem nó có phải là hàng real hay không. Vậy còn làm sao mà browser có thể phân định thật giả? Chúng ta sẽ tìm hiểu trong 1 bài viết khác.</p>\n</li>\n<li><p>Sau khi browser xác minh và đã tin tưởng máy chủ google.com, browser sẽ tạo 1 cặp khoá bảo mật RSA thứ 2, ta gọi là <strong>Public key 2 và Private key 2</strong>.</p>\n</li>\n<li><p>Browser dùng <strong>Public key 1</strong> đã nhận được từ bước 3, để mã hoá <em>Public key 2 và Private key 2</em> sinh ra trong bước 4, rồi gửi cặp khoá này dưới dạng đã mã hoá tới máy chủ google.com.</p>\n</li>\n<li><p>Như bạn nhớ, thì máy chủ google.com đang giữ <strong>Private key 1</strong> và thế là nó có thể giải mã và lấy được cặp key ở bước 5.</p>\n</li>\n<li><p>Vậy là cả máy chủ google.com và client đều có cặp khoá RSA thứ 2, mọi thông tin truyền gửi từ cả 2 phía bây giờ đều được mã hoá bằng Public key 2.</p>\n</li>\n</ol>\n<p>Note: Nhờ cơ chế mã hoá RSA (Chỉ có thể mã hoá bằng public key và giải mã nội dung bằng private key) kể trên. Server và client đã có thể liên lạc với nhau một cách an toàn. Trong quá trình trên, kể cả kẻ thủ ác có bắt được gói tin ở bước 2, bên trong có public key 1, thì cũng không phải vấn đề, bởi vì với public key đó thì hắn không thể đọc được thông tin mà client gửi ở bước 5.</p>\n<h1 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận\"></a>Kết luận</h1><p>Không có kết luận :)</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Đi luôn vào chủ đề, khi mới bắt đầu với môn mạng máy tính ở trường đại học, sự mập mờ khi còn ngồi trên ghế nhà trường khiến chúng ta đôi khi đã nhầm lẫn về <strong>http</strong> và <strong>https</strong>, nhớ ngày đó tôi đã từng nghĩ chúng là 2 giao thức khác nhau, à mà ngày đó tôi có hiểu giao thức là gì không nhỉ :fearful: thôi dẹp qua một bên, bản chất của <strong>https</strong> cũng là giao thức <strong>http</strong> nhưng thêm được chữ <strong>s</strong> ứng với <strong>secure</strong>. Nghe thôi đã thấy bảo mật rồi, <strong>https</strong> ra đời nhằm mục đích làm cho giao thức <strong>http</strong> trở nên an toàn hơn, vậy nó làm cho <strong>http</strong> trở nên an toàn hơn như thế nào?</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Http-hieu-don-gian-thi-hoat-dong-the-nao\"><a href=\"#1-Http-hieu-don-gian-thi-hoat-dong-the-nao\" class=\"headerlink\" title=\"1. Http hiểu đơn giản thì hoạt động thế nào?\"></a>1. Http hiểu đơn giản thì hoạt động thế nào?</h2><p>Mục đích cuối cùng của mớ hỗn độn rối rắm này cũng là truyền nhận thông tin, tôi có một website tôi muốn gửi nó lên mạng internet để bạn, một ai đó mà tôi không quen có thể vô tình lướt qua đọc được.<br>Http là một giao thức, hiểu đơn giản là một bộ quy tắc để chung để người sử dụng dùng trình duyệt có thể truy cập tới 1 trang web, và trang web đó hiểu được yêu cầu đó rồi trả về nội dung mà trình duyệt có thể hiểu được, ví như có nhiều ngôn ngữ trên thế giới, vậy giữa 2 người có 2 tiếng nói khác nhau để giao tiếp được họ phải cùng nhau sử dụng một bộ ngôn ngữ chung mà cả hai cùng hiểu được.</p>\n<p>Một đặc điểm cơ bản của <strong>http</strong> là nó truyền nhận thông tin dưới dạng <strong>text</strong> thông thường, không hề mã hoã, điều này dẫn tới vấn đề đó là thông tin được truyền nhận nhanh chóng, nhẹ nhàng, nội dung rất thân thiện với người dùng (vì nó là text mà).</p>\n<p>Mọi thứ có vẻ good? không hẳn như vậy, việc dữ liệu truyền gửi được lưu dưới dạng text khiến nó quá thân thiện với người dùng, mà người dùng thì không phải ai cũng tốt :smirk: . Có những người dùng mà mục đích họ tới với website của bạn là để phá hoại, họ sẽ dễ dàng tấn công bằng cách nào đó lấy được request của bạn rồi đọc được nội dung trong request đó 1 cách dễ dàng.</p>\n<p>Bài học: Không phải lúc nào cũng nên quá thân thiện với người dùng cuối :worried:</p>\n<h2 id=\"2-Https-khac-phuc-van-de-cua-http-nhu-the-nao\"><a href=\"#2-Https-khac-phuc-van-de-cua-http-nhu-the-nao\" class=\"headerlink\" title=\"2. Https khắc phục vấn đề của http như thế nào?\"></a>2. Https khắc phục vấn đề của http như thế nào?</h2><p>Chúng ta đã nắm được khái quát vấn đề bảo mật gặp phải khi sử dụng <strong>http</strong>. Với những website giải trí thuần tuý với nội dung chủ yếu là hình ảnh, âm thanh và không có thông tin cần bảo mật thì sử dụng https hình như cũng chỉ để tốt cho SEO, ngoài ra cũng không còn giá trị gì. Nhưng nếu bạn sử dụng <strong>Internet Banking</strong> với http, rồi bạn đăng nhập với tài khoản ngân hàng của mình trên đó, mọi thông tin bạn gửi đi đều dưới dạng những gói tin có nội dung plain/text trần trụi, vậy điều gì bảo vệ được tài khoản của bạn nếu request kể trên bị những kẻ xấu dùng những thủ thuật hay phần mềm chuyên dụng để bắt được?</p>\n<p>Https giải bài toán trên bằng cách rất đơn giản, nội dung dạng plain/text giúp kẻ gian có thể bắt và đọc dễ dàng, vậy chúng ta hãy mã hoá nội dung để kẻ gian đó không thể hiểu được, và có bắt được gói tin cũng vô dụng?.</p>\n<h2 id=\"3-Https-va-van-de-ma-hoa-du-lieu\"><a href=\"#3-Https-va-van-de-ma-hoa-du-lieu\" class=\"headerlink\" title=\"3. Https và vấn đề mã hoá dữ liệu\"></a>3. Https và vấn đề mã hoá dữ liệu</h2><p>Trước tiên phải làm rõ là:</p>\n<p><strong>https = http + ssl</strong></p>\n<p>Trong đó:</p>\n<ol>\n<li><p>http là giao thức tryền tải.</p>\n</li>\n<li><p>ssl là cơ chế bảo mật thông tin.</p>\n</li>\n</ol>\n<p><img src=\"/images/7.gif\" alt=\"tam the tu tin\"></p>\n<p>Flow tối thiểu của <strong>https</strong> sẽ như sau:</p>\n<ol>\n<li><p><strong>Client hello</strong>, người dùng sử dụng trình duyệt sẽ request tới google.com.</p>\n</li>\n<li><p><strong>Server hello</strong>, request ở bước một đã tới nơi, server sẽ gửi trả client 2 thông tin quan trọng đó là <strong>ssl certificate</strong> (Để chứng minh “Ê, tao là google.com thật nha, not fake”) và 1 <strong>Public key</strong> (Gọi là Public-key-1. <em>Vậy ta có thể hiểu là ở Server google.com nó đang giữ Private key 1 ứng với Public key 1 kia</em>).</p>\n</li>\n<li><p>Browser sẽ xác minh <strong>ssl certificate</strong> nhận được để xem nó có phải là hàng real hay không. Vậy còn làm sao mà browser có thể phân định thật giả? Chúng ta sẽ tìm hiểu trong 1 bài viết khác.</p>\n</li>\n<li><p>Sau khi browser xác minh và đã tin tưởng máy chủ google.com, browser sẽ tạo 1 cặp khoá bảo mật RSA thứ 2, ta gọi là <strong>Public key 2 và Private key 2</strong>.</p>\n</li>\n<li><p>Browser dùng <strong>Public key 1</strong> đã nhận được từ bước 3, để mã hoá <em>Public key 2 và Private key 2</em> sinh ra trong bước 4, rồi gửi cặp khoá này dưới dạng đã mã hoá tới máy chủ google.com.</p>\n</li>\n<li><p>Như bạn nhớ, thì máy chủ google.com đang giữ <strong>Private key 1</strong> và thế là nó có thể giải mã và lấy được cặp key ở bước 5.</p>\n</li>\n<li><p>Vậy là cả máy chủ google.com và client đều có cặp khoá RSA thứ 2, mọi thông tin truyền gửi từ cả 2 phía bây giờ đều được mã hoá bằng Public key 2.</p>\n</li>\n</ol>\n<p>Note: Nhờ cơ chế mã hoá RSA (Chỉ có thể mã hoá bằng public key và giải mã nội dung bằng private key) kể trên. Server và client đã có thể liên lạc với nhau một cách an toàn. Trong quá trình trên, kể cả kẻ thủ ác có bắt được gói tin ở bước 2, bên trong có public key 1, thì cũng không phải vấn đề, bởi vì với public key đó thì hắn không thể đọc được thông tin mà client gửi ở bước 5.</p>\n<h1 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận\"></a>Kết luận</h1><p>Không có kết luận :)</p>\n"},{"title":"Session Và Cookies Trong Rails","date":"2019-04-16T17:00:00.000Z","draft":false,"_content":"\n## Đặt vấn đề\n**session[:user_id] = @user.id**, dòng code này thật quen thuộc? khi làm chức năng đăng nhập trong những ngày nhập môn, hẳn ai cũng đã từng làm qua hoặc làm gần giống như vậy, ta được dạy rằng, **http** là 1 giao thức không có trạng thái nên request thứ **N + 1** sẽ chẳng thể biết được request thứ **N** đã làm gì, vậy nếu ở lần request thứ **N** chúng ta đã thực hiện hành vi đăng nhập, và **http** thì không có lưu vết lại điều đó, hệ quả là ở lần request tiếp theo, website hiểu như bạn chưa đăng nhập, rất đáng buồn.\n\nDo you familiar with the logic below:\n\n```ruby\nsession[:user_id] = @user.id\n```\n\nCũng theo những gì được dạy, **session/cookies** được tạo ra với mục đích làm cho http request có \"trạng thái\". Vì sao lại để từ trạng thái trong nháy kép, vì thực sự là **http** không bao giờ có trạng thái cả, mà **session/cookies** với khả năng lưu vết của mình có thể giúp website nắm được một số **thông tin** từ client đã request trước đó và làm chúng giống như **http** đã có trạng thái.\n\nQuá mơ hồ? đúng vậy, khi được dạy điều này tôi cũng thấy thật mơ hồ, wth is trạng thái? phi trạng thái? lưu vết?... Hy vọng bài viết này sẽ giúp người đọc có 1 cái nhìn dễ hiểu hơn về 2 đối tượng này trong ruby on rails.\n\n## Luận bàn\n\n## 1. Flow hoạt động\n\nMột cách ngắn gọn cookies sẽ được vận hành như sau:\n\n**Step 1**: Lần đầu bạn request đến web ABC.com, nhẹ nhàng tựa mây bay, bạn không mang theo thông tin gì của ABC.com cả\n\n**Step 2**: ABC.com nhận request của bạn, nó nhận ra bạn không mang theo cookies của website, nên nó trong response trả về nó set một hoặc một vài cookies mặc định cho bạn.\n\n**Step 3**: Bạn nhận được response của ABC.com, rồi bạn tiếp tục request lên ABC.com lần thứ 2, lần này đi theo request của bạn là toàn bộ số cookies đã được khởi tạo ở bước 2.\n\n**Step 4**: ABC.com lại nhận được request của bạn, và lần này nó đã thấy bạn mang cookies của ABC.com nên nó sẽ đọc nội dung trong cookies đó (nếu cần).\n\n## 2. Một vài loại cookies quan trọng trong rails\n\n1. **Normal cookies**: Một dạng cookie mà dữ liệu được lưu trữ dưới dạng text.\n\n2. **Signed cookies**: Một dạng cookie mà dữ liệu lưu trữ sẽ được \"ký\" bởi 1 **digest**, và **digest** này được tạo ra bởi **secret_key_base** trong app của bạn, sau đó nó sẽ được chuyển sang dạng **base64** code. Điều này có nghĩa là nếu ai đó có được **signed cookies** của bạn, thì họ hoàn toàn có thể đọc được nội dung bên trong (decode base64 là có thể đọc được). Tuy nhiên nếu họ sửa lại nội dung của cookies đó và gửi lên server thì lúc này, cookies này trở thành 1 cookies không hợp lệ, vì sao? Vì như đã trình bày, nó được ký bởi 1 digest sinh ra qua **secret_key_base**, vậy nên cookies loại này nếu bị sửa đổi nội dung ở client thì khi kiểm tra tính toàn vẹn trên server thông qua digest sẽ không còn đúng nữa. Và nó trở thành 1 cookies không hợp lệ.\n\n3. **Encrypted cookies**: Một dạng cookies mà dữ liệu được mã hóa qua một quá trình mã hóa với 1 khóa quan trọng là **secret_key_base**, một cách đơn giản nhất để hiểu là không có **secret_key_base** thì ta không thể nào **đọc** hay sửa đổi dữ liệu của cookies này được.\n\nVí dụ:\n\n```ruby\ncookies.signed[:signed] = \"Duy Chinh\"\ncookies.encrypted[:encrypted] = \"Duy Chinh\"\ncookies[:normal] = \"Duy Chinh\"\n\n```\nTôi đã tạo 3 cookies ứng với 3 dạng cookies nêu ở trên, giá trị của chúng đều giống nhau (đều được gán bằng \"Duy Chinh\").\n\nHãy xem giá trị ở client nhận được:\n\n```ruby\nnormal = \"Duy+Chinh\"\nsigned = \"IkR1eSBDaGluaCI%3D--a3af2bfd61abcd20cc3b8ac714968d0aaf578fe5\"\nencrypted = \"%2BVulShtBgFR2I18%3D--zQP8FmCAW4%2FZUwar--CQ%2FH6HFHSVlox5H8QC4CTg%3D%3D\"\n```\n\nNhận xét:\n\n1. Kiểu cookies thông thường, dữ liệu lưu dạng text nên ở client ta dễ dàng đọc được nội dung cũng như sửa đổi dữ liệu của chúng.\n\n2. Nhìn signed cookies và encrypted cookies đều không thân thiện với người dùng cuối, vì chúng gồm những ký tự không có ngữ nghĩa với end user.\n\n3. Nếu decode **base64** ta thu được giá trị của signed cookies ở trên là: **\"Duy Chinh\"7횿f߷횭Ƕч7oƜ뇴i繯Ǟ䀀**, dù một số ký tự phía sau không thể hiểu được, tuy nhiên không quan trọng vì nội dung cookies vẫn được giải mã (đúng với tính chất, có thể đọc nhưng không thể sửa đổi).\n\n4. Việc decode encrypted cookies là vô vọng khi không có **secret_key_base**.\n\n**NOTE:**\n\nViệc sử dụng loại cookies nào sẽ đúng trong những trường hợp cụ thể, với những dữ liệu vô hại và không hề quan trọng thì sử dụng cookies thông thường và lưu mọi thứ dưới dạng text là khả dĩ hơn cả. Bỏ qua các bước mã hóa giúp nó hoạt động với performance tốt hơn hẳn 2 dạng cookies còn lại.\nNgược lại, encrypted cookies là dạng cookies tốn công sức để xử lý nhất, vì vậy hãy chỉ sử dụng nó cho những thông tin thực sự quan trọng và không thể để lộ (những thông tin bớt quan trọng hơn và chỉ cần đảm bảo tính toàn vẹn của dữ liệu chứ không cần bảo mật thông tin thì hãy dùng signed cookies).\n\n## 3. Giải mã cookies và tìm hiểu về session trong rails\n\nSau khá nhiều công sức tìm kiếm, tôi đã tìm ra cách để giải mã cookies trong rails 5.2, nội dung đơn giản như sau:\n\n```ruby\nrequire 'cgi'\nrequire 'active_support'\n\ndef verify_and_decrypt_session_cookie(cookie, secret_key_base)\n  cookie                  = CGI::unescape(cookie)\n  salt                    = 'authenticated encrypted cookie'\n  encrypted_cookie_cipher = 'aes-256-gcm'\n  serializer              = ActiveSupport::MessageEncryptor::NullSerializer\n\n  key_generator           = ActiveSupport::KeyGenerator.new(secret_key_base, iterations: 1000)\n  key_len                 = ActiveSupport::MessageEncryptor.key_len(encrypted_cookie_cipher)\n  secret                  = key_generator.generate_key(salt, key_len)\n  encryptor               = ActiveSupport::MessageEncryptor.new(secret, cipher: encrypted_cookie_cipher, serializer: serializer)\n\n  encryptor.decrypt_and_verify(cookie)\nend\n\ncookie         = \"QkS0eMMxz8z0Kso%3D--4opNQwT5tGUsnn90--5fXye0VQJX%2BXMVkUmK69gw%3D%3D\"\nskb            = \"2fc48081a207cbe98379b2ed33b5072125d6f80a55997494b021bde37cec4d9c8f17f90357d6ade926b02a3bc271ccecaf6894af1410d6ef8f6c9b3b0d871fba\"\ncookie_session = \"ahp9AcIyl%2BhLvQW695lhNUCnI7bF2iNZY8e4bM%2B2Lrx%2FlnbVXkYF3nL493dMM7eslFJKAyBNJKZlY5ugZpUuznCxO%2BpNXudnOdQVuDyvVBLxA8gQ4t48Gs%2BqOS7e%2FlSjBedhFKAaoBRdVI06QL8%3D--enarz3Hu%2FZ2n1Ys%2B--YdTghGWd4ZFef9Lf7WM%2FMQ%3D%3D\"\nputs verify_and_decrypt_session_cookie(cookie_session, skb)\n\n```\n\nNội dung được tham khảo từ nhiều nguồn (vì không một nguồn cụ thể nào copy và chạy luôn được :unamused:), nhưng chủ yếu được tìm hiểu [tại đây](https://api.rubyonrails.org/classes/ActiveSupport/MessageEncryptor.html), các bạn có thể vào trang này để tìm hiểu kỹ hơn.\n\n**NOTE:** Một điểm hết sức cần chú ý đó là biến **skb** tôi sử dụng ở trên chính là **secret_key_base** của project mà tôi sử dụng để demo, vì đây chỉ là một project test nên tôi có thể viết dạng text vào file sau đó commit lên github như này, trong tất cả các trường hợp khác thì đây là một hành động vô cùng **tồi tệ**, việc bị lộ **secret_key_base** sẽ khiến ứng dụng của bạn trần trụi trước hacker. Vậy nên hãy thật cẩn thận!\n\nĐoạn mã trên work tốt trên rails 5.2, chú ý là cách mã hóa ở các phiên bản rails khác nhau hoàn toàn có khả năng khác nhau, nên nếu đoạn mã này không thể chạy được với rails 4 chẳng hạn thì đó là điều hết sức bình thường.\n\nTrở lại vấn đề chính, nếu bạn để ý thì trong lần đầu tiên request khi bạn chưa hề làm gì và code trên server của bạn cũng chưa hề set bất kỳ giá trị cookies nào thì trong response trả về vẫn sẽ có một cookies (mà tôi đã nói ở trên, trong lần đầu request server sẽ khởi tạo và gửi về cho bạn một hoặc một vài cookies).\n\nTrong trường hợp này là một, cookies đó có thể có tên dạng **_app_name_session**. Nội dung của cookies này cũng được mã hóa, thử decode bằng **base64** không được ta có thể hiểu đây là 1 cookies đã được encrypted.\n\nGiá trị của cookies này trong trường hợp tôi test là:\n\n```\n\"aW2fSskgCyZ20Fi6E68xRGl0%2FR%2FzeFWoWU5YdhgkVhB%2FMtWSsX0rf3JuRgsfPPgQXjYYNygaRSxRjXAmOcsjohN28JQJnjej0Grfpwx52cZ5qjIRdMfOS9aXdTmedpuJ7T99aObbv75D3dsPtdQ%3D--FW10HzOu9FIoKK%2B8--9sMKANggTvi%2BlBjFwpIHEg%3D%3D\"\n```\n\nSử dụng đoạn mã ta đã viết ở trên, ta giải mã ra được giá trị của cookies này là:\n\n```ruby\n{\n  \"session_id\":\"52cc440e209ad03d306e550c2ca2dd78\",\n  \"_csrf_token\":\"rD35dsIoJyf5MIRA54/ARQNMBAN0yKvfMU4RjCc9WD8=\"\n}\n```\n\nVậy trong lần đầu request tới 1 website ruby on rails, nó sẽ tạo ra cho chúng ta 1 session, session lúc khởi tạo không có giá trị gì ngoài **session_id** và **_csrf_token**.\n\n**Ủa sai sai, tôi nhớ là ngày xưa đi học được dạy rằng điểm khác biệt của session và cookies là session được lưu ở server còn cookies được lưu ở client cơ mà**\n\nĐúng, tôi cũng được học như vậy, nhưng đó không phải là cách mà rails xử lý, **Rails được config mặc định là lưu session bằng cookies**, nếu không muốn ta có thể lưu trên **redis**, **database**... Tuy nhiên nếu không thấy ngại vì giới hạn không quá **4KB** của cookies thì tôi không thấy lý do gì để chuyển vị trí lưu trữ của session đi cả. :smiley:\n\nBây giờ tôi add thêm 1 giá trị vào session với câu lệnh **session[:user_id] = 1**, lúc này giá trị của cookies cũng thay đổi theo, lại decrypt ta thu được:\n\n```ruby\n{\n  \"session_id\":\"52cc440e209ad03d306e550c2ca2dd78\",\n  \"_csrf_token\":\"rD35dsIoJyf5MIRA54/ARQNMBAN0yKvfMU4RjCc9WD8=\",\n  \"user_id\":1\n}\n```\n\nSession bây giờ đã có thêm một key mới là **user_id** với giá trị là **1**. À vậy cuối cùng thì session cũng là 1 **hash** thôi nhỉ.\n\n## Kết luận\n\nĐể phân biệt các client khác nhau, server sẽ dựa vào **session_id** được lưu trong cookies, vì vậy nếu chiếm được cookies đăng nhập trên website ABC.com của bạn, các hacker có thể dùng nó để giả mạo bạn và request lên server, đáng buồn thay server sẽ đọc cookies được hacker request lên, sử dụng **secret_key_base** để giải mã cookies và đọc nội dung bên trong, đoạn code xử lý login lại đọc từ session[:user_id], lúc này thì cookies kia có giá trị **session[:user_id] = 1** và thế là server đã tưởng rằng hacker chính là bạn.\n","source":"_posts/2019-04-17-doi-dieu-ve-session-va-cookie-trong-rails.md","raw":"---\ntitle: \"Session Và Cookies Trong Rails\"\ndate: 2019-04-17\ndraft: false\ntags: [\"RAILS\"]\n---\n\n## Đặt vấn đề\n**session[:user_id] = @user.id**, dòng code này thật quen thuộc? khi làm chức năng đăng nhập trong những ngày nhập môn, hẳn ai cũng đã từng làm qua hoặc làm gần giống như vậy, ta được dạy rằng, **http** là 1 giao thức không có trạng thái nên request thứ **N + 1** sẽ chẳng thể biết được request thứ **N** đã làm gì, vậy nếu ở lần request thứ **N** chúng ta đã thực hiện hành vi đăng nhập, và **http** thì không có lưu vết lại điều đó, hệ quả là ở lần request tiếp theo, website hiểu như bạn chưa đăng nhập, rất đáng buồn.\n\nDo you familiar with the logic below:\n\n```ruby\nsession[:user_id] = @user.id\n```\n\nCũng theo những gì được dạy, **session/cookies** được tạo ra với mục đích làm cho http request có \"trạng thái\". Vì sao lại để từ trạng thái trong nháy kép, vì thực sự là **http** không bao giờ có trạng thái cả, mà **session/cookies** với khả năng lưu vết của mình có thể giúp website nắm được một số **thông tin** từ client đã request trước đó và làm chúng giống như **http** đã có trạng thái.\n\nQuá mơ hồ? đúng vậy, khi được dạy điều này tôi cũng thấy thật mơ hồ, wth is trạng thái? phi trạng thái? lưu vết?... Hy vọng bài viết này sẽ giúp người đọc có 1 cái nhìn dễ hiểu hơn về 2 đối tượng này trong ruby on rails.\n\n## Luận bàn\n\n## 1. Flow hoạt động\n\nMột cách ngắn gọn cookies sẽ được vận hành như sau:\n\n**Step 1**: Lần đầu bạn request đến web ABC.com, nhẹ nhàng tựa mây bay, bạn không mang theo thông tin gì của ABC.com cả\n\n**Step 2**: ABC.com nhận request của bạn, nó nhận ra bạn không mang theo cookies của website, nên nó trong response trả về nó set một hoặc một vài cookies mặc định cho bạn.\n\n**Step 3**: Bạn nhận được response của ABC.com, rồi bạn tiếp tục request lên ABC.com lần thứ 2, lần này đi theo request của bạn là toàn bộ số cookies đã được khởi tạo ở bước 2.\n\n**Step 4**: ABC.com lại nhận được request của bạn, và lần này nó đã thấy bạn mang cookies của ABC.com nên nó sẽ đọc nội dung trong cookies đó (nếu cần).\n\n## 2. Một vài loại cookies quan trọng trong rails\n\n1. **Normal cookies**: Một dạng cookie mà dữ liệu được lưu trữ dưới dạng text.\n\n2. **Signed cookies**: Một dạng cookie mà dữ liệu lưu trữ sẽ được \"ký\" bởi 1 **digest**, và **digest** này được tạo ra bởi **secret_key_base** trong app của bạn, sau đó nó sẽ được chuyển sang dạng **base64** code. Điều này có nghĩa là nếu ai đó có được **signed cookies** của bạn, thì họ hoàn toàn có thể đọc được nội dung bên trong (decode base64 là có thể đọc được). Tuy nhiên nếu họ sửa lại nội dung của cookies đó và gửi lên server thì lúc này, cookies này trở thành 1 cookies không hợp lệ, vì sao? Vì như đã trình bày, nó được ký bởi 1 digest sinh ra qua **secret_key_base**, vậy nên cookies loại này nếu bị sửa đổi nội dung ở client thì khi kiểm tra tính toàn vẹn trên server thông qua digest sẽ không còn đúng nữa. Và nó trở thành 1 cookies không hợp lệ.\n\n3. **Encrypted cookies**: Một dạng cookies mà dữ liệu được mã hóa qua một quá trình mã hóa với 1 khóa quan trọng là **secret_key_base**, một cách đơn giản nhất để hiểu là không có **secret_key_base** thì ta không thể nào **đọc** hay sửa đổi dữ liệu của cookies này được.\n\nVí dụ:\n\n```ruby\ncookies.signed[:signed] = \"Duy Chinh\"\ncookies.encrypted[:encrypted] = \"Duy Chinh\"\ncookies[:normal] = \"Duy Chinh\"\n\n```\nTôi đã tạo 3 cookies ứng với 3 dạng cookies nêu ở trên, giá trị của chúng đều giống nhau (đều được gán bằng \"Duy Chinh\").\n\nHãy xem giá trị ở client nhận được:\n\n```ruby\nnormal = \"Duy+Chinh\"\nsigned = \"IkR1eSBDaGluaCI%3D--a3af2bfd61abcd20cc3b8ac714968d0aaf578fe5\"\nencrypted = \"%2BVulShtBgFR2I18%3D--zQP8FmCAW4%2FZUwar--CQ%2FH6HFHSVlox5H8QC4CTg%3D%3D\"\n```\n\nNhận xét:\n\n1. Kiểu cookies thông thường, dữ liệu lưu dạng text nên ở client ta dễ dàng đọc được nội dung cũng như sửa đổi dữ liệu của chúng.\n\n2. Nhìn signed cookies và encrypted cookies đều không thân thiện với người dùng cuối, vì chúng gồm những ký tự không có ngữ nghĩa với end user.\n\n3. Nếu decode **base64** ta thu được giá trị của signed cookies ở trên là: **\"Duy Chinh\"7횿f߷횭Ƕч7oƜ뇴i繯Ǟ䀀**, dù một số ký tự phía sau không thể hiểu được, tuy nhiên không quan trọng vì nội dung cookies vẫn được giải mã (đúng với tính chất, có thể đọc nhưng không thể sửa đổi).\n\n4. Việc decode encrypted cookies là vô vọng khi không có **secret_key_base**.\n\n**NOTE:**\n\nViệc sử dụng loại cookies nào sẽ đúng trong những trường hợp cụ thể, với những dữ liệu vô hại và không hề quan trọng thì sử dụng cookies thông thường và lưu mọi thứ dưới dạng text là khả dĩ hơn cả. Bỏ qua các bước mã hóa giúp nó hoạt động với performance tốt hơn hẳn 2 dạng cookies còn lại.\nNgược lại, encrypted cookies là dạng cookies tốn công sức để xử lý nhất, vì vậy hãy chỉ sử dụng nó cho những thông tin thực sự quan trọng và không thể để lộ (những thông tin bớt quan trọng hơn và chỉ cần đảm bảo tính toàn vẹn của dữ liệu chứ không cần bảo mật thông tin thì hãy dùng signed cookies).\n\n## 3. Giải mã cookies và tìm hiểu về session trong rails\n\nSau khá nhiều công sức tìm kiếm, tôi đã tìm ra cách để giải mã cookies trong rails 5.2, nội dung đơn giản như sau:\n\n```ruby\nrequire 'cgi'\nrequire 'active_support'\n\ndef verify_and_decrypt_session_cookie(cookie, secret_key_base)\n  cookie                  = CGI::unescape(cookie)\n  salt                    = 'authenticated encrypted cookie'\n  encrypted_cookie_cipher = 'aes-256-gcm'\n  serializer              = ActiveSupport::MessageEncryptor::NullSerializer\n\n  key_generator           = ActiveSupport::KeyGenerator.new(secret_key_base, iterations: 1000)\n  key_len                 = ActiveSupport::MessageEncryptor.key_len(encrypted_cookie_cipher)\n  secret                  = key_generator.generate_key(salt, key_len)\n  encryptor               = ActiveSupport::MessageEncryptor.new(secret, cipher: encrypted_cookie_cipher, serializer: serializer)\n\n  encryptor.decrypt_and_verify(cookie)\nend\n\ncookie         = \"QkS0eMMxz8z0Kso%3D--4opNQwT5tGUsnn90--5fXye0VQJX%2BXMVkUmK69gw%3D%3D\"\nskb            = \"2fc48081a207cbe98379b2ed33b5072125d6f80a55997494b021bde37cec4d9c8f17f90357d6ade926b02a3bc271ccecaf6894af1410d6ef8f6c9b3b0d871fba\"\ncookie_session = \"ahp9AcIyl%2BhLvQW695lhNUCnI7bF2iNZY8e4bM%2B2Lrx%2FlnbVXkYF3nL493dMM7eslFJKAyBNJKZlY5ugZpUuznCxO%2BpNXudnOdQVuDyvVBLxA8gQ4t48Gs%2BqOS7e%2FlSjBedhFKAaoBRdVI06QL8%3D--enarz3Hu%2FZ2n1Ys%2B--YdTghGWd4ZFef9Lf7WM%2FMQ%3D%3D\"\nputs verify_and_decrypt_session_cookie(cookie_session, skb)\n\n```\n\nNội dung được tham khảo từ nhiều nguồn (vì không một nguồn cụ thể nào copy và chạy luôn được :unamused:), nhưng chủ yếu được tìm hiểu [tại đây](https://api.rubyonrails.org/classes/ActiveSupport/MessageEncryptor.html), các bạn có thể vào trang này để tìm hiểu kỹ hơn.\n\n**NOTE:** Một điểm hết sức cần chú ý đó là biến **skb** tôi sử dụng ở trên chính là **secret_key_base** của project mà tôi sử dụng để demo, vì đây chỉ là một project test nên tôi có thể viết dạng text vào file sau đó commit lên github như này, trong tất cả các trường hợp khác thì đây là một hành động vô cùng **tồi tệ**, việc bị lộ **secret_key_base** sẽ khiến ứng dụng của bạn trần trụi trước hacker. Vậy nên hãy thật cẩn thận!\n\nĐoạn mã trên work tốt trên rails 5.2, chú ý là cách mã hóa ở các phiên bản rails khác nhau hoàn toàn có khả năng khác nhau, nên nếu đoạn mã này không thể chạy được với rails 4 chẳng hạn thì đó là điều hết sức bình thường.\n\nTrở lại vấn đề chính, nếu bạn để ý thì trong lần đầu tiên request khi bạn chưa hề làm gì và code trên server của bạn cũng chưa hề set bất kỳ giá trị cookies nào thì trong response trả về vẫn sẽ có một cookies (mà tôi đã nói ở trên, trong lần đầu request server sẽ khởi tạo và gửi về cho bạn một hoặc một vài cookies).\n\nTrong trường hợp này là một, cookies đó có thể có tên dạng **_app_name_session**. Nội dung của cookies này cũng được mã hóa, thử decode bằng **base64** không được ta có thể hiểu đây là 1 cookies đã được encrypted.\n\nGiá trị của cookies này trong trường hợp tôi test là:\n\n```\n\"aW2fSskgCyZ20Fi6E68xRGl0%2FR%2FzeFWoWU5YdhgkVhB%2FMtWSsX0rf3JuRgsfPPgQXjYYNygaRSxRjXAmOcsjohN28JQJnjej0Grfpwx52cZ5qjIRdMfOS9aXdTmedpuJ7T99aObbv75D3dsPtdQ%3D--FW10HzOu9FIoKK%2B8--9sMKANggTvi%2BlBjFwpIHEg%3D%3D\"\n```\n\nSử dụng đoạn mã ta đã viết ở trên, ta giải mã ra được giá trị của cookies này là:\n\n```ruby\n{\n  \"session_id\":\"52cc440e209ad03d306e550c2ca2dd78\",\n  \"_csrf_token\":\"rD35dsIoJyf5MIRA54/ARQNMBAN0yKvfMU4RjCc9WD8=\"\n}\n```\n\nVậy trong lần đầu request tới 1 website ruby on rails, nó sẽ tạo ra cho chúng ta 1 session, session lúc khởi tạo không có giá trị gì ngoài **session_id** và **_csrf_token**.\n\n**Ủa sai sai, tôi nhớ là ngày xưa đi học được dạy rằng điểm khác biệt của session và cookies là session được lưu ở server còn cookies được lưu ở client cơ mà**\n\nĐúng, tôi cũng được học như vậy, nhưng đó không phải là cách mà rails xử lý, **Rails được config mặc định là lưu session bằng cookies**, nếu không muốn ta có thể lưu trên **redis**, **database**... Tuy nhiên nếu không thấy ngại vì giới hạn không quá **4KB** của cookies thì tôi không thấy lý do gì để chuyển vị trí lưu trữ của session đi cả. :smiley:\n\nBây giờ tôi add thêm 1 giá trị vào session với câu lệnh **session[:user_id] = 1**, lúc này giá trị của cookies cũng thay đổi theo, lại decrypt ta thu được:\n\n```ruby\n{\n  \"session_id\":\"52cc440e209ad03d306e550c2ca2dd78\",\n  \"_csrf_token\":\"rD35dsIoJyf5MIRA54/ARQNMBAN0yKvfMU4RjCc9WD8=\",\n  \"user_id\":1\n}\n```\n\nSession bây giờ đã có thêm một key mới là **user_id** với giá trị là **1**. À vậy cuối cùng thì session cũng là 1 **hash** thôi nhỉ.\n\n## Kết luận\n\nĐể phân biệt các client khác nhau, server sẽ dựa vào **session_id** được lưu trong cookies, vì vậy nếu chiếm được cookies đăng nhập trên website ABC.com của bạn, các hacker có thể dùng nó để giả mạo bạn và request lên server, đáng buồn thay server sẽ đọc cookies được hacker request lên, sử dụng **secret_key_base** để giải mã cookies và đọc nội dung bên trong, đoạn code xử lý login lại đọc từ session[:user_id], lúc này thì cookies kia có giá trị **session[:user_id] = 1** và thế là server đã tưởng rằng hacker chính là bạn.\n","slug":"2019-04-17-doi-dieu-ve-session-va-cookie-trong-rails","published":1,"updated":"2022-01-29T09:29:59.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsao0016p3m22urk7b17","content":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p><strong>session[:user_id] = @user.id</strong>, dòng code này thật quen thuộc? khi làm chức năng đăng nhập trong những ngày nhập môn, hẳn ai cũng đã từng làm qua hoặc làm gần giống như vậy, ta được dạy rằng, <strong>http</strong> là 1 giao thức không có trạng thái nên request thứ <strong>N + 1</strong> sẽ chẳng thể biết được request thứ <strong>N</strong> đã làm gì, vậy nếu ở lần request thứ <strong>N</strong> chúng ta đã thực hiện hành vi đăng nhập, và <strong>http</strong> thì không có lưu vết lại điều đó, hệ quả là ở lần request tiếp theo, website hiểu như bạn chưa đăng nhập, rất đáng buồn.</p>\n<p>Do you familiar with the logic below:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">session[<span class=\"symbol\">:user_id</span>] = @user.id</span><br></pre></td></tr></table></figure>\n\n<p>Cũng theo những gì được dạy, <strong>session/cookies</strong> được tạo ra với mục đích làm cho http request có “trạng thái”. Vì sao lại để từ trạng thái trong nháy kép, vì thực sự là <strong>http</strong> không bao giờ có trạng thái cả, mà <strong>session/cookies</strong> với khả năng lưu vết của mình có thể giúp website nắm được một số <strong>thông tin</strong> từ client đã request trước đó và làm chúng giống như <strong>http</strong> đã có trạng thái.</p>\n<p>Quá mơ hồ? đúng vậy, khi được dạy điều này tôi cũng thấy thật mơ hồ, wth is trạng thái? phi trạng thái? lưu vết?… Hy vọng bài viết này sẽ giúp người đọc có 1 cái nhìn dễ hiểu hơn về 2 đối tượng này trong ruby on rails.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Flow-hoat-dong\"><a href=\"#1-Flow-hoat-dong\" class=\"headerlink\" title=\"1. Flow hoạt động\"></a>1. Flow hoạt động</h2><p>Một cách ngắn gọn cookies sẽ được vận hành như sau:</p>\n<p><strong>Step 1</strong>: Lần đầu bạn request đến web ABC.com, nhẹ nhàng tựa mây bay, bạn không mang theo thông tin gì của ABC.com cả</p>\n<p><strong>Step 2</strong>: ABC.com nhận request của bạn, nó nhận ra bạn không mang theo cookies của website, nên nó trong response trả về nó set một hoặc một vài cookies mặc định cho bạn.</p>\n<p><strong>Step 3</strong>: Bạn nhận được response của ABC.com, rồi bạn tiếp tục request lên ABC.com lần thứ 2, lần này đi theo request của bạn là toàn bộ số cookies đã được khởi tạo ở bước 2.</p>\n<p><strong>Step 4</strong>: ABC.com lại nhận được request của bạn, và lần này nó đã thấy bạn mang cookies của ABC.com nên nó sẽ đọc nội dung trong cookies đó (nếu cần).</p>\n<h2 id=\"2-Mot-vai-loai-cookies-quan-trong-trong-rails\"><a href=\"#2-Mot-vai-loai-cookies-quan-trong-trong-rails\" class=\"headerlink\" title=\"2. Một vài loại cookies quan trọng trong rails\"></a>2. Một vài loại cookies quan trọng trong rails</h2><ol>\n<li><p><strong>Normal cookies</strong>: Một dạng cookie mà dữ liệu được lưu trữ dưới dạng text.</p>\n</li>\n<li><p><strong>Signed cookies</strong>: Một dạng cookie mà dữ liệu lưu trữ sẽ được “ký” bởi 1 <strong>digest</strong>, và <strong>digest</strong> này được tạo ra bởi <strong>secret_key_base</strong> trong app của bạn, sau đó nó sẽ được chuyển sang dạng <strong>base64</strong> code. Điều này có nghĩa là nếu ai đó có được <strong>signed cookies</strong> của bạn, thì họ hoàn toàn có thể đọc được nội dung bên trong (decode base64 là có thể đọc được). Tuy nhiên nếu họ sửa lại nội dung của cookies đó và gửi lên server thì lúc này, cookies này trở thành 1 cookies không hợp lệ, vì sao? Vì như đã trình bày, nó được ký bởi 1 digest sinh ra qua <strong>secret_key_base</strong>, vậy nên cookies loại này nếu bị sửa đổi nội dung ở client thì khi kiểm tra tính toàn vẹn trên server thông qua digest sẽ không còn đúng nữa. Và nó trở thành 1 cookies không hợp lệ.</p>\n</li>\n<li><p><strong>Encrypted cookies</strong>: Một dạng cookies mà dữ liệu được mã hóa qua một quá trình mã hóa với 1 khóa quan trọng là <strong>secret_key_base</strong>, một cách đơn giản nhất để hiểu là không có <strong>secret_key_base</strong> thì ta không thể nào <strong>đọc</strong> hay sửa đổi dữ liệu của cookies này được.</p>\n</li>\n</ol>\n<p>Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cookies.signed[<span class=\"symbol\">:signed</span>] = <span class=\"string\">\"Duy Chinh\"</span></span><br><span class=\"line\">cookies.encrypted[<span class=\"symbol\">:encrypted</span>] = <span class=\"string\">\"Duy Chinh\"</span></span><br><span class=\"line\">cookies[<span class=\"symbol\">:normal</span>] = <span class=\"string\">\"Duy Chinh\"</span></span><br></pre></td></tr></table></figure>\n<p>Tôi đã tạo 3 cookies ứng với 3 dạng cookies nêu ở trên, giá trị của chúng đều giống nhau (đều được gán bằng “Duy Chinh”).</p>\n<p>Hãy xem giá trị ở client nhận được:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">normal = <span class=\"string\">\"Duy+Chinh\"</span></span><br><span class=\"line\">signed = <span class=\"string\">\"IkR1eSBDaGluaCI%3D--a3af2bfd61abcd20cc3b8ac714968d0aaf578fe5\"</span></span><br><span class=\"line\">encrypted = <span class=\"string\">\"%2BVulShtBgFR2I18%3D--zQP8FmCAW4%2FZUwar--CQ%2FH6HFHSVlox5H8QC4CTg%3D%3D\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Nhận xét:</p>\n<ol>\n<li><p>Kiểu cookies thông thường, dữ liệu lưu dạng text nên ở client ta dễ dàng đọc được nội dung cũng như sửa đổi dữ liệu của chúng.</p>\n</li>\n<li><p>Nhìn signed cookies và encrypted cookies đều không thân thiện với người dùng cuối, vì chúng gồm những ký tự không có ngữ nghĩa với end user.</p>\n</li>\n<li><p>Nếu decode <strong>base64</strong> ta thu được giá trị của signed cookies ở trên là: <strong>“Duy Chinh”7횿f߷횭Ƕч7oƜ뇴i繯Ǟ䀀</strong>, dù một số ký tự phía sau không thể hiểu được, tuy nhiên không quan trọng vì nội dung cookies vẫn được giải mã (đúng với tính chất, có thể đọc nhưng không thể sửa đổi).</p>\n</li>\n<li><p>Việc decode encrypted cookies là vô vọng khi không có <strong>secret_key_base</strong>.</p>\n</li>\n</ol>\n<p><strong>NOTE:</strong></p>\n<p>Việc sử dụng loại cookies nào sẽ đúng trong những trường hợp cụ thể, với những dữ liệu vô hại và không hề quan trọng thì sử dụng cookies thông thường và lưu mọi thứ dưới dạng text là khả dĩ hơn cả. Bỏ qua các bước mã hóa giúp nó hoạt động với performance tốt hơn hẳn 2 dạng cookies còn lại.<br>Ngược lại, encrypted cookies là dạng cookies tốn công sức để xử lý nhất, vì vậy hãy chỉ sử dụng nó cho những thông tin thực sự quan trọng và không thể để lộ (những thông tin bớt quan trọng hơn và chỉ cần đảm bảo tính toàn vẹn của dữ liệu chứ không cần bảo mật thông tin thì hãy dùng signed cookies).</p>\n<h2 id=\"3-Giai-ma-cookies-va-tim-hieu-ve-session-trong-rails\"><a href=\"#3-Giai-ma-cookies-va-tim-hieu-ve-session-trong-rails\" class=\"headerlink\" title=\"3. Giải mã cookies và tìm hiểu về session trong rails\"></a>3. Giải mã cookies và tìm hiểu về session trong rails</h2><p>Sau khá nhiều công sức tìm kiếm, tôi đã tìm ra cách để giải mã cookies trong rails 5.2, nội dung đơn giản như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'cgi'</span></span><br><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'active_support'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">verify_and_decrypt_session_cookie</span><span class=\"params\">(cookie, secret_key_base)</span></span></span><br><span class=\"line\">  cookie                  = CGI::unescape(cookie)</span><br><span class=\"line\">  salt                    = <span class=\"string\">'authenticated encrypted cookie'</span></span><br><span class=\"line\">  encrypted_cookie_cipher = <span class=\"string\">'aes-256-gcm'</span></span><br><span class=\"line\">  serializer              = ActiveSupport::MessageEncryptor::NullSerializer</span><br><span class=\"line\"></span><br><span class=\"line\">  key_generator           = ActiveSupport::KeyGenerator.new(secret_key_base, <span class=\"symbol\">iterations:</span> <span class=\"number\">1000</span>)</span><br><span class=\"line\">  key_len                 = ActiveSupport::MessageEncryptor.key_len(encrypted_cookie_cipher)</span><br><span class=\"line\">  secret                  = key_generator.generate_key(salt, key_len)</span><br><span class=\"line\">  encryptor               = ActiveSupport::MessageEncryptor.new(secret, <span class=\"symbol\">cipher:</span> encrypted_cookie_cipher, <span class=\"symbol\">serializer:</span> serializer)</span><br><span class=\"line\"></span><br><span class=\"line\">  encryptor.decrypt_and_verify(cookie)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">cookie         = <span class=\"string\">\"QkS0eMMxz8z0Kso%3D--4opNQwT5tGUsnn90--5fXye0VQJX%2BXMVkUmK69gw%3D%3D\"</span></span><br><span class=\"line\">skb            = <span class=\"string\">\"2fc48081a207cbe98379b2ed33b5072125d6f80a55997494b021bde37cec4d9c8f17f90357d6ade926b02a3bc271ccecaf6894af1410d6ef8f6c9b3b0d871fba\"</span></span><br><span class=\"line\">cookie_session = <span class=\"string\">\"ahp9AcIyl%2BhLvQW695lhNUCnI7bF2iNZY8e4bM%2B2Lrx%2FlnbVXkYF3nL493dMM7eslFJKAyBNJKZlY5ugZpUuznCxO%2BpNXudnOdQVuDyvVBLxA8gQ4t48Gs%2BqOS7e%2FlSjBedhFKAaoBRdVI06QL8%3D--enarz3Hu%2FZ2n1Ys%2B--YdTghGWd4ZFef9Lf7WM%2FMQ%3D%3D\"</span></span><br><span class=\"line\">puts verify_and_decrypt_session_cookie(cookie_session, skb)</span><br></pre></td></tr></table></figure>\n\n<p>Nội dung được tham khảo từ nhiều nguồn (vì không một nguồn cụ thể nào copy và chạy luôn được :unamused:), nhưng chủ yếu được tìm hiểu <a href=\"https://api.rubyonrails.org/classes/ActiveSupport/MessageEncryptor.html\" target=\"_blank\" rel=\"noopener\">tại đây</a>, các bạn có thể vào trang này để tìm hiểu kỹ hơn.</p>\n<p><strong>NOTE:</strong> Một điểm hết sức cần chú ý đó là biến <strong>skb</strong> tôi sử dụng ở trên chính là <strong>secret_key_base</strong> của project mà tôi sử dụng để demo, vì đây chỉ là một project test nên tôi có thể viết dạng text vào file sau đó commit lên github như này, trong tất cả các trường hợp khác thì đây là một hành động vô cùng <strong>tồi tệ</strong>, việc bị lộ <strong>secret_key_base</strong> sẽ khiến ứng dụng của bạn trần trụi trước hacker. Vậy nên hãy thật cẩn thận!</p>\n<p>Đoạn mã trên work tốt trên rails 5.2, chú ý là cách mã hóa ở các phiên bản rails khác nhau hoàn toàn có khả năng khác nhau, nên nếu đoạn mã này không thể chạy được với rails 4 chẳng hạn thì đó là điều hết sức bình thường.</p>\n<p>Trở lại vấn đề chính, nếu bạn để ý thì trong lần đầu tiên request khi bạn chưa hề làm gì và code trên server của bạn cũng chưa hề set bất kỳ giá trị cookies nào thì trong response trả về vẫn sẽ có một cookies (mà tôi đã nói ở trên, trong lần đầu request server sẽ khởi tạo và gửi về cho bạn một hoặc một vài cookies).</p>\n<p>Trong trường hợp này là một, cookies đó có thể có tên dạng <strong>_app_name_session</strong>. Nội dung của cookies này cũng được mã hóa, thử decode bằng <strong>base64</strong> không được ta có thể hiểu đây là 1 cookies đã được encrypted.</p>\n<p>Giá trị của cookies này trong trường hợp tôi test là:</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">\"aW2fSskgCyZ20Fi6E68xRGl0%2FR%2FzeFWoWU5YdhgkVhB%2FMtWSsX0rf3JuRgsfPPgQXjYYNygaRSxRjXAmOcsjohN28JQJnjej0Grfpwx52cZ5qjIRdMfOS9aXdTmedpuJ7T99aObbv75D3dsPtdQ%3D--FW10HzOu9FIoKK%2B8--9sMKANggTvi%2BlBjFwpIHEg%3D%3D\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Sử dụng đoạn mã ta đã viết ở trên, ta giải mã ra được giá trị của cookies này là:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"session_id\"</span><span class=\"symbol\">:<span class=\"string\">\"52cc440e209ad03d306e550c2ca2dd78\"</span></span>,</span><br><span class=\"line\">  <span class=\"string\">\"_csrf_token\"</span><span class=\"symbol\">:<span class=\"string\">\"rD35dsIoJyf5MIRA54/ARQNMBAN0yKvfMU4RjCc9WD8=\"</span></span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Vậy trong lần đầu request tới 1 website ruby on rails, nó sẽ tạo ra cho chúng ta 1 session, session lúc khởi tạo không có giá trị gì ngoài <strong>session_id</strong> và <strong>_csrf_token</strong>.</p>\n<p><strong>Ủa sai sai, tôi nhớ là ngày xưa đi học được dạy rằng điểm khác biệt của session và cookies là session được lưu ở server còn cookies được lưu ở client cơ mà</strong></p>\n<p>Đúng, tôi cũng được học như vậy, nhưng đó không phải là cách mà rails xử lý, <strong>Rails được config mặc định là lưu session bằng cookies</strong>, nếu không muốn ta có thể lưu trên <strong>redis</strong>, <strong>database</strong>… Tuy nhiên nếu không thấy ngại vì giới hạn không quá <strong>4KB</strong> của cookies thì tôi không thấy lý do gì để chuyển vị trí lưu trữ của session đi cả. :smiley:</p>\n<p>Bây giờ tôi add thêm 1 giá trị vào session với câu lệnh <strong>session[:user_id] = 1</strong>, lúc này giá trị của cookies cũng thay đổi theo, lại decrypt ta thu được:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"session_id\"</span><span class=\"symbol\">:<span class=\"string\">\"52cc440e209ad03d306e550c2ca2dd78\"</span></span>,</span><br><span class=\"line\">  <span class=\"string\">\"_csrf_token\"</span><span class=\"symbol\">:<span class=\"string\">\"rD35dsIoJyf5MIRA54/ARQNMBAN0yKvfMU4RjCc9WD8=\"</span></span>,</span><br><span class=\"line\">  <span class=\"string\">\"user_id\"</span><span class=\"symbol\">:</span><span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Session bây giờ đã có thêm một key mới là <strong>user_id</strong> với giá trị là <strong>1</strong>. À vậy cuối cùng thì session cũng là 1 <strong>hash</strong> thôi nhỉ.</p>\n<h2 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận\"></a>Kết luận</h2><p>Để phân biệt các client khác nhau, server sẽ dựa vào <strong>session_id</strong> được lưu trong cookies, vì vậy nếu chiếm được cookies đăng nhập trên website ABC.com của bạn, các hacker có thể dùng nó để giả mạo bạn và request lên server, đáng buồn thay server sẽ đọc cookies được hacker request lên, sử dụng <strong>secret_key_base</strong> để giải mã cookies và đọc nội dung bên trong, đoạn code xử lý login lại đọc từ session[:user_id], lúc này thì cookies kia có giá trị <strong>session[:user_id] = 1</strong> và thế là server đã tưởng rằng hacker chính là bạn.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p><strong>session[:user_id] = @user.id</strong>, dòng code này thật quen thuộc? khi làm chức năng đăng nhập trong những ngày nhập môn, hẳn ai cũng đã từng làm qua hoặc làm gần giống như vậy, ta được dạy rằng, <strong>http</strong> là 1 giao thức không có trạng thái nên request thứ <strong>N + 1</strong> sẽ chẳng thể biết được request thứ <strong>N</strong> đã làm gì, vậy nếu ở lần request thứ <strong>N</strong> chúng ta đã thực hiện hành vi đăng nhập, và <strong>http</strong> thì không có lưu vết lại điều đó, hệ quả là ở lần request tiếp theo, website hiểu như bạn chưa đăng nhập, rất đáng buồn.</p>\n<p>Do you familiar with the logic below:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">session[<span class=\"symbol\">:user_id</span>] = @user.id</span><br></pre></td></tr></table></figure>\n\n<p>Cũng theo những gì được dạy, <strong>session/cookies</strong> được tạo ra với mục đích làm cho http request có “trạng thái”. Vì sao lại để từ trạng thái trong nháy kép, vì thực sự là <strong>http</strong> không bao giờ có trạng thái cả, mà <strong>session/cookies</strong> với khả năng lưu vết của mình có thể giúp website nắm được một số <strong>thông tin</strong> từ client đã request trước đó và làm chúng giống như <strong>http</strong> đã có trạng thái.</p>\n<p>Quá mơ hồ? đúng vậy, khi được dạy điều này tôi cũng thấy thật mơ hồ, wth is trạng thái? phi trạng thái? lưu vết?… Hy vọng bài viết này sẽ giúp người đọc có 1 cái nhìn dễ hiểu hơn về 2 đối tượng này trong ruby on rails.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Flow-hoat-dong\"><a href=\"#1-Flow-hoat-dong\" class=\"headerlink\" title=\"1. Flow hoạt động\"></a>1. Flow hoạt động</h2><p>Một cách ngắn gọn cookies sẽ được vận hành như sau:</p>\n<p><strong>Step 1</strong>: Lần đầu bạn request đến web ABC.com, nhẹ nhàng tựa mây bay, bạn không mang theo thông tin gì của ABC.com cả</p>\n<p><strong>Step 2</strong>: ABC.com nhận request của bạn, nó nhận ra bạn không mang theo cookies của website, nên nó trong response trả về nó set một hoặc một vài cookies mặc định cho bạn.</p>\n<p><strong>Step 3</strong>: Bạn nhận được response của ABC.com, rồi bạn tiếp tục request lên ABC.com lần thứ 2, lần này đi theo request của bạn là toàn bộ số cookies đã được khởi tạo ở bước 2.</p>\n<p><strong>Step 4</strong>: ABC.com lại nhận được request của bạn, và lần này nó đã thấy bạn mang cookies của ABC.com nên nó sẽ đọc nội dung trong cookies đó (nếu cần).</p>\n<h2 id=\"2-Mot-vai-loai-cookies-quan-trong-trong-rails\"><a href=\"#2-Mot-vai-loai-cookies-quan-trong-trong-rails\" class=\"headerlink\" title=\"2. Một vài loại cookies quan trọng trong rails\"></a>2. Một vài loại cookies quan trọng trong rails</h2><ol>\n<li><p><strong>Normal cookies</strong>: Một dạng cookie mà dữ liệu được lưu trữ dưới dạng text.</p>\n</li>\n<li><p><strong>Signed cookies</strong>: Một dạng cookie mà dữ liệu lưu trữ sẽ được “ký” bởi 1 <strong>digest</strong>, và <strong>digest</strong> này được tạo ra bởi <strong>secret_key_base</strong> trong app của bạn, sau đó nó sẽ được chuyển sang dạng <strong>base64</strong> code. Điều này có nghĩa là nếu ai đó có được <strong>signed cookies</strong> của bạn, thì họ hoàn toàn có thể đọc được nội dung bên trong (decode base64 là có thể đọc được). Tuy nhiên nếu họ sửa lại nội dung của cookies đó và gửi lên server thì lúc này, cookies này trở thành 1 cookies không hợp lệ, vì sao? Vì như đã trình bày, nó được ký bởi 1 digest sinh ra qua <strong>secret_key_base</strong>, vậy nên cookies loại này nếu bị sửa đổi nội dung ở client thì khi kiểm tra tính toàn vẹn trên server thông qua digest sẽ không còn đúng nữa. Và nó trở thành 1 cookies không hợp lệ.</p>\n</li>\n<li><p><strong>Encrypted cookies</strong>: Một dạng cookies mà dữ liệu được mã hóa qua một quá trình mã hóa với 1 khóa quan trọng là <strong>secret_key_base</strong>, một cách đơn giản nhất để hiểu là không có <strong>secret_key_base</strong> thì ta không thể nào <strong>đọc</strong> hay sửa đổi dữ liệu của cookies này được.</p>\n</li>\n</ol>\n<p>Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cookies.signed[<span class=\"symbol\">:signed</span>] = <span class=\"string\">\"Duy Chinh\"</span></span><br><span class=\"line\">cookies.encrypted[<span class=\"symbol\">:encrypted</span>] = <span class=\"string\">\"Duy Chinh\"</span></span><br><span class=\"line\">cookies[<span class=\"symbol\">:normal</span>] = <span class=\"string\">\"Duy Chinh\"</span></span><br></pre></td></tr></table></figure>\n<p>Tôi đã tạo 3 cookies ứng với 3 dạng cookies nêu ở trên, giá trị của chúng đều giống nhau (đều được gán bằng “Duy Chinh”).</p>\n<p>Hãy xem giá trị ở client nhận được:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">normal = <span class=\"string\">\"Duy+Chinh\"</span></span><br><span class=\"line\">signed = <span class=\"string\">\"IkR1eSBDaGluaCI%3D--a3af2bfd61abcd20cc3b8ac714968d0aaf578fe5\"</span></span><br><span class=\"line\">encrypted = <span class=\"string\">\"%2BVulShtBgFR2I18%3D--zQP8FmCAW4%2FZUwar--CQ%2FH6HFHSVlox5H8QC4CTg%3D%3D\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Nhận xét:</p>\n<ol>\n<li><p>Kiểu cookies thông thường, dữ liệu lưu dạng text nên ở client ta dễ dàng đọc được nội dung cũng như sửa đổi dữ liệu của chúng.</p>\n</li>\n<li><p>Nhìn signed cookies và encrypted cookies đều không thân thiện với người dùng cuối, vì chúng gồm những ký tự không có ngữ nghĩa với end user.</p>\n</li>\n<li><p>Nếu decode <strong>base64</strong> ta thu được giá trị của signed cookies ở trên là: <strong>“Duy Chinh”7횿f߷횭Ƕч7oƜ뇴i繯Ǟ䀀</strong>, dù một số ký tự phía sau không thể hiểu được, tuy nhiên không quan trọng vì nội dung cookies vẫn được giải mã (đúng với tính chất, có thể đọc nhưng không thể sửa đổi).</p>\n</li>\n<li><p>Việc decode encrypted cookies là vô vọng khi không có <strong>secret_key_base</strong>.</p>\n</li>\n</ol>\n<p><strong>NOTE:</strong></p>\n<p>Việc sử dụng loại cookies nào sẽ đúng trong những trường hợp cụ thể, với những dữ liệu vô hại và không hề quan trọng thì sử dụng cookies thông thường và lưu mọi thứ dưới dạng text là khả dĩ hơn cả. Bỏ qua các bước mã hóa giúp nó hoạt động với performance tốt hơn hẳn 2 dạng cookies còn lại.<br>Ngược lại, encrypted cookies là dạng cookies tốn công sức để xử lý nhất, vì vậy hãy chỉ sử dụng nó cho những thông tin thực sự quan trọng và không thể để lộ (những thông tin bớt quan trọng hơn và chỉ cần đảm bảo tính toàn vẹn của dữ liệu chứ không cần bảo mật thông tin thì hãy dùng signed cookies).</p>\n<h2 id=\"3-Giai-ma-cookies-va-tim-hieu-ve-session-trong-rails\"><a href=\"#3-Giai-ma-cookies-va-tim-hieu-ve-session-trong-rails\" class=\"headerlink\" title=\"3. Giải mã cookies và tìm hiểu về session trong rails\"></a>3. Giải mã cookies và tìm hiểu về session trong rails</h2><p>Sau khá nhiều công sức tìm kiếm, tôi đã tìm ra cách để giải mã cookies trong rails 5.2, nội dung đơn giản như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'cgi'</span></span><br><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'active_support'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">verify_and_decrypt_session_cookie</span><span class=\"params\">(cookie, secret_key_base)</span></span></span><br><span class=\"line\">  cookie                  = CGI::unescape(cookie)</span><br><span class=\"line\">  salt                    = <span class=\"string\">'authenticated encrypted cookie'</span></span><br><span class=\"line\">  encrypted_cookie_cipher = <span class=\"string\">'aes-256-gcm'</span></span><br><span class=\"line\">  serializer              = ActiveSupport::MessageEncryptor::NullSerializer</span><br><span class=\"line\"></span><br><span class=\"line\">  key_generator           = ActiveSupport::KeyGenerator.new(secret_key_base, <span class=\"symbol\">iterations:</span> <span class=\"number\">1000</span>)</span><br><span class=\"line\">  key_len                 = ActiveSupport::MessageEncryptor.key_len(encrypted_cookie_cipher)</span><br><span class=\"line\">  secret                  = key_generator.generate_key(salt, key_len)</span><br><span class=\"line\">  encryptor               = ActiveSupport::MessageEncryptor.new(secret, <span class=\"symbol\">cipher:</span> encrypted_cookie_cipher, <span class=\"symbol\">serializer:</span> serializer)</span><br><span class=\"line\"></span><br><span class=\"line\">  encryptor.decrypt_and_verify(cookie)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">cookie         = <span class=\"string\">\"QkS0eMMxz8z0Kso%3D--4opNQwT5tGUsnn90--5fXye0VQJX%2BXMVkUmK69gw%3D%3D\"</span></span><br><span class=\"line\">skb            = <span class=\"string\">\"2fc48081a207cbe98379b2ed33b5072125d6f80a55997494b021bde37cec4d9c8f17f90357d6ade926b02a3bc271ccecaf6894af1410d6ef8f6c9b3b0d871fba\"</span></span><br><span class=\"line\">cookie_session = <span class=\"string\">\"ahp9AcIyl%2BhLvQW695lhNUCnI7bF2iNZY8e4bM%2B2Lrx%2FlnbVXkYF3nL493dMM7eslFJKAyBNJKZlY5ugZpUuznCxO%2BpNXudnOdQVuDyvVBLxA8gQ4t48Gs%2BqOS7e%2FlSjBedhFKAaoBRdVI06QL8%3D--enarz3Hu%2FZ2n1Ys%2B--YdTghGWd4ZFef9Lf7WM%2FMQ%3D%3D\"</span></span><br><span class=\"line\">puts verify_and_decrypt_session_cookie(cookie_session, skb)</span><br></pre></td></tr></table></figure>\n\n<p>Nội dung được tham khảo từ nhiều nguồn (vì không một nguồn cụ thể nào copy và chạy luôn được :unamused:), nhưng chủ yếu được tìm hiểu <a href=\"https://api.rubyonrails.org/classes/ActiveSupport/MessageEncryptor.html\" target=\"_blank\" rel=\"noopener\">tại đây</a>, các bạn có thể vào trang này để tìm hiểu kỹ hơn.</p>\n<p><strong>NOTE:</strong> Một điểm hết sức cần chú ý đó là biến <strong>skb</strong> tôi sử dụng ở trên chính là <strong>secret_key_base</strong> của project mà tôi sử dụng để demo, vì đây chỉ là một project test nên tôi có thể viết dạng text vào file sau đó commit lên github như này, trong tất cả các trường hợp khác thì đây là một hành động vô cùng <strong>tồi tệ</strong>, việc bị lộ <strong>secret_key_base</strong> sẽ khiến ứng dụng của bạn trần trụi trước hacker. Vậy nên hãy thật cẩn thận!</p>\n<p>Đoạn mã trên work tốt trên rails 5.2, chú ý là cách mã hóa ở các phiên bản rails khác nhau hoàn toàn có khả năng khác nhau, nên nếu đoạn mã này không thể chạy được với rails 4 chẳng hạn thì đó là điều hết sức bình thường.</p>\n<p>Trở lại vấn đề chính, nếu bạn để ý thì trong lần đầu tiên request khi bạn chưa hề làm gì và code trên server của bạn cũng chưa hề set bất kỳ giá trị cookies nào thì trong response trả về vẫn sẽ có một cookies (mà tôi đã nói ở trên, trong lần đầu request server sẽ khởi tạo và gửi về cho bạn một hoặc một vài cookies).</p>\n<p>Trong trường hợp này là một, cookies đó có thể có tên dạng <strong>_app_name_session</strong>. Nội dung của cookies này cũng được mã hóa, thử decode bằng <strong>base64</strong> không được ta có thể hiểu đây là 1 cookies đã được encrypted.</p>\n<p>Giá trị của cookies này trong trường hợp tôi test là:</p>\n<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">\"aW2fSskgCyZ20Fi6E68xRGl0%2FR%2FzeFWoWU5YdhgkVhB%2FMtWSsX0rf3JuRgsfPPgQXjYYNygaRSxRjXAmOcsjohN28JQJnjej0Grfpwx52cZ5qjIRdMfOS9aXdTmedpuJ7T99aObbv75D3dsPtdQ%3D--FW10HzOu9FIoKK%2B8--9sMKANggTvi%2BlBjFwpIHEg%3D%3D\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Sử dụng đoạn mã ta đã viết ở trên, ta giải mã ra được giá trị của cookies này là:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"session_id\"</span><span class=\"symbol\">:<span class=\"string\">\"52cc440e209ad03d306e550c2ca2dd78\"</span></span>,</span><br><span class=\"line\">  <span class=\"string\">\"_csrf_token\"</span><span class=\"symbol\">:<span class=\"string\">\"rD35dsIoJyf5MIRA54/ARQNMBAN0yKvfMU4RjCc9WD8=\"</span></span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Vậy trong lần đầu request tới 1 website ruby on rails, nó sẽ tạo ra cho chúng ta 1 session, session lúc khởi tạo không có giá trị gì ngoài <strong>session_id</strong> và <strong>_csrf_token</strong>.</p>\n<p><strong>Ủa sai sai, tôi nhớ là ngày xưa đi học được dạy rằng điểm khác biệt của session và cookies là session được lưu ở server còn cookies được lưu ở client cơ mà</strong></p>\n<p>Đúng, tôi cũng được học như vậy, nhưng đó không phải là cách mà rails xử lý, <strong>Rails được config mặc định là lưu session bằng cookies</strong>, nếu không muốn ta có thể lưu trên <strong>redis</strong>, <strong>database</strong>… Tuy nhiên nếu không thấy ngại vì giới hạn không quá <strong>4KB</strong> của cookies thì tôi không thấy lý do gì để chuyển vị trí lưu trữ của session đi cả. :smiley:</p>\n<p>Bây giờ tôi add thêm 1 giá trị vào session với câu lệnh <strong>session[:user_id] = 1</strong>, lúc này giá trị của cookies cũng thay đổi theo, lại decrypt ta thu được:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"string\">\"session_id\"</span><span class=\"symbol\">:<span class=\"string\">\"52cc440e209ad03d306e550c2ca2dd78\"</span></span>,</span><br><span class=\"line\">  <span class=\"string\">\"_csrf_token\"</span><span class=\"symbol\">:<span class=\"string\">\"rD35dsIoJyf5MIRA54/ARQNMBAN0yKvfMU4RjCc9WD8=\"</span></span>,</span><br><span class=\"line\">  <span class=\"string\">\"user_id\"</span><span class=\"symbol\">:</span><span class=\"number\">1</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Session bây giờ đã có thêm một key mới là <strong>user_id</strong> với giá trị là <strong>1</strong>. À vậy cuối cùng thì session cũng là 1 <strong>hash</strong> thôi nhỉ.</p>\n<h2 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận\"></a>Kết luận</h2><p>Để phân biệt các client khác nhau, server sẽ dựa vào <strong>session_id</strong> được lưu trong cookies, vì vậy nếu chiếm được cookies đăng nhập trên website ABC.com của bạn, các hacker có thể dùng nó để giả mạo bạn và request lên server, đáng buồn thay server sẽ đọc cookies được hacker request lên, sử dụng <strong>secret_key_base</strong> để giải mã cookies và đọc nội dung bên trong, đoạn code xử lý login lại đọc từ session[:user_id], lúc này thì cookies kia có giá trị <strong>session[:user_id] = 1</strong> và thế là server đã tưởng rằng hacker chính là bạn.</p>\n"},{"title":"Cập Nhật Dữ Liệu Với ActiveRecord","date":"2019-05-07T17:00:00.000Z","draft":false,"label":"#til","_content":"\n## Đặt vấn đề\n\nNgoài phương thức thông dụng **update** để cập nhật dữ liệu. Rails nói chung hay Activerecord nói riêng còn cung cấp 1 số phương thức khác để thay đổi dữ liệu hiện có, hãy cùng tìm hiểu về chúng.\n\n## Luận bàn\n\n**Chuẩn bị:**\n\n1. Tôi có một model **Cat** với 2 thuộc tính là **age** và **name**.\n\n2. Trong model Cat tôi có 1 **validation** và 1 **callback** đơn giản.\n\n**Để so sánh các phương thức chúng ta chú ý đến một số điểm sau:**\n\n1. Phương thức nhận một field cần update hay nhiều field?\n\n2. Phương thức update được cho một hay nhiều record?\n\n3. Validate method có chạy hay không?\n\n4. Callback có chạy hay không?\n\n5. Trường update_at có được cập nhật hay không?\n\n## 1. Phương thức update\n\n**Instance method:**\n\nLà phương thức được gọi thông qua một instance. Ta truyền vào field name cần cập nhật và giá trị mới sau cập nhật. Ta có thể truyền tham số dưới dạng hash.\n\nVí dụ:\n\n```ruby\ncat = Cat.first\ncat.update(name: 'change name')\n```\n\nNhiều tham số\n\n```ruby\ncat = Cat.first\ncat.update(name: 'change name', age: 100)\n```\n\nTruyền dưới dạng hash\n\n```ruby\ncat = Cat.first\ncat.update({:name => 'change name', :age => 1})\n```\n\n**Class method**\n\nLà phương thức được gọi thông qua class model. Nhận vào 2 tham số, thứ nhất là id hoặc một mảng các id của record thuộc class cần cập nhật, thứ hai là một hash key-value các field name cần cập nhật và giá trị của chúng sau cập nhật.\n\nCập nhật 1 record\n\n```ruby\nCat.update(1, {:name => 'change name'})\n```\n\nCập nhật nhiều record\n\n```ruby\nCat.update([1, 2, 3], {:name => 'change name'})\n```\n\nNote:\n\n1. Trường updated_at đều được cập nhật lại khi dùng 2 phương thức trên.\n\n2. Validate và callback đều được chạy.\n\n3. Class method **update** thì có thể cập nhật nhiều record một lúc.\n\n## 2. Phương thức update_attribute và update_attributes\n\nPhương thức update_attribute nhận 2 tham số truyền vào, với tham số thứ nhất là field cần cập nhật và tham số thứ 2 là giá trị cập nhật (Khác với update, thì tham số truyền vào không thể để dưới dạng hash).\n\n```ruby\ncat = Cat.first\ncat.update_attribute(:name, 'change name')\n```\n\nPhương thức update_attributes khác với update_attribute là nó nhận 1 tham số chứ không phải 2. Ta truyền tham số dưới hạng một hash cho phương này với giá trị key-value tương ứng field cần update và giá trị cần cập nhật.\n\n```ruby\ncat = Cat.first\ncat.update_attributes({ :name => 'change name', :age => 20 })\n# cách khác\ncat.update_attributes({ name: 'meo tam the 2', age: 20 })\n```\n\nNote:\n\n1. Trường updated_at có được cập nhật lại.\n\n2. Callback vẫn chạy nhưng **không** chạy validate.\n\n3. update_attribute dùng cho cập nhật 1 field còn update_attributes cần khi cập nhật nhiều field.\n\n## 3. Phương update_column và update_columns\n\nPhương thức update_column có cú pháp giống như update_attribute, còn phương thức update_columns thì có cú pháp tương tự như update_attributes.\n\n```ruby\ncat = Cat.first\ncat.update_column(:name, 'change name')\n\n# với update_columns\ncat.update_columns(name: 'change name', age: 10)\n# or\ncat.update_columns(:name => 'change name', :age => 10)\n```\n\nTuy nhiên ta có một số điểm khác biệt cơ bản cần lưu ý với update_attribute và update_attributes cần lưu ý.\n\nNote: Với phương thức update_column và update_columns\n\n1. Trường updated_at không được cập nhật.\n\n2. Callback và validate đều **không** được chạy.\n\n## Kết luận\n\nCách đây ít lâu tôi có làm 1 ứng dụng nhỏ, trong đó có một model chính gọi là X, trong model này tôi có viết một callback tên Y được thực hiện sau khi record được save (với method after_save). Trong callback Y tôi sử dụng method **update**.\n\nĐáng buồn thay là đoạn code của tôi không hoạt động một cách bình thường, sau khi save record thì terminal bị crash với một vòng lặp bất tận, chợt nhận ra là khi sử dụng **update** thì callback được gọi lại, vậy là nó tạo ra một vòng lặp vĩnh viễn, save record(1) -> callback được gọi(2) -> trong callback có phương thức update(3) -> update được gọi(4) -> update lại gọi lại callback(2).\nĐể khắc phục thì cần chuyển **update** thành **update_column** hoặc **update_columns**.\n","source":"_posts/2019-05-08-phan-biet-update-update-column-va-update-attribute-trong-rails.md","raw":"---\ntitle: \"Cập Nhật Dữ Liệu Với ActiveRecord\"\ndate: 2019-05-08\ndraft: false\ntags: [\"RAILS\"]\nlabel: \"#til\"\n---\n\n## Đặt vấn đề\n\nNgoài phương thức thông dụng **update** để cập nhật dữ liệu. Rails nói chung hay Activerecord nói riêng còn cung cấp 1 số phương thức khác để thay đổi dữ liệu hiện có, hãy cùng tìm hiểu về chúng.\n\n## Luận bàn\n\n**Chuẩn bị:**\n\n1. Tôi có một model **Cat** với 2 thuộc tính là **age** và **name**.\n\n2. Trong model Cat tôi có 1 **validation** và 1 **callback** đơn giản.\n\n**Để so sánh các phương thức chúng ta chú ý đến một số điểm sau:**\n\n1. Phương thức nhận một field cần update hay nhiều field?\n\n2. Phương thức update được cho một hay nhiều record?\n\n3. Validate method có chạy hay không?\n\n4. Callback có chạy hay không?\n\n5. Trường update_at có được cập nhật hay không?\n\n## 1. Phương thức update\n\n**Instance method:**\n\nLà phương thức được gọi thông qua một instance. Ta truyền vào field name cần cập nhật và giá trị mới sau cập nhật. Ta có thể truyền tham số dưới dạng hash.\n\nVí dụ:\n\n```ruby\ncat = Cat.first\ncat.update(name: 'change name')\n```\n\nNhiều tham số\n\n```ruby\ncat = Cat.first\ncat.update(name: 'change name', age: 100)\n```\n\nTruyền dưới dạng hash\n\n```ruby\ncat = Cat.first\ncat.update({:name => 'change name', :age => 1})\n```\n\n**Class method**\n\nLà phương thức được gọi thông qua class model. Nhận vào 2 tham số, thứ nhất là id hoặc một mảng các id của record thuộc class cần cập nhật, thứ hai là một hash key-value các field name cần cập nhật và giá trị của chúng sau cập nhật.\n\nCập nhật 1 record\n\n```ruby\nCat.update(1, {:name => 'change name'})\n```\n\nCập nhật nhiều record\n\n```ruby\nCat.update([1, 2, 3], {:name => 'change name'})\n```\n\nNote:\n\n1. Trường updated_at đều được cập nhật lại khi dùng 2 phương thức trên.\n\n2. Validate và callback đều được chạy.\n\n3. Class method **update** thì có thể cập nhật nhiều record một lúc.\n\n## 2. Phương thức update_attribute và update_attributes\n\nPhương thức update_attribute nhận 2 tham số truyền vào, với tham số thứ nhất là field cần cập nhật và tham số thứ 2 là giá trị cập nhật (Khác với update, thì tham số truyền vào không thể để dưới dạng hash).\n\n```ruby\ncat = Cat.first\ncat.update_attribute(:name, 'change name')\n```\n\nPhương thức update_attributes khác với update_attribute là nó nhận 1 tham số chứ không phải 2. Ta truyền tham số dưới hạng một hash cho phương này với giá trị key-value tương ứng field cần update và giá trị cần cập nhật.\n\n```ruby\ncat = Cat.first\ncat.update_attributes({ :name => 'change name', :age => 20 })\n# cách khác\ncat.update_attributes({ name: 'meo tam the 2', age: 20 })\n```\n\nNote:\n\n1. Trường updated_at có được cập nhật lại.\n\n2. Callback vẫn chạy nhưng **không** chạy validate.\n\n3. update_attribute dùng cho cập nhật 1 field còn update_attributes cần khi cập nhật nhiều field.\n\n## 3. Phương update_column và update_columns\n\nPhương thức update_column có cú pháp giống như update_attribute, còn phương thức update_columns thì có cú pháp tương tự như update_attributes.\n\n```ruby\ncat = Cat.first\ncat.update_column(:name, 'change name')\n\n# với update_columns\ncat.update_columns(name: 'change name', age: 10)\n# or\ncat.update_columns(:name => 'change name', :age => 10)\n```\n\nTuy nhiên ta có một số điểm khác biệt cơ bản cần lưu ý với update_attribute và update_attributes cần lưu ý.\n\nNote: Với phương thức update_column và update_columns\n\n1. Trường updated_at không được cập nhật.\n\n2. Callback và validate đều **không** được chạy.\n\n## Kết luận\n\nCách đây ít lâu tôi có làm 1 ứng dụng nhỏ, trong đó có một model chính gọi là X, trong model này tôi có viết một callback tên Y được thực hiện sau khi record được save (với method after_save). Trong callback Y tôi sử dụng method **update**.\n\nĐáng buồn thay là đoạn code của tôi không hoạt động một cách bình thường, sau khi save record thì terminal bị crash với một vòng lặp bất tận, chợt nhận ra là khi sử dụng **update** thì callback được gọi lại, vậy là nó tạo ra một vòng lặp vĩnh viễn, save record(1) -> callback được gọi(2) -> trong callback có phương thức update(3) -> update được gọi(4) -> update lại gọi lại callback(2).\nĐể khắc phục thì cần chuyển **update** thành **update_column** hoặc **update_columns**.\n","slug":"2019-05-08-phan-biet-update-update-column-va-update-attribute-trong-rails","published":1,"updated":"2022-01-29T09:29:59.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsar0019p3m27dy15vq3","content":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Ngoài phương thức thông dụng <strong>update</strong> để cập nhật dữ liệu. Rails nói chung hay Activerecord nói riêng còn cung cấp 1 số phương thức khác để thay đổi dữ liệu hiện có, hãy cùng tìm hiểu về chúng.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><p><strong>Chuẩn bị:</strong></p>\n<ol>\n<li><p>Tôi có một model <strong>Cat</strong> với 2 thuộc tính là <strong>age</strong> và <strong>name</strong>.</p>\n</li>\n<li><p>Trong model Cat tôi có 1 <strong>validation</strong> và 1 <strong>callback</strong> đơn giản.</p>\n</li>\n</ol>\n<p><strong>Để so sánh các phương thức chúng ta chú ý đến một số điểm sau:</strong></p>\n<ol>\n<li><p>Phương thức nhận một field cần update hay nhiều field?</p>\n</li>\n<li><p>Phương thức update được cho một hay nhiều record?</p>\n</li>\n<li><p>Validate method có chạy hay không?</p>\n</li>\n<li><p>Callback có chạy hay không?</p>\n</li>\n<li><p>Trường update_at có được cập nhật hay không?</p>\n</li>\n</ol>\n<h2 id=\"1-Phuong-thuc-update\"><a href=\"#1-Phuong-thuc-update\" class=\"headerlink\" title=\"1. Phương thức update\"></a>1. Phương thức update</h2><p><strong>Instance method:</strong></p>\n<p>Là phương thức được gọi thông qua một instance. Ta truyền vào field name cần cập nhật và giá trị mới sau cập nhật. Ta có thể truyền tham số dưới dạng hash.</p>\n<p>Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update(<span class=\"symbol\">name:</span> <span class=\"string\">'change name'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Nhiều tham số</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update(<span class=\"symbol\">name:</span> <span class=\"string\">'change name'</span>, <span class=\"symbol\">age:</span> <span class=\"number\">100</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Truyền dưới dạng hash</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update(&#123;<span class=\"symbol\">:name</span> =&gt; <span class=\"string\">'change name'</span>, <span class=\"symbol\">:age</span> =&gt; <span class=\"number\">1</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><strong>Class method</strong></p>\n<p>Là phương thức được gọi thông qua class model. Nhận vào 2 tham số, thứ nhất là id hoặc một mảng các id của record thuộc class cần cập nhật, thứ hai là một hash key-value các field name cần cập nhật và giá trị của chúng sau cập nhật.</p>\n<p>Cập nhật 1 record</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cat.update(<span class=\"number\">1</span>, &#123;<span class=\"symbol\">:name</span> =&gt; <span class=\"string\">'change name'</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Cập nhật nhiều record</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cat.update([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>], &#123;<span class=\"symbol\">:name</span> =&gt; <span class=\"string\">'change name'</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Note:</p>\n<ol>\n<li><p>Trường updated_at đều được cập nhật lại khi dùng 2 phương thức trên.</p>\n</li>\n<li><p>Validate và callback đều được chạy.</p>\n</li>\n<li><p>Class method <strong>update</strong> thì có thể cập nhật nhiều record một lúc.</p>\n</li>\n</ol>\n<h2 id=\"2-Phuong-thuc-update-attribute-va-update-attributes\"><a href=\"#2-Phuong-thuc-update-attribute-va-update-attributes\" class=\"headerlink\" title=\"2. Phương thức update_attribute và update_attributes\"></a>2. Phương thức update_attribute và update_attributes</h2><p>Phương thức update_attribute nhận 2 tham số truyền vào, với tham số thứ nhất là field cần cập nhật và tham số thứ 2 là giá trị cập nhật (Khác với update, thì tham số truyền vào không thể để dưới dạng hash).</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update_attribute(<span class=\"symbol\">:name</span>, <span class=\"string\">'change name'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Phương thức update_attributes khác với update_attribute là nó nhận 1 tham số chứ không phải 2. Ta truyền tham số dưới hạng một hash cho phương này với giá trị key-value tương ứng field cần update và giá trị cần cập nhật.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update_attributes(&#123; <span class=\"symbol\">:name</span> =&gt; <span class=\"string\">'change name'</span>, <span class=\"symbol\">:age</span> =&gt; <span class=\"number\">20</span> &#125;)</span><br><span class=\"line\"><span class=\"comment\"># cách khác</span></span><br><span class=\"line\">cat.update_attributes(&#123; <span class=\"symbol\">name:</span> <span class=\"string\">'meo tam the 2'</span>, <span class=\"symbol\">age:</span> <span class=\"number\">20</span> &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Note:</p>\n<ol>\n<li><p>Trường updated_at có được cập nhật lại.</p>\n</li>\n<li><p>Callback vẫn chạy nhưng <strong>không</strong> chạy validate.</p>\n</li>\n<li><p>update_attribute dùng cho cập nhật 1 field còn update_attributes cần khi cập nhật nhiều field.</p>\n</li>\n</ol>\n<h2 id=\"3-Phuong-update-column-va-update-columns\"><a href=\"#3-Phuong-update-column-va-update-columns\" class=\"headerlink\" title=\"3. Phương update_column và update_columns\"></a>3. Phương update_column và update_columns</h2><p>Phương thức update_column có cú pháp giống như update_attribute, còn phương thức update_columns thì có cú pháp tương tự như update_attributes.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update_column(<span class=\"symbol\">:name</span>, <span class=\"string\">'change name'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># với update_columns</span></span><br><span class=\"line\">cat.update_columns(<span class=\"symbol\">name:</span> <span class=\"string\">'change name'</span>, <span class=\"symbol\">age:</span> <span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"comment\"># or</span></span><br><span class=\"line\">cat.update_columns(<span class=\"symbol\">:name</span> =&gt; <span class=\"string\">'change name'</span>, <span class=\"symbol\">:age</span> =&gt; <span class=\"number\">10</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Tuy nhiên ta có một số điểm khác biệt cơ bản cần lưu ý với update_attribute và update_attributes cần lưu ý.</p>\n<p>Note: Với phương thức update_column và update_columns</p>\n<ol>\n<li><p>Trường updated_at không được cập nhật.</p>\n</li>\n<li><p>Callback và validate đều <strong>không</strong> được chạy.</p>\n</li>\n</ol>\n<h2 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận\"></a>Kết luận</h2><p>Cách đây ít lâu tôi có làm 1 ứng dụng nhỏ, trong đó có một model chính gọi là X, trong model này tôi có viết một callback tên Y được thực hiện sau khi record được save (với method after_save). Trong callback Y tôi sử dụng method <strong>update</strong>.</p>\n<p>Đáng buồn thay là đoạn code của tôi không hoạt động một cách bình thường, sau khi save record thì terminal bị crash với một vòng lặp bất tận, chợt nhận ra là khi sử dụng <strong>update</strong> thì callback được gọi lại, vậy là nó tạo ra một vòng lặp vĩnh viễn, save record(1) -&gt; callback được gọi(2) -&gt; trong callback có phương thức update(3) -&gt; update được gọi(4) -&gt; update lại gọi lại callback(2).<br>Để khắc phục thì cần chuyển <strong>update</strong> thành <strong>update_column</strong> hoặc <strong>update_columns</strong>.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Ngoài phương thức thông dụng <strong>update</strong> để cập nhật dữ liệu. Rails nói chung hay Activerecord nói riêng còn cung cấp 1 số phương thức khác để thay đổi dữ liệu hiện có, hãy cùng tìm hiểu về chúng.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><p><strong>Chuẩn bị:</strong></p>\n<ol>\n<li><p>Tôi có một model <strong>Cat</strong> với 2 thuộc tính là <strong>age</strong> và <strong>name</strong>.</p>\n</li>\n<li><p>Trong model Cat tôi có 1 <strong>validation</strong> và 1 <strong>callback</strong> đơn giản.</p>\n</li>\n</ol>\n<p><strong>Để so sánh các phương thức chúng ta chú ý đến một số điểm sau:</strong></p>\n<ol>\n<li><p>Phương thức nhận một field cần update hay nhiều field?</p>\n</li>\n<li><p>Phương thức update được cho một hay nhiều record?</p>\n</li>\n<li><p>Validate method có chạy hay không?</p>\n</li>\n<li><p>Callback có chạy hay không?</p>\n</li>\n<li><p>Trường update_at có được cập nhật hay không?</p>\n</li>\n</ol>\n<h2 id=\"1-Phuong-thuc-update\"><a href=\"#1-Phuong-thuc-update\" class=\"headerlink\" title=\"1. Phương thức update\"></a>1. Phương thức update</h2><p><strong>Instance method:</strong></p>\n<p>Là phương thức được gọi thông qua một instance. Ta truyền vào field name cần cập nhật và giá trị mới sau cập nhật. Ta có thể truyền tham số dưới dạng hash.</p>\n<p>Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update(<span class=\"symbol\">name:</span> <span class=\"string\">'change name'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Nhiều tham số</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update(<span class=\"symbol\">name:</span> <span class=\"string\">'change name'</span>, <span class=\"symbol\">age:</span> <span class=\"number\">100</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Truyền dưới dạng hash</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update(&#123;<span class=\"symbol\">:name</span> =&gt; <span class=\"string\">'change name'</span>, <span class=\"symbol\">:age</span> =&gt; <span class=\"number\">1</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><strong>Class method</strong></p>\n<p>Là phương thức được gọi thông qua class model. Nhận vào 2 tham số, thứ nhất là id hoặc một mảng các id của record thuộc class cần cập nhật, thứ hai là một hash key-value các field name cần cập nhật và giá trị của chúng sau cập nhật.</p>\n<p>Cập nhật 1 record</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cat.update(<span class=\"number\">1</span>, &#123;<span class=\"symbol\">:name</span> =&gt; <span class=\"string\">'change name'</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Cập nhật nhiều record</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cat.update([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>], &#123;<span class=\"symbol\">:name</span> =&gt; <span class=\"string\">'change name'</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Note:</p>\n<ol>\n<li><p>Trường updated_at đều được cập nhật lại khi dùng 2 phương thức trên.</p>\n</li>\n<li><p>Validate và callback đều được chạy.</p>\n</li>\n<li><p>Class method <strong>update</strong> thì có thể cập nhật nhiều record một lúc.</p>\n</li>\n</ol>\n<h2 id=\"2-Phuong-thuc-update-attribute-va-update-attributes\"><a href=\"#2-Phuong-thuc-update-attribute-va-update-attributes\" class=\"headerlink\" title=\"2. Phương thức update_attribute và update_attributes\"></a>2. Phương thức update_attribute và update_attributes</h2><p>Phương thức update_attribute nhận 2 tham số truyền vào, với tham số thứ nhất là field cần cập nhật và tham số thứ 2 là giá trị cập nhật (Khác với update, thì tham số truyền vào không thể để dưới dạng hash).</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update_attribute(<span class=\"symbol\">:name</span>, <span class=\"string\">'change name'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Phương thức update_attributes khác với update_attribute là nó nhận 1 tham số chứ không phải 2. Ta truyền tham số dưới hạng một hash cho phương này với giá trị key-value tương ứng field cần update và giá trị cần cập nhật.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update_attributes(&#123; <span class=\"symbol\">:name</span> =&gt; <span class=\"string\">'change name'</span>, <span class=\"symbol\">:age</span> =&gt; <span class=\"number\">20</span> &#125;)</span><br><span class=\"line\"><span class=\"comment\"># cách khác</span></span><br><span class=\"line\">cat.update_attributes(&#123; <span class=\"symbol\">name:</span> <span class=\"string\">'meo tam the 2'</span>, <span class=\"symbol\">age:</span> <span class=\"number\">20</span> &#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Note:</p>\n<ol>\n<li><p>Trường updated_at có được cập nhật lại.</p>\n</li>\n<li><p>Callback vẫn chạy nhưng <strong>không</strong> chạy validate.</p>\n</li>\n<li><p>update_attribute dùng cho cập nhật 1 field còn update_attributes cần khi cập nhật nhiều field.</p>\n</li>\n</ol>\n<h2 id=\"3-Phuong-update-column-va-update-columns\"><a href=\"#3-Phuong-update-column-va-update-columns\" class=\"headerlink\" title=\"3. Phương update_column và update_columns\"></a>3. Phương update_column và update_columns</h2><p>Phương thức update_column có cú pháp giống như update_attribute, còn phương thức update_columns thì có cú pháp tương tự như update_attributes.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat = Cat.first</span><br><span class=\"line\">cat.update_column(<span class=\"symbol\">:name</span>, <span class=\"string\">'change name'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># với update_columns</span></span><br><span class=\"line\">cat.update_columns(<span class=\"symbol\">name:</span> <span class=\"string\">'change name'</span>, <span class=\"symbol\">age:</span> <span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"comment\"># or</span></span><br><span class=\"line\">cat.update_columns(<span class=\"symbol\">:name</span> =&gt; <span class=\"string\">'change name'</span>, <span class=\"symbol\">:age</span> =&gt; <span class=\"number\">10</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Tuy nhiên ta có một số điểm khác biệt cơ bản cần lưu ý với update_attribute và update_attributes cần lưu ý.</p>\n<p>Note: Với phương thức update_column và update_columns</p>\n<ol>\n<li><p>Trường updated_at không được cập nhật.</p>\n</li>\n<li><p>Callback và validate đều <strong>không</strong> được chạy.</p>\n</li>\n</ol>\n<h2 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận\"></a>Kết luận</h2><p>Cách đây ít lâu tôi có làm 1 ứng dụng nhỏ, trong đó có một model chính gọi là X, trong model này tôi có viết một callback tên Y được thực hiện sau khi record được save (với method after_save). Trong callback Y tôi sử dụng method <strong>update</strong>.</p>\n<p>Đáng buồn thay là đoạn code của tôi không hoạt động một cách bình thường, sau khi save record thì terminal bị crash với một vòng lặp bất tận, chợt nhận ra là khi sử dụng <strong>update</strong> thì callback được gọi lại, vậy là nó tạo ra một vòng lặp vĩnh viễn, save record(1) -&gt; callback được gọi(2) -&gt; trong callback có phương thức update(3) -&gt; update được gọi(4) -&gt; update lại gọi lại callback(2).<br>Để khắc phục thì cần chuyển <strong>update</strong> thành <strong>update_column</strong> hoặc <strong>update_columns</strong>.</p>\n"},{"title":"Require Và Load Trong Ruby","date":"2019-05-14T17:00:00.000Z","draft":false,"mytag":"Ruby","mytrend":"COOL","_content":"## Đặt vấn đề\n\nKhác với rails, một framework đã có hỗ trợ autoloading, một chương trình ruby đơn thuần không có cơ chế đó. Để sử dụng những mã nguồn phụ thuộc ta phải \"gọi\" chúng tại file hiện tại bằng method **require** hoặc **load**. Ví dụ:\n\n```ruby\nrequire 'animal'\n\nclass Cat < Animal\n  def hello\n    @cat = Animal.new\n  end\nend\n```\n\nỞ một vấn đề khác trong ruby, đó là ngôn ngữ này không hỗ trợ đa kế thừa, thay vào đó chúng có 1 cơ chế gọi là **mixin** để có thể sử dụng các phương thức trong nhiều **moudle** khác nhau. Ta sử dụng 2 method là **include** và **extend** để hiện thực hoá điều này.\n\n## Luận bàn\n\n## 1. So sánh require và require_relative\n\nTrong tiêu đề bài viết không hề đề cập đến **require_relative** vậy sao giờ phải tìm hiểu về nó? Câu trả lời nằm ở cách mà phương thức **require** hoạt động.\n\nTrở lại ví dụ trong mục đặt vấn đề, giả sử cả 2 file **cat.rb** và **animal.rb** nằm trong cùng một thư mục:\n\n```\n- app\n  - cat.rb\n  - animal.rb\n```\n\nCâu hỏi đặt ra là liệu đoạn mã trong phần đặt vấn đề có work với cấu trúc file như này hay không? Có hoặc không, đó là câu trả lời.\n\nKhác với mường tượng ban đầu rằng phương thức require cũng sẽ bắt đầu tìm file từ thư mục gốc (thư mục chứa file gọi method) thì thực tế reuire tìm kiếm file bằng một cách khác.\n\nNó sẽ tìm đến biến global **$LOAD_PATH**, biến này là một đường dẫn, phương thức require sẽ tìm đến đường dẫn này và coi thư mục đó là gốc, nó sẽ tìm kiếm những file được requỉe bắt đầu từ thư mục đó. Trong lần đầu tiên nó tìm thấy thì ruby sẽ dừng chương trình ở đây và load file vừa tìm được lên. Nếu tìm hết các đường dẫn trong $LOAD_PATH và vẫn không thấy thì **LoadError** sẽ được gọi tới.\n\nTrở về với câu hỏi bên trên, đoạn code của chúng ta work khi biến **$LOAD_PATH** được định nghĩa, và nó là đường dẫn tới thư mục đang làm việc (chính là folder app).\n\nTrong tất cả các trường hợp còn lại, như khi biến này chưa được định nghĩa hay nó lại lại một đường dẫn đến một folder khác, thì đoạn mã khi đầu của chúng ta không thể chạy (vì require không tìm được file tương ứng theo yêu cầu).\n\nThứ bạn nhận được khi này chỉ là một thông báo lỗi **cannot load such file -- animal.rb (LoadError)**.\n\n**Giải quyết vấn đề trên bằng cách nào?**\n\nTa sẽ có thể dùng 2 cách:\n\nCách 1: Điền thêm thư mục đang làm việc vào giá trị của biến **$LOAD_PATH**, khi này thì đoạn mã chúng ta sẽ sửa lại như sau:\n\n```ruby\n# nối thêm đường dẫn thư mục hiện tại vào giá trị hiện tại của biến $LOAD_PATH\n$LOAD_PATH << File.join(File.dirname(__FILE__)\nrequire 'animal'\n\nclass Cat < Animal\n  def hello\n    @cat = Animal.new\n  end\nend\n```\n\nCách 2: Sử dụng **require_relative** thay thế cho require, sửa lại đoạn mã như sau:\n\n```ruby\nrequire_relative 'animal'\n\nclass Cat < Animal\n  def hello\n    @cat = Animal.new\n  end\nend\n```\n\nCả hai phương pháp trên đều hoạt động bình thường.\n\n> $: là một cách viết tắt cho $LOAD_PATH\n\n## 2. So sánh require và load\n\nNhư trong mục 1 đã nói vể require, thực chất load có cách hoạt động và mục đích sử dụng rất giống với require. Cả 2 đều được dùng đê \"gọi\" những đoạn mã cần thiết vào file hiện tại đang làm việc, như việc bạn muốn import thêm một file js vào file html đang làm việc nào đó.\n\nTuy nhiên giữa chúng có một điểm khác nhau cơ bản, mà từ đó đã dẫn tới một lời khuyên về việc sử dụng chúng như sau:\n\n```\nMoreover, Kernel#require loads files once, but development is much more smooth\nif code gets refreshed when it changes without restarting the server.\nIt would be nice to be able to use Kernel#load in development,\nand Kernel#require in production.\n```\n\n**- trích dẫn guides.rubyonrails -**\n\n:arrow_right: Điều rút ra ở đây là:\n\n:one: require sẽ đọc và load file được gọi một lần duy nhất.\n\n:two: load sẽ đọc và load file được gọi mỗi khi file đó được chạy.\n\nTừ đó dẫn đến việc là load sẽ hữu dụng khi làm việc tại môi trường development hơn, nơi mà thay đổi diễn ra liên tục, còn require thích hợp khi triển khai lên production.\n\nNote: Sau khi bạn chạy tới method require, nó sẽ đọc file bạn require và lưu tại bộ nhớ, những lần tiếp theo khi bạn chạy tới file đó, nó sẽ đọc nội dung từ bộ nhớ (mà nó đã lưu lại tại lần load đầu tiên), điều này giúp tăng performance vì không phải lood lại file lần nữa, nhưng đồng nghĩa với đó là những thay đổi sau đó tại file require sẽ không được load khi chạy.\n\n## 3. So sánh include và extend\n\nKhông có nhiều liên hệ với hai mục đầu, 2 phương thức được đề cập trong mục 3 để giải quyết bài tóan mixin trong ruby, như đã có lần tôi trình bày khái quát [tại đây](https://hdchinh.com/post/2019-02-24-ruby-method-lookup/).\n\nCó vẻ vì cao hứng chém gió title quá, mà tôi quên mất đã viết về hai phương thức này một lần, và hiện tại vẫn chưa có gì để bổ sung thêm, nếu cần hãy đọc lại bài viết tham khảo bên trên nhé.\n\n## Kết luận\n\nTham khảo:\n\n[1] [https://guides.rubyonrails.org/autoloading_and_reloading_constants.html](https://guides.rubyonrails.org/autoloading_and_reloading_constants.html)\n","source":"_posts/2019-05-15-require-load-include-va-extend-trong-ruby.md","raw":"---\ntitle: \"Require Và Load Trong Ruby\"\ndate: 2019-05-15\ndraft: false\ntags: [\"ruby\"]\ncategories: [\"ruby notes\"]\nmytag: \"Ruby\"\nmytrend: \"COOL\"\n\n---\n## Đặt vấn đề\n\nKhác với rails, một framework đã có hỗ trợ autoloading, một chương trình ruby đơn thuần không có cơ chế đó. Để sử dụng những mã nguồn phụ thuộc ta phải \"gọi\" chúng tại file hiện tại bằng method **require** hoặc **load**. Ví dụ:\n\n```ruby\nrequire 'animal'\n\nclass Cat < Animal\n  def hello\n    @cat = Animal.new\n  end\nend\n```\n\nỞ một vấn đề khác trong ruby, đó là ngôn ngữ này không hỗ trợ đa kế thừa, thay vào đó chúng có 1 cơ chế gọi là **mixin** để có thể sử dụng các phương thức trong nhiều **moudle** khác nhau. Ta sử dụng 2 method là **include** và **extend** để hiện thực hoá điều này.\n\n## Luận bàn\n\n## 1. So sánh require và require_relative\n\nTrong tiêu đề bài viết không hề đề cập đến **require_relative** vậy sao giờ phải tìm hiểu về nó? Câu trả lời nằm ở cách mà phương thức **require** hoạt động.\n\nTrở lại ví dụ trong mục đặt vấn đề, giả sử cả 2 file **cat.rb** và **animal.rb** nằm trong cùng một thư mục:\n\n```\n- app\n  - cat.rb\n  - animal.rb\n```\n\nCâu hỏi đặt ra là liệu đoạn mã trong phần đặt vấn đề có work với cấu trúc file như này hay không? Có hoặc không, đó là câu trả lời.\n\nKhác với mường tượng ban đầu rằng phương thức require cũng sẽ bắt đầu tìm file từ thư mục gốc (thư mục chứa file gọi method) thì thực tế reuire tìm kiếm file bằng một cách khác.\n\nNó sẽ tìm đến biến global **$LOAD_PATH**, biến này là một đường dẫn, phương thức require sẽ tìm đến đường dẫn này và coi thư mục đó là gốc, nó sẽ tìm kiếm những file được requỉe bắt đầu từ thư mục đó. Trong lần đầu tiên nó tìm thấy thì ruby sẽ dừng chương trình ở đây và load file vừa tìm được lên. Nếu tìm hết các đường dẫn trong $LOAD_PATH và vẫn không thấy thì **LoadError** sẽ được gọi tới.\n\nTrở về với câu hỏi bên trên, đoạn code của chúng ta work khi biến **$LOAD_PATH** được định nghĩa, và nó là đường dẫn tới thư mục đang làm việc (chính là folder app).\n\nTrong tất cả các trường hợp còn lại, như khi biến này chưa được định nghĩa hay nó lại lại một đường dẫn đến một folder khác, thì đoạn mã khi đầu của chúng ta không thể chạy (vì require không tìm được file tương ứng theo yêu cầu).\n\nThứ bạn nhận được khi này chỉ là một thông báo lỗi **cannot load such file -- animal.rb (LoadError)**.\n\n**Giải quyết vấn đề trên bằng cách nào?**\n\nTa sẽ có thể dùng 2 cách:\n\nCách 1: Điền thêm thư mục đang làm việc vào giá trị của biến **$LOAD_PATH**, khi này thì đoạn mã chúng ta sẽ sửa lại như sau:\n\n```ruby\n# nối thêm đường dẫn thư mục hiện tại vào giá trị hiện tại của biến $LOAD_PATH\n$LOAD_PATH << File.join(File.dirname(__FILE__)\nrequire 'animal'\n\nclass Cat < Animal\n  def hello\n    @cat = Animal.new\n  end\nend\n```\n\nCách 2: Sử dụng **require_relative** thay thế cho require, sửa lại đoạn mã như sau:\n\n```ruby\nrequire_relative 'animal'\n\nclass Cat < Animal\n  def hello\n    @cat = Animal.new\n  end\nend\n```\n\nCả hai phương pháp trên đều hoạt động bình thường.\n\n> $: là một cách viết tắt cho $LOAD_PATH\n\n## 2. So sánh require và load\n\nNhư trong mục 1 đã nói vể require, thực chất load có cách hoạt động và mục đích sử dụng rất giống với require. Cả 2 đều được dùng đê \"gọi\" những đoạn mã cần thiết vào file hiện tại đang làm việc, như việc bạn muốn import thêm một file js vào file html đang làm việc nào đó.\n\nTuy nhiên giữa chúng có một điểm khác nhau cơ bản, mà từ đó đã dẫn tới một lời khuyên về việc sử dụng chúng như sau:\n\n```\nMoreover, Kernel#require loads files once, but development is much more smooth\nif code gets refreshed when it changes without restarting the server.\nIt would be nice to be able to use Kernel#load in development,\nand Kernel#require in production.\n```\n\n**- trích dẫn guides.rubyonrails -**\n\n:arrow_right: Điều rút ra ở đây là:\n\n:one: require sẽ đọc và load file được gọi một lần duy nhất.\n\n:two: load sẽ đọc và load file được gọi mỗi khi file đó được chạy.\n\nTừ đó dẫn đến việc là load sẽ hữu dụng khi làm việc tại môi trường development hơn, nơi mà thay đổi diễn ra liên tục, còn require thích hợp khi triển khai lên production.\n\nNote: Sau khi bạn chạy tới method require, nó sẽ đọc file bạn require và lưu tại bộ nhớ, những lần tiếp theo khi bạn chạy tới file đó, nó sẽ đọc nội dung từ bộ nhớ (mà nó đã lưu lại tại lần load đầu tiên), điều này giúp tăng performance vì không phải lood lại file lần nữa, nhưng đồng nghĩa với đó là những thay đổi sau đó tại file require sẽ không được load khi chạy.\n\n## 3. So sánh include và extend\n\nKhông có nhiều liên hệ với hai mục đầu, 2 phương thức được đề cập trong mục 3 để giải quyết bài tóan mixin trong ruby, như đã có lần tôi trình bày khái quát [tại đây](https://hdchinh.com/post/2019-02-24-ruby-method-lookup/).\n\nCó vẻ vì cao hứng chém gió title quá, mà tôi quên mất đã viết về hai phương thức này một lần, và hiện tại vẫn chưa có gì để bổ sung thêm, nếu cần hãy đọc lại bài viết tham khảo bên trên nhé.\n\n## Kết luận\n\nTham khảo:\n\n[1] [https://guides.rubyonrails.org/autoloading_and_reloading_constants.html](https://guides.rubyonrails.org/autoloading_and_reloading_constants.html)\n","slug":"2019-05-15-require-load-include-va-extend-trong-ruby","published":1,"updated":"2022-01-29T09:29:59.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsat001cp3m25opih4xm","content":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Khác với rails, một framework đã có hỗ trợ autoloading, một chương trình ruby đơn thuần không có cơ chế đó. Để sử dụng những mã nguồn phụ thuộc ta phải “gọi” chúng tại file hiện tại bằng method <strong>require</strong> hoặc <strong>load</strong>. Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'animal'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    @cat = Animal.new</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Ở một vấn đề khác trong ruby, đó là ngôn ngữ này không hỗ trợ đa kế thừa, thay vào đó chúng có 1 cơ chế gọi là <strong>mixin</strong> để có thể sử dụng các phương thức trong nhiều <strong>moudle</strong> khác nhau. Ta sử dụng 2 method là <strong>include</strong> và <strong>extend</strong> để hiện thực hoá điều này.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-So-sanh-require-va-require-relative\"><a href=\"#1-So-sanh-require-va-require-relative\" class=\"headerlink\" title=\"1. So sánh require và require_relative\"></a>1. So sánh require và require_relative</h2><p>Trong tiêu đề bài viết không hề đề cập đến <strong>require_relative</strong> vậy sao giờ phải tìm hiểu về nó? Câu trả lời nằm ở cách mà phương thức <strong>require</strong> hoạt động.</p>\n<p>Trở lại ví dụ trong mục đặt vấn đề, giả sử cả 2 file <strong>cat.rb</strong> và <strong>animal.rb</strong> nằm trong cùng một thư mục:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>cat.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>animal.rb</span><br></pre></td></tr></table></figure>\n\n<p>Câu hỏi đặt ra là liệu đoạn mã trong phần đặt vấn đề có work với cấu trúc file như này hay không? Có hoặc không, đó là câu trả lời.</p>\n<p>Khác với mường tượng ban đầu rằng phương thức require cũng sẽ bắt đầu tìm file từ thư mục gốc (thư mục chứa file gọi method) thì thực tế reuire tìm kiếm file bằng một cách khác.</p>\n<p>Nó sẽ tìm đến biến global <strong>$LOAD_PATH</strong>, biến này là một đường dẫn, phương thức require sẽ tìm đến đường dẫn này và coi thư mục đó là gốc, nó sẽ tìm kiếm những file được requỉe bắt đầu từ thư mục đó. Trong lần đầu tiên nó tìm thấy thì ruby sẽ dừng chương trình ở đây và load file vừa tìm được lên. Nếu tìm hết các đường dẫn trong $LOAD_PATH và vẫn không thấy thì <strong>LoadError</strong> sẽ được gọi tới.</p>\n<p>Trở về với câu hỏi bên trên, đoạn code của chúng ta work khi biến <strong>$LOAD_PATH</strong> được định nghĩa, và nó là đường dẫn tới thư mục đang làm việc (chính là folder app).</p>\n<p>Trong tất cả các trường hợp còn lại, như khi biến này chưa được định nghĩa hay nó lại lại một đường dẫn đến một folder khác, thì đoạn mã khi đầu của chúng ta không thể chạy (vì require không tìm được file tương ứng theo yêu cầu).</p>\n<p>Thứ bạn nhận được khi này chỉ là một thông báo lỗi <strong>cannot load such file – animal.rb (LoadError)</strong>.</p>\n<p><strong>Giải quyết vấn đề trên bằng cách nào?</strong></p>\n<p>Ta sẽ có thể dùng 2 cách:</p>\n<p>Cách 1: Điền thêm thư mục đang làm việc vào giá trị của biến <strong>$LOAD_PATH</strong>, khi này thì đoạn mã chúng ta sẽ sửa lại như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nối thêm đường dẫn thư mục hiện tại vào giá trị hiện tại của biến $LOAD_PATH</span></span><br><span class=\"line\">$LOAD_PATH &lt;&lt; File.join(File.dirname(__FILE_<span class=\"number\">_</span>)</span><br><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'animal'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    @cat = Animal.new</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Cách 2: Sử dụng <strong>require_relative</strong> thay thế cho require, sửa lại đoạn mã như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">require_relative <span class=\"string\">'animal'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    @cat = Animal.new</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Cả hai phương pháp trên đều hoạt động bình thường.</p>\n<blockquote>\n<p>$: là một cách viết tắt cho $LOAD_PATH</p>\n</blockquote>\n<h2 id=\"2-So-sanh-require-va-load\"><a href=\"#2-So-sanh-require-va-load\" class=\"headerlink\" title=\"2. So sánh require và load\"></a>2. So sánh require và load</h2><p>Như trong mục 1 đã nói vể require, thực chất load có cách hoạt động và mục đích sử dụng rất giống với require. Cả 2 đều được dùng đê “gọi” những đoạn mã cần thiết vào file hiện tại đang làm việc, như việc bạn muốn import thêm một file js vào file html đang làm việc nào đó.</p>\n<p>Tuy nhiên giữa chúng có một điểm khác nhau cơ bản, mà từ đó đã dẫn tới một lời khuyên về việc sử dụng chúng như sau:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Moreover, Kernel<span class=\"comment\">#require loads files once, but development is much more smooth</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> code gets refreshed when <span class=\"keyword\">it</span> changes <span class=\"keyword\">without</span> restarting <span class=\"keyword\">the</span> server.</span><br><span class=\"line\">It would be nice <span class=\"built_in\">to</span> be able <span class=\"built_in\">to</span> use Kernel<span class=\"comment\">#load in development,</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> Kernel<span class=\"comment\">#require in production.</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>- trích dẫn guides.rubyonrails -</strong></p>\n<p>:arrow_right: Điều rút ra ở đây là:</p>\n<p>:one: require sẽ đọc và load file được gọi một lần duy nhất.</p>\n<p>:two: load sẽ đọc và load file được gọi mỗi khi file đó được chạy.</p>\n<p>Từ đó dẫn đến việc là load sẽ hữu dụng khi làm việc tại môi trường development hơn, nơi mà thay đổi diễn ra liên tục, còn require thích hợp khi triển khai lên production.</p>\n<p>Note: Sau khi bạn chạy tới method require, nó sẽ đọc file bạn require và lưu tại bộ nhớ, những lần tiếp theo khi bạn chạy tới file đó, nó sẽ đọc nội dung từ bộ nhớ (mà nó đã lưu lại tại lần load đầu tiên), điều này giúp tăng performance vì không phải lood lại file lần nữa, nhưng đồng nghĩa với đó là những thay đổi sau đó tại file require sẽ không được load khi chạy.</p>\n<h2 id=\"3-So-sanh-include-va-extend\"><a href=\"#3-So-sanh-include-va-extend\" class=\"headerlink\" title=\"3. So sánh include và extend\"></a>3. So sánh include và extend</h2><p>Không có nhiều liên hệ với hai mục đầu, 2 phương thức được đề cập trong mục 3 để giải quyết bài tóan mixin trong ruby, như đã có lần tôi trình bày khái quát <a href=\"https://hdchinh.com/post/2019-02-24-ruby-method-lookup/\" target=\"_blank\" rel=\"noopener\">tại đây</a>.</p>\n<p>Có vẻ vì cao hứng chém gió title quá, mà tôi quên mất đã viết về hai phương thức này một lần, và hiện tại vẫn chưa có gì để bổ sung thêm, nếu cần hãy đọc lại bài viết tham khảo bên trên nhé.</p>\n<h2 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận\"></a>Kết luận</h2><p>Tham khảo:</p>\n<p>[1] <a href=\"https://guides.rubyonrails.org/autoloading_and_reloading_constants.html\" target=\"_blank\" rel=\"noopener\">https://guides.rubyonrails.org/autoloading_and_reloading_constants.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Khác với rails, một framework đã có hỗ trợ autoloading, một chương trình ruby đơn thuần không có cơ chế đó. Để sử dụng những mã nguồn phụ thuộc ta phải “gọi” chúng tại file hiện tại bằng method <strong>require</strong> hoặc <strong>load</strong>. Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'animal'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    @cat = Animal.new</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Ở một vấn đề khác trong ruby, đó là ngôn ngữ này không hỗ trợ đa kế thừa, thay vào đó chúng có 1 cơ chế gọi là <strong>mixin</strong> để có thể sử dụng các phương thức trong nhiều <strong>moudle</strong> khác nhau. Ta sử dụng 2 method là <strong>include</strong> và <strong>extend</strong> để hiện thực hoá điều này.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-So-sanh-require-va-require-relative\"><a href=\"#1-So-sanh-require-va-require-relative\" class=\"headerlink\" title=\"1. So sánh require và require_relative\"></a>1. So sánh require và require_relative</h2><p>Trong tiêu đề bài viết không hề đề cập đến <strong>require_relative</strong> vậy sao giờ phải tìm hiểu về nó? Câu trả lời nằm ở cách mà phương thức <strong>require</strong> hoạt động.</p>\n<p>Trở lại ví dụ trong mục đặt vấn đề, giả sử cả 2 file <strong>cat.rb</strong> và <strong>animal.rb</strong> nằm trong cùng một thư mục:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>cat.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>animal.rb</span><br></pre></td></tr></table></figure>\n\n<p>Câu hỏi đặt ra là liệu đoạn mã trong phần đặt vấn đề có work với cấu trúc file như này hay không? Có hoặc không, đó là câu trả lời.</p>\n<p>Khác với mường tượng ban đầu rằng phương thức require cũng sẽ bắt đầu tìm file từ thư mục gốc (thư mục chứa file gọi method) thì thực tế reuire tìm kiếm file bằng một cách khác.</p>\n<p>Nó sẽ tìm đến biến global <strong>$LOAD_PATH</strong>, biến này là một đường dẫn, phương thức require sẽ tìm đến đường dẫn này và coi thư mục đó là gốc, nó sẽ tìm kiếm những file được requỉe bắt đầu từ thư mục đó. Trong lần đầu tiên nó tìm thấy thì ruby sẽ dừng chương trình ở đây và load file vừa tìm được lên. Nếu tìm hết các đường dẫn trong $LOAD_PATH và vẫn không thấy thì <strong>LoadError</strong> sẽ được gọi tới.</p>\n<p>Trở về với câu hỏi bên trên, đoạn code của chúng ta work khi biến <strong>$LOAD_PATH</strong> được định nghĩa, và nó là đường dẫn tới thư mục đang làm việc (chính là folder app).</p>\n<p>Trong tất cả các trường hợp còn lại, như khi biến này chưa được định nghĩa hay nó lại lại một đường dẫn đến một folder khác, thì đoạn mã khi đầu của chúng ta không thể chạy (vì require không tìm được file tương ứng theo yêu cầu).</p>\n<p>Thứ bạn nhận được khi này chỉ là một thông báo lỗi <strong>cannot load such file – animal.rb (LoadError)</strong>.</p>\n<p><strong>Giải quyết vấn đề trên bằng cách nào?</strong></p>\n<p>Ta sẽ có thể dùng 2 cách:</p>\n<p>Cách 1: Điền thêm thư mục đang làm việc vào giá trị của biến <strong>$LOAD_PATH</strong>, khi này thì đoạn mã chúng ta sẽ sửa lại như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># nối thêm đường dẫn thư mục hiện tại vào giá trị hiện tại của biến $LOAD_PATH</span></span><br><span class=\"line\">$LOAD_PATH &lt;&lt; File.join(File.dirname(__FILE_<span class=\"number\">_</span>)</span><br><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'animal'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    @cat = Animal.new</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Cách 2: Sử dụng <strong>require_relative</strong> thay thế cho require, sửa lại đoạn mã như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">require_relative <span class=\"string\">'animal'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span></span></span><br><span class=\"line\">    @cat = Animal.new</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Cả hai phương pháp trên đều hoạt động bình thường.</p>\n<blockquote>\n<p>$: là một cách viết tắt cho $LOAD_PATH</p>\n</blockquote>\n<h2 id=\"2-So-sanh-require-va-load\"><a href=\"#2-So-sanh-require-va-load\" class=\"headerlink\" title=\"2. So sánh require và load\"></a>2. So sánh require và load</h2><p>Như trong mục 1 đã nói vể require, thực chất load có cách hoạt động và mục đích sử dụng rất giống với require. Cả 2 đều được dùng đê “gọi” những đoạn mã cần thiết vào file hiện tại đang làm việc, như việc bạn muốn import thêm một file js vào file html đang làm việc nào đó.</p>\n<p>Tuy nhiên giữa chúng có một điểm khác nhau cơ bản, mà từ đó đã dẫn tới một lời khuyên về việc sử dụng chúng như sau:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Moreover, Kernel<span class=\"comment\">#require loads files once, but development is much more smooth</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> code gets refreshed when <span class=\"keyword\">it</span> changes <span class=\"keyword\">without</span> restarting <span class=\"keyword\">the</span> server.</span><br><span class=\"line\">It would be nice <span class=\"built_in\">to</span> be able <span class=\"built_in\">to</span> use Kernel<span class=\"comment\">#load in development,</span></span><br><span class=\"line\"><span class=\"keyword\">and</span> Kernel<span class=\"comment\">#require in production.</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>- trích dẫn guides.rubyonrails -</strong></p>\n<p>:arrow_right: Điều rút ra ở đây là:</p>\n<p>:one: require sẽ đọc và load file được gọi một lần duy nhất.</p>\n<p>:two: load sẽ đọc và load file được gọi mỗi khi file đó được chạy.</p>\n<p>Từ đó dẫn đến việc là load sẽ hữu dụng khi làm việc tại môi trường development hơn, nơi mà thay đổi diễn ra liên tục, còn require thích hợp khi triển khai lên production.</p>\n<p>Note: Sau khi bạn chạy tới method require, nó sẽ đọc file bạn require và lưu tại bộ nhớ, những lần tiếp theo khi bạn chạy tới file đó, nó sẽ đọc nội dung từ bộ nhớ (mà nó đã lưu lại tại lần load đầu tiên), điều này giúp tăng performance vì không phải lood lại file lần nữa, nhưng đồng nghĩa với đó là những thay đổi sau đó tại file require sẽ không được load khi chạy.</p>\n<h2 id=\"3-So-sanh-include-va-extend\"><a href=\"#3-So-sanh-include-va-extend\" class=\"headerlink\" title=\"3. So sánh include và extend\"></a>3. So sánh include và extend</h2><p>Không có nhiều liên hệ với hai mục đầu, 2 phương thức được đề cập trong mục 3 để giải quyết bài tóan mixin trong ruby, như đã có lần tôi trình bày khái quát <a href=\"https://hdchinh.com/post/2019-02-24-ruby-method-lookup/\" target=\"_blank\" rel=\"noopener\">tại đây</a>.</p>\n<p>Có vẻ vì cao hứng chém gió title quá, mà tôi quên mất đã viết về hai phương thức này một lần, và hiện tại vẫn chưa có gì để bổ sung thêm, nếu cần hãy đọc lại bài viết tham khảo bên trên nhé.</p>\n<h2 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận\"></a>Kết luận</h2><p>Tham khảo:</p>\n<p>[1] <a href=\"https://guides.rubyonrails.org/autoloading_and_reloading_constants.html\" target=\"_blank\" rel=\"noopener\">https://guides.rubyonrails.org/autoloading_and_reloading_constants.html</a></p>\n"},{"title":"Cơ Chế Autoloading Và Reloading","date":"2019-04-16T17:00:00.000Z","draft":false,"mytag":"#TIL","_content":"\n## Đặt vấn đề\n\n```ruby\nclass CatsController < ApplicationController\n  # do something\nend\n```\n\nĐoạn mã trên là một đoạn mã rất quen thuộc khi sử dụng rails framework, một câu hỏi đó là tại sao trong class CatsController không require file chưa class ApplicationController nhưng ta vẫn có thể sử dụng. Câu trả lời nằm ở việc rails có cơ chế autoloading một số folder nhất định để support cho việc coding và vận hành, bài viết này sẽ nêu một cách khái quát về giải pháp này trong rails.\n\n## Luận bàn\n\nNhư bài viết trước đã đề cập về cách mà phương thức require hoạt động:\n\n1. Tìm file được require theo các đường dẫn được lưu trong biến $LOAD_PATH (biến này là 1 mảng các đường dẫn).\n\n2. Khi tìm được file tương ứng thì dừng quá trình tìm file và bắt đầu load file tìm được vào bộ nhớ.\n\n3. Nếu tìm hết các đường dẫn và không thấy thì gọi tới LoadError.\n\n**autoload_paths** là một tập hợp các thư mục được tự động load mà không cần require. Mặc định thì autoload_paths sẽ chứa các thư mục sau:\n\n1. Tất cả các thư mục con cấp 1 của thư mục app, ví dụ như app/controllers, app/views...\n\n2. Tất cả các thư mục cấp 2 tên là concerns trong app, ví dụ như app/helpers/concerns, app/lib/concerns...\n\n3. Thư mục test/mailers/previews.\n\nTa có thể xem danh sách này bằng câu lệnh:\n\n**bin/rails r 'puts ActiveSupport::Dependencies.autoload_paths'**\n\n**eager_load_paths** hoàn toàn giống như khái niệm về autoload_paths đã nêu ở trên. Điểm chúng ta cần lưu ý đó là:\n\n1. Những thư mục nằm trong eager_load_paths sẽ được load một lần duy nhất TRƯỚC khi ứng dụng của bạn khởi chạy.\n\n2. Những thư mục nằm trong autoload_paths sẽ được sử dụng để tìm kiếm khi chương trình ĐANG CHẠY và gặp 1 từ khoá chưa được định nghĩa trong file hiện tại.\n\nTa có 2 từ in hoa, đó là phần quan trọng, để đảm bảo tính nhất quán và hoạt động một cách ổn định và chính xác, trong môi trường production ta sử dụng eager_load_paths để load toàn bộ những file cần thiết cho các hệ thống cần thì sử dụng, còn ở môi trường phát triển, để khởi chạy ứng dụng nhanh chóng hơn và dễ dàng cập nhật các thay đổi thì ta sử dụng autoload_paths.\n\nViệc thiết lập này phụ thuộc vào cấu hình của bạn trong thư mục **app/config/envirements/...** với 2 cấu hình là:\n\n1. config.cache_classes\n\n2. config.eager_load\n\n## Kết luận\n\nTham khảo:\n\n[1] [autoloading_and_reloading_constants](https://guides.rubyonrails.org/autoloading_and_reloading_constants.html)\n","source":"_posts/2019-05-16-autoloading-va-reloading-constants-trong-rails.md","raw":"---\ntitle: \"Cơ Chế Autoloading Và Reloading\"\ndate: 2019-04-17\ndraft: false\ntags: [\"rails\"]\ncategories: [\"rails notes\"]\nmytag: \"#TIL\"\n---\n\n## Đặt vấn đề\n\n```ruby\nclass CatsController < ApplicationController\n  # do something\nend\n```\n\nĐoạn mã trên là một đoạn mã rất quen thuộc khi sử dụng rails framework, một câu hỏi đó là tại sao trong class CatsController không require file chưa class ApplicationController nhưng ta vẫn có thể sử dụng. Câu trả lời nằm ở việc rails có cơ chế autoloading một số folder nhất định để support cho việc coding và vận hành, bài viết này sẽ nêu một cách khái quát về giải pháp này trong rails.\n\n## Luận bàn\n\nNhư bài viết trước đã đề cập về cách mà phương thức require hoạt động:\n\n1. Tìm file được require theo các đường dẫn được lưu trong biến $LOAD_PATH (biến này là 1 mảng các đường dẫn).\n\n2. Khi tìm được file tương ứng thì dừng quá trình tìm file và bắt đầu load file tìm được vào bộ nhớ.\n\n3. Nếu tìm hết các đường dẫn và không thấy thì gọi tới LoadError.\n\n**autoload_paths** là một tập hợp các thư mục được tự động load mà không cần require. Mặc định thì autoload_paths sẽ chứa các thư mục sau:\n\n1. Tất cả các thư mục con cấp 1 của thư mục app, ví dụ như app/controllers, app/views...\n\n2. Tất cả các thư mục cấp 2 tên là concerns trong app, ví dụ như app/helpers/concerns, app/lib/concerns...\n\n3. Thư mục test/mailers/previews.\n\nTa có thể xem danh sách này bằng câu lệnh:\n\n**bin/rails r 'puts ActiveSupport::Dependencies.autoload_paths'**\n\n**eager_load_paths** hoàn toàn giống như khái niệm về autoload_paths đã nêu ở trên. Điểm chúng ta cần lưu ý đó là:\n\n1. Những thư mục nằm trong eager_load_paths sẽ được load một lần duy nhất TRƯỚC khi ứng dụng của bạn khởi chạy.\n\n2. Những thư mục nằm trong autoload_paths sẽ được sử dụng để tìm kiếm khi chương trình ĐANG CHẠY và gặp 1 từ khoá chưa được định nghĩa trong file hiện tại.\n\nTa có 2 từ in hoa, đó là phần quan trọng, để đảm bảo tính nhất quán và hoạt động một cách ổn định và chính xác, trong môi trường production ta sử dụng eager_load_paths để load toàn bộ những file cần thiết cho các hệ thống cần thì sử dụng, còn ở môi trường phát triển, để khởi chạy ứng dụng nhanh chóng hơn và dễ dàng cập nhật các thay đổi thì ta sử dụng autoload_paths.\n\nViệc thiết lập này phụ thuộc vào cấu hình của bạn trong thư mục **app/config/envirements/...** với 2 cấu hình là:\n\n1. config.cache_classes\n\n2. config.eager_load\n\n## Kết luận\n\nTham khảo:\n\n[1] [autoloading_and_reloading_constants](https://guides.rubyonrails.org/autoloading_and_reloading_constants.html)\n","slug":"2019-05-16-autoloading-va-reloading-constants-trong-rails","published":1,"updated":"2022-01-29T09:29:59.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsau001gp3m20s2u9j6i","content":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CatsController</span> &lt; ApplicationController</span></span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đoạn mã trên là một đoạn mã rất quen thuộc khi sử dụng rails framework, một câu hỏi đó là tại sao trong class CatsController không require file chưa class ApplicationController nhưng ta vẫn có thể sử dụng. Câu trả lời nằm ở việc rails có cơ chế autoloading một số folder nhất định để support cho việc coding và vận hành, bài viết này sẽ nêu một cách khái quát về giải pháp này trong rails.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><p>Như bài viết trước đã đề cập về cách mà phương thức require hoạt động:</p>\n<ol>\n<li><p>Tìm file được require theo các đường dẫn được lưu trong biến $LOAD_PATH (biến này là 1 mảng các đường dẫn).</p>\n</li>\n<li><p>Khi tìm được file tương ứng thì dừng quá trình tìm file và bắt đầu load file tìm được vào bộ nhớ.</p>\n</li>\n<li><p>Nếu tìm hết các đường dẫn và không thấy thì gọi tới LoadError.</p>\n</li>\n</ol>\n<p><strong>autoload_paths</strong> là một tập hợp các thư mục được tự động load mà không cần require. Mặc định thì autoload_paths sẽ chứa các thư mục sau:</p>\n<ol>\n<li><p>Tất cả các thư mục con cấp 1 của thư mục app, ví dụ như app/controllers, app/views…</p>\n</li>\n<li><p>Tất cả các thư mục cấp 2 tên là concerns trong app, ví dụ như app/helpers/concerns, app/lib/concerns…</p>\n</li>\n<li><p>Thư mục test/mailers/previews.</p>\n</li>\n</ol>\n<p>Ta có thể xem danh sách này bằng câu lệnh:</p>\n<p><strong>bin/rails r ‘puts ActiveSupport::Dependencies.autoload_paths’</strong></p>\n<p><strong>eager_load_paths</strong> hoàn toàn giống như khái niệm về autoload_paths đã nêu ở trên. Điểm chúng ta cần lưu ý đó là:</p>\n<ol>\n<li><p>Những thư mục nằm trong eager_load_paths sẽ được load một lần duy nhất TRƯỚC khi ứng dụng của bạn khởi chạy.</p>\n</li>\n<li><p>Những thư mục nằm trong autoload_paths sẽ được sử dụng để tìm kiếm khi chương trình ĐANG CHẠY và gặp 1 từ khoá chưa được định nghĩa trong file hiện tại.</p>\n</li>\n</ol>\n<p>Ta có 2 từ in hoa, đó là phần quan trọng, để đảm bảo tính nhất quán và hoạt động một cách ổn định và chính xác, trong môi trường production ta sử dụng eager_load_paths để load toàn bộ những file cần thiết cho các hệ thống cần thì sử dụng, còn ở môi trường phát triển, để khởi chạy ứng dụng nhanh chóng hơn và dễ dàng cập nhật các thay đổi thì ta sử dụng autoload_paths.</p>\n<p>Việc thiết lập này phụ thuộc vào cấu hình của bạn trong thư mục <strong>app/config/envirements/…</strong> với 2 cấu hình là:</p>\n<ol>\n<li><p>config.cache_classes</p>\n</li>\n<li><p>config.eager_load</p>\n</li>\n</ol>\n<h2 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận\"></a>Kết luận</h2><p>Tham khảo:</p>\n<p>[1] <a href=\"https://guides.rubyonrails.org/autoloading_and_reloading_constants.html\" target=\"_blank\" rel=\"noopener\">autoloading_and_reloading_constants</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CatsController</span> &lt; ApplicationController</span></span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đoạn mã trên là một đoạn mã rất quen thuộc khi sử dụng rails framework, một câu hỏi đó là tại sao trong class CatsController không require file chưa class ApplicationController nhưng ta vẫn có thể sử dụng. Câu trả lời nằm ở việc rails có cơ chế autoloading một số folder nhất định để support cho việc coding và vận hành, bài viết này sẽ nêu một cách khái quát về giải pháp này trong rails.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><p>Như bài viết trước đã đề cập về cách mà phương thức require hoạt động:</p>\n<ol>\n<li><p>Tìm file được require theo các đường dẫn được lưu trong biến $LOAD_PATH (biến này là 1 mảng các đường dẫn).</p>\n</li>\n<li><p>Khi tìm được file tương ứng thì dừng quá trình tìm file và bắt đầu load file tìm được vào bộ nhớ.</p>\n</li>\n<li><p>Nếu tìm hết các đường dẫn và không thấy thì gọi tới LoadError.</p>\n</li>\n</ol>\n<p><strong>autoload_paths</strong> là một tập hợp các thư mục được tự động load mà không cần require. Mặc định thì autoload_paths sẽ chứa các thư mục sau:</p>\n<ol>\n<li><p>Tất cả các thư mục con cấp 1 của thư mục app, ví dụ như app/controllers, app/views…</p>\n</li>\n<li><p>Tất cả các thư mục cấp 2 tên là concerns trong app, ví dụ như app/helpers/concerns, app/lib/concerns…</p>\n</li>\n<li><p>Thư mục test/mailers/previews.</p>\n</li>\n</ol>\n<p>Ta có thể xem danh sách này bằng câu lệnh:</p>\n<p><strong>bin/rails r ‘puts ActiveSupport::Dependencies.autoload_paths’</strong></p>\n<p><strong>eager_load_paths</strong> hoàn toàn giống như khái niệm về autoload_paths đã nêu ở trên. Điểm chúng ta cần lưu ý đó là:</p>\n<ol>\n<li><p>Những thư mục nằm trong eager_load_paths sẽ được load một lần duy nhất TRƯỚC khi ứng dụng của bạn khởi chạy.</p>\n</li>\n<li><p>Những thư mục nằm trong autoload_paths sẽ được sử dụng để tìm kiếm khi chương trình ĐANG CHẠY và gặp 1 từ khoá chưa được định nghĩa trong file hiện tại.</p>\n</li>\n</ol>\n<p>Ta có 2 từ in hoa, đó là phần quan trọng, để đảm bảo tính nhất quán và hoạt động một cách ổn định và chính xác, trong môi trường production ta sử dụng eager_load_paths để load toàn bộ những file cần thiết cho các hệ thống cần thì sử dụng, còn ở môi trường phát triển, để khởi chạy ứng dụng nhanh chóng hơn và dễ dàng cập nhật các thay đổi thì ta sử dụng autoload_paths.</p>\n<p>Việc thiết lập này phụ thuộc vào cấu hình của bạn trong thư mục <strong>app/config/envirements/…</strong> với 2 cấu hình là:</p>\n<ol>\n<li><p>config.cache_classes</p>\n</li>\n<li><p>config.eager_load</p>\n</li>\n</ol>\n<h2 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận\"></a>Kết luận</h2><p>Tham khảo:</p>\n<p>[1] <a href=\"https://guides.rubyonrails.org/autoloading_and_reloading_constants.html\" target=\"_blank\" rel=\"noopener\">autoloading_and_reloading_constants</a></p>\n"},{"title":"Tổng Quan Nguyên Lý SOLID","date":"2019-05-16T17:00:00.000Z","draft":false,"_content":"\n## 1. Định nghĩa và mục tiêu sử dụng\n\n![hoa](/images/solid.png)\n\nTrước tiên, hãy xem SOLID là viết tắt của những cụm từ gì.\n\n**1:** **S**ingle Responsibility Principle\n\n**2:** **O**pen/Closed Principle\n\n**3:** **L**iskov Substitution Principle\n\n**4:** **I**nterface Segregation Principle\n\n**5:** **D**ependency Inversion Principle\n\nHàn lâm là vậy nhưng để dễ nhớ thì tôi gọi chúng ngắn gọn là: **S**ingle, **O**pen, **L**iskov, **I**nterface và **D**ependency.\n\nVề mục tiêu để cái nguyên lý này có mặt trên cõi đời, âu cũng là xuất phát từ nhu cầu làm ít hơn của con người, việc code không có hệ thống khiến các nhà phát triển tốn nhiều thời gian bảo trì và dễ phát sinh lỗi trong quá trình sử dụng.\nĐể giảm bớt gánh nặng này các nhà phát triển đã cô đọng lại một số khuôn khổ, cách thức lập trình mà dưới góc nhìn và kinh nghiệm của nhiều người, các khuôn khổ cách thức đó giúp cho việc bảo trì trở nên dễ dàng hơn, hệ thống ít phát sinh lỗi ngoài ý muốn hơn. Một trong số đó là hệ thống các nguyên tắc trong SOLID.\n\nGiả sử tôi phải xử lý một bài toán tính promotion cho một ứng dụng thương mại điện tử. Đây sẽ là ví dụ ta dùng đến trong các phần phía dưới. Giả sử cấu trúc dự án hiện tại như sau:\n\n```\n- app\n  - signin.rb\n  - signup.rb\n  - checkout.rb\n```\n\nTrong đó signin chứa mã nguồn thực hiện chức năng đăng nhập, signup chứa mã thực hiện chức năng đăng ký và checkout chứa mã thực hiện chức năng thanh toán.\n\n## 2. **S**ingle Responsibility Principle\n\n![hoa](/images/srp.jpg)\n\nNguyên lý này được phát biểu như sau:\n\n> Every class should have a single responsibility, and that responsibility should be entirely encapsulated by the class.\n\nĐiều cần quan tâm ở đây là single responsibility có thể hiểu là gì? Nghĩa của responsibility là 'trách nhiệm', vậy 'trách nhiệm' trong code là gì?\n\nTa có thể hiểu nó đồng nghĩa với 'chức năng' hay không? Cứ giả sử như ta có thể hiểu nó là 'chức năng' vậy khi đó thì nguyên lý này có thể phát biểu lại thành như sau:\n\n> Mỗi class nên chỉ mang một chức năng nhất định, và chức năng đó phải được đóng gói trong class này.\n\nBây giờ thì đã dễ hiểu hơn nhiều, quay trở về ví dụ, chúng ta cần viết một chức năng tính promotion. Ta có thể  viết chức năng này vào đâu?\n\nCâu trả lời đơn giản nhất là chúng ta viết chức năng này luôn vào file checkout.rb, khi thực hiện chức năng thanh toán thì sử dụng luôn các method tính promotion trong đó. Mọi chuyện thật đơn giản phải không? Điều này có vi phạm nguyên tắc SRP không?\n\nNếu tôi nói là không vi phạm? Diễn giải của tôi như sau: Trách nhiệm của cái module/class Checkout là thanh toán những mặt hàng bạn đã bỏ vào cart, vậy promotion cũng chỉ một step trong quá trình thanh toán, nên nếu tôi viết code promotion trong module/class Checkout thì tôi vi phạm nguyên tắc SRP chỗ nào?  Checkout vẫn đang làm đúng và duy nhất một 'trách nhiệm' đó là giúp thanh toán đơn hàng và promotion chỉ là phần phụ trợ cho quá trình đó hay nói cách khác promotion chỉ là một bước trong nhiều bước của quá trình thanh toán.\n\nVậy tôi có sai khi nói vậy không? Bạn có thể chứng minh là tôi sai nguyên lý SRP được hay không?\n\n1. Tôi nghe nhiều người nói đây là nguyên tắc dễ nhất trong SOLID, theo tôi nó chỉ là nguyên tắc mà định nghĩa dễ học thuộc nhất mà thôi.\n\n2. Responsibility thì hãy hiểu nó là responsibility (hay hiểu nó là đúng ngữ nghĩa là trách nhiệm). Không đánh đồng responsibility thành 'chức năng' như trên.\n\n3. Nội dung nguyên lý chỉ có tính tương đối, nó phụ thuộc hoàn toàn vào cái mà bạn xem là một responsibility.\n\nĐể đánh giá đâu, cái gì là một responsibility thì có lẽ điều kiện cần là phải có đủ kinh nghiệm. Trở lại ví dụ, tôi có thể coi promotion là một responsibility riêng rẽ với chức năng thanh toán. Khi đó tổ chức code của tôi như sau:\n\n```\n- app\n  - signin.rb\n  - signup.rb\n  - checkout.rb\n  - promotion.rb\n```\n\nNhư này đã phải là cách tốt nhất? Câu trả lời là tuỳ ngữ điệu hoàn cảnh, giả sử nếu chức năng promotion có nhiều rule khác nhau thì việc bỏ tất cả function tính promotion vào 1 file promotion.rb có vẻ không phải là một cách hay. Khi đó ta tổ chức lại như sau:\n\n```\n- app\n  - signin.rb\n  - signup.rb\n  - checkout.rb\n  - promotion\n    - promotion_type_a.rb\n    - promotion_type_b.rb\n    - promotion_type_c.rb\n```\n\nCách tổ chức này đã là tốt nhất hay chưa? câu trả lời là chưa chắc, mọi thứ lại phụ thuộc vào ngữ cảnh.\nNguyên lý SRP có thể sai hay đúng trong một số trường hợp là rất mập mờ, tuỳ theo cái mà nhà phát triển định nghĩa cho responsibility mà họ xây dựng.\n\nNote: Nhưng cuối cùng nguyên lý SRP cũng chỉ có một mục đích duy nhất để cấu trúc dự án dễ sửa đổi và bảo trì, vì vậy trong từng tình huống sẽ có những cách khác nhau để phân chia tổ chức mã nguồn, dựa vào chức năng, dựa vào yêu cầu khách hàng, dựa vào tiềm năng phát triển dự án...\n\n## 3. **O**pen/Closed Principle\n\n![hoa](/images/ocp.jpg)\n\nNguyên lý này được phát biểu như sau:\n\n> One software entity (class/module) must be open for extension but closed for modification.\n\nHiểu đơn giản:\n\n> Một class/module cần phải có thể mở rộng, nhưng không/không nên sửa đổi nó.\n\nVì sao nguyên lý này lại yêu cầu như vậy? việc tôi muốn mở rộng hay tôi sửa đổi một cái class thì có ảnh hưởng gì đâu mà căng nhỉ?\n\nĐúng là như vậy, trong phần lớn quá trình phát triển những ứng dụng cá nhân đơn giản thì việc chúng ta có thêm, xoá, sửa hay mở rộng một class/module đa phần đều không mang lại hậu quả gì ngoài ý muốn.\n\nNhưng ngữ cảnh mà nguyên lý này hướng tới là những ứng dụng thực sự trong cuộc sống, ở đó những ứng dụng này sẽ lớn, rối rắm và có business không hề đơn giản. Một điểm nữa là dự án đó khi tới tay bạn đã có thể trải qua 5, 7 lần đổi team phát triển và những gì bạn thấy là thành quả của cả một quá trình phát triển tính năng và maintain trong đơn vị tính bằng năm.\n\nLiệu bạn có nắm hết được flow hoạt động của từng đoạn mã, từng file từng class hay không? Nhất định là không rồi.\n\nĐó chính là lý do mà nguyên lý OCP ra đời, khi hệ thống phức tạp và bạn không nắm được hết tất cả những gì sẽ xảy ra sau khi bạn thay đổi mã nguồn tại một class/module. Hãy đừng thay đổi, để tránh làm ảnh hưởng đến một phần logic tiềm tàng nào đó. Thay vào đó hãy mở rộng class/module đó, mở rộng để bổ sung tính năng bạn cần mà còn giúp không ảnh hưởng đến những phần code cũ không sai lệch về logic luận lý (Vì nó có thể vẫn đang sử dụng chức năng cũ, liệu bạn có cover được hết để sửa đổi tất cả các trường hợp có thể xảy ra hay không?).\n\n> Vì vậy hãy ưu tiên mở rộng một class/module khi cần phát triển thêm hay thay đổi tính năng, hạn chế và hãy thật cẩn thận khi cần sửa đổi mã nguồn có sẵn (chính là sửa đổi class/module).\n\nMục tiêu của nguyên lý là vậy, rất dễ hiểu, hãy cùng thảo luận về một ví dụ trước khi sang phần tiếp theo:\n\nLại quay trở lại ví dụ về bài toán promotion, giả sử tôi lự chọn cấu trúc chương trình như sau:\n\n```\n- app\n  - signin.rb\n  - signup.rb\n  - checkout.rb\n  - promotion.rb\n```\n\nNhư đã trình bày ở trên, cấu trúc như này về lý thuyết thì cũng chả ai bảo là tôi vi phạm nguyên tắc số 1 SRP được. Giả sử nội dung của file promotion.rb như sau:\n\n```ruby\nclass Promotion\n  def promotion_type_a\n    # implement rule promotion type a\n  end\n\n  def promotion_type_b\n    # implement rule promotion type b\n  end\nend\n```\n\nVậy bây giờ khi tôi muốn thêm một rule tính promotion mới, thì tôi sẽ phải sửa đổi file promotion.rb này, về nguyên tắc nó đã vi phạm nguyên lý số 2 OCP (mở để mở rộng chứ không phải để sửa đổi).\n\nĐể khắc phục ta có thể cấu trúc lại mã nguồn như sau:\n\n```\n- app\n  - signin.rb\n  - signup.rb\n  - checkout.rb\n  - promotion\n    - promotion.rb\n    - promotion_type_a.rb\n    - promotion_type_b.rb\n    - promotion_type_c.rb\n```\n\nVà khi này, khi tôi cần thêm mới 1 rule promotion, tôi sẽ tạo một file mới trong thư mục promotion, với nội dung kế thừa từ class Promotion.\n\nVí dụ bổ sung thêm rule promotion_type_x.rb với nội dung:\n\n```ruby\nclass PromotionTypeX < Promotion\n  # do something\nend\n```\n\n## 4. **L**iskov Substitution Principle\n\n![hoa](/images/lsp.jpg)\n\nNguyên lý này được phát biểu như sau:\n\n> If S is a subtype of T, then objects of type T may be replaced with objects of type S (i.e., objects of type S may substitute objects of type T) without altering any of the desirable properties of that program (correctness, task performed, etc.).\n\nHiểu đơn giản là:\n\n> Bạn có class A là con của class B, thì instance của class A phải thay thế được cho instance của class B trong mã nguồn mà không gây ra sai xót nào (không lỗi và không sai ngữ nghĩa).\n\nMột ví dụ đơn giản như sau:\n\n```ruby\nclass Animal\n  def animal_hello\n    puts \"Animal say hello\"\n  end\nend\n\nclass Cat < Animal\n  def cat_hello\n    puts \"Cat say hello\"\n  end\nend\n```\n\nĐoạn mã trên là một đoạn mã hợp lệ với nguyên lý Liskov vì:\n\n```ruby\ntemp = Animal.new\ntemp.animal_hello\n# kết quả trả về là: \"Animal say hello\"\n\ntemp = Cat.new\ntemp.animal_hello\n# kết quả trả về vẫn là: \"Animal say hello\"\n```\n\nNhư bạn thấy, kết quả trả về không thay đổi khi ta dùng instance của class Cat thay cho instance class cha của nó là Animal, và vậy là nguyên lý Liskov được bảo toàn tính đúng đắn của nó.\n\nHãy thử một đoạn mã nguồn khác như sau:\n\n```ruby\nclass Animal\n  def animal_hello\n    puts \"Animal say hello\"\n  end\nend\n\nclass Cat < Animal\n  def animal_hello\n    puts \"Cat say hello\"\n  end\nend\n```\n\nĐây là đoạn mã vi phạm nguyên tắc của Liskov, khi này ta có:\n\n```ruby\ntemp = Animal.new\ntemp.animal_hello\n# kết quả trả về là: \"Animal say hello\"\n\ntemp = Cat.new\ntemp.animal_hello\n# kết quả trả về là: \"Cat say hello\"\n```\n\nTa có thể thấy, instance của class Cat khi gọi tới method animal_hello đã không còn trả về kết quả tương tự như một instance Animal nữa rồi, vì lý do ở class Cat, class này đã override lại phương thức animal_hello, và từ đó dẫn tới vi phạm nguyên tắc Liskov.\n\n## 5. **I**nterface Segregation Principle\n\n![hoa](/images/isp.png)\n\nNguyên lý này được phát biểu như sau:\n\n> No client should be forced to depend on methods it does not use.\n\nHiểu đơn giản là:\n\n> Nếu bạn là một đối tượng nào đó trong mã nguồn, hãy đảm bảo là bạn phải/chỉ làm những công việc mà bạn phải/có thể làm. Không trao cho bạn những khả năng mà bạn không cần.\n\nThử một ví dụ đơn giản, bạn là một học sinh được giao nhiệm vụ trực nhật lớp, cô giáo bạn phải đảm bảo rằng bạn chỉ được trao chìa khoá mở cửa phòng học của bạn, chứ không trao cho bạn những chìa khoá khác (như chìa khoá các lớp học khác, phòng tin học, phòng giáo viên...), đấy là những công việc của những cá nhân khác.\n\nNếu bạn được trao những công việc của người khác, có thể bạn sẽ tạo ra những sai lầm không thể sửa đổi được. Vì vậy hãy làm đúng công việc của mình.\n\nHãy bắt đầu với một ví dụ:\n\nTa có một class Animal.\n\n```ruby\nclass Animal\n  include AnimalHelper\n  # do something\nend\n```\n\nClass Animal bên trên include module dưới đây.\n\n```ruby\nmodule AnimalHelper\n  def animal_helper_a\n    # do something\n  end\n\n  def animal_helper_b\n    # do something\n  end\n\n  def animal_helper_c\n    # do something\n  end\nend\n```\n\nMọi chuyện ổn chứ? Rất ổn, 3 method hiện có trong module AnimalHelper là 3 method hỗ trợ cho class Animal.\n\nVậy bây giờ tôi có thêm một class nữa như sau:\n\n```ruby\nclass YellowCat\n  # do something\nend\n```\n\nClass này cần một phương thức support tên là **yellow_cat_helper**, tôi sẽ viết thêm method này vào module AnimalHelper và include module AnimalHelper vào class YellowCat vậy là đúng và đủ yêu cầu. Khi này module AnimalHelper và class YellowCat sẽ trở thành như sau:\n\nClass YellowCat\n\n```ruby\nclass YellowCat\n  include AnimalHelper\n  # do something\nend\n```\n\nModule AnimalHelper\n\n```ruby\nmodule AnimalHelper\n  def animal_helper_a\n    # do something\n  end\n\n  def animal_helper_b\n    # do something\n  end\n\n  def animal_helper_c\n    # do something\n  end\n\n  # add new method for YellowCat\n  def yellow_cat_helper\n    # do something\n  end\nend\n```\n\nMọi chuyện giờ vẫn ổn chứ? Không, bây giờ thì không ổn nữa rồi nó đã vi phạm nguyên tắc SOLID thứ 4, chữ \"I\" mà chúng ta đang xét.\n\nVì sao?\n\nVì class Animal đâu có cần method **yellow_cat_helper**, còn class YellowCat đâu có cần 3 method **animal_helper_a**, **animal_helper_b**, **animal_helper_c** này đâu?\n\nVậy mà chúng vẫn có thể sử dụng những method mà chúng vốn không cần, vì lý do ta viết chung tất cả method vào một module và include module vào từng class.\n\nY như ví dụ bên trên: Bạn cần trực nhật lớp 1A thôi mà, cô giáo bạn đưa cho bạn trùm chìa khoá của cả trường làm gì? Cầm thì nặng, mà nhỡ đâu bạn ~~tắt mắt~~ nghịch dại thì hậu quả khôn lường.\n\nVậy để không vi phạm nguyên tắc này ta có thể sửa lại mã nguồn như sau:\n\nClass Animal\n\n```ruby\nclass Animal\n  include AnimalHelper\n  # do something\nend\n```\n\nModule Animal\n\n```ruby\nmodule AnimalHelper\n  def animal_helper_a\n    # do something\n  end\n\n  def animal_helper_b\n    # do something\n  end\n\n  def animal_helper_c\n    # do something\n  end\nend\n```\n\nClass YellowCat\n\n```ruby\nclass YellowCat\n  include YellowCatHelper\n  # do something\nend\n```\n\nVà giờ ta tạo một module mới để YellowCat include\n\n```ruby\nmodule YellowCatHelper\n  def yellow_cat_helper\n    # do something\n  end\nend\n```\n\nOk, vậy là look good rồi :smile: Lúc này class Animal chỉ được include những method mà nó cần và class YellowCat cũng vậy.\n\n## 6. **D**ependency Inversion Principle\n\n![hoa](/images/dip.jpg)\n\nNguyên lý này được phát biểu như sau:\n\n> 1. High-level modules should not depend on low-level modules. Both should depend on abstractions.\n> 2. Abstractions should not depend upon details. Details should depend upon abstractions.\n\nDịch sát nghĩa sẽ là:\n\n> 1. Module cấp cao không nên phụ thuộc vào module cấp thấp hơn. Cả hai nên phụ thuộc vào abstractions.\n> 2. Abstractions không nên phụ thuộc vào details. Details nên phụ thuộc vào abstractions\n\nQuay trở lại ví dụ promotion ban đầu, giả sử ta viết mã nguồn như sau:\n\n```ruby\n# app/checkout.rb\nclass Checkout\n  def get_bill(cart)\n    PromotionTypeA.promotion_type_a(cart)\n  end\nend\n\n# app/promotion/promotion_type_a.rb\nclass PromotionTypeA\n  def self.promotion_type_a(cart)\n    # do something\n  end\nend\n```\n\nTrong đoạn mã nguồn trên đây, method get_bill trong class Checkout phụ thuộc vào class PromotionTypeA. Rõ ràng là như vậy, câu hỏi là nếu ta có PromotionTypeB, PromotionTypeC... Thì phải làm sao?\n\nChúng ta sẽ phải viết 3 method get_bill ứng với PromotionTypeA, PromotionTypeB và PromotionTypeC hay sao?\n\nĐó cũng là một cách, nhưng đó là cách đã vi phạm nguyên lý DIP, khi mà các module phụ thuộc lẫn nhau.\n\nĐể giải quyết vấn đề này ta có thể viết lại mã nguồn như sau:\n\n```ruby\n# app/checkout.rb\nclass Checkout\n  def get_bill(cart, PromotionType)\n    PromotionType.get_promotion(cart)\n  end\nend\n\n# app/promotion/promotion_type_a.rb\nclass PromotionTypeA\n  def self.get_promotion(cart)\n    # do something\n  end\nend\n\n# get_bill với PromotionTypeA\nCheckout.new.get_bill(cart, PromotionTypeA)\n\n# để viết thêm PromotionTypeB, ta viết thêm một class PromotionTypeB và truyền PromotionTypeB vào get_bill method.\n\n# app/promotion/promotion_type_a.rb\nclass PromotionTypeB\n  def self.get_promotion(cart)\n    # do something\n  end\nend\n\nCheckout.new.get_bill(cart, PromotionTypeB)\n```\n\n## Tham khảo\n\n[1] [https://en.wikipedia.org/wiki/SOLID](https://en.wikipedia.org/wiki/SOLID)\n","source":"_posts/2019-05-17-nguyen-ly-solid-trong-code-ruby.md","raw":"---\ntitle: \"Tổng Quan Nguyên Lý SOLID\"\ndate: 2019-05-17\ndraft: false\ntags: [\"SOLID\", \"RUBY\"]\ncategories: [\"RUBY\", \"PROGRAMMING\"]\n---\n\n## 1. Định nghĩa và mục tiêu sử dụng\n\n![hoa](/images/solid.png)\n\nTrước tiên, hãy xem SOLID là viết tắt của những cụm từ gì.\n\n**1:** **S**ingle Responsibility Principle\n\n**2:** **O**pen/Closed Principle\n\n**3:** **L**iskov Substitution Principle\n\n**4:** **I**nterface Segregation Principle\n\n**5:** **D**ependency Inversion Principle\n\nHàn lâm là vậy nhưng để dễ nhớ thì tôi gọi chúng ngắn gọn là: **S**ingle, **O**pen, **L**iskov, **I**nterface và **D**ependency.\n\nVề mục tiêu để cái nguyên lý này có mặt trên cõi đời, âu cũng là xuất phát từ nhu cầu làm ít hơn của con người, việc code không có hệ thống khiến các nhà phát triển tốn nhiều thời gian bảo trì và dễ phát sinh lỗi trong quá trình sử dụng.\nĐể giảm bớt gánh nặng này các nhà phát triển đã cô đọng lại một số khuôn khổ, cách thức lập trình mà dưới góc nhìn và kinh nghiệm của nhiều người, các khuôn khổ cách thức đó giúp cho việc bảo trì trở nên dễ dàng hơn, hệ thống ít phát sinh lỗi ngoài ý muốn hơn. Một trong số đó là hệ thống các nguyên tắc trong SOLID.\n\nGiả sử tôi phải xử lý một bài toán tính promotion cho một ứng dụng thương mại điện tử. Đây sẽ là ví dụ ta dùng đến trong các phần phía dưới. Giả sử cấu trúc dự án hiện tại như sau:\n\n```\n- app\n  - signin.rb\n  - signup.rb\n  - checkout.rb\n```\n\nTrong đó signin chứa mã nguồn thực hiện chức năng đăng nhập, signup chứa mã thực hiện chức năng đăng ký và checkout chứa mã thực hiện chức năng thanh toán.\n\n## 2. **S**ingle Responsibility Principle\n\n![hoa](/images/srp.jpg)\n\nNguyên lý này được phát biểu như sau:\n\n> Every class should have a single responsibility, and that responsibility should be entirely encapsulated by the class.\n\nĐiều cần quan tâm ở đây là single responsibility có thể hiểu là gì? Nghĩa của responsibility là 'trách nhiệm', vậy 'trách nhiệm' trong code là gì?\n\nTa có thể hiểu nó đồng nghĩa với 'chức năng' hay không? Cứ giả sử như ta có thể hiểu nó là 'chức năng' vậy khi đó thì nguyên lý này có thể phát biểu lại thành như sau:\n\n> Mỗi class nên chỉ mang một chức năng nhất định, và chức năng đó phải được đóng gói trong class này.\n\nBây giờ thì đã dễ hiểu hơn nhiều, quay trở về ví dụ, chúng ta cần viết một chức năng tính promotion. Ta có thể  viết chức năng này vào đâu?\n\nCâu trả lời đơn giản nhất là chúng ta viết chức năng này luôn vào file checkout.rb, khi thực hiện chức năng thanh toán thì sử dụng luôn các method tính promotion trong đó. Mọi chuyện thật đơn giản phải không? Điều này có vi phạm nguyên tắc SRP không?\n\nNếu tôi nói là không vi phạm? Diễn giải của tôi như sau: Trách nhiệm của cái module/class Checkout là thanh toán những mặt hàng bạn đã bỏ vào cart, vậy promotion cũng chỉ một step trong quá trình thanh toán, nên nếu tôi viết code promotion trong module/class Checkout thì tôi vi phạm nguyên tắc SRP chỗ nào?  Checkout vẫn đang làm đúng và duy nhất một 'trách nhiệm' đó là giúp thanh toán đơn hàng và promotion chỉ là phần phụ trợ cho quá trình đó hay nói cách khác promotion chỉ là một bước trong nhiều bước của quá trình thanh toán.\n\nVậy tôi có sai khi nói vậy không? Bạn có thể chứng minh là tôi sai nguyên lý SRP được hay không?\n\n1. Tôi nghe nhiều người nói đây là nguyên tắc dễ nhất trong SOLID, theo tôi nó chỉ là nguyên tắc mà định nghĩa dễ học thuộc nhất mà thôi.\n\n2. Responsibility thì hãy hiểu nó là responsibility (hay hiểu nó là đúng ngữ nghĩa là trách nhiệm). Không đánh đồng responsibility thành 'chức năng' như trên.\n\n3. Nội dung nguyên lý chỉ có tính tương đối, nó phụ thuộc hoàn toàn vào cái mà bạn xem là một responsibility.\n\nĐể đánh giá đâu, cái gì là một responsibility thì có lẽ điều kiện cần là phải có đủ kinh nghiệm. Trở lại ví dụ, tôi có thể coi promotion là một responsibility riêng rẽ với chức năng thanh toán. Khi đó tổ chức code của tôi như sau:\n\n```\n- app\n  - signin.rb\n  - signup.rb\n  - checkout.rb\n  - promotion.rb\n```\n\nNhư này đã phải là cách tốt nhất? Câu trả lời là tuỳ ngữ điệu hoàn cảnh, giả sử nếu chức năng promotion có nhiều rule khác nhau thì việc bỏ tất cả function tính promotion vào 1 file promotion.rb có vẻ không phải là một cách hay. Khi đó ta tổ chức lại như sau:\n\n```\n- app\n  - signin.rb\n  - signup.rb\n  - checkout.rb\n  - promotion\n    - promotion_type_a.rb\n    - promotion_type_b.rb\n    - promotion_type_c.rb\n```\n\nCách tổ chức này đã là tốt nhất hay chưa? câu trả lời là chưa chắc, mọi thứ lại phụ thuộc vào ngữ cảnh.\nNguyên lý SRP có thể sai hay đúng trong một số trường hợp là rất mập mờ, tuỳ theo cái mà nhà phát triển định nghĩa cho responsibility mà họ xây dựng.\n\nNote: Nhưng cuối cùng nguyên lý SRP cũng chỉ có một mục đích duy nhất để cấu trúc dự án dễ sửa đổi và bảo trì, vì vậy trong từng tình huống sẽ có những cách khác nhau để phân chia tổ chức mã nguồn, dựa vào chức năng, dựa vào yêu cầu khách hàng, dựa vào tiềm năng phát triển dự án...\n\n## 3. **O**pen/Closed Principle\n\n![hoa](/images/ocp.jpg)\n\nNguyên lý này được phát biểu như sau:\n\n> One software entity (class/module) must be open for extension but closed for modification.\n\nHiểu đơn giản:\n\n> Một class/module cần phải có thể mở rộng, nhưng không/không nên sửa đổi nó.\n\nVì sao nguyên lý này lại yêu cầu như vậy? việc tôi muốn mở rộng hay tôi sửa đổi một cái class thì có ảnh hưởng gì đâu mà căng nhỉ?\n\nĐúng là như vậy, trong phần lớn quá trình phát triển những ứng dụng cá nhân đơn giản thì việc chúng ta có thêm, xoá, sửa hay mở rộng một class/module đa phần đều không mang lại hậu quả gì ngoài ý muốn.\n\nNhưng ngữ cảnh mà nguyên lý này hướng tới là những ứng dụng thực sự trong cuộc sống, ở đó những ứng dụng này sẽ lớn, rối rắm và có business không hề đơn giản. Một điểm nữa là dự án đó khi tới tay bạn đã có thể trải qua 5, 7 lần đổi team phát triển và những gì bạn thấy là thành quả của cả một quá trình phát triển tính năng và maintain trong đơn vị tính bằng năm.\n\nLiệu bạn có nắm hết được flow hoạt động của từng đoạn mã, từng file từng class hay không? Nhất định là không rồi.\n\nĐó chính là lý do mà nguyên lý OCP ra đời, khi hệ thống phức tạp và bạn không nắm được hết tất cả những gì sẽ xảy ra sau khi bạn thay đổi mã nguồn tại một class/module. Hãy đừng thay đổi, để tránh làm ảnh hưởng đến một phần logic tiềm tàng nào đó. Thay vào đó hãy mở rộng class/module đó, mở rộng để bổ sung tính năng bạn cần mà còn giúp không ảnh hưởng đến những phần code cũ không sai lệch về logic luận lý (Vì nó có thể vẫn đang sử dụng chức năng cũ, liệu bạn có cover được hết để sửa đổi tất cả các trường hợp có thể xảy ra hay không?).\n\n> Vì vậy hãy ưu tiên mở rộng một class/module khi cần phát triển thêm hay thay đổi tính năng, hạn chế và hãy thật cẩn thận khi cần sửa đổi mã nguồn có sẵn (chính là sửa đổi class/module).\n\nMục tiêu của nguyên lý là vậy, rất dễ hiểu, hãy cùng thảo luận về một ví dụ trước khi sang phần tiếp theo:\n\nLại quay trở lại ví dụ về bài toán promotion, giả sử tôi lự chọn cấu trúc chương trình như sau:\n\n```\n- app\n  - signin.rb\n  - signup.rb\n  - checkout.rb\n  - promotion.rb\n```\n\nNhư đã trình bày ở trên, cấu trúc như này về lý thuyết thì cũng chả ai bảo là tôi vi phạm nguyên tắc số 1 SRP được. Giả sử nội dung của file promotion.rb như sau:\n\n```ruby\nclass Promotion\n  def promotion_type_a\n    # implement rule promotion type a\n  end\n\n  def promotion_type_b\n    # implement rule promotion type b\n  end\nend\n```\n\nVậy bây giờ khi tôi muốn thêm một rule tính promotion mới, thì tôi sẽ phải sửa đổi file promotion.rb này, về nguyên tắc nó đã vi phạm nguyên lý số 2 OCP (mở để mở rộng chứ không phải để sửa đổi).\n\nĐể khắc phục ta có thể cấu trúc lại mã nguồn như sau:\n\n```\n- app\n  - signin.rb\n  - signup.rb\n  - checkout.rb\n  - promotion\n    - promotion.rb\n    - promotion_type_a.rb\n    - promotion_type_b.rb\n    - promotion_type_c.rb\n```\n\nVà khi này, khi tôi cần thêm mới 1 rule promotion, tôi sẽ tạo một file mới trong thư mục promotion, với nội dung kế thừa từ class Promotion.\n\nVí dụ bổ sung thêm rule promotion_type_x.rb với nội dung:\n\n```ruby\nclass PromotionTypeX < Promotion\n  # do something\nend\n```\n\n## 4. **L**iskov Substitution Principle\n\n![hoa](/images/lsp.jpg)\n\nNguyên lý này được phát biểu như sau:\n\n> If S is a subtype of T, then objects of type T may be replaced with objects of type S (i.e., objects of type S may substitute objects of type T) without altering any of the desirable properties of that program (correctness, task performed, etc.).\n\nHiểu đơn giản là:\n\n> Bạn có class A là con của class B, thì instance của class A phải thay thế được cho instance của class B trong mã nguồn mà không gây ra sai xót nào (không lỗi và không sai ngữ nghĩa).\n\nMột ví dụ đơn giản như sau:\n\n```ruby\nclass Animal\n  def animal_hello\n    puts \"Animal say hello\"\n  end\nend\n\nclass Cat < Animal\n  def cat_hello\n    puts \"Cat say hello\"\n  end\nend\n```\n\nĐoạn mã trên là một đoạn mã hợp lệ với nguyên lý Liskov vì:\n\n```ruby\ntemp = Animal.new\ntemp.animal_hello\n# kết quả trả về là: \"Animal say hello\"\n\ntemp = Cat.new\ntemp.animal_hello\n# kết quả trả về vẫn là: \"Animal say hello\"\n```\n\nNhư bạn thấy, kết quả trả về không thay đổi khi ta dùng instance của class Cat thay cho instance class cha của nó là Animal, và vậy là nguyên lý Liskov được bảo toàn tính đúng đắn của nó.\n\nHãy thử một đoạn mã nguồn khác như sau:\n\n```ruby\nclass Animal\n  def animal_hello\n    puts \"Animal say hello\"\n  end\nend\n\nclass Cat < Animal\n  def animal_hello\n    puts \"Cat say hello\"\n  end\nend\n```\n\nĐây là đoạn mã vi phạm nguyên tắc của Liskov, khi này ta có:\n\n```ruby\ntemp = Animal.new\ntemp.animal_hello\n# kết quả trả về là: \"Animal say hello\"\n\ntemp = Cat.new\ntemp.animal_hello\n# kết quả trả về là: \"Cat say hello\"\n```\n\nTa có thể thấy, instance của class Cat khi gọi tới method animal_hello đã không còn trả về kết quả tương tự như một instance Animal nữa rồi, vì lý do ở class Cat, class này đã override lại phương thức animal_hello, và từ đó dẫn tới vi phạm nguyên tắc Liskov.\n\n## 5. **I**nterface Segregation Principle\n\n![hoa](/images/isp.png)\n\nNguyên lý này được phát biểu như sau:\n\n> No client should be forced to depend on methods it does not use.\n\nHiểu đơn giản là:\n\n> Nếu bạn là một đối tượng nào đó trong mã nguồn, hãy đảm bảo là bạn phải/chỉ làm những công việc mà bạn phải/có thể làm. Không trao cho bạn những khả năng mà bạn không cần.\n\nThử một ví dụ đơn giản, bạn là một học sinh được giao nhiệm vụ trực nhật lớp, cô giáo bạn phải đảm bảo rằng bạn chỉ được trao chìa khoá mở cửa phòng học của bạn, chứ không trao cho bạn những chìa khoá khác (như chìa khoá các lớp học khác, phòng tin học, phòng giáo viên...), đấy là những công việc của những cá nhân khác.\n\nNếu bạn được trao những công việc của người khác, có thể bạn sẽ tạo ra những sai lầm không thể sửa đổi được. Vì vậy hãy làm đúng công việc của mình.\n\nHãy bắt đầu với một ví dụ:\n\nTa có một class Animal.\n\n```ruby\nclass Animal\n  include AnimalHelper\n  # do something\nend\n```\n\nClass Animal bên trên include module dưới đây.\n\n```ruby\nmodule AnimalHelper\n  def animal_helper_a\n    # do something\n  end\n\n  def animal_helper_b\n    # do something\n  end\n\n  def animal_helper_c\n    # do something\n  end\nend\n```\n\nMọi chuyện ổn chứ? Rất ổn, 3 method hiện có trong module AnimalHelper là 3 method hỗ trợ cho class Animal.\n\nVậy bây giờ tôi có thêm một class nữa như sau:\n\n```ruby\nclass YellowCat\n  # do something\nend\n```\n\nClass này cần một phương thức support tên là **yellow_cat_helper**, tôi sẽ viết thêm method này vào module AnimalHelper và include module AnimalHelper vào class YellowCat vậy là đúng và đủ yêu cầu. Khi này module AnimalHelper và class YellowCat sẽ trở thành như sau:\n\nClass YellowCat\n\n```ruby\nclass YellowCat\n  include AnimalHelper\n  # do something\nend\n```\n\nModule AnimalHelper\n\n```ruby\nmodule AnimalHelper\n  def animal_helper_a\n    # do something\n  end\n\n  def animal_helper_b\n    # do something\n  end\n\n  def animal_helper_c\n    # do something\n  end\n\n  # add new method for YellowCat\n  def yellow_cat_helper\n    # do something\n  end\nend\n```\n\nMọi chuyện giờ vẫn ổn chứ? Không, bây giờ thì không ổn nữa rồi nó đã vi phạm nguyên tắc SOLID thứ 4, chữ \"I\" mà chúng ta đang xét.\n\nVì sao?\n\nVì class Animal đâu có cần method **yellow_cat_helper**, còn class YellowCat đâu có cần 3 method **animal_helper_a**, **animal_helper_b**, **animal_helper_c** này đâu?\n\nVậy mà chúng vẫn có thể sử dụng những method mà chúng vốn không cần, vì lý do ta viết chung tất cả method vào một module và include module vào từng class.\n\nY như ví dụ bên trên: Bạn cần trực nhật lớp 1A thôi mà, cô giáo bạn đưa cho bạn trùm chìa khoá của cả trường làm gì? Cầm thì nặng, mà nhỡ đâu bạn ~~tắt mắt~~ nghịch dại thì hậu quả khôn lường.\n\nVậy để không vi phạm nguyên tắc này ta có thể sửa lại mã nguồn như sau:\n\nClass Animal\n\n```ruby\nclass Animal\n  include AnimalHelper\n  # do something\nend\n```\n\nModule Animal\n\n```ruby\nmodule AnimalHelper\n  def animal_helper_a\n    # do something\n  end\n\n  def animal_helper_b\n    # do something\n  end\n\n  def animal_helper_c\n    # do something\n  end\nend\n```\n\nClass YellowCat\n\n```ruby\nclass YellowCat\n  include YellowCatHelper\n  # do something\nend\n```\n\nVà giờ ta tạo một module mới để YellowCat include\n\n```ruby\nmodule YellowCatHelper\n  def yellow_cat_helper\n    # do something\n  end\nend\n```\n\nOk, vậy là look good rồi :smile: Lúc này class Animal chỉ được include những method mà nó cần và class YellowCat cũng vậy.\n\n## 6. **D**ependency Inversion Principle\n\n![hoa](/images/dip.jpg)\n\nNguyên lý này được phát biểu như sau:\n\n> 1. High-level modules should not depend on low-level modules. Both should depend on abstractions.\n> 2. Abstractions should not depend upon details. Details should depend upon abstractions.\n\nDịch sát nghĩa sẽ là:\n\n> 1. Module cấp cao không nên phụ thuộc vào module cấp thấp hơn. Cả hai nên phụ thuộc vào abstractions.\n> 2. Abstractions không nên phụ thuộc vào details. Details nên phụ thuộc vào abstractions\n\nQuay trở lại ví dụ promotion ban đầu, giả sử ta viết mã nguồn như sau:\n\n```ruby\n# app/checkout.rb\nclass Checkout\n  def get_bill(cart)\n    PromotionTypeA.promotion_type_a(cart)\n  end\nend\n\n# app/promotion/promotion_type_a.rb\nclass PromotionTypeA\n  def self.promotion_type_a(cart)\n    # do something\n  end\nend\n```\n\nTrong đoạn mã nguồn trên đây, method get_bill trong class Checkout phụ thuộc vào class PromotionTypeA. Rõ ràng là như vậy, câu hỏi là nếu ta có PromotionTypeB, PromotionTypeC... Thì phải làm sao?\n\nChúng ta sẽ phải viết 3 method get_bill ứng với PromotionTypeA, PromotionTypeB và PromotionTypeC hay sao?\n\nĐó cũng là một cách, nhưng đó là cách đã vi phạm nguyên lý DIP, khi mà các module phụ thuộc lẫn nhau.\n\nĐể giải quyết vấn đề này ta có thể viết lại mã nguồn như sau:\n\n```ruby\n# app/checkout.rb\nclass Checkout\n  def get_bill(cart, PromotionType)\n    PromotionType.get_promotion(cart)\n  end\nend\n\n# app/promotion/promotion_type_a.rb\nclass PromotionTypeA\n  def self.get_promotion(cart)\n    # do something\n  end\nend\n\n# get_bill với PromotionTypeA\nCheckout.new.get_bill(cart, PromotionTypeA)\n\n# để viết thêm PromotionTypeB, ta viết thêm một class PromotionTypeB và truyền PromotionTypeB vào get_bill method.\n\n# app/promotion/promotion_type_a.rb\nclass PromotionTypeB\n  def self.get_promotion(cart)\n    # do something\n  end\nend\n\nCheckout.new.get_bill(cart, PromotionTypeB)\n```\n\n## Tham khảo\n\n[1] [https://en.wikipedia.org/wiki/SOLID](https://en.wikipedia.org/wiki/SOLID)\n","slug":"2019-05-17-nguyen-ly-solid-trong-code-ruby","published":1,"updated":"2022-01-29T09:29:59.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsaw001jp3m2basybd2q","content":"<h2 id=\"1-Dinh-nghia-va-muc-tieu-su-dung\"><a href=\"#1-Dinh-nghia-va-muc-tieu-su-dung\" class=\"headerlink\" title=\"1. Định nghĩa và mục tiêu sử dụng\"></a>1. Định nghĩa và mục tiêu sử dụng</h2><p><img src=\"/images/solid.png\" alt=\"hoa\"></p>\n<p>Trước tiên, hãy xem SOLID là viết tắt của những cụm từ gì.</p>\n<p><strong>1:</strong> <strong>S</strong>ingle Responsibility Principle</p>\n<p><strong>2:</strong> <strong>O</strong>pen/Closed Principle</p>\n<p><strong>3:</strong> <strong>L</strong>iskov Substitution Principle</p>\n<p><strong>4:</strong> <strong>I</strong>nterface Segregation Principle</p>\n<p><strong>5:</strong> <strong>D</strong>ependency Inversion Principle</p>\n<p>Hàn lâm là vậy nhưng để dễ nhớ thì tôi gọi chúng ngắn gọn là: <strong>S</strong>ingle, <strong>O</strong>pen, <strong>L</strong>iskov, <strong>I</strong>nterface và <strong>D</strong>ependency.</p>\n<p>Về mục tiêu để cái nguyên lý này có mặt trên cõi đời, âu cũng là xuất phát từ nhu cầu làm ít hơn của con người, việc code không có hệ thống khiến các nhà phát triển tốn nhiều thời gian bảo trì và dễ phát sinh lỗi trong quá trình sử dụng.<br>Để giảm bớt gánh nặng này các nhà phát triển đã cô đọng lại một số khuôn khổ, cách thức lập trình mà dưới góc nhìn và kinh nghiệm của nhiều người, các khuôn khổ cách thức đó giúp cho việc bảo trì trở nên dễ dàng hơn, hệ thống ít phát sinh lỗi ngoài ý muốn hơn. Một trong số đó là hệ thống các nguyên tắc trong SOLID.</p>\n<p>Giả sử tôi phải xử lý một bài toán tính promotion cho một ứng dụng thương mại điện tử. Đây sẽ là ví dụ ta dùng đến trong các phần phía dưới. Giả sử cấu trúc dự án hiện tại như sau:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signin.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signup.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>checkout.rb</span><br></pre></td></tr></table></figure>\n\n<p>Trong đó signin chứa mã nguồn thực hiện chức năng đăng nhập, signup chứa mã thực hiện chức năng đăng ký và checkout chứa mã thực hiện chức năng thanh toán.</p>\n<h2 id=\"2-Single-Responsibility-Principle\"><a href=\"#2-Single-Responsibility-Principle\" class=\"headerlink\" title=\"2. Single Responsibility Principle\"></a>2. <strong>S</strong>ingle Responsibility Principle</h2><p><img src=\"/images/srp.jpg\" alt=\"hoa\"></p>\n<p>Nguyên lý này được phát biểu như sau:</p>\n<blockquote>\n<p>Every class should have a single responsibility, and that responsibility should be entirely encapsulated by the class.</p>\n</blockquote>\n<p>Điều cần quan tâm ở đây là single responsibility có thể hiểu là gì? Nghĩa của responsibility là ‘trách nhiệm’, vậy ‘trách nhiệm’ trong code là gì?</p>\n<p>Ta có thể hiểu nó đồng nghĩa với ‘chức năng’ hay không? Cứ giả sử như ta có thể hiểu nó là ‘chức năng’ vậy khi đó thì nguyên lý này có thể phát biểu lại thành như sau:</p>\n<blockquote>\n<p>Mỗi class nên chỉ mang một chức năng nhất định, và chức năng đó phải được đóng gói trong class này.</p>\n</blockquote>\n<p>Bây giờ thì đã dễ hiểu hơn nhiều, quay trở về ví dụ, chúng ta cần viết một chức năng tính promotion. Ta có thể  viết chức năng này vào đâu?</p>\n<p>Câu trả lời đơn giản nhất là chúng ta viết chức năng này luôn vào file checkout.rb, khi thực hiện chức năng thanh toán thì sử dụng luôn các method tính promotion trong đó. Mọi chuyện thật đơn giản phải không? Điều này có vi phạm nguyên tắc SRP không?</p>\n<p>Nếu tôi nói là không vi phạm? Diễn giải của tôi như sau: Trách nhiệm của cái module/class Checkout là thanh toán những mặt hàng bạn đã bỏ vào cart, vậy promotion cũng chỉ một step trong quá trình thanh toán, nên nếu tôi viết code promotion trong module/class Checkout thì tôi vi phạm nguyên tắc SRP chỗ nào?  Checkout vẫn đang làm đúng và duy nhất một ‘trách nhiệm’ đó là giúp thanh toán đơn hàng và promotion chỉ là phần phụ trợ cho quá trình đó hay nói cách khác promotion chỉ là một bước trong nhiều bước của quá trình thanh toán.</p>\n<p>Vậy tôi có sai khi nói vậy không? Bạn có thể chứng minh là tôi sai nguyên lý SRP được hay không?</p>\n<ol>\n<li><p>Tôi nghe nhiều người nói đây là nguyên tắc dễ nhất trong SOLID, theo tôi nó chỉ là nguyên tắc mà định nghĩa dễ học thuộc nhất mà thôi.</p>\n</li>\n<li><p>Responsibility thì hãy hiểu nó là responsibility (hay hiểu nó là đúng ngữ nghĩa là trách nhiệm). Không đánh đồng responsibility thành ‘chức năng’ như trên.</p>\n</li>\n<li><p>Nội dung nguyên lý chỉ có tính tương đối, nó phụ thuộc hoàn toàn vào cái mà bạn xem là một responsibility.</p>\n</li>\n</ol>\n<p>Để đánh giá đâu, cái gì là một responsibility thì có lẽ điều kiện cần là phải có đủ kinh nghiệm. Trở lại ví dụ, tôi có thể coi promotion là một responsibility riêng rẽ với chức năng thanh toán. Khi đó tổ chức code của tôi như sau:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signin.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signup.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>checkout.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>promotion.rb</span><br></pre></td></tr></table></figure>\n\n<p>Như này đã phải là cách tốt nhất? Câu trả lời là tuỳ ngữ điệu hoàn cảnh, giả sử nếu chức năng promotion có nhiều rule khác nhau thì việc bỏ tất cả function tính promotion vào 1 file promotion.rb có vẻ không phải là một cách hay. Khi đó ta tổ chức lại như sau:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signin.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signup.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>checkout.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>promotion</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>a.rb</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>b.rb</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>c.rb</span><br></pre></td></tr></table></figure>\n\n<p>Cách tổ chức này đã là tốt nhất hay chưa? câu trả lời là chưa chắc, mọi thứ lại phụ thuộc vào ngữ cảnh.<br>Nguyên lý SRP có thể sai hay đúng trong một số trường hợp là rất mập mờ, tuỳ theo cái mà nhà phát triển định nghĩa cho responsibility mà họ xây dựng.</p>\n<p>Note: Nhưng cuối cùng nguyên lý SRP cũng chỉ có một mục đích duy nhất để cấu trúc dự án dễ sửa đổi và bảo trì, vì vậy trong từng tình huống sẽ có những cách khác nhau để phân chia tổ chức mã nguồn, dựa vào chức năng, dựa vào yêu cầu khách hàng, dựa vào tiềm năng phát triển dự án…</p>\n<h2 id=\"3-Open-Closed-Principle\"><a href=\"#3-Open-Closed-Principle\" class=\"headerlink\" title=\"3. Open/Closed Principle\"></a>3. <strong>O</strong>pen/Closed Principle</h2><p><img src=\"/images/ocp.jpg\" alt=\"hoa\"></p>\n<p>Nguyên lý này được phát biểu như sau:</p>\n<blockquote>\n<p>One software entity (class/module) must be open for extension but closed for modification.</p>\n</blockquote>\n<p>Hiểu đơn giản:</p>\n<blockquote>\n<p>Một class/module cần phải có thể mở rộng, nhưng không/không nên sửa đổi nó.</p>\n</blockquote>\n<p>Vì sao nguyên lý này lại yêu cầu như vậy? việc tôi muốn mở rộng hay tôi sửa đổi một cái class thì có ảnh hưởng gì đâu mà căng nhỉ?</p>\n<p>Đúng là như vậy, trong phần lớn quá trình phát triển những ứng dụng cá nhân đơn giản thì việc chúng ta có thêm, xoá, sửa hay mở rộng một class/module đa phần đều không mang lại hậu quả gì ngoài ý muốn.</p>\n<p>Nhưng ngữ cảnh mà nguyên lý này hướng tới là những ứng dụng thực sự trong cuộc sống, ở đó những ứng dụng này sẽ lớn, rối rắm và có business không hề đơn giản. Một điểm nữa là dự án đó khi tới tay bạn đã có thể trải qua 5, 7 lần đổi team phát triển và những gì bạn thấy là thành quả của cả một quá trình phát triển tính năng và maintain trong đơn vị tính bằng năm.</p>\n<p>Liệu bạn có nắm hết được flow hoạt động của từng đoạn mã, từng file từng class hay không? Nhất định là không rồi.</p>\n<p>Đó chính là lý do mà nguyên lý OCP ra đời, khi hệ thống phức tạp và bạn không nắm được hết tất cả những gì sẽ xảy ra sau khi bạn thay đổi mã nguồn tại một class/module. Hãy đừng thay đổi, để tránh làm ảnh hưởng đến một phần logic tiềm tàng nào đó. Thay vào đó hãy mở rộng class/module đó, mở rộng để bổ sung tính năng bạn cần mà còn giúp không ảnh hưởng đến những phần code cũ không sai lệch về logic luận lý (Vì nó có thể vẫn đang sử dụng chức năng cũ, liệu bạn có cover được hết để sửa đổi tất cả các trường hợp có thể xảy ra hay không?).</p>\n<blockquote>\n<p>Vì vậy hãy ưu tiên mở rộng một class/module khi cần phát triển thêm hay thay đổi tính năng, hạn chế và hãy thật cẩn thận khi cần sửa đổi mã nguồn có sẵn (chính là sửa đổi class/module).</p>\n</blockquote>\n<p>Mục tiêu của nguyên lý là vậy, rất dễ hiểu, hãy cùng thảo luận về một ví dụ trước khi sang phần tiếp theo:</p>\n<p>Lại quay trở lại ví dụ về bài toán promotion, giả sử tôi lự chọn cấu trúc chương trình như sau:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signin.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signup.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>checkout.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>promotion.rb</span><br></pre></td></tr></table></figure>\n\n<p>Như đã trình bày ở trên, cấu trúc như này về lý thuyết thì cũng chả ai bảo là tôi vi phạm nguyên tắc số 1 SRP được. Giả sử nội dung của file promotion.rb như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Promotion</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">promotion_type_a</span></span></span><br><span class=\"line\">    <span class=\"comment\"># implement rule promotion type a</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">promotion_type_b</span></span></span><br><span class=\"line\">    <span class=\"comment\"># implement rule promotion type b</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Vậy bây giờ khi tôi muốn thêm một rule tính promotion mới, thì tôi sẽ phải sửa đổi file promotion.rb này, về nguyên tắc nó đã vi phạm nguyên lý số 2 OCP (mở để mở rộng chứ không phải để sửa đổi).</p>\n<p>Để khắc phục ta có thể cấu trúc lại mã nguồn như sau:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signin.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signup.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>checkout.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>promotion</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion.rb</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>a.rb</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>b.rb</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>c.rb</span><br></pre></td></tr></table></figure>\n\n<p>Và khi này, khi tôi cần thêm mới 1 rule promotion, tôi sẽ tạo một file mới trong thư mục promotion, với nội dung kế thừa từ class Promotion.</p>\n<p>Ví dụ bổ sung thêm rule promotion_type_x.rb với nội dung:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PromotionTypeX</span> &lt; Promotion</span></span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Liskov-Substitution-Principle\"><a href=\"#4-Liskov-Substitution-Principle\" class=\"headerlink\" title=\"4. Liskov Substitution Principle\"></a>4. <strong>L</strong>iskov Substitution Principle</h2><p><img src=\"/images/lsp.jpg\" alt=\"hoa\"></p>\n<p>Nguyên lý này được phát biểu như sau:</p>\n<blockquote>\n<p>If S is a subtype of T, then objects of type T may be replaced with objects of type S (i.e., objects of type S may substitute objects of type T) without altering any of the desirable properties of that program (correctness, task performed, etc.).</p>\n</blockquote>\n<p>Hiểu đơn giản là:</p>\n<blockquote>\n<p>Bạn có class A là con của class B, thì instance của class A phải thay thế được cho instance của class B trong mã nguồn mà không gây ra sai xót nào (không lỗi và không sai ngữ nghĩa).</p>\n</blockquote>\n<p>Một ví dụ đơn giản như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_hello</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"Animal say hello\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cat_hello</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"Cat say hello\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đoạn mã trên là một đoạn mã hợp lệ với nguyên lý Liskov vì:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp = Animal.new</span><br><span class=\"line\">temp.animal_hello</span><br><span class=\"line\"><span class=\"comment\"># kết quả trả về là: \"Animal say hello\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = Cat.new</span><br><span class=\"line\">temp.animal_hello</span><br><span class=\"line\"><span class=\"comment\"># kết quả trả về vẫn là: \"Animal say hello\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Như bạn thấy, kết quả trả về không thay đổi khi ta dùng instance của class Cat thay cho instance class cha của nó là Animal, và vậy là nguyên lý Liskov được bảo toàn tính đúng đắn của nó.</p>\n<p>Hãy thử một đoạn mã nguồn khác như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_hello</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"Animal say hello\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_hello</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"Cat say hello\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đây là đoạn mã vi phạm nguyên tắc của Liskov, khi này ta có:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp = Animal.new</span><br><span class=\"line\">temp.animal_hello</span><br><span class=\"line\"><span class=\"comment\"># kết quả trả về là: \"Animal say hello\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = Cat.new</span><br><span class=\"line\">temp.animal_hello</span><br><span class=\"line\"><span class=\"comment\"># kết quả trả về là: \"Cat say hello\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Ta có thể thấy, instance của class Cat khi gọi tới method animal_hello đã không còn trả về kết quả tương tự như một instance Animal nữa rồi, vì lý do ở class Cat, class này đã override lại phương thức animal_hello, và từ đó dẫn tới vi phạm nguyên tắc Liskov.</p>\n<h2 id=\"5-Interface-Segregation-Principle\"><a href=\"#5-Interface-Segregation-Principle\" class=\"headerlink\" title=\"5. Interface Segregation Principle\"></a>5. <strong>I</strong>nterface Segregation Principle</h2><p><img src=\"/images/isp.png\" alt=\"hoa\"></p>\n<p>Nguyên lý này được phát biểu như sau:</p>\n<blockquote>\n<p>No client should be forced to depend on methods it does not use.</p>\n</blockquote>\n<p>Hiểu đơn giản là:</p>\n<blockquote>\n<p>Nếu bạn là một đối tượng nào đó trong mã nguồn, hãy đảm bảo là bạn phải/chỉ làm những công việc mà bạn phải/có thể làm. Không trao cho bạn những khả năng mà bạn không cần.</p>\n</blockquote>\n<p>Thử một ví dụ đơn giản, bạn là một học sinh được giao nhiệm vụ trực nhật lớp, cô giáo bạn phải đảm bảo rằng bạn chỉ được trao chìa khoá mở cửa phòng học của bạn, chứ không trao cho bạn những chìa khoá khác (như chìa khoá các lớp học khác, phòng tin học, phòng giáo viên…), đấy là những công việc của những cá nhân khác.</p>\n<p>Nếu bạn được trao những công việc của người khác, có thể bạn sẽ tạo ra những sai lầm không thể sửa đổi được. Vì vậy hãy làm đúng công việc của mình.</p>\n<p>Hãy bắt đầu với một ví dụ:</p>\n<p>Ta có một class Animal.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span></span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> AnimalHelper</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Class Animal bên trên include module dưới đây.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">AnimalHelper</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_a</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_b</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_c</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Mọi chuyện ổn chứ? Rất ổn, 3 method hiện có trong module AnimalHelper là 3 method hỗ trợ cho class Animal.</p>\n<p>Vậy bây giờ tôi có thêm một class nữa như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span></span></span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Class này cần một phương thức support tên là <strong>yellow_cat_helper</strong>, tôi sẽ viết thêm method này vào module AnimalHelper và include module AnimalHelper vào class YellowCat vậy là đúng và đủ yêu cầu. Khi này module AnimalHelper và class YellowCat sẽ trở thành như sau:</p>\n<p>Class YellowCat</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span></span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> AnimalHelper</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Module AnimalHelper</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">AnimalHelper</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_a</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_b</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_c</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># add new method for YellowCat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">yellow_cat_helper</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Mọi chuyện giờ vẫn ổn chứ? Không, bây giờ thì không ổn nữa rồi nó đã vi phạm nguyên tắc SOLID thứ 4, chữ “I” mà chúng ta đang xét.</p>\n<p>Vì sao?</p>\n<p>Vì class Animal đâu có cần method <strong>yellow_cat_helper</strong>, còn class YellowCat đâu có cần 3 method <strong>animal_helper_a</strong>, <strong>animal_helper_b</strong>, <strong>animal_helper_c</strong> này đâu?</p>\n<p>Vậy mà chúng vẫn có thể sử dụng những method mà chúng vốn không cần, vì lý do ta viết chung tất cả method vào một module và include module vào từng class.</p>\n<p>Y như ví dụ bên trên: Bạn cần trực nhật lớp 1A thôi mà, cô giáo bạn đưa cho bạn trùm chìa khoá của cả trường làm gì? Cầm thì nặng, mà nhỡ đâu bạn <del>tắt mắt</del> nghịch dại thì hậu quả khôn lường.</p>\n<p>Vậy để không vi phạm nguyên tắc này ta có thể sửa lại mã nguồn như sau:</p>\n<p>Class Animal</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span></span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> AnimalHelper</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Module Animal</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">AnimalHelper</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_a</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_b</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_c</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Class YellowCat</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span></span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> YellowCatHelper</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Và giờ ta tạo một module mới để YellowCat include</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">YellowCatHelper</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">yellow_cat_helper</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Ok, vậy là look good rồi :smile: Lúc này class Animal chỉ được include những method mà nó cần và class YellowCat cũng vậy.</p>\n<h2 id=\"6-Dependency-Inversion-Principle\"><a href=\"#6-Dependency-Inversion-Principle\" class=\"headerlink\" title=\"6. Dependency Inversion Principle\"></a>6. <strong>D</strong>ependency Inversion Principle</h2><p><img src=\"/images/dip.jpg\" alt=\"hoa\"></p>\n<p>Nguyên lý này được phát biểu như sau:</p>\n<blockquote>\n<ol>\n<li>High-level modules should not depend on low-level modules. Both should depend on abstractions.</li>\n<li>Abstractions should not depend upon details. Details should depend upon abstractions.</li>\n</ol>\n</blockquote>\n<p>Dịch sát nghĩa sẽ là:</p>\n<blockquote>\n<ol>\n<li>Module cấp cao không nên phụ thuộc vào module cấp thấp hơn. Cả hai nên phụ thuộc vào abstractions.</li>\n<li>Abstractions không nên phụ thuộc vào details. Details nên phụ thuộc vào abstractions</li>\n</ol>\n</blockquote>\n<p>Quay trở lại ví dụ promotion ban đầu, giả sử ta viết mã nguồn như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># app/checkout.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Checkout</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_bill</span><span class=\"params\">(cart)</span></span></span><br><span class=\"line\">    PromotionTypeA.promotion_type_a(cart)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># app/promotion/promotion_type_a.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PromotionTypeA</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">promotion_type_a</span><span class=\"params\">(cart)</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Trong đoạn mã nguồn trên đây, method get_bill trong class Checkout phụ thuộc vào class PromotionTypeA. Rõ ràng là như vậy, câu hỏi là nếu ta có PromotionTypeB, PromotionTypeC… Thì phải làm sao?</p>\n<p>Chúng ta sẽ phải viết 3 method get_bill ứng với PromotionTypeA, PromotionTypeB và PromotionTypeC hay sao?</p>\n<p>Đó cũng là một cách, nhưng đó là cách đã vi phạm nguyên lý DIP, khi mà các module phụ thuộc lẫn nhau.</p>\n<p>Để giải quyết vấn đề này ta có thể viết lại mã nguồn như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># app/checkout.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Checkout</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_bill</span><span class=\"params\">(cart, PromotionType)</span></span></span><br><span class=\"line\">    PromotionType.get_promotion(cart)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># app/promotion/promotion_type_a.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PromotionTypeA</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">get_promotion</span><span class=\"params\">(cart)</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_bill với PromotionTypeA</span></span><br><span class=\"line\">Checkout.new.get_bill(cart, PromotionTypeA)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># để viết thêm PromotionTypeB, ta viết thêm một class PromotionTypeB và truyền PromotionTypeB vào get_bill method.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># app/promotion/promotion_type_a.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PromotionTypeB</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">get_promotion</span><span class=\"params\">(cart)</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">Checkout.new.get_bill(cart, PromotionTypeB)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Tham-khao\"><a href=\"#Tham-khao\" class=\"headerlink\" title=\"Tham khảo\"></a>Tham khảo</h2><p>[1] <a href=\"https://en.wikipedia.org/wiki/SOLID\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/SOLID</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Dinh-nghia-va-muc-tieu-su-dung\"><a href=\"#1-Dinh-nghia-va-muc-tieu-su-dung\" class=\"headerlink\" title=\"1. Định nghĩa và mục tiêu sử dụng\"></a>1. Định nghĩa và mục tiêu sử dụng</h2><p><img src=\"/images/solid.png\" alt=\"hoa\"></p>\n<p>Trước tiên, hãy xem SOLID là viết tắt của những cụm từ gì.</p>\n<p><strong>1:</strong> <strong>S</strong>ingle Responsibility Principle</p>\n<p><strong>2:</strong> <strong>O</strong>pen/Closed Principle</p>\n<p><strong>3:</strong> <strong>L</strong>iskov Substitution Principle</p>\n<p><strong>4:</strong> <strong>I</strong>nterface Segregation Principle</p>\n<p><strong>5:</strong> <strong>D</strong>ependency Inversion Principle</p>\n<p>Hàn lâm là vậy nhưng để dễ nhớ thì tôi gọi chúng ngắn gọn là: <strong>S</strong>ingle, <strong>O</strong>pen, <strong>L</strong>iskov, <strong>I</strong>nterface và <strong>D</strong>ependency.</p>\n<p>Về mục tiêu để cái nguyên lý này có mặt trên cõi đời, âu cũng là xuất phát từ nhu cầu làm ít hơn của con người, việc code không có hệ thống khiến các nhà phát triển tốn nhiều thời gian bảo trì và dễ phát sinh lỗi trong quá trình sử dụng.<br>Để giảm bớt gánh nặng này các nhà phát triển đã cô đọng lại một số khuôn khổ, cách thức lập trình mà dưới góc nhìn và kinh nghiệm của nhiều người, các khuôn khổ cách thức đó giúp cho việc bảo trì trở nên dễ dàng hơn, hệ thống ít phát sinh lỗi ngoài ý muốn hơn. Một trong số đó là hệ thống các nguyên tắc trong SOLID.</p>\n<p>Giả sử tôi phải xử lý một bài toán tính promotion cho một ứng dụng thương mại điện tử. Đây sẽ là ví dụ ta dùng đến trong các phần phía dưới. Giả sử cấu trúc dự án hiện tại như sau:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signin.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signup.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>checkout.rb</span><br></pre></td></tr></table></figure>\n\n<p>Trong đó signin chứa mã nguồn thực hiện chức năng đăng nhập, signup chứa mã thực hiện chức năng đăng ký và checkout chứa mã thực hiện chức năng thanh toán.</p>\n<h2 id=\"2-Single-Responsibility-Principle\"><a href=\"#2-Single-Responsibility-Principle\" class=\"headerlink\" title=\"2. Single Responsibility Principle\"></a>2. <strong>S</strong>ingle Responsibility Principle</h2><p><img src=\"/images/srp.jpg\" alt=\"hoa\"></p>\n<p>Nguyên lý này được phát biểu như sau:</p>\n<blockquote>\n<p>Every class should have a single responsibility, and that responsibility should be entirely encapsulated by the class.</p>\n</blockquote>\n<p>Điều cần quan tâm ở đây là single responsibility có thể hiểu là gì? Nghĩa của responsibility là ‘trách nhiệm’, vậy ‘trách nhiệm’ trong code là gì?</p>\n<p>Ta có thể hiểu nó đồng nghĩa với ‘chức năng’ hay không? Cứ giả sử như ta có thể hiểu nó là ‘chức năng’ vậy khi đó thì nguyên lý này có thể phát biểu lại thành như sau:</p>\n<blockquote>\n<p>Mỗi class nên chỉ mang một chức năng nhất định, và chức năng đó phải được đóng gói trong class này.</p>\n</blockquote>\n<p>Bây giờ thì đã dễ hiểu hơn nhiều, quay trở về ví dụ, chúng ta cần viết một chức năng tính promotion. Ta có thể  viết chức năng này vào đâu?</p>\n<p>Câu trả lời đơn giản nhất là chúng ta viết chức năng này luôn vào file checkout.rb, khi thực hiện chức năng thanh toán thì sử dụng luôn các method tính promotion trong đó. Mọi chuyện thật đơn giản phải không? Điều này có vi phạm nguyên tắc SRP không?</p>\n<p>Nếu tôi nói là không vi phạm? Diễn giải của tôi như sau: Trách nhiệm của cái module/class Checkout là thanh toán những mặt hàng bạn đã bỏ vào cart, vậy promotion cũng chỉ một step trong quá trình thanh toán, nên nếu tôi viết code promotion trong module/class Checkout thì tôi vi phạm nguyên tắc SRP chỗ nào?  Checkout vẫn đang làm đúng và duy nhất một ‘trách nhiệm’ đó là giúp thanh toán đơn hàng và promotion chỉ là phần phụ trợ cho quá trình đó hay nói cách khác promotion chỉ là một bước trong nhiều bước của quá trình thanh toán.</p>\n<p>Vậy tôi có sai khi nói vậy không? Bạn có thể chứng minh là tôi sai nguyên lý SRP được hay không?</p>\n<ol>\n<li><p>Tôi nghe nhiều người nói đây là nguyên tắc dễ nhất trong SOLID, theo tôi nó chỉ là nguyên tắc mà định nghĩa dễ học thuộc nhất mà thôi.</p>\n</li>\n<li><p>Responsibility thì hãy hiểu nó là responsibility (hay hiểu nó là đúng ngữ nghĩa là trách nhiệm). Không đánh đồng responsibility thành ‘chức năng’ như trên.</p>\n</li>\n<li><p>Nội dung nguyên lý chỉ có tính tương đối, nó phụ thuộc hoàn toàn vào cái mà bạn xem là một responsibility.</p>\n</li>\n</ol>\n<p>Để đánh giá đâu, cái gì là một responsibility thì có lẽ điều kiện cần là phải có đủ kinh nghiệm. Trở lại ví dụ, tôi có thể coi promotion là một responsibility riêng rẽ với chức năng thanh toán. Khi đó tổ chức code của tôi như sau:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signin.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signup.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>checkout.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>promotion.rb</span><br></pre></td></tr></table></figure>\n\n<p>Như này đã phải là cách tốt nhất? Câu trả lời là tuỳ ngữ điệu hoàn cảnh, giả sử nếu chức năng promotion có nhiều rule khác nhau thì việc bỏ tất cả function tính promotion vào 1 file promotion.rb có vẻ không phải là một cách hay. Khi đó ta tổ chức lại như sau:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signin.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signup.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>checkout.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>promotion</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>a.rb</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>b.rb</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>c.rb</span><br></pre></td></tr></table></figure>\n\n<p>Cách tổ chức này đã là tốt nhất hay chưa? câu trả lời là chưa chắc, mọi thứ lại phụ thuộc vào ngữ cảnh.<br>Nguyên lý SRP có thể sai hay đúng trong một số trường hợp là rất mập mờ, tuỳ theo cái mà nhà phát triển định nghĩa cho responsibility mà họ xây dựng.</p>\n<p>Note: Nhưng cuối cùng nguyên lý SRP cũng chỉ có một mục đích duy nhất để cấu trúc dự án dễ sửa đổi và bảo trì, vì vậy trong từng tình huống sẽ có những cách khác nhau để phân chia tổ chức mã nguồn, dựa vào chức năng, dựa vào yêu cầu khách hàng, dựa vào tiềm năng phát triển dự án…</p>\n<h2 id=\"3-Open-Closed-Principle\"><a href=\"#3-Open-Closed-Principle\" class=\"headerlink\" title=\"3. Open/Closed Principle\"></a>3. <strong>O</strong>pen/Closed Principle</h2><p><img src=\"/images/ocp.jpg\" alt=\"hoa\"></p>\n<p>Nguyên lý này được phát biểu như sau:</p>\n<blockquote>\n<p>One software entity (class/module) must be open for extension but closed for modification.</p>\n</blockquote>\n<p>Hiểu đơn giản:</p>\n<blockquote>\n<p>Một class/module cần phải có thể mở rộng, nhưng không/không nên sửa đổi nó.</p>\n</blockquote>\n<p>Vì sao nguyên lý này lại yêu cầu như vậy? việc tôi muốn mở rộng hay tôi sửa đổi một cái class thì có ảnh hưởng gì đâu mà căng nhỉ?</p>\n<p>Đúng là như vậy, trong phần lớn quá trình phát triển những ứng dụng cá nhân đơn giản thì việc chúng ta có thêm, xoá, sửa hay mở rộng một class/module đa phần đều không mang lại hậu quả gì ngoài ý muốn.</p>\n<p>Nhưng ngữ cảnh mà nguyên lý này hướng tới là những ứng dụng thực sự trong cuộc sống, ở đó những ứng dụng này sẽ lớn, rối rắm và có business không hề đơn giản. Một điểm nữa là dự án đó khi tới tay bạn đã có thể trải qua 5, 7 lần đổi team phát triển và những gì bạn thấy là thành quả của cả một quá trình phát triển tính năng và maintain trong đơn vị tính bằng năm.</p>\n<p>Liệu bạn có nắm hết được flow hoạt động của từng đoạn mã, từng file từng class hay không? Nhất định là không rồi.</p>\n<p>Đó chính là lý do mà nguyên lý OCP ra đời, khi hệ thống phức tạp và bạn không nắm được hết tất cả những gì sẽ xảy ra sau khi bạn thay đổi mã nguồn tại một class/module. Hãy đừng thay đổi, để tránh làm ảnh hưởng đến một phần logic tiềm tàng nào đó. Thay vào đó hãy mở rộng class/module đó, mở rộng để bổ sung tính năng bạn cần mà còn giúp không ảnh hưởng đến những phần code cũ không sai lệch về logic luận lý (Vì nó có thể vẫn đang sử dụng chức năng cũ, liệu bạn có cover được hết để sửa đổi tất cả các trường hợp có thể xảy ra hay không?).</p>\n<blockquote>\n<p>Vì vậy hãy ưu tiên mở rộng một class/module khi cần phát triển thêm hay thay đổi tính năng, hạn chế và hãy thật cẩn thận khi cần sửa đổi mã nguồn có sẵn (chính là sửa đổi class/module).</p>\n</blockquote>\n<p>Mục tiêu của nguyên lý là vậy, rất dễ hiểu, hãy cùng thảo luận về một ví dụ trước khi sang phần tiếp theo:</p>\n<p>Lại quay trở lại ví dụ về bài toán promotion, giả sử tôi lự chọn cấu trúc chương trình như sau:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signin.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signup.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>checkout.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>promotion.rb</span><br></pre></td></tr></table></figure>\n\n<p>Như đã trình bày ở trên, cấu trúc như này về lý thuyết thì cũng chả ai bảo là tôi vi phạm nguyên tắc số 1 SRP được. Giả sử nội dung của file promotion.rb như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Promotion</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">promotion_type_a</span></span></span><br><span class=\"line\">    <span class=\"comment\"># implement rule promotion type a</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">promotion_type_b</span></span></span><br><span class=\"line\">    <span class=\"comment\"># implement rule promotion type b</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Vậy bây giờ khi tôi muốn thêm một rule tính promotion mới, thì tôi sẽ phải sửa đổi file promotion.rb này, về nguyên tắc nó đã vi phạm nguyên lý số 2 OCP (mở để mở rộng chứ không phải để sửa đổi).</p>\n<p>Để khắc phục ta có thể cấu trúc lại mã nguồn như sau:</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">- </span>app</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signin.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>signup.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>checkout.rb</span><br><span class=\"line\"><span class=\"bullet\">  - </span>promotion</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion.rb</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>a.rb</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>b.rb</span><br><span class=\"line\"><span class=\"bullet\">    - </span>promotion<span class=\"emphasis\">_type_</span>c.rb</span><br></pre></td></tr></table></figure>\n\n<p>Và khi này, khi tôi cần thêm mới 1 rule promotion, tôi sẽ tạo một file mới trong thư mục promotion, với nội dung kế thừa từ class Promotion.</p>\n<p>Ví dụ bổ sung thêm rule promotion_type_x.rb với nội dung:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PromotionTypeX</span> &lt; Promotion</span></span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Liskov-Substitution-Principle\"><a href=\"#4-Liskov-Substitution-Principle\" class=\"headerlink\" title=\"4. Liskov Substitution Principle\"></a>4. <strong>L</strong>iskov Substitution Principle</h2><p><img src=\"/images/lsp.jpg\" alt=\"hoa\"></p>\n<p>Nguyên lý này được phát biểu như sau:</p>\n<blockquote>\n<p>If S is a subtype of T, then objects of type T may be replaced with objects of type S (i.e., objects of type S may substitute objects of type T) without altering any of the desirable properties of that program (correctness, task performed, etc.).</p>\n</blockquote>\n<p>Hiểu đơn giản là:</p>\n<blockquote>\n<p>Bạn có class A là con của class B, thì instance của class A phải thay thế được cho instance của class B trong mã nguồn mà không gây ra sai xót nào (không lỗi và không sai ngữ nghĩa).</p>\n</blockquote>\n<p>Một ví dụ đơn giản như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_hello</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"Animal say hello\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cat_hello</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"Cat say hello\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đoạn mã trên là một đoạn mã hợp lệ với nguyên lý Liskov vì:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp = Animal.new</span><br><span class=\"line\">temp.animal_hello</span><br><span class=\"line\"><span class=\"comment\"># kết quả trả về là: \"Animal say hello\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = Cat.new</span><br><span class=\"line\">temp.animal_hello</span><br><span class=\"line\"><span class=\"comment\"># kết quả trả về vẫn là: \"Animal say hello\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Như bạn thấy, kết quả trả về không thay đổi khi ta dùng instance của class Cat thay cho instance class cha của nó là Animal, và vậy là nguyên lý Liskov được bảo toàn tính đúng đắn của nó.</p>\n<p>Hãy thử một đoạn mã nguồn khác như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_hello</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"Animal say hello\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_hello</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"Cat say hello\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đây là đoạn mã vi phạm nguyên tắc của Liskov, khi này ta có:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">temp = Animal.new</span><br><span class=\"line\">temp.animal_hello</span><br><span class=\"line\"><span class=\"comment\"># kết quả trả về là: \"Animal say hello\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">temp = Cat.new</span><br><span class=\"line\">temp.animal_hello</span><br><span class=\"line\"><span class=\"comment\"># kết quả trả về là: \"Cat say hello\"</span></span><br></pre></td></tr></table></figure>\n\n<p>Ta có thể thấy, instance của class Cat khi gọi tới method animal_hello đã không còn trả về kết quả tương tự như một instance Animal nữa rồi, vì lý do ở class Cat, class này đã override lại phương thức animal_hello, và từ đó dẫn tới vi phạm nguyên tắc Liskov.</p>\n<h2 id=\"5-Interface-Segregation-Principle\"><a href=\"#5-Interface-Segregation-Principle\" class=\"headerlink\" title=\"5. Interface Segregation Principle\"></a>5. <strong>I</strong>nterface Segregation Principle</h2><p><img src=\"/images/isp.png\" alt=\"hoa\"></p>\n<p>Nguyên lý này được phát biểu như sau:</p>\n<blockquote>\n<p>No client should be forced to depend on methods it does not use.</p>\n</blockquote>\n<p>Hiểu đơn giản là:</p>\n<blockquote>\n<p>Nếu bạn là một đối tượng nào đó trong mã nguồn, hãy đảm bảo là bạn phải/chỉ làm những công việc mà bạn phải/có thể làm. Không trao cho bạn những khả năng mà bạn không cần.</p>\n</blockquote>\n<p>Thử một ví dụ đơn giản, bạn là một học sinh được giao nhiệm vụ trực nhật lớp, cô giáo bạn phải đảm bảo rằng bạn chỉ được trao chìa khoá mở cửa phòng học của bạn, chứ không trao cho bạn những chìa khoá khác (như chìa khoá các lớp học khác, phòng tin học, phòng giáo viên…), đấy là những công việc của những cá nhân khác.</p>\n<p>Nếu bạn được trao những công việc của người khác, có thể bạn sẽ tạo ra những sai lầm không thể sửa đổi được. Vì vậy hãy làm đúng công việc của mình.</p>\n<p>Hãy bắt đầu với một ví dụ:</p>\n<p>Ta có một class Animal.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span></span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> AnimalHelper</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Class Animal bên trên include module dưới đây.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">AnimalHelper</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_a</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_b</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_c</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Mọi chuyện ổn chứ? Rất ổn, 3 method hiện có trong module AnimalHelper là 3 method hỗ trợ cho class Animal.</p>\n<p>Vậy bây giờ tôi có thêm một class nữa như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span></span></span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Class này cần một phương thức support tên là <strong>yellow_cat_helper</strong>, tôi sẽ viết thêm method này vào module AnimalHelper và include module AnimalHelper vào class YellowCat vậy là đúng và đủ yêu cầu. Khi này module AnimalHelper và class YellowCat sẽ trở thành như sau:</p>\n<p>Class YellowCat</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span></span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> AnimalHelper</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Module AnimalHelper</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">AnimalHelper</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_a</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_b</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_c</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># add new method for YellowCat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">yellow_cat_helper</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Mọi chuyện giờ vẫn ổn chứ? Không, bây giờ thì không ổn nữa rồi nó đã vi phạm nguyên tắc SOLID thứ 4, chữ “I” mà chúng ta đang xét.</p>\n<p>Vì sao?</p>\n<p>Vì class Animal đâu có cần method <strong>yellow_cat_helper</strong>, còn class YellowCat đâu có cần 3 method <strong>animal_helper_a</strong>, <strong>animal_helper_b</strong>, <strong>animal_helper_c</strong> này đâu?</p>\n<p>Vậy mà chúng vẫn có thể sử dụng những method mà chúng vốn không cần, vì lý do ta viết chung tất cả method vào một module và include module vào từng class.</p>\n<p>Y như ví dụ bên trên: Bạn cần trực nhật lớp 1A thôi mà, cô giáo bạn đưa cho bạn trùm chìa khoá của cả trường làm gì? Cầm thì nặng, mà nhỡ đâu bạn <del>tắt mắt</del> nghịch dại thì hậu quả khôn lường.</p>\n<p>Vậy để không vi phạm nguyên tắc này ta có thể sửa lại mã nguồn như sau:</p>\n<p>Class Animal</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Animal</span></span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> AnimalHelper</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Module Animal</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">AnimalHelper</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_a</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_b</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">animal_helper_c</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Class YellowCat</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span></span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> YellowCatHelper</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Và giờ ta tạo một module mới để YellowCat include</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">YellowCatHelper</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">yellow_cat_helper</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Ok, vậy là look good rồi :smile: Lúc này class Animal chỉ được include những method mà nó cần và class YellowCat cũng vậy.</p>\n<h2 id=\"6-Dependency-Inversion-Principle\"><a href=\"#6-Dependency-Inversion-Principle\" class=\"headerlink\" title=\"6. Dependency Inversion Principle\"></a>6. <strong>D</strong>ependency Inversion Principle</h2><p><img src=\"/images/dip.jpg\" alt=\"hoa\"></p>\n<p>Nguyên lý này được phát biểu như sau:</p>\n<blockquote>\n<ol>\n<li>High-level modules should not depend on low-level modules. Both should depend on abstractions.</li>\n<li>Abstractions should not depend upon details. Details should depend upon abstractions.</li>\n</ol>\n</blockquote>\n<p>Dịch sát nghĩa sẽ là:</p>\n<blockquote>\n<ol>\n<li>Module cấp cao không nên phụ thuộc vào module cấp thấp hơn. Cả hai nên phụ thuộc vào abstractions.</li>\n<li>Abstractions không nên phụ thuộc vào details. Details nên phụ thuộc vào abstractions</li>\n</ol>\n</blockquote>\n<p>Quay trở lại ví dụ promotion ban đầu, giả sử ta viết mã nguồn như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># app/checkout.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Checkout</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_bill</span><span class=\"params\">(cart)</span></span></span><br><span class=\"line\">    PromotionTypeA.promotion_type_a(cart)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># app/promotion/promotion_type_a.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PromotionTypeA</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">promotion_type_a</span><span class=\"params\">(cart)</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Trong đoạn mã nguồn trên đây, method get_bill trong class Checkout phụ thuộc vào class PromotionTypeA. Rõ ràng là như vậy, câu hỏi là nếu ta có PromotionTypeB, PromotionTypeC… Thì phải làm sao?</p>\n<p>Chúng ta sẽ phải viết 3 method get_bill ứng với PromotionTypeA, PromotionTypeB và PromotionTypeC hay sao?</p>\n<p>Đó cũng là một cách, nhưng đó là cách đã vi phạm nguyên lý DIP, khi mà các module phụ thuộc lẫn nhau.</p>\n<p>Để giải quyết vấn đề này ta có thể viết lại mã nguồn như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># app/checkout.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Checkout</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_bill</span><span class=\"params\">(cart, PromotionType)</span></span></span><br><span class=\"line\">    PromotionType.get_promotion(cart)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># app/promotion/promotion_type_a.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PromotionTypeA</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">get_promotion</span><span class=\"params\">(cart)</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># get_bill với PromotionTypeA</span></span><br><span class=\"line\">Checkout.new.get_bill(cart, PromotionTypeA)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># để viết thêm PromotionTypeB, ta viết thêm một class PromotionTypeB và truyền PromotionTypeB vào get_bill method.</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># app/promotion/promotion_type_a.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PromotionTypeB</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">get_promotion</span><span class=\"params\">(cart)</span></span></span><br><span class=\"line\">    <span class=\"comment\"># do something</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">Checkout.new.get_bill(cart, PromotionTypeB)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Tham-khao\"><a href=\"#Tham-khao\" class=\"headerlink\" title=\"Tham khảo\"></a>Tham khảo</h2><p>[1] <a href=\"https://en.wikipedia.org/wiki/SOLID\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/SOLID</a></p>\n"},{"title":"Symbol Và String Trong Ruby","date":"2019-06-08T17:00:00.000Z","draft":false,"_content":"\n## Đặt vấn đề\n\nSymbol là khái niệm rất quen tai và quen tay với lập trình viên ruby, ắt hẳn ai cũng đã từng nghe không ít thì nhiều, bản thân symbol cũng xuất hiện rất thường xuyên trong rails framework.\n\nKhi tôi là thực tập sinh, tôi nhận được nhiều lời khuyên về việc nên sử dụng symbol nhưng chưa từng được nghe 1 lý giải đủ rõ ràng về việc vì sao nên sử dụng nó, mà có lẽ tôi cũng không thích nó, sự xuất hiện của symbol làm cú pháp trong rails không thống nhất khi có thể viết nhiều kiểu để biểu hiện cùng một ý nghĩa. Tôi không thích việc không đồng bộ đó chút nào.\n\nCó một lý giải đơn giản và dễ nhớ để phân biệt giữa 2 đối tượng này đó là: Symbol mà giá trị giống nhau thì có cùng object_id, còn String thì dù giá trị giống nhau, mỗi chuỗi vẫn sẽ có một object_id khác nhau.\nLiệu lý giải này đã đủ? Hãy cùng tìm hiểu.\n\n## Luận bàn\n\n## 1. Khai báo và tư tưởng\n\nĐể khai báo một symbol bạn thêm dấu **:** đằng trước.\n\n```ruby\n:meo\n\n:\"meo\"\n```\n\nĐơn giản như trên, ta đã khai báo bằng 2 cách khác nhau. Nhưng thực tế ruby hiểu là chúng cùng là 1 symbol.\n\nĐiểm cần phải nói rõ trước khi đi xuống các phần sau đó là:\n\n1. Symbol thực chất cũng là một String.\n\n2. Symbol là một [immutable](https://hdchinh.com/programing/2019/04/08/immutable-va-mutable-trong-ruby.html).\n\n## 2. Mutable và Immutable\n\nTôi đã từng trình bày một bài viết về chủ đề này. Các bạn có thể tham khảo tại [đây](https://hdchinh.com/programing/2019/04/08/immutable-va-mutable-trong-ruby.html).\n\nNhưng nói một cách vắn tắt thì biến X là một immutable khi mà vùng nhớ lưu giá trị của X không thể được thay đổi giá trị.\n\nNhư trình bày ở mục 1, symbol là immutable (khác với string thì là mutable).\n\nChúng ta có thể kết luận rằng, symbol thực chất là một string có tính chất bất biến giá trị (immutable).\n\nCâu hỏi đặt ra là: Tại sao tôi lại cần những biến không thể thay đổi giá trị?\n\n1. Trong quá trình lập trình, chúng ta cần một số biến không thể bị thay đổi giá trị trong quá trình sử dụng, để đảm bảo tính đúng đắn của chương trình. (Tôi không có ví dụ cụ thể nào).\n\n2. Vì là mutable, nên mỗi khi một string được gọi, bất kể là các chuỗi có giống nhau hay không, ruby luôn tạo ra một vùng nhớ mới cho chúng.\n\n```ruby\n\"Chinh\".object_id\n#  => 70159285001700\n\"Chinh\".object_id\n# => 70159284996100\n\"Chinh\".object_id\n# => 70159289079920\n```\n\nBa chuỗi cùng một nội dung, nhưng khi được gọi thì lại có 3 object_id khác nhau, chứng tỏ rằng dù cùng giá trị nhưng ruby coi chúng là 3 đối tượng khác nhau và lưu trữ mỗi vùng nhớ riêng cho từng chuỗi.\n\n**Vấn đề phát sinh từ đây khi mà  vùng nhớ bị lãng phí.**\n\nHãy cùng thử với symbol.\n\n```ruby\n:\"Chinh\".object_id\n# => 1271588\n:\"Chinh\".object_id\n# => 1271588\n:\"Chinh\".object_id\n# => 1271588\n```\n\nThật tuyệt, vậy là bằng một cách nào đó, khi sử dụng symbol, ruby biết được symbol này đã tồn tại hay chưa, nếu tồn tại rồi thì khi được gọi chúng sẽ dùng lại đối tượng đã có chứ không tạo thêm vùng nhớ mới.\n\n## 3. Symbol và String được lưu trữ như nào.\n\nMột tiêu đề có vẻ buồn cười, vì cái đối tượng trong ruby tất nhiên được lưu ở bộ nhớ trong với phân vùng gọi là heap.\n\nHiển nhiên String không ngoại lệ.\n\nNếu String được lưu trữ một cách bình thường và không thể kiểm soát xem nó lưu những gì (vì nó là mutable). Nên khi tạo ra một đối tượng String mới, Ruby sẽ tìm một vùng nhớ trống và lưu nó tại đó và không quan tâm xem là có bao nhiêu String đang hoạt động trong chương trình có nội dung giống nhau.\n\nVậy Symbol thì sao? Như đã trình bày ở mục trên thì bằng cách nào đó mà ruby có thể biết được symbol đã tồn tại hay chưa, nếu tồn tại thì xài lại còn chưa thì mới tạo ra vùng nhớ mới. Vậy chúng làm vậy bằng cách nào?\n\nThực ra không hề có phép màu nào ở đây cả, muốn truy vết symbol như nói ở trên thì chúng buộc phải được lưu trữ và quản lý dưới 1 dạng cơ sở dữ liệu nào đó.\n\nSự thật là Symbol được lưu trữ thành một table (thôi cứ tạm gọi là vậy), trong suốt quá trình vận hành một chương trình. Cứ tưởng tượng như việc bạn có 1 bảng trong excel, và khi có một dữ liệu mới được yêu cầu, bạn sẽ tra trong bảng excel này trước coi có chưa, nếu có rồi thì lấy ra xài lại. Còn nếu không có? thì sẽ làm 2 việc:\n\n1. Tạo dữ liệu đó.\n2. Lưu lại trong bảng để lần sau tra cứu.\n\nĐể lấy giá trị trong table lưu symbol nói trên ta có thể dụng lệnh:\n\n```ruby\nputs Symbol.all_symbols\n# hoặc lấy tổng số symbol đã được lưu trữ trong chương trình.\nputs Symbol.all_symbols.size\n```\n\n## 4. Về tốc độ thực thi\n\nQua những gì để phân tích. Ta rút ra một kết luận là Symbol thì tiết kiệm vùng nhớ một cách đáng kể so với String (xem lại cơ chế lưu vào table bên trên).\n\nNhưng vậy ngoài ra thì chúng còn gì khác biệt nữa không? Về performance thì sao?\n\nCâu trả lời là Symbol vẫn nổi trội hơn String ở tốc độ thực thi:\n\n1. Trong trường hợp tạo một đối tượng mới: Symbol có thể sử dụng lại, còn String thì luôn luôn tạo mới. Ủa vậy thì tạo mới String phải nhanh hơn chứ ta. Vì nó không cần quét lại bảng table symbols mà luôn luôn tạo đối tượng mới, trong khi đó thì Symbol phải quét lại trước rồi nếu không có mới tạo đối tượng.\n\nNhưng mọi thứ không đơn giản như vậy, Trong ruby có một module gọi tắt là GC có chức năng thu gòm \"rác\", rác ở đây là các string được khai báo nhưng không còn sử dụng, GC sẽ thu hồi vùng nhớ của chúng để lấy không gian cho các đối tượng khác. Đây là một công việc vất vả.\n\nFlow đơn giản của nó sẽ là:  GC quét các đối tượng => Đánh dấu các đối tượng không được sử dụng => Khi chương trình trong thời gian rảnh rỗi thì GC sẽ thu gồm vùng nhớ của các đối tượng bị đánh dấu. Sẽ tốt không ít thời gian cho công đoạn này.\n\nVì vậy về mặt performance khi tạo đối tượng mới, Symbol vẫn giành chiến thắng.\n\n2. Trong trường hợp so sánh 2 đối tượng: Chiến thắng một lần nữa thuộc về Symbol.\n\nLý do thì lần này khá đơn giản: Khi cần so sánh 2 symbol, ruby sẽ vào symbols table và so sánh là xong. Trong khi người anh em String thì không thể và để so sánh 2 chuỗi, ruby sẽ phải so sánh từng ký tự trong chuỗi này với từng ký tự trong chuỗi kia. Đây lại là một công việc vất vả.\n\nVà thế là ta đã hiểu performance, Symbol win ez.\n\nĐể thử nghiệm bạn có thể sử dụng thư viện benchmark để kiểm nghiệm kết luận.\n\n## 5. Điểm yếu của Symbol\n\nNếu Symbol toàn năng, toàn thiện thì đã không có lý do gì nó không thay thế luôn String. Bản chất của điểm yếu của Symbol cũng chính là điểm mạnh của nó.\n\nĐó chính là tính chất immutable.\n\nVì không phải khi nào cũng cần một đối tượng immutable, tôi có một input là tên người dùng nhập vào. Tôi muốn chắc chắn là sẽ lưu tên người dùng dưới dạng chữ hoa trong csdl. Vì vậy tôi chạy method **upcase!**.\n\nTuy nhiên, Symbol là immutable mà phương thức **upcase!** lại có mục tiêu thay đổi giá trị của đối tượng và thế là chương trình bắn ra một error về việc bạn đang cố thay đổi giá trị của symbol.\n\nTrong trường hợp này rõ ràng sử dụng String là điều hiển nhiên.\n","source":"_posts/2019-06-09-so-sanh-symbol-va-string-trong-ruby.md","raw":"---\ntitle: \"Symbol Và String Trong Ruby\"\ndate: 2019-06-09\ndraft: false\ntags: [\"RUBY\"]\ncategories: [\"RUBY\"]\n---\n\n## Đặt vấn đề\n\nSymbol là khái niệm rất quen tai và quen tay với lập trình viên ruby, ắt hẳn ai cũng đã từng nghe không ít thì nhiều, bản thân symbol cũng xuất hiện rất thường xuyên trong rails framework.\n\nKhi tôi là thực tập sinh, tôi nhận được nhiều lời khuyên về việc nên sử dụng symbol nhưng chưa từng được nghe 1 lý giải đủ rõ ràng về việc vì sao nên sử dụng nó, mà có lẽ tôi cũng không thích nó, sự xuất hiện của symbol làm cú pháp trong rails không thống nhất khi có thể viết nhiều kiểu để biểu hiện cùng một ý nghĩa. Tôi không thích việc không đồng bộ đó chút nào.\n\nCó một lý giải đơn giản và dễ nhớ để phân biệt giữa 2 đối tượng này đó là: Symbol mà giá trị giống nhau thì có cùng object_id, còn String thì dù giá trị giống nhau, mỗi chuỗi vẫn sẽ có một object_id khác nhau.\nLiệu lý giải này đã đủ? Hãy cùng tìm hiểu.\n\n## Luận bàn\n\n## 1. Khai báo và tư tưởng\n\nĐể khai báo một symbol bạn thêm dấu **:** đằng trước.\n\n```ruby\n:meo\n\n:\"meo\"\n```\n\nĐơn giản như trên, ta đã khai báo bằng 2 cách khác nhau. Nhưng thực tế ruby hiểu là chúng cùng là 1 symbol.\n\nĐiểm cần phải nói rõ trước khi đi xuống các phần sau đó là:\n\n1. Symbol thực chất cũng là một String.\n\n2. Symbol là một [immutable](https://hdchinh.com/programing/2019/04/08/immutable-va-mutable-trong-ruby.html).\n\n## 2. Mutable và Immutable\n\nTôi đã từng trình bày một bài viết về chủ đề này. Các bạn có thể tham khảo tại [đây](https://hdchinh.com/programing/2019/04/08/immutable-va-mutable-trong-ruby.html).\n\nNhưng nói một cách vắn tắt thì biến X là một immutable khi mà vùng nhớ lưu giá trị của X không thể được thay đổi giá trị.\n\nNhư trình bày ở mục 1, symbol là immutable (khác với string thì là mutable).\n\nChúng ta có thể kết luận rằng, symbol thực chất là một string có tính chất bất biến giá trị (immutable).\n\nCâu hỏi đặt ra là: Tại sao tôi lại cần những biến không thể thay đổi giá trị?\n\n1. Trong quá trình lập trình, chúng ta cần một số biến không thể bị thay đổi giá trị trong quá trình sử dụng, để đảm bảo tính đúng đắn của chương trình. (Tôi không có ví dụ cụ thể nào).\n\n2. Vì là mutable, nên mỗi khi một string được gọi, bất kể là các chuỗi có giống nhau hay không, ruby luôn tạo ra một vùng nhớ mới cho chúng.\n\n```ruby\n\"Chinh\".object_id\n#  => 70159285001700\n\"Chinh\".object_id\n# => 70159284996100\n\"Chinh\".object_id\n# => 70159289079920\n```\n\nBa chuỗi cùng một nội dung, nhưng khi được gọi thì lại có 3 object_id khác nhau, chứng tỏ rằng dù cùng giá trị nhưng ruby coi chúng là 3 đối tượng khác nhau và lưu trữ mỗi vùng nhớ riêng cho từng chuỗi.\n\n**Vấn đề phát sinh từ đây khi mà  vùng nhớ bị lãng phí.**\n\nHãy cùng thử với symbol.\n\n```ruby\n:\"Chinh\".object_id\n# => 1271588\n:\"Chinh\".object_id\n# => 1271588\n:\"Chinh\".object_id\n# => 1271588\n```\n\nThật tuyệt, vậy là bằng một cách nào đó, khi sử dụng symbol, ruby biết được symbol này đã tồn tại hay chưa, nếu tồn tại rồi thì khi được gọi chúng sẽ dùng lại đối tượng đã có chứ không tạo thêm vùng nhớ mới.\n\n## 3. Symbol và String được lưu trữ như nào.\n\nMột tiêu đề có vẻ buồn cười, vì cái đối tượng trong ruby tất nhiên được lưu ở bộ nhớ trong với phân vùng gọi là heap.\n\nHiển nhiên String không ngoại lệ.\n\nNếu String được lưu trữ một cách bình thường và không thể kiểm soát xem nó lưu những gì (vì nó là mutable). Nên khi tạo ra một đối tượng String mới, Ruby sẽ tìm một vùng nhớ trống và lưu nó tại đó và không quan tâm xem là có bao nhiêu String đang hoạt động trong chương trình có nội dung giống nhau.\n\nVậy Symbol thì sao? Như đã trình bày ở mục trên thì bằng cách nào đó mà ruby có thể biết được symbol đã tồn tại hay chưa, nếu tồn tại thì xài lại còn chưa thì mới tạo ra vùng nhớ mới. Vậy chúng làm vậy bằng cách nào?\n\nThực ra không hề có phép màu nào ở đây cả, muốn truy vết symbol như nói ở trên thì chúng buộc phải được lưu trữ và quản lý dưới 1 dạng cơ sở dữ liệu nào đó.\n\nSự thật là Symbol được lưu trữ thành một table (thôi cứ tạm gọi là vậy), trong suốt quá trình vận hành một chương trình. Cứ tưởng tượng như việc bạn có 1 bảng trong excel, và khi có một dữ liệu mới được yêu cầu, bạn sẽ tra trong bảng excel này trước coi có chưa, nếu có rồi thì lấy ra xài lại. Còn nếu không có? thì sẽ làm 2 việc:\n\n1. Tạo dữ liệu đó.\n2. Lưu lại trong bảng để lần sau tra cứu.\n\nĐể lấy giá trị trong table lưu symbol nói trên ta có thể dụng lệnh:\n\n```ruby\nputs Symbol.all_symbols\n# hoặc lấy tổng số symbol đã được lưu trữ trong chương trình.\nputs Symbol.all_symbols.size\n```\n\n## 4. Về tốc độ thực thi\n\nQua những gì để phân tích. Ta rút ra một kết luận là Symbol thì tiết kiệm vùng nhớ một cách đáng kể so với String (xem lại cơ chế lưu vào table bên trên).\n\nNhưng vậy ngoài ra thì chúng còn gì khác biệt nữa không? Về performance thì sao?\n\nCâu trả lời là Symbol vẫn nổi trội hơn String ở tốc độ thực thi:\n\n1. Trong trường hợp tạo một đối tượng mới: Symbol có thể sử dụng lại, còn String thì luôn luôn tạo mới. Ủa vậy thì tạo mới String phải nhanh hơn chứ ta. Vì nó không cần quét lại bảng table symbols mà luôn luôn tạo đối tượng mới, trong khi đó thì Symbol phải quét lại trước rồi nếu không có mới tạo đối tượng.\n\nNhưng mọi thứ không đơn giản như vậy, Trong ruby có một module gọi tắt là GC có chức năng thu gòm \"rác\", rác ở đây là các string được khai báo nhưng không còn sử dụng, GC sẽ thu hồi vùng nhớ của chúng để lấy không gian cho các đối tượng khác. Đây là một công việc vất vả.\n\nFlow đơn giản của nó sẽ là:  GC quét các đối tượng => Đánh dấu các đối tượng không được sử dụng => Khi chương trình trong thời gian rảnh rỗi thì GC sẽ thu gồm vùng nhớ của các đối tượng bị đánh dấu. Sẽ tốt không ít thời gian cho công đoạn này.\n\nVì vậy về mặt performance khi tạo đối tượng mới, Symbol vẫn giành chiến thắng.\n\n2. Trong trường hợp so sánh 2 đối tượng: Chiến thắng một lần nữa thuộc về Symbol.\n\nLý do thì lần này khá đơn giản: Khi cần so sánh 2 symbol, ruby sẽ vào symbols table và so sánh là xong. Trong khi người anh em String thì không thể và để so sánh 2 chuỗi, ruby sẽ phải so sánh từng ký tự trong chuỗi này với từng ký tự trong chuỗi kia. Đây lại là một công việc vất vả.\n\nVà thế là ta đã hiểu performance, Symbol win ez.\n\nĐể thử nghiệm bạn có thể sử dụng thư viện benchmark để kiểm nghiệm kết luận.\n\n## 5. Điểm yếu của Symbol\n\nNếu Symbol toàn năng, toàn thiện thì đã không có lý do gì nó không thay thế luôn String. Bản chất của điểm yếu của Symbol cũng chính là điểm mạnh của nó.\n\nĐó chính là tính chất immutable.\n\nVì không phải khi nào cũng cần một đối tượng immutable, tôi có một input là tên người dùng nhập vào. Tôi muốn chắc chắn là sẽ lưu tên người dùng dưới dạng chữ hoa trong csdl. Vì vậy tôi chạy method **upcase!**.\n\nTuy nhiên, Symbol là immutable mà phương thức **upcase!** lại có mục tiêu thay đổi giá trị của đối tượng và thế là chương trình bắn ra một error về việc bạn đang cố thay đổi giá trị của symbol.\n\nTrong trường hợp này rõ ràng sử dụng String là điều hiển nhiên.\n","slug":"2019-06-09-so-sanh-symbol-va-string-trong-ruby","published":1,"updated":"2022-01-29T09:29:59.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsax001mp3m2epto803r","content":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Symbol là khái niệm rất quen tai và quen tay với lập trình viên ruby, ắt hẳn ai cũng đã từng nghe không ít thì nhiều, bản thân symbol cũng xuất hiện rất thường xuyên trong rails framework.</p>\n<p>Khi tôi là thực tập sinh, tôi nhận được nhiều lời khuyên về việc nên sử dụng symbol nhưng chưa từng được nghe 1 lý giải đủ rõ ràng về việc vì sao nên sử dụng nó, mà có lẽ tôi cũng không thích nó, sự xuất hiện của symbol làm cú pháp trong rails không thống nhất khi có thể viết nhiều kiểu để biểu hiện cùng một ý nghĩa. Tôi không thích việc không đồng bộ đó chút nào.</p>\n<p>Có một lý giải đơn giản và dễ nhớ để phân biệt giữa 2 đối tượng này đó là: Symbol mà giá trị giống nhau thì có cùng object_id, còn String thì dù giá trị giống nhau, mỗi chuỗi vẫn sẽ có một object_id khác nhau.<br>Liệu lý giải này đã đủ? Hãy cùng tìm hiểu.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Khai-bao-va-tu-tuong\"><a href=\"#1-Khai-bao-va-tu-tuong\" class=\"headerlink\" title=\"1. Khai báo và tư tưởng\"></a>1. Khai báo và tư tưởng</h2><p>Để khai báo một symbol bạn thêm dấu <strong>:</strong> đằng trước.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">:meo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">:<span class=\"string\">\"meo\"</span></span></span><br></pre></td></tr></table></figure>\n\n<p>Đơn giản như trên, ta đã khai báo bằng 2 cách khác nhau. Nhưng thực tế ruby hiểu là chúng cùng là 1 symbol.</p>\n<p>Điểm cần phải nói rõ trước khi đi xuống các phần sau đó là:</p>\n<ol>\n<li><p>Symbol thực chất cũng là một String.</p>\n</li>\n<li><p>Symbol là một <a href=\"https://hdchinh.com/programing/2019/04/08/immutable-va-mutable-trong-ruby.html\" target=\"_blank\" rel=\"noopener\">immutable</a>.</p>\n</li>\n</ol>\n<h2 id=\"2-Mutable-va-Immutable\"><a href=\"#2-Mutable-va-Immutable\" class=\"headerlink\" title=\"2. Mutable và Immutable\"></a>2. Mutable và Immutable</h2><p>Tôi đã từng trình bày một bài viết về chủ đề này. Các bạn có thể tham khảo tại <a href=\"https://hdchinh.com/programing/2019/04/08/immutable-va-mutable-trong-ruby.html\" target=\"_blank\" rel=\"noopener\">đây</a>.</p>\n<p>Nhưng nói một cách vắn tắt thì biến X là một immutable khi mà vùng nhớ lưu giá trị của X không thể được thay đổi giá trị.</p>\n<p>Như trình bày ở mục 1, symbol là immutable (khác với string thì là mutable).</p>\n<p>Chúng ta có thể kết luận rằng, symbol thực chất là một string có tính chất bất biến giá trị (immutable).</p>\n<p>Câu hỏi đặt ra là: Tại sao tôi lại cần những biến không thể thay đổi giá trị?</p>\n<ol>\n<li><p>Trong quá trình lập trình, chúng ta cần một số biến không thể bị thay đổi giá trị trong quá trình sử dụng, để đảm bảo tính đúng đắn của chương trình. (Tôi không có ví dụ cụ thể nào).</p>\n</li>\n<li><p>Vì là mutable, nên mỗi khi một string được gọi, bất kể là các chuỗi có giống nhau hay không, ruby luôn tạo ra một vùng nhớ mới cho chúng.</p>\n</li>\n</ol>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">\"Chinh\"</span>.object_id</span><br><span class=\"line\"><span class=\"comment\">#  =&gt; 70159285001700</span></span><br><span class=\"line\"><span class=\"string\">\"Chinh\"</span>.object_id</span><br><span class=\"line\"><span class=\"comment\"># =&gt; 70159284996100</span></span><br><span class=\"line\"><span class=\"string\">\"Chinh\"</span>.object_id</span><br><span class=\"line\"><span class=\"comment\"># =&gt; 70159289079920</span></span><br></pre></td></tr></table></figure>\n\n<p>Ba chuỗi cùng một nội dung, nhưng khi được gọi thì lại có 3 object_id khác nhau, chứng tỏ rằng dù cùng giá trị nhưng ruby coi chúng là 3 đối tượng khác nhau và lưu trữ mỗi vùng nhớ riêng cho từng chuỗi.</p>\n<p><strong>Vấn đề phát sinh từ đây khi mà  vùng nhớ bị lãng phí.</strong></p>\n<p>Hãy cùng thử với symbol.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">:<span class=\"string\">\"Chinh\"</span></span>.object_id</span><br><span class=\"line\"><span class=\"comment\"># =&gt; 1271588</span></span><br><span class=\"line\"><span class=\"symbol\">:<span class=\"string\">\"Chinh\"</span></span>.object_id</span><br><span class=\"line\"><span class=\"comment\"># =&gt; 1271588</span></span><br><span class=\"line\"><span class=\"symbol\">:<span class=\"string\">\"Chinh\"</span></span>.object_id</span><br><span class=\"line\"><span class=\"comment\"># =&gt; 1271588</span></span><br></pre></td></tr></table></figure>\n\n<p>Thật tuyệt, vậy là bằng một cách nào đó, khi sử dụng symbol, ruby biết được symbol này đã tồn tại hay chưa, nếu tồn tại rồi thì khi được gọi chúng sẽ dùng lại đối tượng đã có chứ không tạo thêm vùng nhớ mới.</p>\n<h2 id=\"3-Symbol-va-String-duoc-luu-tru-nhu-nao\"><a href=\"#3-Symbol-va-String-duoc-luu-tru-nhu-nao\" class=\"headerlink\" title=\"3. Symbol và String được lưu trữ như nào.\"></a>3. Symbol và String được lưu trữ như nào.</h2><p>Một tiêu đề có vẻ buồn cười, vì cái đối tượng trong ruby tất nhiên được lưu ở bộ nhớ trong với phân vùng gọi là heap.</p>\n<p>Hiển nhiên String không ngoại lệ.</p>\n<p>Nếu String được lưu trữ một cách bình thường và không thể kiểm soát xem nó lưu những gì (vì nó là mutable). Nên khi tạo ra một đối tượng String mới, Ruby sẽ tìm một vùng nhớ trống và lưu nó tại đó và không quan tâm xem là có bao nhiêu String đang hoạt động trong chương trình có nội dung giống nhau.</p>\n<p>Vậy Symbol thì sao? Như đã trình bày ở mục trên thì bằng cách nào đó mà ruby có thể biết được symbol đã tồn tại hay chưa, nếu tồn tại thì xài lại còn chưa thì mới tạo ra vùng nhớ mới. Vậy chúng làm vậy bằng cách nào?</p>\n<p>Thực ra không hề có phép màu nào ở đây cả, muốn truy vết symbol như nói ở trên thì chúng buộc phải được lưu trữ và quản lý dưới 1 dạng cơ sở dữ liệu nào đó.</p>\n<p>Sự thật là Symbol được lưu trữ thành một table (thôi cứ tạm gọi là vậy), trong suốt quá trình vận hành một chương trình. Cứ tưởng tượng như việc bạn có 1 bảng trong excel, và khi có một dữ liệu mới được yêu cầu, bạn sẽ tra trong bảng excel này trước coi có chưa, nếu có rồi thì lấy ra xài lại. Còn nếu không có? thì sẽ làm 2 việc:</p>\n<ol>\n<li>Tạo dữ liệu đó.</li>\n<li>Lưu lại trong bảng để lần sau tra cứu.</li>\n</ol>\n<p>Để lấy giá trị trong table lưu symbol nói trên ta có thể dụng lệnh:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">puts Symbol.all_symbols</span><br><span class=\"line\"><span class=\"comment\"># hoặc lấy tổng số symbol đã được lưu trữ trong chương trình.</span></span><br><span class=\"line\">puts Symbol.all_symbols.size</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Ve-toc-do-thuc-thi\"><a href=\"#4-Ve-toc-do-thuc-thi\" class=\"headerlink\" title=\"4. Về tốc độ thực thi\"></a>4. Về tốc độ thực thi</h2><p>Qua những gì để phân tích. Ta rút ra một kết luận là Symbol thì tiết kiệm vùng nhớ một cách đáng kể so với String (xem lại cơ chế lưu vào table bên trên).</p>\n<p>Nhưng vậy ngoài ra thì chúng còn gì khác biệt nữa không? Về performance thì sao?</p>\n<p>Câu trả lời là Symbol vẫn nổi trội hơn String ở tốc độ thực thi:</p>\n<ol>\n<li>Trong trường hợp tạo một đối tượng mới: Symbol có thể sử dụng lại, còn String thì luôn luôn tạo mới. Ủa vậy thì tạo mới String phải nhanh hơn chứ ta. Vì nó không cần quét lại bảng table symbols mà luôn luôn tạo đối tượng mới, trong khi đó thì Symbol phải quét lại trước rồi nếu không có mới tạo đối tượng.</li>\n</ol>\n<p>Nhưng mọi thứ không đơn giản như vậy, Trong ruby có một module gọi tắt là GC có chức năng thu gòm “rác”, rác ở đây là các string được khai báo nhưng không còn sử dụng, GC sẽ thu hồi vùng nhớ của chúng để lấy không gian cho các đối tượng khác. Đây là một công việc vất vả.</p>\n<p>Flow đơn giản của nó sẽ là:  GC quét các đối tượng =&gt; Đánh dấu các đối tượng không được sử dụng =&gt; Khi chương trình trong thời gian rảnh rỗi thì GC sẽ thu gồm vùng nhớ của các đối tượng bị đánh dấu. Sẽ tốt không ít thời gian cho công đoạn này.</p>\n<p>Vì vậy về mặt performance khi tạo đối tượng mới, Symbol vẫn giành chiến thắng.</p>\n<ol start=\"2\">\n<li>Trong trường hợp so sánh 2 đối tượng: Chiến thắng một lần nữa thuộc về Symbol.</li>\n</ol>\n<p>Lý do thì lần này khá đơn giản: Khi cần so sánh 2 symbol, ruby sẽ vào symbols table và so sánh là xong. Trong khi người anh em String thì không thể và để so sánh 2 chuỗi, ruby sẽ phải so sánh từng ký tự trong chuỗi này với từng ký tự trong chuỗi kia. Đây lại là một công việc vất vả.</p>\n<p>Và thế là ta đã hiểu performance, Symbol win ez.</p>\n<p>Để thử nghiệm bạn có thể sử dụng thư viện benchmark để kiểm nghiệm kết luận.</p>\n<h2 id=\"5-Diem-yeu-cua-Symbol\"><a href=\"#5-Diem-yeu-cua-Symbol\" class=\"headerlink\" title=\"5. Điểm yếu của Symbol\"></a>5. Điểm yếu của Symbol</h2><p>Nếu Symbol toàn năng, toàn thiện thì đã không có lý do gì nó không thay thế luôn String. Bản chất của điểm yếu của Symbol cũng chính là điểm mạnh của nó.</p>\n<p>Đó chính là tính chất immutable.</p>\n<p>Vì không phải khi nào cũng cần một đối tượng immutable, tôi có một input là tên người dùng nhập vào. Tôi muốn chắc chắn là sẽ lưu tên người dùng dưới dạng chữ hoa trong csdl. Vì vậy tôi chạy method <strong>upcase!</strong>.</p>\n<p>Tuy nhiên, Symbol là immutable mà phương thức <strong>upcase!</strong> lại có mục tiêu thay đổi giá trị của đối tượng và thế là chương trình bắn ra một error về việc bạn đang cố thay đổi giá trị của symbol.</p>\n<p>Trong trường hợp này rõ ràng sử dụng String là điều hiển nhiên.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Symbol là khái niệm rất quen tai và quen tay với lập trình viên ruby, ắt hẳn ai cũng đã từng nghe không ít thì nhiều, bản thân symbol cũng xuất hiện rất thường xuyên trong rails framework.</p>\n<p>Khi tôi là thực tập sinh, tôi nhận được nhiều lời khuyên về việc nên sử dụng symbol nhưng chưa từng được nghe 1 lý giải đủ rõ ràng về việc vì sao nên sử dụng nó, mà có lẽ tôi cũng không thích nó, sự xuất hiện của symbol làm cú pháp trong rails không thống nhất khi có thể viết nhiều kiểu để biểu hiện cùng một ý nghĩa. Tôi không thích việc không đồng bộ đó chút nào.</p>\n<p>Có một lý giải đơn giản và dễ nhớ để phân biệt giữa 2 đối tượng này đó là: Symbol mà giá trị giống nhau thì có cùng object_id, còn String thì dù giá trị giống nhau, mỗi chuỗi vẫn sẽ có một object_id khác nhau.<br>Liệu lý giải này đã đủ? Hãy cùng tìm hiểu.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Khai-bao-va-tu-tuong\"><a href=\"#1-Khai-bao-va-tu-tuong\" class=\"headerlink\" title=\"1. Khai báo và tư tưởng\"></a>1. Khai báo và tư tưởng</h2><p>Để khai báo một symbol bạn thêm dấu <strong>:</strong> đằng trước.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">:meo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"symbol\">:<span class=\"string\">\"meo\"</span></span></span><br></pre></td></tr></table></figure>\n\n<p>Đơn giản như trên, ta đã khai báo bằng 2 cách khác nhau. Nhưng thực tế ruby hiểu là chúng cùng là 1 symbol.</p>\n<p>Điểm cần phải nói rõ trước khi đi xuống các phần sau đó là:</p>\n<ol>\n<li><p>Symbol thực chất cũng là một String.</p>\n</li>\n<li><p>Symbol là một <a href=\"https://hdchinh.com/programing/2019/04/08/immutable-va-mutable-trong-ruby.html\" target=\"_blank\" rel=\"noopener\">immutable</a>.</p>\n</li>\n</ol>\n<h2 id=\"2-Mutable-va-Immutable\"><a href=\"#2-Mutable-va-Immutable\" class=\"headerlink\" title=\"2. Mutable và Immutable\"></a>2. Mutable và Immutable</h2><p>Tôi đã từng trình bày một bài viết về chủ đề này. Các bạn có thể tham khảo tại <a href=\"https://hdchinh.com/programing/2019/04/08/immutable-va-mutable-trong-ruby.html\" target=\"_blank\" rel=\"noopener\">đây</a>.</p>\n<p>Nhưng nói một cách vắn tắt thì biến X là một immutable khi mà vùng nhớ lưu giá trị của X không thể được thay đổi giá trị.</p>\n<p>Như trình bày ở mục 1, symbol là immutable (khác với string thì là mutable).</p>\n<p>Chúng ta có thể kết luận rằng, symbol thực chất là một string có tính chất bất biến giá trị (immutable).</p>\n<p>Câu hỏi đặt ra là: Tại sao tôi lại cần những biến không thể thay đổi giá trị?</p>\n<ol>\n<li><p>Trong quá trình lập trình, chúng ta cần một số biến không thể bị thay đổi giá trị trong quá trình sử dụng, để đảm bảo tính đúng đắn của chương trình. (Tôi không có ví dụ cụ thể nào).</p>\n</li>\n<li><p>Vì là mutable, nên mỗi khi một string được gọi, bất kể là các chuỗi có giống nhau hay không, ruby luôn tạo ra một vùng nhớ mới cho chúng.</p>\n</li>\n</ol>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">\"Chinh\"</span>.object_id</span><br><span class=\"line\"><span class=\"comment\">#  =&gt; 70159285001700</span></span><br><span class=\"line\"><span class=\"string\">\"Chinh\"</span>.object_id</span><br><span class=\"line\"><span class=\"comment\"># =&gt; 70159284996100</span></span><br><span class=\"line\"><span class=\"string\">\"Chinh\"</span>.object_id</span><br><span class=\"line\"><span class=\"comment\"># =&gt; 70159289079920</span></span><br></pre></td></tr></table></figure>\n\n<p>Ba chuỗi cùng một nội dung, nhưng khi được gọi thì lại có 3 object_id khác nhau, chứng tỏ rằng dù cùng giá trị nhưng ruby coi chúng là 3 đối tượng khác nhau và lưu trữ mỗi vùng nhớ riêng cho từng chuỗi.</p>\n<p><strong>Vấn đề phát sinh từ đây khi mà  vùng nhớ bị lãng phí.</strong></p>\n<p>Hãy cùng thử với symbol.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"symbol\">:<span class=\"string\">\"Chinh\"</span></span>.object_id</span><br><span class=\"line\"><span class=\"comment\"># =&gt; 1271588</span></span><br><span class=\"line\"><span class=\"symbol\">:<span class=\"string\">\"Chinh\"</span></span>.object_id</span><br><span class=\"line\"><span class=\"comment\"># =&gt; 1271588</span></span><br><span class=\"line\"><span class=\"symbol\">:<span class=\"string\">\"Chinh\"</span></span>.object_id</span><br><span class=\"line\"><span class=\"comment\"># =&gt; 1271588</span></span><br></pre></td></tr></table></figure>\n\n<p>Thật tuyệt, vậy là bằng một cách nào đó, khi sử dụng symbol, ruby biết được symbol này đã tồn tại hay chưa, nếu tồn tại rồi thì khi được gọi chúng sẽ dùng lại đối tượng đã có chứ không tạo thêm vùng nhớ mới.</p>\n<h2 id=\"3-Symbol-va-String-duoc-luu-tru-nhu-nao\"><a href=\"#3-Symbol-va-String-duoc-luu-tru-nhu-nao\" class=\"headerlink\" title=\"3. Symbol và String được lưu trữ như nào.\"></a>3. Symbol và String được lưu trữ như nào.</h2><p>Một tiêu đề có vẻ buồn cười, vì cái đối tượng trong ruby tất nhiên được lưu ở bộ nhớ trong với phân vùng gọi là heap.</p>\n<p>Hiển nhiên String không ngoại lệ.</p>\n<p>Nếu String được lưu trữ một cách bình thường và không thể kiểm soát xem nó lưu những gì (vì nó là mutable). Nên khi tạo ra một đối tượng String mới, Ruby sẽ tìm một vùng nhớ trống và lưu nó tại đó và không quan tâm xem là có bao nhiêu String đang hoạt động trong chương trình có nội dung giống nhau.</p>\n<p>Vậy Symbol thì sao? Như đã trình bày ở mục trên thì bằng cách nào đó mà ruby có thể biết được symbol đã tồn tại hay chưa, nếu tồn tại thì xài lại còn chưa thì mới tạo ra vùng nhớ mới. Vậy chúng làm vậy bằng cách nào?</p>\n<p>Thực ra không hề có phép màu nào ở đây cả, muốn truy vết symbol như nói ở trên thì chúng buộc phải được lưu trữ và quản lý dưới 1 dạng cơ sở dữ liệu nào đó.</p>\n<p>Sự thật là Symbol được lưu trữ thành một table (thôi cứ tạm gọi là vậy), trong suốt quá trình vận hành một chương trình. Cứ tưởng tượng như việc bạn có 1 bảng trong excel, và khi có một dữ liệu mới được yêu cầu, bạn sẽ tra trong bảng excel này trước coi có chưa, nếu có rồi thì lấy ra xài lại. Còn nếu không có? thì sẽ làm 2 việc:</p>\n<ol>\n<li>Tạo dữ liệu đó.</li>\n<li>Lưu lại trong bảng để lần sau tra cứu.</li>\n</ol>\n<p>Để lấy giá trị trong table lưu symbol nói trên ta có thể dụng lệnh:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">puts Symbol.all_symbols</span><br><span class=\"line\"><span class=\"comment\"># hoặc lấy tổng số symbol đã được lưu trữ trong chương trình.</span></span><br><span class=\"line\">puts Symbol.all_symbols.size</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Ve-toc-do-thuc-thi\"><a href=\"#4-Ve-toc-do-thuc-thi\" class=\"headerlink\" title=\"4. Về tốc độ thực thi\"></a>4. Về tốc độ thực thi</h2><p>Qua những gì để phân tích. Ta rút ra một kết luận là Symbol thì tiết kiệm vùng nhớ một cách đáng kể so với String (xem lại cơ chế lưu vào table bên trên).</p>\n<p>Nhưng vậy ngoài ra thì chúng còn gì khác biệt nữa không? Về performance thì sao?</p>\n<p>Câu trả lời là Symbol vẫn nổi trội hơn String ở tốc độ thực thi:</p>\n<ol>\n<li>Trong trường hợp tạo một đối tượng mới: Symbol có thể sử dụng lại, còn String thì luôn luôn tạo mới. Ủa vậy thì tạo mới String phải nhanh hơn chứ ta. Vì nó không cần quét lại bảng table symbols mà luôn luôn tạo đối tượng mới, trong khi đó thì Symbol phải quét lại trước rồi nếu không có mới tạo đối tượng.</li>\n</ol>\n<p>Nhưng mọi thứ không đơn giản như vậy, Trong ruby có một module gọi tắt là GC có chức năng thu gòm “rác”, rác ở đây là các string được khai báo nhưng không còn sử dụng, GC sẽ thu hồi vùng nhớ của chúng để lấy không gian cho các đối tượng khác. Đây là một công việc vất vả.</p>\n<p>Flow đơn giản của nó sẽ là:  GC quét các đối tượng =&gt; Đánh dấu các đối tượng không được sử dụng =&gt; Khi chương trình trong thời gian rảnh rỗi thì GC sẽ thu gồm vùng nhớ của các đối tượng bị đánh dấu. Sẽ tốt không ít thời gian cho công đoạn này.</p>\n<p>Vì vậy về mặt performance khi tạo đối tượng mới, Symbol vẫn giành chiến thắng.</p>\n<ol start=\"2\">\n<li>Trong trường hợp so sánh 2 đối tượng: Chiến thắng một lần nữa thuộc về Symbol.</li>\n</ol>\n<p>Lý do thì lần này khá đơn giản: Khi cần so sánh 2 symbol, ruby sẽ vào symbols table và so sánh là xong. Trong khi người anh em String thì không thể và để so sánh 2 chuỗi, ruby sẽ phải so sánh từng ký tự trong chuỗi này với từng ký tự trong chuỗi kia. Đây lại là một công việc vất vả.</p>\n<p>Và thế là ta đã hiểu performance, Symbol win ez.</p>\n<p>Để thử nghiệm bạn có thể sử dụng thư viện benchmark để kiểm nghiệm kết luận.</p>\n<h2 id=\"5-Diem-yeu-cua-Symbol\"><a href=\"#5-Diem-yeu-cua-Symbol\" class=\"headerlink\" title=\"5. Điểm yếu của Symbol\"></a>5. Điểm yếu của Symbol</h2><p>Nếu Symbol toàn năng, toàn thiện thì đã không có lý do gì nó không thay thế luôn String. Bản chất của điểm yếu của Symbol cũng chính là điểm mạnh của nó.</p>\n<p>Đó chính là tính chất immutable.</p>\n<p>Vì không phải khi nào cũng cần một đối tượng immutable, tôi có một input là tên người dùng nhập vào. Tôi muốn chắc chắn là sẽ lưu tên người dùng dưới dạng chữ hoa trong csdl. Vì vậy tôi chạy method <strong>upcase!</strong>.</p>\n<p>Tuy nhiên, Symbol là immutable mà phương thức <strong>upcase!</strong> lại có mục tiêu thay đổi giá trị của đối tượng và thế là chương trình bắn ra một error về việc bạn đang cố thay đổi giá trị của symbol.</p>\n<p>Trong trường hợp này rõ ràng sử dụng String là điều hiển nhiên.</p>\n"},{"title":"Tấn Công SQL Injection","date":"2019-06-07T17:00:00.000Z","draft":false,"_content":"\n## Đặt vấn đề\n\nTrong project của bạn, đã bao giờ bạn sử dụng câu lệnh có dạng như:\n\n```ruby\n  Product.where(\"product_name = 'Meo con di lon ton' \")\n```\n\nNếu có, thì bạn đã vô tình tạo một lỗ hổng về an toàn cho website của mình. Hãy cùng tìm hiểu vì sao lại như vậy.\n\n## Luận bàn\n\n## 1. Tìm hiểu về Sql Injection\n\nQuay lại ví dụ bên trên, nội dung câu lệnh này nhắm lấy ra sản phẩm có tên là **Meo con di lon ton**. Vậy có gì sai nhỉ?\n\nĐể nói rõ hơn, thì câu lệnh này là một câu lệnh được support bởi 1 thư viện ORM mặc định trong rails tên là ActiveRecord. Nó sẽ được phiên dịch thành mã sql như sau:\n\n```sql\n  SELECT  \"products\".* FROM \"products\" WHERE (product_name = 'Meo con di lon ton')\n```\n\nĐây vẫn là một câu lệnh quen thuộc, và nhìn qua thì không thấy gì sai trái cả.\n\nFlow hoạt động của website của tôi bình yên như vậy mà ta.\n\n1. Người dùng submit lên server product_name.\n\n2. Code xử lý ở server sẽ lấy product_name người dùng truyền lên và thực hiện truy vấn như trên.\n\n3. Trả về kết quả cho người dùng.\n\nVậy có gì mà không ổn?\n\nVới những người dùng thông thường thì. Đúng, mã nguồn của chúng ta hoàn toàn ổn. Nhưng nếu bạn là một ông chủ giàu có của một website nổi tiếng, và có nhiều kẻ ghét bạn vì bạn giàu hoặc nhìn mặt bạn thấy ghét và muốn tìm cách phá hoại website bạn thì sao?\n\n**Vậy là thay vì gửi một product_name thông thường như \"iphone x\", \"ghế tình yêu\"...Thì họ lại gửi một product_name có dạng như  **chinh' or '' = '****\n\nLúc này truy vấn của chúng ta sẽ trở thành:\n\n```ruby\n  Product.where(\"product_name = 'chinh' OR ''=''\")\n```\n\nChuyển sang dạng Sql:\n\n```sql\n  SELECT  \"products\".* FROM \"products\" WHERE (product_name = 'chinh' or '' = '')\n```\n\nVì điều kiện trong where luôn trả về true bất kể product_name có bằng 'xxx' hay không (vì '' thì luôn luôn bằng '' :smile:). Nên câu truy vấn này sẽ trả về toàn bộ bảng products.\n\nVà như vậy dữ liệu website của bạn đã bị lộ trước những kẻ không lấy gì làm tốt đẹp.\n\nTrên đây chỉ là một ví dụ sơ sài, trong thực tế dữ liệu của bạn sẽ quan trọng hơn nhiều là cái products information như trên. Có thể là thông tin liên lạc, địa chỉ nhà, thông tin tài khoản ngân hàng...\n\n## 2. Cách phòng tránh Sql Injection trong rails.\n\nCó thể thấy khi để query dạng string như trên thì rất dễ bị khai thác, vì ActiveRecord sẽ không thể validate giá trị input mà người dùng nhập vào có hợp lệ hay không. Vậy cách tốt nhất để chống lại Sql injection chính là sử dụng query theo params thay vì sử dụng chuỗi như trên.\n\nThay vì viết:\n\n```ruby\n  Product.where(\"product_name  = 'Meo con di lon ton'\")\n```\n\nTa có thể viết dưới dạng params query như sau:\n\n```ruby\n  Product.where(product_name: 'Meo con di lon ton')\n  # hoặc\n  Product.where('product_name = ?', ['Meo con di lon ton'])\n  # hoặc\n  Product.where('product_name = :product_name', {:product_name => 'Meo con di lon ton'})\n```\n\nVới các cách thay thế, giá trị người dùng truyền vào sẽ được đảm bảo hợp lệ trước khi có dữ liệu trả về...\n\n\n## Kết luận.\n\nĐây là một bài sơ sài, ngắn gọn và khái quát cho người mới tìm hiểu về sql injection. Không phải bài viết chuyên sâu dành cho người có nhiều kinh nghiệm. Hãy để lại thảo luận nếu bạn có thắc mắc.\n","source":"_posts/2019-06-08-tan-cong-sql-injection-va-cach-phong-chong-trong-rails.md","raw":"---\ntitle: \"Tấn Công SQL Injection\"\ndate: 2019-06-08\ndraft: false\ntags: [\"SECURE\", \"RAILS\"]\ncategories: [\"RAILS\"]\n\n---\n\n## Đặt vấn đề\n\nTrong project của bạn, đã bao giờ bạn sử dụng câu lệnh có dạng như:\n\n```ruby\n  Product.where(\"product_name = 'Meo con di lon ton' \")\n```\n\nNếu có, thì bạn đã vô tình tạo một lỗ hổng về an toàn cho website của mình. Hãy cùng tìm hiểu vì sao lại như vậy.\n\n## Luận bàn\n\n## 1. Tìm hiểu về Sql Injection\n\nQuay lại ví dụ bên trên, nội dung câu lệnh này nhắm lấy ra sản phẩm có tên là **Meo con di lon ton**. Vậy có gì sai nhỉ?\n\nĐể nói rõ hơn, thì câu lệnh này là một câu lệnh được support bởi 1 thư viện ORM mặc định trong rails tên là ActiveRecord. Nó sẽ được phiên dịch thành mã sql như sau:\n\n```sql\n  SELECT  \"products\".* FROM \"products\" WHERE (product_name = 'Meo con di lon ton')\n```\n\nĐây vẫn là một câu lệnh quen thuộc, và nhìn qua thì không thấy gì sai trái cả.\n\nFlow hoạt động của website của tôi bình yên như vậy mà ta.\n\n1. Người dùng submit lên server product_name.\n\n2. Code xử lý ở server sẽ lấy product_name người dùng truyền lên và thực hiện truy vấn như trên.\n\n3. Trả về kết quả cho người dùng.\n\nVậy có gì mà không ổn?\n\nVới những người dùng thông thường thì. Đúng, mã nguồn của chúng ta hoàn toàn ổn. Nhưng nếu bạn là một ông chủ giàu có của một website nổi tiếng, và có nhiều kẻ ghét bạn vì bạn giàu hoặc nhìn mặt bạn thấy ghét và muốn tìm cách phá hoại website bạn thì sao?\n\n**Vậy là thay vì gửi một product_name thông thường như \"iphone x\", \"ghế tình yêu\"...Thì họ lại gửi một product_name có dạng như  **chinh' or '' = '****\n\nLúc này truy vấn của chúng ta sẽ trở thành:\n\n```ruby\n  Product.where(\"product_name = 'chinh' OR ''=''\")\n```\n\nChuyển sang dạng Sql:\n\n```sql\n  SELECT  \"products\".* FROM \"products\" WHERE (product_name = 'chinh' or '' = '')\n```\n\nVì điều kiện trong where luôn trả về true bất kể product_name có bằng 'xxx' hay không (vì '' thì luôn luôn bằng '' :smile:). Nên câu truy vấn này sẽ trả về toàn bộ bảng products.\n\nVà như vậy dữ liệu website của bạn đã bị lộ trước những kẻ không lấy gì làm tốt đẹp.\n\nTrên đây chỉ là một ví dụ sơ sài, trong thực tế dữ liệu của bạn sẽ quan trọng hơn nhiều là cái products information như trên. Có thể là thông tin liên lạc, địa chỉ nhà, thông tin tài khoản ngân hàng...\n\n## 2. Cách phòng tránh Sql Injection trong rails.\n\nCó thể thấy khi để query dạng string như trên thì rất dễ bị khai thác, vì ActiveRecord sẽ không thể validate giá trị input mà người dùng nhập vào có hợp lệ hay không. Vậy cách tốt nhất để chống lại Sql injection chính là sử dụng query theo params thay vì sử dụng chuỗi như trên.\n\nThay vì viết:\n\n```ruby\n  Product.where(\"product_name  = 'Meo con di lon ton'\")\n```\n\nTa có thể viết dưới dạng params query như sau:\n\n```ruby\n  Product.where(product_name: 'Meo con di lon ton')\n  # hoặc\n  Product.where('product_name = ?', ['Meo con di lon ton'])\n  # hoặc\n  Product.where('product_name = :product_name', {:product_name => 'Meo con di lon ton'})\n```\n\nVới các cách thay thế, giá trị người dùng truyền vào sẽ được đảm bảo hợp lệ trước khi có dữ liệu trả về...\n\n\n## Kết luận.\n\nĐây là một bài sơ sài, ngắn gọn và khái quát cho người mới tìm hiểu về sql injection. Không phải bài viết chuyên sâu dành cho người có nhiều kinh nghiệm. Hãy để lại thảo luận nếu bạn có thắc mắc.\n","slug":"2019-06-08-tan-cong-sql-injection-va-cach-phong-chong-trong-rails","published":1,"updated":"2022-01-29T09:29:59.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsb3001rp3m24xpf63g1","content":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Trong project của bạn, đã bao giờ bạn sử dụng câu lệnh có dạng như:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.where(<span class=\"string\">\"product_name = 'Meo con di lon ton' \"</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Nếu có, thì bạn đã vô tình tạo một lỗ hổng về an toàn cho website của mình. Hãy cùng tìm hiểu vì sao lại như vậy.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Tim-hieu-ve-Sql-Injection\"><a href=\"#1-Tim-hieu-ve-Sql-Injection\" class=\"headerlink\" title=\"1. Tìm hiểu về Sql Injection\"></a>1. Tìm hiểu về Sql Injection</h2><p>Quay lại ví dụ bên trên, nội dung câu lệnh này nhắm lấy ra sản phẩm có tên là <strong>Meo con di lon ton</strong>. Vậy có gì sai nhỉ?</p>\n<p>Để nói rõ hơn, thì câu lệnh này là một câu lệnh được support bởi 1 thư viện ORM mặc định trong rails tên là ActiveRecord. Nó sẽ được phiên dịch thành mã sql như sau:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span>  <span class=\"string\">\"products\"</span>.* <span class=\"keyword\">FROM</span> <span class=\"string\">\"products\"</span> <span class=\"keyword\">WHERE</span> (product_name = <span class=\"string\">'Meo con di lon ton'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Đây vẫn là một câu lệnh quen thuộc, và nhìn qua thì không thấy gì sai trái cả.</p>\n<p>Flow hoạt động của website của tôi bình yên như vậy mà ta.</p>\n<ol>\n<li><p>Người dùng submit lên server product_name.</p>\n</li>\n<li><p>Code xử lý ở server sẽ lấy product_name người dùng truyền lên và thực hiện truy vấn như trên.</p>\n</li>\n<li><p>Trả về kết quả cho người dùng.</p>\n</li>\n</ol>\n<p>Vậy có gì mà không ổn?</p>\n<p>Với những người dùng thông thường thì. Đúng, mã nguồn của chúng ta hoàn toàn ổn. Nhưng nếu bạn là một ông chủ giàu có của một website nổi tiếng, và có nhiều kẻ ghét bạn vì bạn giàu hoặc nhìn mặt bạn thấy ghét và muốn tìm cách phá hoại website bạn thì sao?</p>\n<p><strong>Vậy là thay vì gửi một product_name thông thường như “iphone x”, “ghế tình yêu”…Thì họ lại gửi một product_name có dạng như  <strong>chinh’ or ‘’ = ‘</strong></strong></p>\n<p>Lúc này truy vấn của chúng ta sẽ trở thành:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.where(<span class=\"string\">\"product_name = 'chinh' OR ''=''\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Chuyển sang dạng Sql:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span>  <span class=\"string\">\"products\"</span>.* <span class=\"keyword\">FROM</span> <span class=\"string\">\"products\"</span> <span class=\"keyword\">WHERE</span> (product_name = <span class=\"string\">'chinh'</span> <span class=\"keyword\">or</span> <span class=\"string\">''</span> = <span class=\"string\">''</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Vì điều kiện trong where luôn trả về true bất kể product_name có bằng ‘xxx’ hay không (vì ‘’ thì luôn luôn bằng ‘’ :smile:). Nên câu truy vấn này sẽ trả về toàn bộ bảng products.</p>\n<p>Và như vậy dữ liệu website của bạn đã bị lộ trước những kẻ không lấy gì làm tốt đẹp.</p>\n<p>Trên đây chỉ là một ví dụ sơ sài, trong thực tế dữ liệu của bạn sẽ quan trọng hơn nhiều là cái products information như trên. Có thể là thông tin liên lạc, địa chỉ nhà, thông tin tài khoản ngân hàng…</p>\n<h2 id=\"2-Cach-phong-tranh-Sql-Injection-trong-rails\"><a href=\"#2-Cach-phong-tranh-Sql-Injection-trong-rails\" class=\"headerlink\" title=\"2. Cách phòng tránh Sql Injection trong rails.\"></a>2. Cách phòng tránh Sql Injection trong rails.</h2><p>Có thể thấy khi để query dạng string như trên thì rất dễ bị khai thác, vì ActiveRecord sẽ không thể validate giá trị input mà người dùng nhập vào có hợp lệ hay không. Vậy cách tốt nhất để chống lại Sql injection chính là sử dụng query theo params thay vì sử dụng chuỗi như trên.</p>\n<p>Thay vì viết:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.where(<span class=\"string\">\"product_name  = 'Meo con di lon ton'\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Ta có thể viết dưới dạng params query như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.where(<span class=\"symbol\">product_name:</span> <span class=\"string\">'Meo con di lon ton'</span>)</span><br><span class=\"line\"><span class=\"comment\"># hoặc</span></span><br><span class=\"line\">Product.where(<span class=\"string\">'product_name = ?'</span>, [<span class=\"string\">'Meo con di lon ton'</span>])</span><br><span class=\"line\"><span class=\"comment\"># hoặc</span></span><br><span class=\"line\">Product.where(<span class=\"string\">'product_name = :product_name'</span>, &#123;<span class=\"symbol\">:product_name</span> =&gt; <span class=\"string\">'Meo con di lon ton'</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Với các cách thay thế, giá trị người dùng truyền vào sẽ được đảm bảo hợp lệ trước khi có dữ liệu trả về…</p>\n<h2 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận.\"></a>Kết luận.</h2><p>Đây là một bài sơ sài, ngắn gọn và khái quát cho người mới tìm hiểu về sql injection. Không phải bài viết chuyên sâu dành cho người có nhiều kinh nghiệm. Hãy để lại thảo luận nếu bạn có thắc mắc.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Trong project của bạn, đã bao giờ bạn sử dụng câu lệnh có dạng như:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.where(<span class=\"string\">\"product_name = 'Meo con di lon ton' \"</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Nếu có, thì bạn đã vô tình tạo một lỗ hổng về an toàn cho website của mình. Hãy cùng tìm hiểu vì sao lại như vậy.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Tim-hieu-ve-Sql-Injection\"><a href=\"#1-Tim-hieu-ve-Sql-Injection\" class=\"headerlink\" title=\"1. Tìm hiểu về Sql Injection\"></a>1. Tìm hiểu về Sql Injection</h2><p>Quay lại ví dụ bên trên, nội dung câu lệnh này nhắm lấy ra sản phẩm có tên là <strong>Meo con di lon ton</strong>. Vậy có gì sai nhỉ?</p>\n<p>Để nói rõ hơn, thì câu lệnh này là một câu lệnh được support bởi 1 thư viện ORM mặc định trong rails tên là ActiveRecord. Nó sẽ được phiên dịch thành mã sql như sau:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span>  <span class=\"string\">\"products\"</span>.* <span class=\"keyword\">FROM</span> <span class=\"string\">\"products\"</span> <span class=\"keyword\">WHERE</span> (product_name = <span class=\"string\">'Meo con di lon ton'</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Đây vẫn là một câu lệnh quen thuộc, và nhìn qua thì không thấy gì sai trái cả.</p>\n<p>Flow hoạt động của website của tôi bình yên như vậy mà ta.</p>\n<ol>\n<li><p>Người dùng submit lên server product_name.</p>\n</li>\n<li><p>Code xử lý ở server sẽ lấy product_name người dùng truyền lên và thực hiện truy vấn như trên.</p>\n</li>\n<li><p>Trả về kết quả cho người dùng.</p>\n</li>\n</ol>\n<p>Vậy có gì mà không ổn?</p>\n<p>Với những người dùng thông thường thì. Đúng, mã nguồn của chúng ta hoàn toàn ổn. Nhưng nếu bạn là một ông chủ giàu có của một website nổi tiếng, và có nhiều kẻ ghét bạn vì bạn giàu hoặc nhìn mặt bạn thấy ghét và muốn tìm cách phá hoại website bạn thì sao?</p>\n<p><strong>Vậy là thay vì gửi một product_name thông thường như “iphone x”, “ghế tình yêu”…Thì họ lại gửi một product_name có dạng như  <strong>chinh’ or ‘’ = ‘</strong></strong></p>\n<p>Lúc này truy vấn của chúng ta sẽ trở thành:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.where(<span class=\"string\">\"product_name = 'chinh' OR ''=''\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Chuyển sang dạng Sql:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span>  <span class=\"string\">\"products\"</span>.* <span class=\"keyword\">FROM</span> <span class=\"string\">\"products\"</span> <span class=\"keyword\">WHERE</span> (product_name = <span class=\"string\">'chinh'</span> <span class=\"keyword\">or</span> <span class=\"string\">''</span> = <span class=\"string\">''</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Vì điều kiện trong where luôn trả về true bất kể product_name có bằng ‘xxx’ hay không (vì ‘’ thì luôn luôn bằng ‘’ :smile:). Nên câu truy vấn này sẽ trả về toàn bộ bảng products.</p>\n<p>Và như vậy dữ liệu website của bạn đã bị lộ trước những kẻ không lấy gì làm tốt đẹp.</p>\n<p>Trên đây chỉ là một ví dụ sơ sài, trong thực tế dữ liệu của bạn sẽ quan trọng hơn nhiều là cái products information như trên. Có thể là thông tin liên lạc, địa chỉ nhà, thông tin tài khoản ngân hàng…</p>\n<h2 id=\"2-Cach-phong-tranh-Sql-Injection-trong-rails\"><a href=\"#2-Cach-phong-tranh-Sql-Injection-trong-rails\" class=\"headerlink\" title=\"2. Cách phòng tránh Sql Injection trong rails.\"></a>2. Cách phòng tránh Sql Injection trong rails.</h2><p>Có thể thấy khi để query dạng string như trên thì rất dễ bị khai thác, vì ActiveRecord sẽ không thể validate giá trị input mà người dùng nhập vào có hợp lệ hay không. Vậy cách tốt nhất để chống lại Sql injection chính là sử dụng query theo params thay vì sử dụng chuỗi như trên.</p>\n<p>Thay vì viết:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.where(<span class=\"string\">\"product_name  = 'Meo con di lon ton'\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Ta có thể viết dưới dạng params query như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.where(<span class=\"symbol\">product_name:</span> <span class=\"string\">'Meo con di lon ton'</span>)</span><br><span class=\"line\"><span class=\"comment\"># hoặc</span></span><br><span class=\"line\">Product.where(<span class=\"string\">'product_name = ?'</span>, [<span class=\"string\">'Meo con di lon ton'</span>])</span><br><span class=\"line\"><span class=\"comment\"># hoặc</span></span><br><span class=\"line\">Product.where(<span class=\"string\">'product_name = :product_name'</span>, &#123;<span class=\"symbol\">:product_name</span> =&gt; <span class=\"string\">'Meo con di lon ton'</span>&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Với các cách thay thế, giá trị người dùng truyền vào sẽ được đảm bảo hợp lệ trước khi có dữ liệu trả về…</p>\n<h2 id=\"Ket-luan\"><a href=\"#Ket-luan\" class=\"headerlink\" title=\"Kết luận.\"></a>Kết luận.</h2><p>Đây là một bài sơ sài, ngắn gọn và khái quát cho người mới tìm hiểu về sql injection. Không phải bài viết chuyên sâu dành cho người có nhiều kinh nghiệm. Hãy để lại thảo luận nếu bạn có thắc mắc.</p>\n"},{"title":"Exception Trong Rails","date":"2019-06-09T17:00:00.000Z","draft":false,"_content":"\n## Đặt vấn đề\n\nTôi có một số tình huống diễn ra hàng ngày về con mèo của tôi. Nếu nó đói tôi cho nó ăn, nếu nó đi vs lung tung tôi sẽ dọn dẹp chúng.\n\nNhưng bỗng một ngày con mèo stupid của tôi bị \"người ngoài hành tinh bắt cóc\", wtf?. Đây là một tình huống không bình thường và tôi không có một **HÀNH ĐỘNG THỐNG NHẤT** nào để đối phó với 1 tình huống như vậy, tôi có thể khóc, có thể báo công an, nhưng chắc chắn không thể có một cách giải quyết triệt để. Trong lập trình ta gọi những tình huống mà logic luận lý sai lệch không còn đi theo logic bình thường như này là một exception.\n\nVí dụ như máy tính của bạn không được thiết kế để thực hiện phép chia cho số 0. Vậy khi bạn bắt nó thực hiện phép chia cho số 0, nó sẽ nghĩ \"wtf is going on?\" và đành quăng ra cho bạn một thông báo về việc bạn đã bắt nó làm một việc mà nó không được thiết kế để làm.\n\nTrong bài viết này chúng ta sẽ tìm hiểu về exception trong ruby.\n\n## Luận bàn\n\n## 1. Tìm hiểu về Exception\n\nĐầu tiên chúng ta phải ghi nhớ rằng khi một exception được gọi, chương trình của bạn sẽ ngừng và đoạn code phía sau không thể chạy được nữa.\n\n1. Tôi đến trường đón con mèo.\n\n2. Tôi đem con mèo đi bán vào quán tiểu hổ.\n\nNếu ở **bước 1**, thay vì đón thành công con mèo, tôi lại dính một exception \"MeoMissing\" vì lý do nó bị người ngoài hành tinh bắt cóc.\n\nKhi này dĩ nhiên chương trình sẽ dừng lại, vì tôi làm gì còn con mèo để mà đem nó đi bán ở  **bước 2**.\n\nQuay về với ví dụ đơn giản là chia cho số 0:\n\n```ruby\n10/0\n# => ZeroDivisionError (divided by 0)\n```\n\n**ZeroDivisionError** là một exception được ruby tạo ra để trả về khi bạn cố chia một số cho số 0.\n\n```\n  if (chia đàng hoàng)\n    thực hiện phép tính.\n  else\n    if (chia cho số 0)\n      trả về exception ZeroDivisionError\n    end\n  end\n```\n\nFlow logic đơn giản về exception như trên.\n\n## 2. Làm sao để lấy về đối tượng Exception\n\nNhư chúng ta đã biết, gần như mọi thứ trong ruby đều là object(Ngoại trừ method và block). Vậy nên Exception cũng là một đối tượng.\n\nZeroDivisionError ở trên là một Class, vậy khi bạn thực hiện một phép chia cho số 0, bạn đã rơi vào trường hợp mà ZeroDivisionError quản lý và nó sẽ trả về một đối tượng ZeroDivisionError.\n\nVậy tức là ở 2 lần chia cho số 0 khác nhau, nó sẽ trả về cho bạn 2 object exception khác nhau chỉ là cùng một class ZeroDivisionError.\n\nVậy cách nào để bắt được đối tượng này? Cú pháp để thực hiện việc này sẽ như sau:\n\n```ruby\nbegin\n  meo = 10\n  meo/0\nrescue ZeroDivisionError => e\n  puts \"Exception Class: #{ e.class.name }\"\n  puts \"Exception Message: #{ e.message }\"\nend\n```\n\n**rescue** là từ khoá sẽ giúp bạn lấy được đối tượng exception trả về. Như ví dụ trên tôi lấy đối tượng exeption trả về (nếu exception đó là dạng ZeroDivisionError) và truyền nó vào biến **e**. Từ đây **e** chính là object exception nếu exception đó xảy ra.\n\nTôi có thể dùng e để xuất ra các thông tin mà tôi cần như class name hay message thông báo lỗi.\n\n## 3. Xây dựng một class Exception\n\nMột sự thật hiển nhiên là những thiết kế có sẵn không bao giờ có thể cover cho tất cả các trường hợp có thể xảy ra trong thực tiễn. Đôi lúc bạn muốn thêm một exception để cover cho trường hợp của riêng dự án của bạn thì sao?\n\nCâu trả lời mà tôi mới tìm được khá thú vị và cũng rất quen thuộc. Đó là Exception cũng có thể được tạo ra như một class bình thường. Hãy để nó kế thừa lớp **StandardError** là được.\n\n```ruby\nclass MeoException < StandardError; end\n\n```\n\nVậy là ta đã có một class exception của riêng mình. Khi cần gọi đến exception này thì ta sẽ gọi sử dụng phương thức **raise** để gọi một đối tượng.\n\n```ruby\nraise MeoException.new(params_gi_do_ma_ban_muon)\n```\n\nVậy trong class class **MeoException** ta sẽ thiết kế những gì? :smile: Tôi cũng chưa tìm hiểu.\n\n## 4. Các lớp Exception có sẵn trong Ruby\n\n![hoa](/images/ruby-exception.jpg)\n\nĐây là sơ đồ về các lớp exception trong ruby, nếu ta rescue một exception X, X lại có dăm 3 exception con, thì chỉ cần chương trình của bạn phát sinh vấn đề và trả ra một exception con nào đó thì X được gọi.\n\n## 5. Cách bắt Exception hợp lý\n\n**Cách 1:**\n\n```ruby\nbegin\n  di_don_con_meo_truong()\nrescue Exception => e\n  # do something\nend\n```\n\nĐây là một cách tệ vì khi rescue với Exception, lớp cha của tất cả các Exception khác thì nó cover quá nhiều trường hợp cũng trả ra exception, hãy nhớ lại ở trên chúng ta đã nói một khi Exception được trả về thì chương trình của bạn sẽ dừng lại. Vậy nên không sử dụng cách này.\n\n**Cách 2:**\n\n```ruby\nbegin\n  di_don_con_meo_truong()\nrescue StandardError => e\n  # do something\nend\n```\n\nĐây là cách làm tốt hơn, vì ta chỉ cover các lỗi standard, ít ra chương trình của bạn sẽ không thi thoảng bị shutdown mà không biết vì sao như cách đầu tiên.\n\n**Cách 3:**\n\n```ruby\nbegin\n  di_don_con_meo_truong()\nrescue MeoBiBatCoc, MeoBiDauChan => e\n  # do something\nend\n```\n\nĐây là cách tốt nhất, ta goi trực tiếp đến trường hợp ngoại lệ mà ta cần bắt lấy và xử lý.\n","source":"_posts/2019-06-10-xu-ly-ngoai-le-trong-rails.md","raw":"---\ntitle: \"Exception Trong Rails\"\ndate: 2019-06-10\ndraft: false\ntags: [\"RAILS\"]\ncategories: [\"RAILS\"]\n---\n\n## Đặt vấn đề\n\nTôi có một số tình huống diễn ra hàng ngày về con mèo của tôi. Nếu nó đói tôi cho nó ăn, nếu nó đi vs lung tung tôi sẽ dọn dẹp chúng.\n\nNhưng bỗng một ngày con mèo stupid của tôi bị \"người ngoài hành tinh bắt cóc\", wtf?. Đây là một tình huống không bình thường và tôi không có một **HÀNH ĐỘNG THỐNG NHẤT** nào để đối phó với 1 tình huống như vậy, tôi có thể khóc, có thể báo công an, nhưng chắc chắn không thể có một cách giải quyết triệt để. Trong lập trình ta gọi những tình huống mà logic luận lý sai lệch không còn đi theo logic bình thường như này là một exception.\n\nVí dụ như máy tính của bạn không được thiết kế để thực hiện phép chia cho số 0. Vậy khi bạn bắt nó thực hiện phép chia cho số 0, nó sẽ nghĩ \"wtf is going on?\" và đành quăng ra cho bạn một thông báo về việc bạn đã bắt nó làm một việc mà nó không được thiết kế để làm.\n\nTrong bài viết này chúng ta sẽ tìm hiểu về exception trong ruby.\n\n## Luận bàn\n\n## 1. Tìm hiểu về Exception\n\nĐầu tiên chúng ta phải ghi nhớ rằng khi một exception được gọi, chương trình của bạn sẽ ngừng và đoạn code phía sau không thể chạy được nữa.\n\n1. Tôi đến trường đón con mèo.\n\n2. Tôi đem con mèo đi bán vào quán tiểu hổ.\n\nNếu ở **bước 1**, thay vì đón thành công con mèo, tôi lại dính một exception \"MeoMissing\" vì lý do nó bị người ngoài hành tinh bắt cóc.\n\nKhi này dĩ nhiên chương trình sẽ dừng lại, vì tôi làm gì còn con mèo để mà đem nó đi bán ở  **bước 2**.\n\nQuay về với ví dụ đơn giản là chia cho số 0:\n\n```ruby\n10/0\n# => ZeroDivisionError (divided by 0)\n```\n\n**ZeroDivisionError** là một exception được ruby tạo ra để trả về khi bạn cố chia một số cho số 0.\n\n```\n  if (chia đàng hoàng)\n    thực hiện phép tính.\n  else\n    if (chia cho số 0)\n      trả về exception ZeroDivisionError\n    end\n  end\n```\n\nFlow logic đơn giản về exception như trên.\n\n## 2. Làm sao để lấy về đối tượng Exception\n\nNhư chúng ta đã biết, gần như mọi thứ trong ruby đều là object(Ngoại trừ method và block). Vậy nên Exception cũng là một đối tượng.\n\nZeroDivisionError ở trên là một Class, vậy khi bạn thực hiện một phép chia cho số 0, bạn đã rơi vào trường hợp mà ZeroDivisionError quản lý và nó sẽ trả về một đối tượng ZeroDivisionError.\n\nVậy tức là ở 2 lần chia cho số 0 khác nhau, nó sẽ trả về cho bạn 2 object exception khác nhau chỉ là cùng một class ZeroDivisionError.\n\nVậy cách nào để bắt được đối tượng này? Cú pháp để thực hiện việc này sẽ như sau:\n\n```ruby\nbegin\n  meo = 10\n  meo/0\nrescue ZeroDivisionError => e\n  puts \"Exception Class: #{ e.class.name }\"\n  puts \"Exception Message: #{ e.message }\"\nend\n```\n\n**rescue** là từ khoá sẽ giúp bạn lấy được đối tượng exception trả về. Như ví dụ trên tôi lấy đối tượng exeption trả về (nếu exception đó là dạng ZeroDivisionError) và truyền nó vào biến **e**. Từ đây **e** chính là object exception nếu exception đó xảy ra.\n\nTôi có thể dùng e để xuất ra các thông tin mà tôi cần như class name hay message thông báo lỗi.\n\n## 3. Xây dựng một class Exception\n\nMột sự thật hiển nhiên là những thiết kế có sẵn không bao giờ có thể cover cho tất cả các trường hợp có thể xảy ra trong thực tiễn. Đôi lúc bạn muốn thêm một exception để cover cho trường hợp của riêng dự án của bạn thì sao?\n\nCâu trả lời mà tôi mới tìm được khá thú vị và cũng rất quen thuộc. Đó là Exception cũng có thể được tạo ra như một class bình thường. Hãy để nó kế thừa lớp **StandardError** là được.\n\n```ruby\nclass MeoException < StandardError; end\n\n```\n\nVậy là ta đã có một class exception của riêng mình. Khi cần gọi đến exception này thì ta sẽ gọi sử dụng phương thức **raise** để gọi một đối tượng.\n\n```ruby\nraise MeoException.new(params_gi_do_ma_ban_muon)\n```\n\nVậy trong class class **MeoException** ta sẽ thiết kế những gì? :smile: Tôi cũng chưa tìm hiểu.\n\n## 4. Các lớp Exception có sẵn trong Ruby\n\n![hoa](/images/ruby-exception.jpg)\n\nĐây là sơ đồ về các lớp exception trong ruby, nếu ta rescue một exception X, X lại có dăm 3 exception con, thì chỉ cần chương trình của bạn phát sinh vấn đề và trả ra một exception con nào đó thì X được gọi.\n\n## 5. Cách bắt Exception hợp lý\n\n**Cách 1:**\n\n```ruby\nbegin\n  di_don_con_meo_truong()\nrescue Exception => e\n  # do something\nend\n```\n\nĐây là một cách tệ vì khi rescue với Exception, lớp cha của tất cả các Exception khác thì nó cover quá nhiều trường hợp cũng trả ra exception, hãy nhớ lại ở trên chúng ta đã nói một khi Exception được trả về thì chương trình của bạn sẽ dừng lại. Vậy nên không sử dụng cách này.\n\n**Cách 2:**\n\n```ruby\nbegin\n  di_don_con_meo_truong()\nrescue StandardError => e\n  # do something\nend\n```\n\nĐây là cách làm tốt hơn, vì ta chỉ cover các lỗi standard, ít ra chương trình của bạn sẽ không thi thoảng bị shutdown mà không biết vì sao như cách đầu tiên.\n\n**Cách 3:**\n\n```ruby\nbegin\n  di_don_con_meo_truong()\nrescue MeoBiBatCoc, MeoBiDauChan => e\n  # do something\nend\n```\n\nĐây là cách tốt nhất, ta goi trực tiếp đến trường hợp ngoại lệ mà ta cần bắt lấy và xử lý.\n","slug":"2019-06-10-xu-ly-ngoai-le-trong-rails","published":1,"updated":"2022-01-29T09:29:59.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsb4001up3m24ams57lp","content":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Tôi có một số tình huống diễn ra hàng ngày về con mèo của tôi. Nếu nó đói tôi cho nó ăn, nếu nó đi vs lung tung tôi sẽ dọn dẹp chúng.</p>\n<p>Nhưng bỗng một ngày con mèo stupid của tôi bị “người ngoài hành tinh bắt cóc”, wtf?. Đây là một tình huống không bình thường và tôi không có một <strong>HÀNH ĐỘNG THỐNG NHẤT</strong> nào để đối phó với 1 tình huống như vậy, tôi có thể khóc, có thể báo công an, nhưng chắc chắn không thể có một cách giải quyết triệt để. Trong lập trình ta gọi những tình huống mà logic luận lý sai lệch không còn đi theo logic bình thường như này là một exception.</p>\n<p>Ví dụ như máy tính của bạn không được thiết kế để thực hiện phép chia cho số 0. Vậy khi bạn bắt nó thực hiện phép chia cho số 0, nó sẽ nghĩ “wtf is going on?” và đành quăng ra cho bạn một thông báo về việc bạn đã bắt nó làm một việc mà nó không được thiết kế để làm.</p>\n<p>Trong bài viết này chúng ta sẽ tìm hiểu về exception trong ruby.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Tim-hieu-ve-Exception\"><a href=\"#1-Tim-hieu-ve-Exception\" class=\"headerlink\" title=\"1. Tìm hiểu về Exception\"></a>1. Tìm hiểu về Exception</h2><p>Đầu tiên chúng ta phải ghi nhớ rằng khi một exception được gọi, chương trình của bạn sẽ ngừng và đoạn code phía sau không thể chạy được nữa.</p>\n<ol>\n<li><p>Tôi đến trường đón con mèo.</p>\n</li>\n<li><p>Tôi đem con mèo đi bán vào quán tiểu hổ.</p>\n</li>\n</ol>\n<p>Nếu ở <strong>bước 1</strong>, thay vì đón thành công con mèo, tôi lại dính một exception “MeoMissing” vì lý do nó bị người ngoài hành tinh bắt cóc.</p>\n<p>Khi này dĩ nhiên chương trình sẽ dừng lại, vì tôi làm gì còn con mèo để mà đem nó đi bán ở  <strong>bước 2</strong>.</p>\n<p>Quay về với ví dụ đơn giản là chia cho số 0:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">10</span>/<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; ZeroDivisionError (divided by 0)</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>ZeroDivisionError</strong> là một exception được ruby tạo ra để trả về khi bạn cố chia một số cho số 0.</p>\n<figure class=\"highlight gauss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (chia đàng hoàng)</span><br><span class=\"line\">  thực hiện phép tính.</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (chia cho số <span class=\"number\">0</span>)</span><br><span class=\"line\">    trả về exception ZeroDivisionError</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Flow logic đơn giản về exception như trên.</p>\n<h2 id=\"2-Lam-sao-de-lay-ve-doi-tuong-Exception\"><a href=\"#2-Lam-sao-de-lay-ve-doi-tuong-Exception\" class=\"headerlink\" title=\"2. Làm sao để lấy về đối tượng Exception\"></a>2. Làm sao để lấy về đối tượng Exception</h2><p>Như chúng ta đã biết, gần như mọi thứ trong ruby đều là object(Ngoại trừ method và block). Vậy nên Exception cũng là một đối tượng.</p>\n<p>ZeroDivisionError ở trên là một Class, vậy khi bạn thực hiện một phép chia cho số 0, bạn đã rơi vào trường hợp mà ZeroDivisionError quản lý và nó sẽ trả về một đối tượng ZeroDivisionError.</p>\n<p>Vậy tức là ở 2 lần chia cho số 0 khác nhau, nó sẽ trả về cho bạn 2 object exception khác nhau chỉ là cùng một class ZeroDivisionError.</p>\n<p>Vậy cách nào để bắt được đối tượng này? Cú pháp để thực hiện việc này sẽ như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  meo = <span class=\"number\">10</span></span><br><span class=\"line\">  meo/<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">rescue</span> ZeroDivisionError =&gt; e</span><br><span class=\"line\">  puts <span class=\"string\">\"Exception Class: <span class=\"subst\">#&#123; e<span class=\"class\">.<span class=\"keyword\">class</span>.<span class=\"title\">name</span> &#125;\"</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">  puts <span class=\"string\">\"Exception Message: <span class=\"subst\">#&#123; e.message &#125;</span>\"</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"keyword\">end</span></span></span></span><br></pre></td></tr></table></figure>\n\n<p><strong>rescue</strong> là từ khoá sẽ giúp bạn lấy được đối tượng exception trả về. Như ví dụ trên tôi lấy đối tượng exeption trả về (nếu exception đó là dạng ZeroDivisionError) và truyền nó vào biến <strong>e</strong>. Từ đây <strong>e</strong> chính là object exception nếu exception đó xảy ra.</p>\n<p>Tôi có thể dùng e để xuất ra các thông tin mà tôi cần như class name hay message thông báo lỗi.</p>\n<h2 id=\"3-Xay-dung-mot-class-Exception\"><a href=\"#3-Xay-dung-mot-class-Exception\" class=\"headerlink\" title=\"3. Xây dựng một class Exception\"></a>3. Xây dựng một class Exception</h2><p>Một sự thật hiển nhiên là những thiết kế có sẵn không bao giờ có thể cover cho tất cả các trường hợp có thể xảy ra trong thực tiễn. Đôi lúc bạn muốn thêm một exception để cover cho trường hợp của riêng dự án của bạn thì sao?</p>\n<p>Câu trả lời mà tôi mới tìm được khá thú vị và cũng rất quen thuộc. Đó là Exception cũng có thể được tạo ra như một class bình thường. Hãy để nó kế thừa lớp <strong>StandardError</strong> là được.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MeoException</span> &lt; StandardError;</span> <span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Vậy là ta đã có một class exception của riêng mình. Khi cần gọi đến exception này thì ta sẽ gọi sử dụng phương thức <strong>raise</strong> để gọi một đối tượng.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raise MeoException.new(params_gi_do_ma_ban_muon)</span><br></pre></td></tr></table></figure>\n\n<p>Vậy trong class class <strong>MeoException</strong> ta sẽ thiết kế những gì? :smile: Tôi cũng chưa tìm hiểu.</p>\n<h2 id=\"4-Cac-lop-Exception-co-san-trong-Ruby\"><a href=\"#4-Cac-lop-Exception-co-san-trong-Ruby\" class=\"headerlink\" title=\"4. Các lớp Exception có sẵn trong Ruby\"></a>4. Các lớp Exception có sẵn trong Ruby</h2><p><img src=\"/images/ruby-exception.jpg\" alt=\"hoa\"></p>\n<p>Đây là sơ đồ về các lớp exception trong ruby, nếu ta rescue một exception X, X lại có dăm 3 exception con, thì chỉ cần chương trình của bạn phát sinh vấn đề và trả ra một exception con nào đó thì X được gọi.</p>\n<h2 id=\"5-Cach-bat-Exception-hop-ly\"><a href=\"#5-Cach-bat-Exception-hop-ly\" class=\"headerlink\" title=\"5. Cách bắt Exception hợp lý\"></a>5. Cách bắt Exception hợp lý</h2><p><strong>Cách 1:</strong></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  di_don_con_meo_truong()</span><br><span class=\"line\"><span class=\"keyword\">rescue</span> Exception =&gt; e</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đây là một cách tệ vì khi rescue với Exception, lớp cha của tất cả các Exception khác thì nó cover quá nhiều trường hợp cũng trả ra exception, hãy nhớ lại ở trên chúng ta đã nói một khi Exception được trả về thì chương trình của bạn sẽ dừng lại. Vậy nên không sử dụng cách này.</p>\n<p><strong>Cách 2:</strong></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  di_don_con_meo_truong()</span><br><span class=\"line\"><span class=\"keyword\">rescue</span> StandardError =&gt; e</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đây là cách làm tốt hơn, vì ta chỉ cover các lỗi standard, ít ra chương trình của bạn sẽ không thi thoảng bị shutdown mà không biết vì sao như cách đầu tiên.</p>\n<p><strong>Cách 3:</strong></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  di_don_con_meo_truong()</span><br><span class=\"line\"><span class=\"keyword\">rescue</span> MeoBiBatCoc, MeoBiDauChan =&gt; e</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đây là cách tốt nhất, ta goi trực tiếp đến trường hợp ngoại lệ mà ta cần bắt lấy và xử lý.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Tôi có một số tình huống diễn ra hàng ngày về con mèo của tôi. Nếu nó đói tôi cho nó ăn, nếu nó đi vs lung tung tôi sẽ dọn dẹp chúng.</p>\n<p>Nhưng bỗng một ngày con mèo stupid của tôi bị “người ngoài hành tinh bắt cóc”, wtf?. Đây là một tình huống không bình thường và tôi không có một <strong>HÀNH ĐỘNG THỐNG NHẤT</strong> nào để đối phó với 1 tình huống như vậy, tôi có thể khóc, có thể báo công an, nhưng chắc chắn không thể có một cách giải quyết triệt để. Trong lập trình ta gọi những tình huống mà logic luận lý sai lệch không còn đi theo logic bình thường như này là một exception.</p>\n<p>Ví dụ như máy tính của bạn không được thiết kế để thực hiện phép chia cho số 0. Vậy khi bạn bắt nó thực hiện phép chia cho số 0, nó sẽ nghĩ “wtf is going on?” và đành quăng ra cho bạn một thông báo về việc bạn đã bắt nó làm một việc mà nó không được thiết kế để làm.</p>\n<p>Trong bài viết này chúng ta sẽ tìm hiểu về exception trong ruby.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Tim-hieu-ve-Exception\"><a href=\"#1-Tim-hieu-ve-Exception\" class=\"headerlink\" title=\"1. Tìm hiểu về Exception\"></a>1. Tìm hiểu về Exception</h2><p>Đầu tiên chúng ta phải ghi nhớ rằng khi một exception được gọi, chương trình của bạn sẽ ngừng và đoạn code phía sau không thể chạy được nữa.</p>\n<ol>\n<li><p>Tôi đến trường đón con mèo.</p>\n</li>\n<li><p>Tôi đem con mèo đi bán vào quán tiểu hổ.</p>\n</li>\n</ol>\n<p>Nếu ở <strong>bước 1</strong>, thay vì đón thành công con mèo, tôi lại dính một exception “MeoMissing” vì lý do nó bị người ngoài hành tinh bắt cóc.</p>\n<p>Khi này dĩ nhiên chương trình sẽ dừng lại, vì tôi làm gì còn con mèo để mà đem nó đi bán ở  <strong>bước 2</strong>.</p>\n<p>Quay về với ví dụ đơn giản là chia cho số 0:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">10</span>/<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; ZeroDivisionError (divided by 0)</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>ZeroDivisionError</strong> là một exception được ruby tạo ra để trả về khi bạn cố chia một số cho số 0.</p>\n<figure class=\"highlight gauss\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (chia đàng hoàng)</span><br><span class=\"line\">  thực hiện phép tính.</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (chia cho số <span class=\"number\">0</span>)</span><br><span class=\"line\">    trả về exception ZeroDivisionError</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Flow logic đơn giản về exception như trên.</p>\n<h2 id=\"2-Lam-sao-de-lay-ve-doi-tuong-Exception\"><a href=\"#2-Lam-sao-de-lay-ve-doi-tuong-Exception\" class=\"headerlink\" title=\"2. Làm sao để lấy về đối tượng Exception\"></a>2. Làm sao để lấy về đối tượng Exception</h2><p>Như chúng ta đã biết, gần như mọi thứ trong ruby đều là object(Ngoại trừ method và block). Vậy nên Exception cũng là một đối tượng.</p>\n<p>ZeroDivisionError ở trên là một Class, vậy khi bạn thực hiện một phép chia cho số 0, bạn đã rơi vào trường hợp mà ZeroDivisionError quản lý và nó sẽ trả về một đối tượng ZeroDivisionError.</p>\n<p>Vậy tức là ở 2 lần chia cho số 0 khác nhau, nó sẽ trả về cho bạn 2 object exception khác nhau chỉ là cùng một class ZeroDivisionError.</p>\n<p>Vậy cách nào để bắt được đối tượng này? Cú pháp để thực hiện việc này sẽ như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  meo = <span class=\"number\">10</span></span><br><span class=\"line\">  meo/<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">rescue</span> ZeroDivisionError =&gt; e</span><br><span class=\"line\">  puts <span class=\"string\">\"Exception Class: <span class=\"subst\">#&#123; e<span class=\"class\">.<span class=\"keyword\">class</span>.<span class=\"title\">name</span> &#125;\"</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\">  puts <span class=\"string\">\"Exception Message: <span class=\"subst\">#&#123; e.message &#125;</span>\"</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"subst\"><span class=\"keyword\">end</span></span></span></span><br></pre></td></tr></table></figure>\n\n<p><strong>rescue</strong> là từ khoá sẽ giúp bạn lấy được đối tượng exception trả về. Như ví dụ trên tôi lấy đối tượng exeption trả về (nếu exception đó là dạng ZeroDivisionError) và truyền nó vào biến <strong>e</strong>. Từ đây <strong>e</strong> chính là object exception nếu exception đó xảy ra.</p>\n<p>Tôi có thể dùng e để xuất ra các thông tin mà tôi cần như class name hay message thông báo lỗi.</p>\n<h2 id=\"3-Xay-dung-mot-class-Exception\"><a href=\"#3-Xay-dung-mot-class-Exception\" class=\"headerlink\" title=\"3. Xây dựng một class Exception\"></a>3. Xây dựng một class Exception</h2><p>Một sự thật hiển nhiên là những thiết kế có sẵn không bao giờ có thể cover cho tất cả các trường hợp có thể xảy ra trong thực tiễn. Đôi lúc bạn muốn thêm một exception để cover cho trường hợp của riêng dự án của bạn thì sao?</p>\n<p>Câu trả lời mà tôi mới tìm được khá thú vị và cũng rất quen thuộc. Đó là Exception cũng có thể được tạo ra như một class bình thường. Hãy để nó kế thừa lớp <strong>StandardError</strong> là được.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MeoException</span> &lt; StandardError;</span> <span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Vậy là ta đã có một class exception của riêng mình. Khi cần gọi đến exception này thì ta sẽ gọi sử dụng phương thức <strong>raise</strong> để gọi một đối tượng.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">raise MeoException.new(params_gi_do_ma_ban_muon)</span><br></pre></td></tr></table></figure>\n\n<p>Vậy trong class class <strong>MeoException</strong> ta sẽ thiết kế những gì? :smile: Tôi cũng chưa tìm hiểu.</p>\n<h2 id=\"4-Cac-lop-Exception-co-san-trong-Ruby\"><a href=\"#4-Cac-lop-Exception-co-san-trong-Ruby\" class=\"headerlink\" title=\"4. Các lớp Exception có sẵn trong Ruby\"></a>4. Các lớp Exception có sẵn trong Ruby</h2><p><img src=\"/images/ruby-exception.jpg\" alt=\"hoa\"></p>\n<p>Đây là sơ đồ về các lớp exception trong ruby, nếu ta rescue một exception X, X lại có dăm 3 exception con, thì chỉ cần chương trình của bạn phát sinh vấn đề và trả ra một exception con nào đó thì X được gọi.</p>\n<h2 id=\"5-Cach-bat-Exception-hop-ly\"><a href=\"#5-Cach-bat-Exception-hop-ly\" class=\"headerlink\" title=\"5. Cách bắt Exception hợp lý\"></a>5. Cách bắt Exception hợp lý</h2><p><strong>Cách 1:</strong></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  di_don_con_meo_truong()</span><br><span class=\"line\"><span class=\"keyword\">rescue</span> Exception =&gt; e</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đây là một cách tệ vì khi rescue với Exception, lớp cha của tất cả các Exception khác thì nó cover quá nhiều trường hợp cũng trả ra exception, hãy nhớ lại ở trên chúng ta đã nói một khi Exception được trả về thì chương trình của bạn sẽ dừng lại. Vậy nên không sử dụng cách này.</p>\n<p><strong>Cách 2:</strong></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  di_don_con_meo_truong()</span><br><span class=\"line\"><span class=\"keyword\">rescue</span> StandardError =&gt; e</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đây là cách làm tốt hơn, vì ta chỉ cover các lỗi standard, ít ra chương trình của bạn sẽ không thi thoảng bị shutdown mà không biết vì sao như cách đầu tiên.</p>\n<p><strong>Cách 3:</strong></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">  di_don_con_meo_truong()</span><br><span class=\"line\"><span class=\"keyword\">rescue</span> MeoBiBatCoc, MeoBiDauChan =&gt; e</span><br><span class=\"line\">  <span class=\"comment\"># do something</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Đây là cách tốt nhất, ta goi trực tiếp đến trường hợp ngoại lệ mà ta cần bắt lấy và xử lý.</p>\n"},{"title":"So Sánh Class Method Và Scope","date":"2019-06-08T17:00:00.000Z","draft":false,"_content":"\nTôi có 1 scope:\n\n```ruby\nclass Product < ActiveRecord::Base\n  scope :is_active, -> { where is_active: true }\nend\n\n# Lấy các products có thuộc tính is_active là true.\n```\n\nTôi có 1 class method:\n\n```ruby\nclass Product < ActiveRecord::Base\n  def self.is_active\n    where is_active: true\n  end\nend\n```\n\n2 method này là hoàn toàn tương đương nhau, kết quả trả về cũng vậy. Bây giờ thử 1 ví dụ khác.\n\n```ruby\nclass Product < ActiveRecord::Base\n  # lấy các products đang active\n  scope :is_active, -> { where is_active: true }\n  # lấy các products có type bằng type được truyền vào scope, và đảm bảo type được truyền vào có giá trị\n  scope :by_type, -> type { where type: type if type.present? }\nend\n\n```\n\nViết ví dụ trên dưới dạng Class Method:\n\n```ruby\nclass Product < ActiveRecord::Base\n  # lấy các products đang active\n  def self.is_active\n    where is_active: true\n  end\n  # lấy các products có type bằng type được truyền vào scope và đảm bảo type truyền vào có giá trị\n  def self.by_type(type)\n    where type: type if type.present?\n  end\nend\n```\n\nTiến hành gọi liên tiếp Scope:\n\n```ruby\nProduct.by_type(nil).is_active\n# truyền vào type không hợp lệ, nhưng scope is_active vẫn work bình thường\n```\n\nTiến hành gọi liên tiếp Class Method:\n\n```ruby\nProduct.by_type(nil).is_active\n\n# Trản về một error method is_active không được định nghĩa cho nil.\n```\n\nỦa vậy chuyện này là sao? Tại sao Scope vẫn work bình thường trong khi Class Method lại bắn về một exception?\n\nĐây chính là điểm khác biệt quan trọng của Scopy và Class Method.\n\nScope luôn luôn trả về một **ActiveRecord Relation**. Còn Class Method thì sao? Nếu bạn không cover trường hợp **nil/blank** thì nó sẽ văng về **nil/blank** như vậy không thể chạy Class Method phía sau, vì method đó không thể chạy **với nil/blank**.\n","source":"_posts/2019-06-09-luu-y-ngan-gon-ve-scope-va-class-method.md","raw":"---\ntitle: \"So Sánh Class Method Và Scope\"\ndate: 2019-06-09\ndraft: false\ntags: [\"RUBY\", \"RAILS\"]\ncategories: [\"RAILS\"]\n---\n\nTôi có 1 scope:\n\n```ruby\nclass Product < ActiveRecord::Base\n  scope :is_active, -> { where is_active: true }\nend\n\n# Lấy các products có thuộc tính is_active là true.\n```\n\nTôi có 1 class method:\n\n```ruby\nclass Product < ActiveRecord::Base\n  def self.is_active\n    where is_active: true\n  end\nend\n```\n\n2 method này là hoàn toàn tương đương nhau, kết quả trả về cũng vậy. Bây giờ thử 1 ví dụ khác.\n\n```ruby\nclass Product < ActiveRecord::Base\n  # lấy các products đang active\n  scope :is_active, -> { where is_active: true }\n  # lấy các products có type bằng type được truyền vào scope, và đảm bảo type được truyền vào có giá trị\n  scope :by_type, -> type { where type: type if type.present? }\nend\n\n```\n\nViết ví dụ trên dưới dạng Class Method:\n\n```ruby\nclass Product < ActiveRecord::Base\n  # lấy các products đang active\n  def self.is_active\n    where is_active: true\n  end\n  # lấy các products có type bằng type được truyền vào scope và đảm bảo type truyền vào có giá trị\n  def self.by_type(type)\n    where type: type if type.present?\n  end\nend\n```\n\nTiến hành gọi liên tiếp Scope:\n\n```ruby\nProduct.by_type(nil).is_active\n# truyền vào type không hợp lệ, nhưng scope is_active vẫn work bình thường\n```\n\nTiến hành gọi liên tiếp Class Method:\n\n```ruby\nProduct.by_type(nil).is_active\n\n# Trản về một error method is_active không được định nghĩa cho nil.\n```\n\nỦa vậy chuyện này là sao? Tại sao Scope vẫn work bình thường trong khi Class Method lại bắn về một exception?\n\nĐây chính là điểm khác biệt quan trọng của Scopy và Class Method.\n\nScope luôn luôn trả về một **ActiveRecord Relation**. Còn Class Method thì sao? Nếu bạn không cover trường hợp **nil/blank** thì nó sẽ văng về **nil/blank** như vậy không thể chạy Class Method phía sau, vì method đó không thể chạy **với nil/blank**.\n","slug":"2019-06-09-luu-y-ngan-gon-ve-scope-va-class-method","published":1,"updated":"2022-01-29T09:29:59.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsb4001wp3m26aaaai9f","content":"<p>Tôi có 1 scope:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Product</span> &lt; ActiveRecord::Base</span></span><br><span class=\"line\">  scope <span class=\"symbol\">:is_active</span>, -&gt; &#123; where <span class=\"symbol\">is_active:</span> <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Lấy các products có thuộc tính is_active là true.</span></span><br></pre></td></tr></table></figure>\n\n<p>Tôi có 1 class method:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Product</span> &lt; ActiveRecord::Base</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">is_active</span></span></span><br><span class=\"line\">    where <span class=\"symbol\">is_active:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>2 method này là hoàn toàn tương đương nhau, kết quả trả về cũng vậy. Bây giờ thử 1 ví dụ khác.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Product</span> &lt; ActiveRecord::Base</span></span><br><span class=\"line\">  <span class=\"comment\"># lấy các products đang active</span></span><br><span class=\"line\">  scope <span class=\"symbol\">:is_active</span>, -&gt; &#123; where <span class=\"symbol\">is_active:</span> <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">  <span class=\"comment\"># lấy các products có type bằng type được truyền vào scope, và đảm bảo type được truyền vào có giá trị</span></span><br><span class=\"line\">  scope <span class=\"symbol\">:by_type</span>, -&gt; type &#123; where <span class=\"symbol\">type:</span> type <span class=\"keyword\">if</span> type.present? &#125;</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Viết ví dụ trên dưới dạng Class Method:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Product</span> &lt; ActiveRecord::Base</span></span><br><span class=\"line\">  <span class=\"comment\"># lấy các products đang active</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">is_active</span></span></span><br><span class=\"line\">    where <span class=\"symbol\">is_active:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"comment\"># lấy các products có type bằng type được truyền vào scope và đảm bảo type truyền vào có giá trị</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">by_type</span><span class=\"params\">(type)</span></span></span><br><span class=\"line\">    where <span class=\"symbol\">type:</span> type <span class=\"keyword\">if</span> type.present?</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Tiến hành gọi liên tiếp Scope:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.by_type(<span class=\"literal\">nil</span>).is_active</span><br><span class=\"line\"><span class=\"comment\"># truyền vào type không hợp lệ, nhưng scope is_active vẫn work bình thường</span></span><br></pre></td></tr></table></figure>\n\n<p>Tiến hành gọi liên tiếp Class Method:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.by_type(<span class=\"literal\">nil</span>).is_active</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Trản về một error method is_active không được định nghĩa cho nil.</span></span><br></pre></td></tr></table></figure>\n\n<p>Ủa vậy chuyện này là sao? Tại sao Scope vẫn work bình thường trong khi Class Method lại bắn về một exception?</p>\n<p>Đây chính là điểm khác biệt quan trọng của Scopy và Class Method.</p>\n<p>Scope luôn luôn trả về một <strong>ActiveRecord Relation</strong>. Còn Class Method thì sao? Nếu bạn không cover trường hợp <strong>nil/blank</strong> thì nó sẽ văng về <strong>nil/blank</strong> như vậy không thể chạy Class Method phía sau, vì method đó không thể chạy <strong>với nil/blank</strong>.</p>\n","site":{"data":{}},"excerpt":"","more":"<p>Tôi có 1 scope:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Product</span> &lt; ActiveRecord::Base</span></span><br><span class=\"line\">  scope <span class=\"symbol\">:is_active</span>, -&gt; &#123; where <span class=\"symbol\">is_active:</span> <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Lấy các products có thuộc tính is_active là true.</span></span><br></pre></td></tr></table></figure>\n\n<p>Tôi có 1 class method:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Product</span> &lt; ActiveRecord::Base</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">is_active</span></span></span><br><span class=\"line\">    where <span class=\"symbol\">is_active:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>2 method này là hoàn toàn tương đương nhau, kết quả trả về cũng vậy. Bây giờ thử 1 ví dụ khác.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Product</span> &lt; ActiveRecord::Base</span></span><br><span class=\"line\">  <span class=\"comment\"># lấy các products đang active</span></span><br><span class=\"line\">  scope <span class=\"symbol\">:is_active</span>, -&gt; &#123; where <span class=\"symbol\">is_active:</span> <span class=\"literal\">true</span> &#125;</span><br><span class=\"line\">  <span class=\"comment\"># lấy các products có type bằng type được truyền vào scope, và đảm bảo type được truyền vào có giá trị</span></span><br><span class=\"line\">  scope <span class=\"symbol\">:by_type</span>, -&gt; type &#123; where <span class=\"symbol\">type:</span> type <span class=\"keyword\">if</span> type.present? &#125;</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Viết ví dụ trên dưới dạng Class Method:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Product</span> &lt; ActiveRecord::Base</span></span><br><span class=\"line\">  <span class=\"comment\"># lấy các products đang active</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">is_active</span></span></span><br><span class=\"line\">    where <span class=\"symbol\">is_active:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"comment\"># lấy các products có type bằng type được truyền vào scope và đảm bảo type truyền vào có giá trị</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">by_type</span><span class=\"params\">(type)</span></span></span><br><span class=\"line\">    where <span class=\"symbol\">type:</span> type <span class=\"keyword\">if</span> type.present?</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Tiến hành gọi liên tiếp Scope:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.by_type(<span class=\"literal\">nil</span>).is_active</span><br><span class=\"line\"><span class=\"comment\"># truyền vào type không hợp lệ, nhưng scope is_active vẫn work bình thường</span></span><br></pre></td></tr></table></figure>\n\n<p>Tiến hành gọi liên tiếp Class Method:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Product.by_type(<span class=\"literal\">nil</span>).is_active</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Trản về một error method is_active không được định nghĩa cho nil.</span></span><br></pre></td></tr></table></figure>\n\n<p>Ủa vậy chuyện này là sao? Tại sao Scope vẫn work bình thường trong khi Class Method lại bắn về một exception?</p>\n<p>Đây chính là điểm khác biệt quan trọng của Scopy và Class Method.</p>\n<p>Scope luôn luôn trả về một <strong>ActiveRecord Relation</strong>. Còn Class Method thì sao? Nếu bạn không cover trường hợp <strong>nil/blank</strong> thì nó sẽ văng về <strong>nil/blank</strong> như vậy không thể chạy Class Method phía sau, vì method đó không thể chạy <strong>với nil/blank</strong>.</p>\n"},{"title":"Public, Private Và Protected","date":"2019-06-10T17:00:00.000Z","draft":false,"_content":"\n## Đặt vấn đề\n\nKhi còn học đại học, chúng ta được học về tầm vực của các phương thức như sau:\n\n1. Public phương thức, gọi ở đâu cũng được chỉ cần đảm bảo đã include cái class khai báo phương thức đó là được.\n\n2. Protected phương thức, gọi ở chính class khai báo nó, ngoài ra còn có thẻ gọi ở các lớp kế thừa class khai báo phương thức này.\n\n3. Private phương thức, gọi ở chính class mà nó được khai báo, ngoài ra...à mà quên không có ngoài ra, chỉ vậy thôi.\n\nNhững trích rút trên dựa theo ngôn ngữ mà chúng ta cùng theo đuổi ngày đại học C++. Vậy với Ruby? Liệu những phát biểu trên liệu còn đúng?\n\n## Luận bàn\n\nKhông, những trích rút trên không còn đúng đắn hoàn toàn với ngôn ngữ Ruby. Có một số khác biệt. Trong bài viết này chúng ta sẽ đi sơ qua về nó.\n\n\"Mà sao lại là sơ qua? sao bài nào cũng dùng từ đi sơ qua mà không phải là \"đíp đờ rai tu\" gì đó, viết blog kiểu cơm nguội như này viết làm gì (angry).\"\n\n=> Vì đây không phải kiến thức cao siêu gì cả, có vô vàn tài liệu anh ngữ đề cập đến nó rồi và tôi không thấy cái lý do gì để cố đọc tài liệu thật nhiều, translate thật đã tay, rồi vietsub ra một bài viết dài như sông Hồng để nói về một chủ đề vô cùng normal để thể hiện bản thân cả :smile:\n\n## Lấy một ví dụ\n\n```ruby\nclass Cat\n  # default public method\n  def cat_hello_public\n    puts \"T*o ngao ngao public mot cach quy toc\"\n  end\n\n  protected\n\n  def cat_hello_protected\n    puts \"T*o ngao ngao protected mot cach sexy\"\n  end\n\n  private\n\n  def cat_hello_private\n    puts \"T*o ngao ngao private mot  cach len lut\"\n  end\nend\n```\n\nRa ngoài scope của class này rồi chạy:\n\n```ruby\nCat.new.cat_hello_public\n# => T*o ngao ngao public mot cach quy toc.\nCat.new.cat_hello_protected\n# => error\nCat.new.cat_hello_private\n# => error\n```\n\n**Note:** public có thể gọi ngoài tầm vực của một class, những method còn lại thì không. Đồng nghĩa với việc bạn chỉ cần đảm bảo ref được file chưa class có phương thức public đó thì bạn có thể thoải mái gọi phương thức này.\n\n## Thêm một class con kế thừa\n\n```ruby\nclass YellowCat < Cat; end\n```\n\nChạy:\n\n```ruby\nYellowCat.new.cat_hello_public\n# => T*o ngao ngao public mot cach quy toc.\n```\n\n**Note:** Phương thức public có thể được gọi công khai bởi class kế thừa của class chưa phương thức đó.\n\n## Gọi 3 phương thức Cat trong một method thuộc YellowCat\n\n```ruby\nclass YellowCat < Cat\n  def yellow_cat\n    cat_hello_public\n    cat_hello_protected\n    cat_hello_private\n  end\nend\n```\n\nChạy:\n\n```ruby\nYellowCat.new.yellow_cat\n# => T*o ngao ngao public mot cach quy toc\n# => T*o ngao ngao protected mot cach sexy\n# => T*o ngao ngao private mot  cach len lut\n```\n\n**Note:** Cả 3 dạng phương thức đều có thể được gọi trong lớp con (Trong lớp con nhé).\n\n> Trong phương thức yellow_cat khai báo một đối tượng Cat và gọi tới 3 phương thức\n\n```ruby\nclass YellowCat < Cat\n  def yellow_cat\n    cat = Cat.new\n    cat.cat_hello_public\n    cat.cat_hello_protected\n    cat.cat_hello_private\n  end\nend\n```\n\nChạy:\n\n```ruby\nYellowCat.new.yellow_cat\n# => T*o ngao ngao public mot cach quy toc\n# => T*o ngao ngao protected mot cach sexy\n# =>  error\n```\n\n**Note:** Trong một lớp con kế thừa từ lớp cha, public và protected method của lớp cha có thể được lớp con access thông qua **implicit receiver** and **explicit receiver**. Còn private method thì chỉ có thể được access thông qua **implicit receiver**.\n\n1. **Implicit receiver**: Không chỉ định đối tượng sẽ thực hiện phương thức.\n\n2. **Explicit receiver**: Chỉ định rõ ràng đối tượng sẽ thực hiện phương thức.\n","source":"_posts/2019-06-11-public-private-va-protected-method-trong-ruby.md","raw":"---\ntitle: \"Public, Private Và Protected\"\ndate: 2019-06-11\ndraft: false\ntags: [\"RUBY\"]\ncategories: [\"RUBY\"]\n\n---\n\n## Đặt vấn đề\n\nKhi còn học đại học, chúng ta được học về tầm vực của các phương thức như sau:\n\n1. Public phương thức, gọi ở đâu cũng được chỉ cần đảm bảo đã include cái class khai báo phương thức đó là được.\n\n2. Protected phương thức, gọi ở chính class khai báo nó, ngoài ra còn có thẻ gọi ở các lớp kế thừa class khai báo phương thức này.\n\n3. Private phương thức, gọi ở chính class mà nó được khai báo, ngoài ra...à mà quên không có ngoài ra, chỉ vậy thôi.\n\nNhững trích rút trên dựa theo ngôn ngữ mà chúng ta cùng theo đuổi ngày đại học C++. Vậy với Ruby? Liệu những phát biểu trên liệu còn đúng?\n\n## Luận bàn\n\nKhông, những trích rút trên không còn đúng đắn hoàn toàn với ngôn ngữ Ruby. Có một số khác biệt. Trong bài viết này chúng ta sẽ đi sơ qua về nó.\n\n\"Mà sao lại là sơ qua? sao bài nào cũng dùng từ đi sơ qua mà không phải là \"đíp đờ rai tu\" gì đó, viết blog kiểu cơm nguội như này viết làm gì (angry).\"\n\n=> Vì đây không phải kiến thức cao siêu gì cả, có vô vàn tài liệu anh ngữ đề cập đến nó rồi và tôi không thấy cái lý do gì để cố đọc tài liệu thật nhiều, translate thật đã tay, rồi vietsub ra một bài viết dài như sông Hồng để nói về một chủ đề vô cùng normal để thể hiện bản thân cả :smile:\n\n## Lấy một ví dụ\n\n```ruby\nclass Cat\n  # default public method\n  def cat_hello_public\n    puts \"T*o ngao ngao public mot cach quy toc\"\n  end\n\n  protected\n\n  def cat_hello_protected\n    puts \"T*o ngao ngao protected mot cach sexy\"\n  end\n\n  private\n\n  def cat_hello_private\n    puts \"T*o ngao ngao private mot  cach len lut\"\n  end\nend\n```\n\nRa ngoài scope của class này rồi chạy:\n\n```ruby\nCat.new.cat_hello_public\n# => T*o ngao ngao public mot cach quy toc.\nCat.new.cat_hello_protected\n# => error\nCat.new.cat_hello_private\n# => error\n```\n\n**Note:** public có thể gọi ngoài tầm vực của một class, những method còn lại thì không. Đồng nghĩa với việc bạn chỉ cần đảm bảo ref được file chưa class có phương thức public đó thì bạn có thể thoải mái gọi phương thức này.\n\n## Thêm một class con kế thừa\n\n```ruby\nclass YellowCat < Cat; end\n```\n\nChạy:\n\n```ruby\nYellowCat.new.cat_hello_public\n# => T*o ngao ngao public mot cach quy toc.\n```\n\n**Note:** Phương thức public có thể được gọi công khai bởi class kế thừa của class chưa phương thức đó.\n\n## Gọi 3 phương thức Cat trong một method thuộc YellowCat\n\n```ruby\nclass YellowCat < Cat\n  def yellow_cat\n    cat_hello_public\n    cat_hello_protected\n    cat_hello_private\n  end\nend\n```\n\nChạy:\n\n```ruby\nYellowCat.new.yellow_cat\n# => T*o ngao ngao public mot cach quy toc\n# => T*o ngao ngao protected mot cach sexy\n# => T*o ngao ngao private mot  cach len lut\n```\n\n**Note:** Cả 3 dạng phương thức đều có thể được gọi trong lớp con (Trong lớp con nhé).\n\n> Trong phương thức yellow_cat khai báo một đối tượng Cat và gọi tới 3 phương thức\n\n```ruby\nclass YellowCat < Cat\n  def yellow_cat\n    cat = Cat.new\n    cat.cat_hello_public\n    cat.cat_hello_protected\n    cat.cat_hello_private\n  end\nend\n```\n\nChạy:\n\n```ruby\nYellowCat.new.yellow_cat\n# => T*o ngao ngao public mot cach quy toc\n# => T*o ngao ngao protected mot cach sexy\n# =>  error\n```\n\n**Note:** Trong một lớp con kế thừa từ lớp cha, public và protected method của lớp cha có thể được lớp con access thông qua **implicit receiver** and **explicit receiver**. Còn private method thì chỉ có thể được access thông qua **implicit receiver**.\n\n1. **Implicit receiver**: Không chỉ định đối tượng sẽ thực hiện phương thức.\n\n2. **Explicit receiver**: Chỉ định rõ ràng đối tượng sẽ thực hiện phương thức.\n","slug":"2019-06-11-public-private-va-protected-method-trong-ruby","published":1,"updated":"2022-01-29T09:29:59.927Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsb5001zp3m2gr1p2vmr","content":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Khi còn học đại học, chúng ta được học về tầm vực của các phương thức như sau:</p>\n<ol>\n<li><p>Public phương thức, gọi ở đâu cũng được chỉ cần đảm bảo đã include cái class khai báo phương thức đó là được.</p>\n</li>\n<li><p>Protected phương thức, gọi ở chính class khai báo nó, ngoài ra còn có thẻ gọi ở các lớp kế thừa class khai báo phương thức này.</p>\n</li>\n<li><p>Private phương thức, gọi ở chính class mà nó được khai báo, ngoài ra…à mà quên không có ngoài ra, chỉ vậy thôi.</p>\n</li>\n</ol>\n<p>Những trích rút trên dựa theo ngôn ngữ mà chúng ta cùng theo đuổi ngày đại học C++. Vậy với Ruby? Liệu những phát biểu trên liệu còn đúng?</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><p>Không, những trích rút trên không còn đúng đắn hoàn toàn với ngôn ngữ Ruby. Có một số khác biệt. Trong bài viết này chúng ta sẽ đi sơ qua về nó.</p>\n<p>“Mà sao lại là sơ qua? sao bài nào cũng dùng từ đi sơ qua mà không phải là “đíp đờ rai tu” gì đó, viết blog kiểu cơm nguội như này viết làm gì (angry).”</p>\n<p>=&gt; Vì đây không phải kiến thức cao siêu gì cả, có vô vàn tài liệu anh ngữ đề cập đến nó rồi và tôi không thấy cái lý do gì để cố đọc tài liệu thật nhiều, translate thật đã tay, rồi vietsub ra một bài viết dài như sông Hồng để nói về một chủ đề vô cùng normal để thể hiện bản thân cả :smile:</p>\n<h2 id=\"Lay-mot-vi-du\"><a href=\"#Lay-mot-vi-du\" class=\"headerlink\" title=\"Lấy một ví dụ\"></a>Lấy một ví dụ</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span></span></span><br><span class=\"line\">  <span class=\"comment\"># default public method</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cat_hello_public</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"T*o ngao ngao public mot cach quy toc\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  protected</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cat_hello_protected</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"T*o ngao ngao protected mot cach sexy\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cat_hello_private</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"T*o ngao ngao private mot  cach len lut\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Ra ngoài scope của class này rồi chạy:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cat.new.cat_hello_public</span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao public mot cach quy toc.</span></span><br><span class=\"line\">Cat.new.cat_hello_protected</span><br><span class=\"line\"><span class=\"comment\"># =&gt; error</span></span><br><span class=\"line\">Cat.new.cat_hello_private</span><br><span class=\"line\"><span class=\"comment\"># =&gt; error</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Note:</strong> public có thể gọi ngoài tầm vực của một class, những method còn lại thì không. Đồng nghĩa với việc bạn chỉ cần đảm bảo ref được file chưa class có phương thức public đó thì bạn có thể thoải mái gọi phương thức này.</p>\n<h2 id=\"Them-mot-class-con-ke-thua\"><a href=\"#Them-mot-class-con-ke-thua\" class=\"headerlink\" title=\"Thêm một class con kế thừa\"></a>Thêm một class con kế thừa</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat;</span> <span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Chạy:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">YellowCat.new.cat_hello_public</span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao public mot cach quy toc.</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Note:</strong> Phương thức public có thể được gọi công khai bởi class kế thừa của class chưa phương thức đó.</p>\n<h2 id=\"Goi-3-phuong-thuc-Cat-trong-mot-method-thuoc-YellowCat\"><a href=\"#Goi-3-phuong-thuc-Cat-trong-mot-method-thuoc-YellowCat\" class=\"headerlink\" title=\"Gọi 3 phương thức Cat trong một method thuộc YellowCat\"></a>Gọi 3 phương thức Cat trong một method thuộc YellowCat</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">yellow_cat</span></span></span><br><span class=\"line\">    cat_hello_public</span><br><span class=\"line\">    cat_hello_protected</span><br><span class=\"line\">    cat_hello_private</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Chạy:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">YellowCat.new.yellow_cat</span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao public mot cach quy toc</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao protected mot cach sexy</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao private mot  cach len lut</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Note:</strong> Cả 3 dạng phương thức đều có thể được gọi trong lớp con (Trong lớp con nhé).</p>\n<blockquote>\n<p>Trong phương thức yellow_cat khai báo một đối tượng Cat và gọi tới 3 phương thức</p>\n</blockquote>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">yellow_cat</span></span></span><br><span class=\"line\">    cat = Cat.new</span><br><span class=\"line\">    cat.cat_hello_public</span><br><span class=\"line\">    cat.cat_hello_protected</span><br><span class=\"line\">    cat.cat_hello_private</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Chạy:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">YellowCat.new.yellow_cat</span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao public mot cach quy toc</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao protected mot cach sexy</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt;  error</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Note:</strong> Trong một lớp con kế thừa từ lớp cha, public và protected method của lớp cha có thể được lớp con access thông qua <strong>implicit receiver</strong> and <strong>explicit receiver</strong>. Còn private method thì chỉ có thể được access thông qua <strong>implicit receiver</strong>.</p>\n<ol>\n<li><p><strong>Implicit receiver</strong>: Không chỉ định đối tượng sẽ thực hiện phương thức.</p>\n</li>\n<li><p><strong>Explicit receiver</strong>: Chỉ định rõ ràng đối tượng sẽ thực hiện phương thức.</p>\n</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Khi còn học đại học, chúng ta được học về tầm vực của các phương thức như sau:</p>\n<ol>\n<li><p>Public phương thức, gọi ở đâu cũng được chỉ cần đảm bảo đã include cái class khai báo phương thức đó là được.</p>\n</li>\n<li><p>Protected phương thức, gọi ở chính class khai báo nó, ngoài ra còn có thẻ gọi ở các lớp kế thừa class khai báo phương thức này.</p>\n</li>\n<li><p>Private phương thức, gọi ở chính class mà nó được khai báo, ngoài ra…à mà quên không có ngoài ra, chỉ vậy thôi.</p>\n</li>\n</ol>\n<p>Những trích rút trên dựa theo ngôn ngữ mà chúng ta cùng theo đuổi ngày đại học C++. Vậy với Ruby? Liệu những phát biểu trên liệu còn đúng?</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><p>Không, những trích rút trên không còn đúng đắn hoàn toàn với ngôn ngữ Ruby. Có một số khác biệt. Trong bài viết này chúng ta sẽ đi sơ qua về nó.</p>\n<p>“Mà sao lại là sơ qua? sao bài nào cũng dùng từ đi sơ qua mà không phải là “đíp đờ rai tu” gì đó, viết blog kiểu cơm nguội như này viết làm gì (angry).”</p>\n<p>=&gt; Vì đây không phải kiến thức cao siêu gì cả, có vô vàn tài liệu anh ngữ đề cập đến nó rồi và tôi không thấy cái lý do gì để cố đọc tài liệu thật nhiều, translate thật đã tay, rồi vietsub ra một bài viết dài như sông Hồng để nói về một chủ đề vô cùng normal để thể hiện bản thân cả :smile:</p>\n<h2 id=\"Lay-mot-vi-du\"><a href=\"#Lay-mot-vi-du\" class=\"headerlink\" title=\"Lấy một ví dụ\"></a>Lấy một ví dụ</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span></span></span><br><span class=\"line\">  <span class=\"comment\"># default public method</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cat_hello_public</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"T*o ngao ngao public mot cach quy toc\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  protected</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cat_hello_protected</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"T*o ngao ngao protected mot cach sexy\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cat_hello_private</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"T*o ngao ngao private mot  cach len lut\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Ra ngoài scope của class này rồi chạy:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cat.new.cat_hello_public</span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao public mot cach quy toc.</span></span><br><span class=\"line\">Cat.new.cat_hello_protected</span><br><span class=\"line\"><span class=\"comment\"># =&gt; error</span></span><br><span class=\"line\">Cat.new.cat_hello_private</span><br><span class=\"line\"><span class=\"comment\"># =&gt; error</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Note:</strong> public có thể gọi ngoài tầm vực của một class, những method còn lại thì không. Đồng nghĩa với việc bạn chỉ cần đảm bảo ref được file chưa class có phương thức public đó thì bạn có thể thoải mái gọi phương thức này.</p>\n<h2 id=\"Them-mot-class-con-ke-thua\"><a href=\"#Them-mot-class-con-ke-thua\" class=\"headerlink\" title=\"Thêm một class con kế thừa\"></a>Thêm một class con kế thừa</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat;</span> <span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Chạy:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">YellowCat.new.cat_hello_public</span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao public mot cach quy toc.</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Note:</strong> Phương thức public có thể được gọi công khai bởi class kế thừa của class chưa phương thức đó.</p>\n<h2 id=\"Goi-3-phuong-thuc-Cat-trong-mot-method-thuoc-YellowCat\"><a href=\"#Goi-3-phuong-thuc-Cat-trong-mot-method-thuoc-YellowCat\" class=\"headerlink\" title=\"Gọi 3 phương thức Cat trong một method thuộc YellowCat\"></a>Gọi 3 phương thức Cat trong một method thuộc YellowCat</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">yellow_cat</span></span></span><br><span class=\"line\">    cat_hello_public</span><br><span class=\"line\">    cat_hello_protected</span><br><span class=\"line\">    cat_hello_private</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Chạy:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">YellowCat.new.yellow_cat</span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao public mot cach quy toc</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao protected mot cach sexy</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao private mot  cach len lut</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Note:</strong> Cả 3 dạng phương thức đều có thể được gọi trong lớp con (Trong lớp con nhé).</p>\n<blockquote>\n<p>Trong phương thức yellow_cat khai báo một đối tượng Cat và gọi tới 3 phương thức</p>\n</blockquote>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">yellow_cat</span></span></span><br><span class=\"line\">    cat = Cat.new</span><br><span class=\"line\">    cat.cat_hello_public</span><br><span class=\"line\">    cat.cat_hello_protected</span><br><span class=\"line\">    cat.cat_hello_private</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Chạy:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">YellowCat.new.yellow_cat</span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao public mot cach quy toc</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; T*o ngao ngao protected mot cach sexy</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt;  error</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Note:</strong> Trong một lớp con kế thừa từ lớp cha, public và protected method của lớp cha có thể được lớp con access thông qua <strong>implicit receiver</strong> and <strong>explicit receiver</strong>. Còn private method thì chỉ có thể được access thông qua <strong>implicit receiver</strong>.</p>\n<ol>\n<li><p><strong>Implicit receiver</strong>: Không chỉ định đối tượng sẽ thực hiện phương thức.</p>\n</li>\n<li><p><strong>Explicit receiver</strong>: Chỉ định rõ ràng đối tượng sẽ thực hiện phương thức.</p>\n</li>\n</ol>\n"},{"title":"Build A Simple ORM","date":"2019-06-25T17:00:00.000Z","draft":false,"_content":"\n## 1. Intro\n\nDoes ROR is a great framework? Yes, it does, to me, it's lighting and very powerful. Although, the ROR project needs more RAM than most other frameworks and also difficult to scale up.\n\nBut ROR is stale, high security and has very very library supported. And the last one, ROR is the first technology I learn after I graduated from university, therefore I love Rails.\n\none of the reasons why many people love and use Rails today is ActiveRecord. The default ORM of Rails, more powerful and easy to use. It helps too much for us when we want to build a web app without deep experiences in SQL.\n\nLike many developers, when I start to learn Rails, I used a few methods of ActiveRecord and don't care what's happening after these methods.  Not bad for a beginner, but if I want to become a   good developer, I need to know more details behind these methods, know deep enough to use them better.\n\n## 2. Source Code\n\n> The resource of this post you can see [here](https://github.com/hdchinh/simple-orm-ruby)\n\n## 3. Explaintion\n\n> The first action we need to do after read more is known what is ORM. You can read more about ORM by [article](https://en.wikipedia.org/wiki/Object-relational_mapping).\n\nTo build a simple ORM and run a few basic methods, we need to do 2 things:\n\n1. Connect database (I use Postgresql for my example).\n2. Create Class using any languages that you familiar with, for me I use Ruby.\n\n**STEP 1: Create project**\n\nCreate an empty project with single Gemfile with the content below:\n\n```ruby\nsource 'https://rubygems.org'\n\ngem 'pg'\n```\n\nInstall gem by command **bundle install**\n\nIf you get errors. let's read more about bundler gem.\n\n**STEP 2: Connect to Database.**\n\nCreate a file for the connection. I named this file is **connection.rb**:\n\n```ruby\nrequire 'pg'\n\n$conn = PG::Connection.connect(\n  :hostaddr=>\"127.0.0.1\", :port=>5432,\n  :dbname=>\"test-psql_development\",\n  :user=>\"admin\",\n  :password=>''\n)\n```\n\nNote: The content above is my info login of my Database, You must change for your Database.\n\nAt this time, our project has the structure:\n\n```\n-- simple-orm\n  -- Gemfile\n  -- Gemfile.lock (sinh ra sau lệnh `bundle install`)\n  -- connection.rb\n```\n\n**STEP 3: Create Main Class.**\n\nCreate the main class, I named this file is **mybase.rb**. You can name it with any names you like, don't matter:\n\n```ruby\nrequire_relative 'connection.rb'\n\nclass MyBase\n  def self.all\n    term = \"SELECT * FROM #{self.name.downcase}\"\n    res = $conn.exec(term)\n\n    res.each{ |row|\n      puts \"#{row}\\n\"\n    }\n  end\n\n  def self.find(id)\n    term = \"SELECT * FROM #{self.name.downcase} where id = #{id}\"\n    res = $conn.exec(term)\n\n    res.each{ |row|\n      puts \"#{row}\\n\"\n    }\n  end\nend\n```\n\nIn this example above, I create two methods:\n\n**all**: To return all records of this Class.\n**find**: To find a record by ID.\n\n**STEP 4: Create Child Class Of Main Class.**\n\nIn my Database, I have a table called comics. So I create a file named **comics.rb** to handle the comics table:\n\n```ruby\nrequire_relative 'mybase.rb'\n\nclass Comics < MyBase; end\n\nputs \"All record in comics table:\\n\"\nComics.all\nputs \"Find record has id is 6:\\n\"\nComics.find(6)\n```\n\nFinally, my project has the structure below:\n\n```\n-- simple-orm\n  -- Gemfile\n  -- Gemfile.lock (sinh ra sau lệnh `bundle install`)\n  -- connection.rb\n  -- mybase.rb (main chính chứa các phương thức)\n  -- comics.rb (class ứng với table comics trong csdl, kế thừa MyBase)\n```\n\nRun **comics.rb** file with command **ruby comics.rb** to see what's happening (please create your sample data first.)\n\n## References\n\n[1][https://en.wikipedia.org/wiki/Object-relational_mapping](https://en.wikipedia.org/wiki/Object-relational_mapping)\n\n[2][https://medium.com/@violetmoon/understanding-orm-frameworks-with-ruby-and-activerecord-83a9e9d8490e](https://medium.com/@violetmoon/understanding-orm-frameworks-with-ruby-and-activerecord-83a9e9d8490e)\n\n[3][https://stackoverflow.com/questions/2194915/what-is-orm-as-related-to-ruby-on-rails](https://stackoverflow.com/questions/2194915/what-is-orm-as-related-to-ruby-on-rails)\n","source":"_posts/2019-06-25-build-a-simple-orm-with-ruby.md","raw":"---\ntitle: \"Build A Simple ORM\"\ndate: 2019-06-26\ndraft: false\ntags: [\"ORM\", \"RUBY\"]\ncategories: [\"RUBY\"]\n---\n\n## 1. Intro\n\nDoes ROR is a great framework? Yes, it does, to me, it's lighting and very powerful. Although, the ROR project needs more RAM than most other frameworks and also difficult to scale up.\n\nBut ROR is stale, high security and has very very library supported. And the last one, ROR is the first technology I learn after I graduated from university, therefore I love Rails.\n\none of the reasons why many people love and use Rails today is ActiveRecord. The default ORM of Rails, more powerful and easy to use. It helps too much for us when we want to build a web app without deep experiences in SQL.\n\nLike many developers, when I start to learn Rails, I used a few methods of ActiveRecord and don't care what's happening after these methods.  Not bad for a beginner, but if I want to become a   good developer, I need to know more details behind these methods, know deep enough to use them better.\n\n## 2. Source Code\n\n> The resource of this post you can see [here](https://github.com/hdchinh/simple-orm-ruby)\n\n## 3. Explaintion\n\n> The first action we need to do after read more is known what is ORM. You can read more about ORM by [article](https://en.wikipedia.org/wiki/Object-relational_mapping).\n\nTo build a simple ORM and run a few basic methods, we need to do 2 things:\n\n1. Connect database (I use Postgresql for my example).\n2. Create Class using any languages that you familiar with, for me I use Ruby.\n\n**STEP 1: Create project**\n\nCreate an empty project with single Gemfile with the content below:\n\n```ruby\nsource 'https://rubygems.org'\n\ngem 'pg'\n```\n\nInstall gem by command **bundle install**\n\nIf you get errors. let's read more about bundler gem.\n\n**STEP 2: Connect to Database.**\n\nCreate a file for the connection. I named this file is **connection.rb**:\n\n```ruby\nrequire 'pg'\n\n$conn = PG::Connection.connect(\n  :hostaddr=>\"127.0.0.1\", :port=>5432,\n  :dbname=>\"test-psql_development\",\n  :user=>\"admin\",\n  :password=>''\n)\n```\n\nNote: The content above is my info login of my Database, You must change for your Database.\n\nAt this time, our project has the structure:\n\n```\n-- simple-orm\n  -- Gemfile\n  -- Gemfile.lock (sinh ra sau lệnh `bundle install`)\n  -- connection.rb\n```\n\n**STEP 3: Create Main Class.**\n\nCreate the main class, I named this file is **mybase.rb**. You can name it with any names you like, don't matter:\n\n```ruby\nrequire_relative 'connection.rb'\n\nclass MyBase\n  def self.all\n    term = \"SELECT * FROM #{self.name.downcase}\"\n    res = $conn.exec(term)\n\n    res.each{ |row|\n      puts \"#{row}\\n\"\n    }\n  end\n\n  def self.find(id)\n    term = \"SELECT * FROM #{self.name.downcase} where id = #{id}\"\n    res = $conn.exec(term)\n\n    res.each{ |row|\n      puts \"#{row}\\n\"\n    }\n  end\nend\n```\n\nIn this example above, I create two methods:\n\n**all**: To return all records of this Class.\n**find**: To find a record by ID.\n\n**STEP 4: Create Child Class Of Main Class.**\n\nIn my Database, I have a table called comics. So I create a file named **comics.rb** to handle the comics table:\n\n```ruby\nrequire_relative 'mybase.rb'\n\nclass Comics < MyBase; end\n\nputs \"All record in comics table:\\n\"\nComics.all\nputs \"Find record has id is 6:\\n\"\nComics.find(6)\n```\n\nFinally, my project has the structure below:\n\n```\n-- simple-orm\n  -- Gemfile\n  -- Gemfile.lock (sinh ra sau lệnh `bundle install`)\n  -- connection.rb\n  -- mybase.rb (main chính chứa các phương thức)\n  -- comics.rb (class ứng với table comics trong csdl, kế thừa MyBase)\n```\n\nRun **comics.rb** file with command **ruby comics.rb** to see what's happening (please create your sample data first.)\n\n## References\n\n[1][https://en.wikipedia.org/wiki/Object-relational_mapping](https://en.wikipedia.org/wiki/Object-relational_mapping)\n\n[2][https://medium.com/@violetmoon/understanding-orm-frameworks-with-ruby-and-activerecord-83a9e9d8490e](https://medium.com/@violetmoon/understanding-orm-frameworks-with-ruby-and-activerecord-83a9e9d8490e)\n\n[3][https://stackoverflow.com/questions/2194915/what-is-orm-as-related-to-ruby-on-rails](https://stackoverflow.com/questions/2194915/what-is-orm-as-related-to-ruby-on-rails)\n","slug":"2019-06-25-build-a-simple-orm-with-ruby","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsb60022p3m242jha7ss","content":"<h2 id=\"1-Intro\"><a href=\"#1-Intro\" class=\"headerlink\" title=\"1. Intro\"></a>1. Intro</h2><p>Does ROR is a great framework? Yes, it does, to me, it’s lighting and very powerful. Although, the ROR project needs more RAM than most other frameworks and also difficult to scale up.</p>\n<p>But ROR is stale, high security and has very very library supported. And the last one, ROR is the first technology I learn after I graduated from university, therefore I love Rails.</p>\n<p>one of the reasons why many people love and use Rails today is ActiveRecord. The default ORM of Rails, more powerful and easy to use. It helps too much for us when we want to build a web app without deep experiences in SQL.</p>\n<p>Like many developers, when I start to learn Rails, I used a few methods of ActiveRecord and don’t care what’s happening after these methods.  Not bad for a beginner, but if I want to become a   good developer, I need to know more details behind these methods, know deep enough to use them better.</p>\n<h2 id=\"2-Source-Code\"><a href=\"#2-Source-Code\" class=\"headerlink\" title=\"2. Source Code\"></a>2. Source Code</h2><blockquote>\n<p>The resource of this post you can see <a href=\"https://github.com/hdchinh/simple-orm-ruby\" target=\"_blank\" rel=\"noopener\">here</a></p>\n</blockquote>\n<h2 id=\"3-Explaintion\"><a href=\"#3-Explaintion\" class=\"headerlink\" title=\"3. Explaintion\"></a>3. Explaintion</h2><blockquote>\n<p>The first action we need to do after read more is known what is ORM. You can read more about ORM by <a href=\"https://en.wikipedia.org/wiki/Object-relational_mapping\" target=\"_blank\" rel=\"noopener\">article</a>.</p>\n</blockquote>\n<p>To build a simple ORM and run a few basic methods, we need to do 2 things:</p>\n<ol>\n<li>Connect database (I use Postgresql for my example).</li>\n<li>Create Class using any languages that you familiar with, for me I use Ruby.</li>\n</ol>\n<p><strong>STEP 1: Create project</strong></p>\n<p>Create an empty project with single Gemfile with the content below:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source <span class=\"string\">'https://rubygems.org'</span></span><br><span class=\"line\"></span><br><span class=\"line\">gem <span class=\"string\">'pg'</span></span><br></pre></td></tr></table></figure>\n\n<p>Install gem by command <strong>bundle install</strong></p>\n<p>If you get errors. let’s read more about bundler gem.</p>\n<p><strong>STEP 2: Connect to Database.</strong></p>\n<p>Create a file for the connection. I named this file is <strong>connection.rb</strong>:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'pg'</span></span><br><span class=\"line\"></span><br><span class=\"line\">$conn = PG::Connection.connect(</span><br><span class=\"line\">  <span class=\"symbol\">:hostaddr=&gt;<span class=\"string\">\"127.0.0.1\"</span></span>, <span class=\"symbol\">:port=&gt;</span><span class=\"number\">5432</span>,</span><br><span class=\"line\">  <span class=\"symbol\">:dbname=&gt;<span class=\"string\">\"test-psql_development\"</span></span>,</span><br><span class=\"line\">  <span class=\"symbol\">:user=&gt;<span class=\"string\">\"admin\"</span></span>,</span><br><span class=\"line\">  <span class=\"symbol\">:password=&gt;<span class=\"string\">''</span></span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>Note: The content above is my info login of my Database, You must change for your Database.</p>\n<p>At this time, our project has the structure:</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-<span class=\"ruby\">- simple-orm</span></span><br><span class=\"line\"><span class=\"ruby\">  -- Gemfile</span></span><br><span class=\"line\"><span class=\"ruby\">  -- Gemfile.lock (sinh ra sau lệnh <span class=\"string\">`bundle install`</span>)</span></span><br><span class=\"line\"><span class=\"ruby\">  -- connection.rb</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>STEP 3: Create Main Class.</strong></p>\n<p>Create the main class, I named this file is <strong>mybase.rb</strong>. You can name it with any names you like, don’t matter:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">require_relative <span class=\"string\">'connection.rb'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyBase</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">all</span></span></span><br><span class=\"line\">    term = <span class=\"string\">\"SELECT * FROM <span class=\"subst\">#&#123;<span class=\"keyword\">self</span>.name.downcase&#125;</span>\"</span></span><br><span class=\"line\">    res = $conn.exec(term)</span><br><span class=\"line\"></span><br><span class=\"line\">    res.each&#123; <span class=\"params\">|row|</span></span><br><span class=\"line\">      puts <span class=\"string\">\"<span class=\"subst\">#&#123;row&#125;</span>\\n\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">find</span><span class=\"params\">(id)</span></span></span><br><span class=\"line\">    term = <span class=\"string\">\"SELECT * FROM <span class=\"subst\">#&#123;<span class=\"keyword\">self</span>.name.downcase&#125;</span> where id = <span class=\"subst\">#&#123;id&#125;</span>\"</span></span><br><span class=\"line\">    res = $conn.exec(term)</span><br><span class=\"line\"></span><br><span class=\"line\">    res.each&#123; <span class=\"params\">|row|</span></span><br><span class=\"line\">      puts <span class=\"string\">\"<span class=\"subst\">#&#123;row&#125;</span>\\n\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>In this example above, I create two methods:</p>\n<p><strong>all</strong>: To return all records of this Class.<br><strong>find</strong>: To find a record by ID.</p>\n<p><strong>STEP 4: Create Child Class Of Main Class.</strong></p>\n<p>In my Database, I have a table called comics. So I create a file named <strong>comics.rb</strong> to handle the comics table:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">require_relative <span class=\"string\">'mybase.rb'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Comics</span> &lt; MyBase;</span> <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"All record in comics table:\\n\"</span></span><br><span class=\"line\">Comics.all</span><br><span class=\"line\">puts <span class=\"string\">\"Find record has id is 6:\\n\"</span></span><br><span class=\"line\">Comics.find(<span class=\"number\">6</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Finally, my project has the structure below:</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- simple-orm</span><br><span class=\"line\">  -- Gemfile</span><br><span class=\"line\">  -- Gemfile.lock (sinh ra sau lệnh `bundle install`)</span><br><span class=\"line\">  -- connection.rb</span><br><span class=\"line\">  -- mybase.rb (main chính chứa các phương thức)</span><br><span class=\"line\">  -- comics.rb (<span class=\"keyword\">class</span> ứ<span class=\"symbol\">ng</span> <span class=\"symbol\">v</span>ớ<span class=\"symbol\">i</span> <span class=\"symbol\">table</span> <span class=\"symbol\">comics</span> <span class=\"symbol\">trong</span> <span class=\"symbol\">csdl, <span class=\"symbol\">k</span></span>ế <span class=\"symbol\">th</span>ừ<span class=\"symbol\">a</span> <span class=\"symbol\">MyBase</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Run <strong>comics.rb</strong> file with command <strong>ruby comics.rb</strong> to see what’s happening (please create your sample data first.)</p>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><p>[1]<a href=\"https://en.wikipedia.org/wiki/Object-relational_mapping\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/Object-relational_mapping</a></p>\n<p>[2]<a href=\"https://medium.com/@violetmoon/understanding-orm-frameworks-with-ruby-and-activerecord-83a9e9d8490e\" target=\"_blank\" rel=\"noopener\">https://medium.com/@violetmoon/understanding-orm-frameworks-with-ruby-and-activerecord-83a9e9d8490e</a></p>\n<p>[3]<a href=\"https://stackoverflow.com/questions/2194915/what-is-orm-as-related-to-ruby-on-rails\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/2194915/what-is-orm-as-related-to-ruby-on-rails</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Intro\"><a href=\"#1-Intro\" class=\"headerlink\" title=\"1. Intro\"></a>1. Intro</h2><p>Does ROR is a great framework? Yes, it does, to me, it’s lighting and very powerful. Although, the ROR project needs more RAM than most other frameworks and also difficult to scale up.</p>\n<p>But ROR is stale, high security and has very very library supported. And the last one, ROR is the first technology I learn after I graduated from university, therefore I love Rails.</p>\n<p>one of the reasons why many people love and use Rails today is ActiveRecord. The default ORM of Rails, more powerful and easy to use. It helps too much for us when we want to build a web app without deep experiences in SQL.</p>\n<p>Like many developers, when I start to learn Rails, I used a few methods of ActiveRecord and don’t care what’s happening after these methods.  Not bad for a beginner, but if I want to become a   good developer, I need to know more details behind these methods, know deep enough to use them better.</p>\n<h2 id=\"2-Source-Code\"><a href=\"#2-Source-Code\" class=\"headerlink\" title=\"2. Source Code\"></a>2. Source Code</h2><blockquote>\n<p>The resource of this post you can see <a href=\"https://github.com/hdchinh/simple-orm-ruby\" target=\"_blank\" rel=\"noopener\">here</a></p>\n</blockquote>\n<h2 id=\"3-Explaintion\"><a href=\"#3-Explaintion\" class=\"headerlink\" title=\"3. Explaintion\"></a>3. Explaintion</h2><blockquote>\n<p>The first action we need to do after read more is known what is ORM. You can read more about ORM by <a href=\"https://en.wikipedia.org/wiki/Object-relational_mapping\" target=\"_blank\" rel=\"noopener\">article</a>.</p>\n</blockquote>\n<p>To build a simple ORM and run a few basic methods, we need to do 2 things:</p>\n<ol>\n<li>Connect database (I use Postgresql for my example).</li>\n<li>Create Class using any languages that you familiar with, for me I use Ruby.</li>\n</ol>\n<p><strong>STEP 1: Create project</strong></p>\n<p>Create an empty project with single Gemfile with the content below:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source <span class=\"string\">'https://rubygems.org'</span></span><br><span class=\"line\"></span><br><span class=\"line\">gem <span class=\"string\">'pg'</span></span><br></pre></td></tr></table></figure>\n\n<p>Install gem by command <strong>bundle install</strong></p>\n<p>If you get errors. let’s read more about bundler gem.</p>\n<p><strong>STEP 2: Connect to Database.</strong></p>\n<p>Create a file for the connection. I named this file is <strong>connection.rb</strong>:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'pg'</span></span><br><span class=\"line\"></span><br><span class=\"line\">$conn = PG::Connection.connect(</span><br><span class=\"line\">  <span class=\"symbol\">:hostaddr=&gt;<span class=\"string\">\"127.0.0.1\"</span></span>, <span class=\"symbol\">:port=&gt;</span><span class=\"number\">5432</span>,</span><br><span class=\"line\">  <span class=\"symbol\">:dbname=&gt;<span class=\"string\">\"test-psql_development\"</span></span>,</span><br><span class=\"line\">  <span class=\"symbol\">:user=&gt;<span class=\"string\">\"admin\"</span></span>,</span><br><span class=\"line\">  <span class=\"symbol\">:password=&gt;<span class=\"string\">''</span></span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>Note: The content above is my info login of my Database, You must change for your Database.</p>\n<p>At this time, our project has the structure:</p>\n<figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-<span class=\"ruby\">- simple-orm</span></span><br><span class=\"line\"><span class=\"ruby\">  -- Gemfile</span></span><br><span class=\"line\"><span class=\"ruby\">  -- Gemfile.lock (sinh ra sau lệnh <span class=\"string\">`bundle install`</span>)</span></span><br><span class=\"line\"><span class=\"ruby\">  -- connection.rb</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>STEP 3: Create Main Class.</strong></p>\n<p>Create the main class, I named this file is <strong>mybase.rb</strong>. You can name it with any names you like, don’t matter:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">require_relative <span class=\"string\">'connection.rb'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyBase</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">all</span></span></span><br><span class=\"line\">    term = <span class=\"string\">\"SELECT * FROM <span class=\"subst\">#&#123;<span class=\"keyword\">self</span>.name.downcase&#125;</span>\"</span></span><br><span class=\"line\">    res = $conn.exec(term)</span><br><span class=\"line\"></span><br><span class=\"line\">    res.each&#123; <span class=\"params\">|row|</span></span><br><span class=\"line\">      puts <span class=\"string\">\"<span class=\"subst\">#&#123;row&#125;</span>\\n\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">find</span><span class=\"params\">(id)</span></span></span><br><span class=\"line\">    term = <span class=\"string\">\"SELECT * FROM <span class=\"subst\">#&#123;<span class=\"keyword\">self</span>.name.downcase&#125;</span> where id = <span class=\"subst\">#&#123;id&#125;</span>\"</span></span><br><span class=\"line\">    res = $conn.exec(term)</span><br><span class=\"line\"></span><br><span class=\"line\">    res.each&#123; <span class=\"params\">|row|</span></span><br><span class=\"line\">      puts <span class=\"string\">\"<span class=\"subst\">#&#123;row&#125;</span>\\n\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>In this example above, I create two methods:</p>\n<p><strong>all</strong>: To return all records of this Class.<br><strong>find</strong>: To find a record by ID.</p>\n<p><strong>STEP 4: Create Child Class Of Main Class.</strong></p>\n<p>In my Database, I have a table called comics. So I create a file named <strong>comics.rb</strong> to handle the comics table:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">require_relative <span class=\"string\">'mybase.rb'</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Comics</span> &lt; MyBase;</span> <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"All record in comics table:\\n\"</span></span><br><span class=\"line\">Comics.all</span><br><span class=\"line\">puts <span class=\"string\">\"Find record has id is 6:\\n\"</span></span><br><span class=\"line\">Comics.find(<span class=\"number\">6</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Finally, my project has the structure below:</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- simple-orm</span><br><span class=\"line\">  -- Gemfile</span><br><span class=\"line\">  -- Gemfile.lock (sinh ra sau lệnh `bundle install`)</span><br><span class=\"line\">  -- connection.rb</span><br><span class=\"line\">  -- mybase.rb (main chính chứa các phương thức)</span><br><span class=\"line\">  -- comics.rb (<span class=\"keyword\">class</span> ứ<span class=\"symbol\">ng</span> <span class=\"symbol\">v</span>ớ<span class=\"symbol\">i</span> <span class=\"symbol\">table</span> <span class=\"symbol\">comics</span> <span class=\"symbol\">trong</span> <span class=\"symbol\">csdl, <span class=\"symbol\">k</span></span>ế <span class=\"symbol\">th</span>ừ<span class=\"symbol\">a</span> <span class=\"symbol\">MyBase</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Run <strong>comics.rb</strong> file with command <strong>ruby comics.rb</strong> to see what’s happening (please create your sample data first.)</p>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><p>[1]<a href=\"https://en.wikipedia.org/wiki/Object-relational_mapping\" target=\"_blank\" rel=\"noopener\">https://en.wikipedia.org/wiki/Object-relational_mapping</a></p>\n<p>[2]<a href=\"https://medium.com/@violetmoon/understanding-orm-frameworks-with-ruby-and-activerecord-83a9e9d8490e\" target=\"_blank\" rel=\"noopener\">https://medium.com/@violetmoon/understanding-orm-frameworks-with-ruby-and-activerecord-83a9e9d8490e</a></p>\n<p>[3]<a href=\"https://stackoverflow.com/questions/2194915/what-is-orm-as-related-to-ruby-on-rails\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/2194915/what-is-orm-as-related-to-ruby-on-rails</a></p>\n"},{"title":"A Simple Rack Application","date":"2019-06-23T17:00:00.000Z","draft":false,"_content":"\n## 1. Đặt vấn đề\nCó lẽ cũng như tôi, khi mới tiếp cận với một framework ruby như Rails chẳng hạn, bạn đã nghe về Rack? hoặc ít ra cũng từng thấy cái **gem rack** trong Gemfile. Nhưng có khi nào bạn dùng đến chúng? Không ư? Tôi cũng nghĩ vậy, tôi cũng kệ, tôi cũng chả quan tâm, cuộc sống không đủ high hay sao mà lại đâm đầu vào cái khó :alien:.\n\nNhưng làm việc hàng ngày với nó mà không hiểu nó là gì luôn làm cho ta cảm giác bất an vô định, cập nhật CV là Developer mà đi phỏng vấn được hỏi rack là gì, lại trả lời \"em...em..em hông biết\" thì liệu có bị đánh xuống rank junior hay không? Thôi thì cứ tìm hiểu coi nó ra sao.\n\nVà thế là tôi đã đọc docs trên trang chủ của Rack, nói chung đọc qua thì có hiểu, mà cái hiểu nó mông lung như một trò đùa, chút nữa thì đành phải \"anh xin giơ tay rút lui thôi\".\n\nVậy nên tôi sẽ viết một ứng dụng Rack (chạy trên Rack) very..very simple, để tôi và có thể cả bạn có cái nhìn thoáng qua về Rack trước đã, chứ tôi thấy hiểu biết hiện tại của mình chưa đủ để chém gió hàn lâm về chủ đề này (hy vọng tương lai gần sẽ có bài chém gió hàn lâm).\n\n## 2. Tham khảo?\n\n1. Bài viết này tôi tham khảo cách sử dụng Rack trên trang chủ của Rack [tại đây](https://rack.github.io/) và trên mục docs của ruby [tại đây](https://www.rubydoc.info/github/rack/rack/).\n\n2. Ứng dụng rất thô sơ và KHÔNG sử dụng \"bét pờ rạch tít\" nào cả.\n\n\n## 3. Kiến thức cần chuẩn bị trước.\n\nDù ít dù nhiều thì vẫn phải đánh qua lý thuyết một chút trước khi mày mò làm gì đó. Một số khái niệm/quy trình chúng ta nên nắm trước như sau:\n\n1) Rack là một lớp nằm giữa web/app server và ứng dụng.\n\nEx: Nếu tôi sử dụng Rails với app server là Puma, web server là Nginx thì đường đi của một request sẽ như sau:\n\n![hoa](/images/rack.jpeg)\n\nNote: Khái niệm **web server** và **app server** chúng ta sẽ bàn tới sau.\n\n2) Như hình trên, ta có thể thấy Rack sẽ giao tiếp với **app server**, nên Rack sẽ nhận request từ app server gửi qua, với nội dung lằng nhằng rối rắm gì đó, sau đó Rack sẽ **làm gì đó** với cái request rối rắm kia, rồi gửi kết quả mà Rails có thể hiểu và thực thi được. Sau đó Rails sẽ gửi về cho Rack kết quả cũng rối rắm không kém và nhiệm vụ của Rack lại là tiếp tục **làm gì đó** cái kết quả từ Rails, sao cho chuyển kết quả đó thành 1 thứ gì đó mà app server có thể hiểu, cuối cùng app server quăng kết quả về cho người dùng.\n\nNote: Vậy Rack như một phiên dịch viên để truyền đạt giữa ứng dụng và app server (Không thật sự đúng về bản chất nhưng ta cứ tạm chấp nhận liên tưởng này).\n\n## 4. Build một simple Rack application\n\n- Tạo 1 Folder với 1 file tên **Gemfile** có nội dung như sau:\n\n```ruby\nsource 'https://rubygems.org'\n\ngem 'rack'\n```\n\n- Cài đặt gem vói lệnh **bundle install**\n\n- Tạo file **config.ru**.\n\nNote: Đây sẽ là file main để xử lý request.\n\n- Chạy project với lệnh **bundle exec rackup**\n\n> Project demo [tại đây!](https://github.com/hdchinh/simple-rack-app)\n\n## 5. Giải thích nội dung mã nguồn của app demo\n\n```ruby\nmap '/signup_user' do\n  run SignUpUser.new\nend\n\nmap '/signup' do\n  run MySignUp.new\nend\n\nmap '/signin' do\n  run MySignIn.new\nend\n\nmap '/signin_user' do\n  run SignInUser.new\nend\n\nmap '/' do\n  run HomePage.new\nend\n\nrun MyNotFound.new\n```\n\nChắc bạn cũng có thể đoán ra ý nghĩa của nó, nếu map chúng đường dẫn thì sẽ chạy lệnh trong đó.\n\nEx:\n\n```ruby\nmap '/' do\n  run HomePage.new\nend\n```\n\nNếu truy cập theo trang chủ thì sẽ chạy lệnh **run HomePage.new**.\n\nNếu url người dùng request không trùng bất cứ trường hợp nào thì chạy lệnh **run MyNotFound.new** ở cuối.\n\nMột class sẽ có dạng như sau:\n\n```ruby\nclass SignInUser\n  def call(env)\n    # read file data\n    file = File.read('data.txt')\n\n    # get params\n    data =  Rack::Utils.parse_nested_query(env['QUERY_STRING'])\n    email = data['email']\n    pass = data['password']\n\n    # convert file data from string to hash\n    hash_data = eval(file)\n    # init variable for user login\n    user_email = nil\n\n    # loop hash to find email params\n    hash_data.each do |k, val|\n      if k == email\n        if val = pass\n          user_email = k\n        end\n      end\n    end\n\n    if user_email\n      body = [\"<h1>email: #{user_email}<h/1>\"]\n    else\n      body = [\"<h1>Email or Password Invalid</h1>\"]\n    end\n\n    [200, {'Content-Type' => 'text/html'}, body]\n  end\nend\n```\n\nBạn thấy phức tạp? Không sao cả, chỉ cần chú ý đến dòng cuối cùng trong method call. Ta chỉ cần nhớ:\n\n- Mỗi class sử dụng method call để cài đặt (yêu cầu của Rack).\n\n- Trong method này nhận vào một params, đây chính là request đi tới.\n\n- Kết quả trả về của method call này là một mảng gồm 3 phần tử:\n\n  1. Status code (Ví dụ như: 200 -> success, 404 -> not found).\n  2. Một hash, ở đây chính là header, chứa những thông tin mà trình duyệt cần.\n  3. Phần tử cuối cùng là một mảng, chính là phần body của kết quả trả về.\n\n## 6. Kết luận\n\nTrên là một basic app xây dựng với Rack, vì định nghĩa chỉ đọc không làm sẽ rất khó hiểu, nên tôi làm demo trước, hy vọng trong thời gian tới nếu kiến thức thu lượm đủ để viết về cách vận hành của Rack một cách sâu sắc, tôi có thể tiếp tục chủ đề này.\n","source":"_posts/2019-06-24-simple-rack-application.md","raw":"---\ntitle: \"A Simple Rack Application\"\ndate: 2019-06-24\ndraft: false\ntags: [\"RACK\", \"RUBY\"]\n---\n\n## 1. Đặt vấn đề\nCó lẽ cũng như tôi, khi mới tiếp cận với một framework ruby như Rails chẳng hạn, bạn đã nghe về Rack? hoặc ít ra cũng từng thấy cái **gem rack** trong Gemfile. Nhưng có khi nào bạn dùng đến chúng? Không ư? Tôi cũng nghĩ vậy, tôi cũng kệ, tôi cũng chả quan tâm, cuộc sống không đủ high hay sao mà lại đâm đầu vào cái khó :alien:.\n\nNhưng làm việc hàng ngày với nó mà không hiểu nó là gì luôn làm cho ta cảm giác bất an vô định, cập nhật CV là Developer mà đi phỏng vấn được hỏi rack là gì, lại trả lời \"em...em..em hông biết\" thì liệu có bị đánh xuống rank junior hay không? Thôi thì cứ tìm hiểu coi nó ra sao.\n\nVà thế là tôi đã đọc docs trên trang chủ của Rack, nói chung đọc qua thì có hiểu, mà cái hiểu nó mông lung như một trò đùa, chút nữa thì đành phải \"anh xin giơ tay rút lui thôi\".\n\nVậy nên tôi sẽ viết một ứng dụng Rack (chạy trên Rack) very..very simple, để tôi và có thể cả bạn có cái nhìn thoáng qua về Rack trước đã, chứ tôi thấy hiểu biết hiện tại của mình chưa đủ để chém gió hàn lâm về chủ đề này (hy vọng tương lai gần sẽ có bài chém gió hàn lâm).\n\n## 2. Tham khảo?\n\n1. Bài viết này tôi tham khảo cách sử dụng Rack trên trang chủ của Rack [tại đây](https://rack.github.io/) và trên mục docs của ruby [tại đây](https://www.rubydoc.info/github/rack/rack/).\n\n2. Ứng dụng rất thô sơ và KHÔNG sử dụng \"bét pờ rạch tít\" nào cả.\n\n\n## 3. Kiến thức cần chuẩn bị trước.\n\nDù ít dù nhiều thì vẫn phải đánh qua lý thuyết một chút trước khi mày mò làm gì đó. Một số khái niệm/quy trình chúng ta nên nắm trước như sau:\n\n1) Rack là một lớp nằm giữa web/app server và ứng dụng.\n\nEx: Nếu tôi sử dụng Rails với app server là Puma, web server là Nginx thì đường đi của một request sẽ như sau:\n\n![hoa](/images/rack.jpeg)\n\nNote: Khái niệm **web server** và **app server** chúng ta sẽ bàn tới sau.\n\n2) Như hình trên, ta có thể thấy Rack sẽ giao tiếp với **app server**, nên Rack sẽ nhận request từ app server gửi qua, với nội dung lằng nhằng rối rắm gì đó, sau đó Rack sẽ **làm gì đó** với cái request rối rắm kia, rồi gửi kết quả mà Rails có thể hiểu và thực thi được. Sau đó Rails sẽ gửi về cho Rack kết quả cũng rối rắm không kém và nhiệm vụ của Rack lại là tiếp tục **làm gì đó** cái kết quả từ Rails, sao cho chuyển kết quả đó thành 1 thứ gì đó mà app server có thể hiểu, cuối cùng app server quăng kết quả về cho người dùng.\n\nNote: Vậy Rack như một phiên dịch viên để truyền đạt giữa ứng dụng và app server (Không thật sự đúng về bản chất nhưng ta cứ tạm chấp nhận liên tưởng này).\n\n## 4. Build một simple Rack application\n\n- Tạo 1 Folder với 1 file tên **Gemfile** có nội dung như sau:\n\n```ruby\nsource 'https://rubygems.org'\n\ngem 'rack'\n```\n\n- Cài đặt gem vói lệnh **bundle install**\n\n- Tạo file **config.ru**.\n\nNote: Đây sẽ là file main để xử lý request.\n\n- Chạy project với lệnh **bundle exec rackup**\n\n> Project demo [tại đây!](https://github.com/hdchinh/simple-rack-app)\n\n## 5. Giải thích nội dung mã nguồn của app demo\n\n```ruby\nmap '/signup_user' do\n  run SignUpUser.new\nend\n\nmap '/signup' do\n  run MySignUp.new\nend\n\nmap '/signin' do\n  run MySignIn.new\nend\n\nmap '/signin_user' do\n  run SignInUser.new\nend\n\nmap '/' do\n  run HomePage.new\nend\n\nrun MyNotFound.new\n```\n\nChắc bạn cũng có thể đoán ra ý nghĩa của nó, nếu map chúng đường dẫn thì sẽ chạy lệnh trong đó.\n\nEx:\n\n```ruby\nmap '/' do\n  run HomePage.new\nend\n```\n\nNếu truy cập theo trang chủ thì sẽ chạy lệnh **run HomePage.new**.\n\nNếu url người dùng request không trùng bất cứ trường hợp nào thì chạy lệnh **run MyNotFound.new** ở cuối.\n\nMột class sẽ có dạng như sau:\n\n```ruby\nclass SignInUser\n  def call(env)\n    # read file data\n    file = File.read('data.txt')\n\n    # get params\n    data =  Rack::Utils.parse_nested_query(env['QUERY_STRING'])\n    email = data['email']\n    pass = data['password']\n\n    # convert file data from string to hash\n    hash_data = eval(file)\n    # init variable for user login\n    user_email = nil\n\n    # loop hash to find email params\n    hash_data.each do |k, val|\n      if k == email\n        if val = pass\n          user_email = k\n        end\n      end\n    end\n\n    if user_email\n      body = [\"<h1>email: #{user_email}<h/1>\"]\n    else\n      body = [\"<h1>Email or Password Invalid</h1>\"]\n    end\n\n    [200, {'Content-Type' => 'text/html'}, body]\n  end\nend\n```\n\nBạn thấy phức tạp? Không sao cả, chỉ cần chú ý đến dòng cuối cùng trong method call. Ta chỉ cần nhớ:\n\n- Mỗi class sử dụng method call để cài đặt (yêu cầu của Rack).\n\n- Trong method này nhận vào một params, đây chính là request đi tới.\n\n- Kết quả trả về của method call này là một mảng gồm 3 phần tử:\n\n  1. Status code (Ví dụ như: 200 -> success, 404 -> not found).\n  2. Một hash, ở đây chính là header, chứa những thông tin mà trình duyệt cần.\n  3. Phần tử cuối cùng là một mảng, chính là phần body của kết quả trả về.\n\n## 6. Kết luận\n\nTrên là một basic app xây dựng với Rack, vì định nghĩa chỉ đọc không làm sẽ rất khó hiểu, nên tôi làm demo trước, hy vọng trong thời gian tới nếu kiến thức thu lượm đủ để viết về cách vận hành của Rack một cách sâu sắc, tôi có thể tiếp tục chủ đề này.\n","slug":"2019-06-24-simple-rack-application","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsb60025p3m2cm933tm0","content":"<h2 id=\"1-Dat-van-de\"><a href=\"#1-Dat-van-de\" class=\"headerlink\" title=\"1. Đặt vấn đề\"></a>1. Đặt vấn đề</h2><p>Có lẽ cũng như tôi, khi mới tiếp cận với một framework ruby như Rails chẳng hạn, bạn đã nghe về Rack? hoặc ít ra cũng từng thấy cái <strong>gem rack</strong> trong Gemfile. Nhưng có khi nào bạn dùng đến chúng? Không ư? Tôi cũng nghĩ vậy, tôi cũng kệ, tôi cũng chả quan tâm, cuộc sống không đủ high hay sao mà lại đâm đầu vào cái khó :alien:.</p>\n<p>Nhưng làm việc hàng ngày với nó mà không hiểu nó là gì luôn làm cho ta cảm giác bất an vô định, cập nhật CV là Developer mà đi phỏng vấn được hỏi rack là gì, lại trả lời “em…em..em hông biết” thì liệu có bị đánh xuống rank junior hay không? Thôi thì cứ tìm hiểu coi nó ra sao.</p>\n<p>Và thế là tôi đã đọc docs trên trang chủ của Rack, nói chung đọc qua thì có hiểu, mà cái hiểu nó mông lung như một trò đùa, chút nữa thì đành phải “anh xin giơ tay rút lui thôi”.</p>\n<p>Vậy nên tôi sẽ viết một ứng dụng Rack (chạy trên Rack) very..very simple, để tôi và có thể cả bạn có cái nhìn thoáng qua về Rack trước đã, chứ tôi thấy hiểu biết hiện tại của mình chưa đủ để chém gió hàn lâm về chủ đề này (hy vọng tương lai gần sẽ có bài chém gió hàn lâm).</p>\n<h2 id=\"2-Tham-khao\"><a href=\"#2-Tham-khao\" class=\"headerlink\" title=\"2. Tham khảo?\"></a>2. Tham khảo?</h2><ol>\n<li><p>Bài viết này tôi tham khảo cách sử dụng Rack trên trang chủ của Rack <a href=\"https://rack.github.io/\" target=\"_blank\" rel=\"noopener\">tại đây</a> và trên mục docs của ruby <a href=\"https://www.rubydoc.info/github/rack/rack/\" target=\"_blank\" rel=\"noopener\">tại đây</a>.</p>\n</li>\n<li><p>Ứng dụng rất thô sơ và KHÔNG sử dụng “bét pờ rạch tít” nào cả.</p>\n</li>\n</ol>\n<h2 id=\"3-Kien-thuc-can-chuan-bi-truoc\"><a href=\"#3-Kien-thuc-can-chuan-bi-truoc\" class=\"headerlink\" title=\"3. Kiến thức cần chuẩn bị trước.\"></a>3. Kiến thức cần chuẩn bị trước.</h2><p>Dù ít dù nhiều thì vẫn phải đánh qua lý thuyết một chút trước khi mày mò làm gì đó. Một số khái niệm/quy trình chúng ta nên nắm trước như sau:</p>\n<p>1) Rack là một lớp nằm giữa web/app server và ứng dụng.</p>\n<p>Ex: Nếu tôi sử dụng Rails với app server là Puma, web server là Nginx thì đường đi của một request sẽ như sau:</p>\n<p><img src=\"/images/rack.jpeg\" alt=\"hoa\"></p>\n<p>Note: Khái niệm <strong>web server</strong> và <strong>app server</strong> chúng ta sẽ bàn tới sau.</p>\n<p>2) Như hình trên, ta có thể thấy Rack sẽ giao tiếp với <strong>app server</strong>, nên Rack sẽ nhận request từ app server gửi qua, với nội dung lằng nhằng rối rắm gì đó, sau đó Rack sẽ <strong>làm gì đó</strong> với cái request rối rắm kia, rồi gửi kết quả mà Rails có thể hiểu và thực thi được. Sau đó Rails sẽ gửi về cho Rack kết quả cũng rối rắm không kém và nhiệm vụ của Rack lại là tiếp tục <strong>làm gì đó</strong> cái kết quả từ Rails, sao cho chuyển kết quả đó thành 1 thứ gì đó mà app server có thể hiểu, cuối cùng app server quăng kết quả về cho người dùng.</p>\n<p>Note: Vậy Rack như một phiên dịch viên để truyền đạt giữa ứng dụng và app server (Không thật sự đúng về bản chất nhưng ta cứ tạm chấp nhận liên tưởng này).</p>\n<h2 id=\"4-Build-mot-simple-Rack-application\"><a href=\"#4-Build-mot-simple-Rack-application\" class=\"headerlink\" title=\"4. Build một simple Rack application\"></a>4. Build một simple Rack application</h2><ul>\n<li>Tạo 1 Folder với 1 file tên <strong>Gemfile</strong> có nội dung như sau:</li>\n</ul>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source <span class=\"string\">'https://rubygems.org'</span></span><br><span class=\"line\"></span><br><span class=\"line\">gem <span class=\"string\">'rack'</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>Cài đặt gem vói lệnh <strong>bundle install</strong></p>\n</li>\n<li><p>Tạo file <strong>config.ru</strong>.</p>\n</li>\n</ul>\n<p>Note: Đây sẽ là file main để xử lý request.</p>\n<ul>\n<li>Chạy project với lệnh <strong>bundle exec rackup</strong></li>\n</ul>\n<blockquote>\n<p>Project demo <a href=\"https://github.com/hdchinh/simple-rack-app\" target=\"_blank\" rel=\"noopener\">tại đây!</a></p>\n</blockquote>\n<h2 id=\"5-Giai-thich-noi-dung-ma-nguon-cua-app-demo\"><a href=\"#5-Giai-thich-noi-dung-ma-nguon-cua-app-demo\" class=\"headerlink\" title=\"5. Giải thích nội dung mã nguồn của app demo\"></a>5. Giải thích nội dung mã nguồn của app demo</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">map <span class=\"string\">'/signup_user'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run SignUpUser.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">map <span class=\"string\">'/signup'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run MySignUp.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">map <span class=\"string\">'/signin'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run MySignIn.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">map <span class=\"string\">'/signin_user'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run SignInUser.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">map <span class=\"string\">'/'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run HomePage.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">run MyNotFound.new</span><br></pre></td></tr></table></figure>\n\n<p>Chắc bạn cũng có thể đoán ra ý nghĩa của nó, nếu map chúng đường dẫn thì sẽ chạy lệnh trong đó.</p>\n<p>Ex:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">map <span class=\"string\">'/'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run HomePage.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Nếu truy cập theo trang chủ thì sẽ chạy lệnh <strong>run HomePage.new</strong>.</p>\n<p>Nếu url người dùng request không trùng bất cứ trường hợp nào thì chạy lệnh <strong>run MyNotFound.new</strong> ở cuối.</p>\n<p>Một class sẽ có dạng như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SignInUser</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">call</span><span class=\"params\">(env)</span></span></span><br><span class=\"line\">    <span class=\"comment\"># read file data</span></span><br><span class=\"line\">    file = File.read(<span class=\"string\">'data.txt'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># get params</span></span><br><span class=\"line\">    data =  Rack::Utils.parse_nested_query(env[<span class=\"string\">'QUERY_STRING'</span>])</span><br><span class=\"line\">    email = data[<span class=\"string\">'email'</span>]</span><br><span class=\"line\">    pass = data[<span class=\"string\">'password'</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># convert file data from string to hash</span></span><br><span class=\"line\">    hash_data = eval(file)</span><br><span class=\"line\">    <span class=\"comment\"># init variable for user login</span></span><br><span class=\"line\">    user_email = <span class=\"literal\">nil</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># loop hash to find email params</span></span><br><span class=\"line\">    hash_data.each <span class=\"keyword\">do</span> <span class=\"params\">|k, val|</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> k == email</span><br><span class=\"line\">        <span class=\"keyword\">if</span> val = pass</span><br><span class=\"line\">          user_email = k</span><br><span class=\"line\">        <span class=\"keyword\">end</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> user_email</span><br><span class=\"line\">      body = [<span class=\"string\">\"&lt;h1&gt;email: <span class=\"subst\">#&#123;user_email&#125;</span>&lt;h/1&gt;\"</span>]</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      body = [<span class=\"string\">\"&lt;h1&gt;Email or Password Invalid&lt;/h1&gt;\"</span>]</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"number\">200</span>, &#123;<span class=\"string\">'Content-Type'</span> =&gt; <span class=\"string\">'text/html'</span>&#125;, body]</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Bạn thấy phức tạp? Không sao cả, chỉ cần chú ý đến dòng cuối cùng trong method call. Ta chỉ cần nhớ:</p>\n<ul>\n<li><p>Mỗi class sử dụng method call để cài đặt (yêu cầu của Rack).</p>\n</li>\n<li><p>Trong method này nhận vào một params, đây chính là request đi tới.</p>\n</li>\n<li><p>Kết quả trả về của method call này là một mảng gồm 3 phần tử:</p>\n<ol>\n<li>Status code (Ví dụ như: 200 -&gt; success, 404 -&gt; not found).</li>\n<li>Một hash, ở đây chính là header, chứa những thông tin mà trình duyệt cần.</li>\n<li>Phần tử cuối cùng là một mảng, chính là phần body của kết quả trả về.</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"6-Ket-luan\"><a href=\"#6-Ket-luan\" class=\"headerlink\" title=\"6. Kết luận\"></a>6. Kết luận</h2><p>Trên là một basic app xây dựng với Rack, vì định nghĩa chỉ đọc không làm sẽ rất khó hiểu, nên tôi làm demo trước, hy vọng trong thời gian tới nếu kiến thức thu lượm đủ để viết về cách vận hành của Rack một cách sâu sắc, tôi có thể tiếp tục chủ đề này.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Dat-van-de\"><a href=\"#1-Dat-van-de\" class=\"headerlink\" title=\"1. Đặt vấn đề\"></a>1. Đặt vấn đề</h2><p>Có lẽ cũng như tôi, khi mới tiếp cận với một framework ruby như Rails chẳng hạn, bạn đã nghe về Rack? hoặc ít ra cũng từng thấy cái <strong>gem rack</strong> trong Gemfile. Nhưng có khi nào bạn dùng đến chúng? Không ư? Tôi cũng nghĩ vậy, tôi cũng kệ, tôi cũng chả quan tâm, cuộc sống không đủ high hay sao mà lại đâm đầu vào cái khó :alien:.</p>\n<p>Nhưng làm việc hàng ngày với nó mà không hiểu nó là gì luôn làm cho ta cảm giác bất an vô định, cập nhật CV là Developer mà đi phỏng vấn được hỏi rack là gì, lại trả lời “em…em..em hông biết” thì liệu có bị đánh xuống rank junior hay không? Thôi thì cứ tìm hiểu coi nó ra sao.</p>\n<p>Và thế là tôi đã đọc docs trên trang chủ của Rack, nói chung đọc qua thì có hiểu, mà cái hiểu nó mông lung như một trò đùa, chút nữa thì đành phải “anh xin giơ tay rút lui thôi”.</p>\n<p>Vậy nên tôi sẽ viết một ứng dụng Rack (chạy trên Rack) very..very simple, để tôi và có thể cả bạn có cái nhìn thoáng qua về Rack trước đã, chứ tôi thấy hiểu biết hiện tại của mình chưa đủ để chém gió hàn lâm về chủ đề này (hy vọng tương lai gần sẽ có bài chém gió hàn lâm).</p>\n<h2 id=\"2-Tham-khao\"><a href=\"#2-Tham-khao\" class=\"headerlink\" title=\"2. Tham khảo?\"></a>2. Tham khảo?</h2><ol>\n<li><p>Bài viết này tôi tham khảo cách sử dụng Rack trên trang chủ của Rack <a href=\"https://rack.github.io/\" target=\"_blank\" rel=\"noopener\">tại đây</a> và trên mục docs của ruby <a href=\"https://www.rubydoc.info/github/rack/rack/\" target=\"_blank\" rel=\"noopener\">tại đây</a>.</p>\n</li>\n<li><p>Ứng dụng rất thô sơ và KHÔNG sử dụng “bét pờ rạch tít” nào cả.</p>\n</li>\n</ol>\n<h2 id=\"3-Kien-thuc-can-chuan-bi-truoc\"><a href=\"#3-Kien-thuc-can-chuan-bi-truoc\" class=\"headerlink\" title=\"3. Kiến thức cần chuẩn bị trước.\"></a>3. Kiến thức cần chuẩn bị trước.</h2><p>Dù ít dù nhiều thì vẫn phải đánh qua lý thuyết một chút trước khi mày mò làm gì đó. Một số khái niệm/quy trình chúng ta nên nắm trước như sau:</p>\n<p>1) Rack là một lớp nằm giữa web/app server và ứng dụng.</p>\n<p>Ex: Nếu tôi sử dụng Rails với app server là Puma, web server là Nginx thì đường đi của một request sẽ như sau:</p>\n<p><img src=\"/images/rack.jpeg\" alt=\"hoa\"></p>\n<p>Note: Khái niệm <strong>web server</strong> và <strong>app server</strong> chúng ta sẽ bàn tới sau.</p>\n<p>2) Như hình trên, ta có thể thấy Rack sẽ giao tiếp với <strong>app server</strong>, nên Rack sẽ nhận request từ app server gửi qua, với nội dung lằng nhằng rối rắm gì đó, sau đó Rack sẽ <strong>làm gì đó</strong> với cái request rối rắm kia, rồi gửi kết quả mà Rails có thể hiểu và thực thi được. Sau đó Rails sẽ gửi về cho Rack kết quả cũng rối rắm không kém và nhiệm vụ của Rack lại là tiếp tục <strong>làm gì đó</strong> cái kết quả từ Rails, sao cho chuyển kết quả đó thành 1 thứ gì đó mà app server có thể hiểu, cuối cùng app server quăng kết quả về cho người dùng.</p>\n<p>Note: Vậy Rack như một phiên dịch viên để truyền đạt giữa ứng dụng và app server (Không thật sự đúng về bản chất nhưng ta cứ tạm chấp nhận liên tưởng này).</p>\n<h2 id=\"4-Build-mot-simple-Rack-application\"><a href=\"#4-Build-mot-simple-Rack-application\" class=\"headerlink\" title=\"4. Build một simple Rack application\"></a>4. Build một simple Rack application</h2><ul>\n<li>Tạo 1 Folder với 1 file tên <strong>Gemfile</strong> có nội dung như sau:</li>\n</ul>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source <span class=\"string\">'https://rubygems.org'</span></span><br><span class=\"line\"></span><br><span class=\"line\">gem <span class=\"string\">'rack'</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>Cài đặt gem vói lệnh <strong>bundle install</strong></p>\n</li>\n<li><p>Tạo file <strong>config.ru</strong>.</p>\n</li>\n</ul>\n<p>Note: Đây sẽ là file main để xử lý request.</p>\n<ul>\n<li>Chạy project với lệnh <strong>bundle exec rackup</strong></li>\n</ul>\n<blockquote>\n<p>Project demo <a href=\"https://github.com/hdchinh/simple-rack-app\" target=\"_blank\" rel=\"noopener\">tại đây!</a></p>\n</blockquote>\n<h2 id=\"5-Giai-thich-noi-dung-ma-nguon-cua-app-demo\"><a href=\"#5-Giai-thich-noi-dung-ma-nguon-cua-app-demo\" class=\"headerlink\" title=\"5. Giải thích nội dung mã nguồn của app demo\"></a>5. Giải thích nội dung mã nguồn của app demo</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">map <span class=\"string\">'/signup_user'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run SignUpUser.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">map <span class=\"string\">'/signup'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run MySignUp.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">map <span class=\"string\">'/signin'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run MySignIn.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">map <span class=\"string\">'/signin_user'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run SignInUser.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">map <span class=\"string\">'/'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run HomePage.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">run MyNotFound.new</span><br></pre></td></tr></table></figure>\n\n<p>Chắc bạn cũng có thể đoán ra ý nghĩa của nó, nếu map chúng đường dẫn thì sẽ chạy lệnh trong đó.</p>\n<p>Ex:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">map <span class=\"string\">'/'</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">  run HomePage.new</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Nếu truy cập theo trang chủ thì sẽ chạy lệnh <strong>run HomePage.new</strong>.</p>\n<p>Nếu url người dùng request không trùng bất cứ trường hợp nào thì chạy lệnh <strong>run MyNotFound.new</strong> ở cuối.</p>\n<p>Một class sẽ có dạng như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SignInUser</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">call</span><span class=\"params\">(env)</span></span></span><br><span class=\"line\">    <span class=\"comment\"># read file data</span></span><br><span class=\"line\">    file = File.read(<span class=\"string\">'data.txt'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># get params</span></span><br><span class=\"line\">    data =  Rack::Utils.parse_nested_query(env[<span class=\"string\">'QUERY_STRING'</span>])</span><br><span class=\"line\">    email = data[<span class=\"string\">'email'</span>]</span><br><span class=\"line\">    pass = data[<span class=\"string\">'password'</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># convert file data from string to hash</span></span><br><span class=\"line\">    hash_data = eval(file)</span><br><span class=\"line\">    <span class=\"comment\"># init variable for user login</span></span><br><span class=\"line\">    user_email = <span class=\"literal\">nil</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># loop hash to find email params</span></span><br><span class=\"line\">    hash_data.each <span class=\"keyword\">do</span> <span class=\"params\">|k, val|</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span> k == email</span><br><span class=\"line\">        <span class=\"keyword\">if</span> val = pass</span><br><span class=\"line\">          user_email = k</span><br><span class=\"line\">        <span class=\"keyword\">end</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> user_email</span><br><span class=\"line\">      body = [<span class=\"string\">\"&lt;h1&gt;email: <span class=\"subst\">#&#123;user_email&#125;</span>&lt;h/1&gt;\"</span>]</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      body = [<span class=\"string\">\"&lt;h1&gt;Email or Password Invalid&lt;/h1&gt;\"</span>]</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    [<span class=\"number\">200</span>, &#123;<span class=\"string\">'Content-Type'</span> =&gt; <span class=\"string\">'text/html'</span>&#125;, body]</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Bạn thấy phức tạp? Không sao cả, chỉ cần chú ý đến dòng cuối cùng trong method call. Ta chỉ cần nhớ:</p>\n<ul>\n<li><p>Mỗi class sử dụng method call để cài đặt (yêu cầu của Rack).</p>\n</li>\n<li><p>Trong method này nhận vào một params, đây chính là request đi tới.</p>\n</li>\n<li><p>Kết quả trả về của method call này là một mảng gồm 3 phần tử:</p>\n<ol>\n<li>Status code (Ví dụ như: 200 -&gt; success, 404 -&gt; not found).</li>\n<li>Một hash, ở đây chính là header, chứa những thông tin mà trình duyệt cần.</li>\n<li>Phần tử cuối cùng là một mảng, chính là phần body của kết quả trả về.</li>\n</ol>\n</li>\n</ul>\n<h2 id=\"6-Ket-luan\"><a href=\"#6-Ket-luan\" class=\"headerlink\" title=\"6. Kết luận\"></a>6. Kết luận</h2><p>Trên là một basic app xây dựng với Rack, vì định nghĩa chỉ đọc không làm sẽ rất khó hiểu, nên tôi làm demo trước, hy vọng trong thời gian tới nếu kiến thức thu lượm đủ để viết về cách vận hành của Rack một cách sâu sắc, tôi có thể tiếp tục chủ đề này.</p>\n"},{"title":"Từ Khoá Super Trong Ruby?","date":"2019-06-15T17:00:00.000Z","draft":false,"_content":"\n## Đặt vấn đề\n\nKế thừa là một 1 trong 4 yếu tố cốt lõi tạo nên đặc tính hướng đối tượng của một ngôn ngữ (như những gì chúng ta đã được dạy ở trường). Riêng điều đó thôi đã đủ để thể hiện tầm quan trọng của nó (có thật không nhỉ :grimacing:).\n\nTrong ngôn ngữ ruby có một từ khoá thường xuyên xuất hiện khi cần kế thừa hay override lại phương thức lớp cha đó là **super**.\n\nQua bài viết chúng ta sẽ cùng tìm hiểu về nó.\n\n## Luận bàn\n\n## 1. Định nghĩa\n\n```\nIt calls a method on the parent class with the same name as the method that calls super.\n```\n\nVí dụ:\n\n```ruby\nclass Dog < Pig\n  def testing\n    super\n  end\nend\n```\n\n=> Khi ta gọi phương thức **testing** với một instance của lớp Dog, ruby sẽ đi đến class cha/ông/cụ/kỵ... của **Dog** để tìm và chạy phương thức **testing** được implement ở lớp cha/ông/cụ/kỵ... đó.\n\n## 2. So sánh super và super()\n\nVới những bạn mới học, chúng ta đôi lúc sẽ nhầm lẫn là 2 cách gọi này thực chất là một, cũng bởi vì ruby cho phép sử dụng **()** như một optional, tức là có cũng được mà không có cũng được.\n\nNhưng thực ra không phải vậy, 2 cách sử dụng này sẽ dẫn đến các kết qủa khác nhau.\n\nCùng xét một ví dụ: Giả sử tôi có class Cat và một class con của Cat tên là YellowCat, mã nguồn như sau.\n\nSử dụng super\n\n```ruby\nclass Cat\n  def initialize\n    puts \"i'm meo\"\n  end\nend\n\nclass YellowCat < Cat\n  def initialize\n    super\n  end\nend\n\nYellowCat.new\n\n# => i'm meo\n```\n\nSử dụng super()\n\n```ruby\nclass Cat\n  def initialize\n    puts \"i'm meo\"\n  end\nend\n\nclass YellowCat < Cat\n  def initialize\n    super\n  end\nend\n\nYellowCat.new\n\n# => i'm meo\n```\n\n**Kết quả là tương tự nhau, điều này giúp chúng ta ghi nhớ một ý, đó là khi không có tham số truyền vào method thì dùng **super** hay **super()** là tương đương nhau**\n\nTa xét một ví dụ khác:\n\nSử dụng super\n\n```ruby\nclass Cat\n  attr_accessor :name\n\n  def initialize(name)\n    @name = name\n  end\nend\n\nclass YellowCat < Cat\n  def initialize(name)\n    super\n  end\nend\n\nmeo = YellowCat.new('mi mi')\n\nputs \"ten meo: #{meo.name}\"\n# => ten meo: mi mi\n```\n\nSử dụng super()\n\n```ruby\nclass Cat\n  attr_accessor :name\n\n  def initialize(name)\n    @name = name\n  end\nend\n\nclass YellowCat < Cat\n  def initialize(name)\n    super()\n  end\nend\n\nmeo = YellowCat.new('mi mi')\n\nputs \"ten meo: #{meo.name}\"\n# => ten meo: mi mi\n```\n\nĐến bây giờ chúng ta đã phát sinh một lỗi **wrong number of arguments (given 0, expected 1)**.\nĐiều này xảy ra là vì:\n\n**Với từ khoá **super** bạn sẽ truyền TẤT CẢ tham số lên method đó ở lớp cha. Còn với **super()** bạn chỉ truyền lên lớp cha những tham số mà bạn bỏ vào trong **super()**.**\n\nNhư ta thấy trong ví dụ trên, ta không bỏ gì vào **super()** => khi lên lớp cha (lớp Cat) method initialize yêu cầu tham số name nhưng chúng ta không truyền gì lên và từ đó dẫn đến lỗi wrong number of arguments.\n\nĐể khắc phục chúng ta chỉ cần truyền tham số vào super() để lớp Cat nhân được tham số đó.\n\n```ruby\nclass YellowCat < Cat\n  def initialize(name)\n    super(name)\n  end\nend\n```\n\n## 3. Sự hữu ích của super()\n\nTôi có một bài toán:\n\n:one: Tôi có 1 lớp Cat với 2 instance variable là name và age.\n:two: Lớp YellowCat là lớp con của Cat.\n:three: Lớp YellowCat có thêm 1 instance variable là role.\n\nXây dựng lớp Cat có vẻ đơn giản, ta làm như sau:\n\n```ruby\nclass Cat < Animal\n  attr_accessor :name, :age\n\n  def initialize(name, age)\n    @name = name\n    @age = age\n  end\nend\n\n# => hoàn thành yêu cầu\n```\n\nTiếp theo đến lớp  YellowCat, xem chừng cũng không khó:\n\n```ruby\nclass YellowCat < Cat\n  attr_accessor :yellow_cat_name, :yellow_cat_age, :role\n\n  def initialize(yellow_cat_name, yellow_cat_age, role)\n    @yellow_cat_name = yellow_cat_name\n    @yellow_cat_age = yellow_cat_age\n    @role = role\n  end\nend\n\n# => Cũng hoàn thành yêu cầu.\n```\n\nCách này cũng hoàn thành được yêu cầu của bài toán, nhưng nó không ổn tí nào. Vì sao? Vì khi bạn tạo một instance thuộc lớp YellowCat nó sẽ có tổng cộng 5 instance variable bao gồm 3 instance variable khai báo trong lớp YellowCat, và 2 trong lớp Cat (bị thừa 2 instance variable).\n\nĐiều này đi ngược lại với các quy tắc lập trình quan trọng chúng ta cần tuần thủ như DRY.\n\nĐến đây sức mạnh **super()** sẽ được thời cơ để thể hiện. Ta sẽ optimize lại mã nguồn của YellowCat như sau:\n\n```ruby\nclass YellowCat < Cat\n  # thêm một instance variable\n  attr_accessor :role\n\n  def initialize(name, age, role)\n    super(name, age)\n    @role = role\n  end\nend\n\nmeo2 = YellowCat.new('ni ni', 10, 'admin')\nputs \"ten meo la: #{meo2.name} \\ntuoi meo la: #{meo2.age} \\nrole cua meo la: #{meo2.role}\"\n\n# => ten meo la: ni ni\n# => tuoi meo la: 10\n# => role cua meo la: admin\n```\n\nỞ lớp con chúng ta có thêm 1 instance variable, chúng ta khai báo cho mình nó và duy nhất mỗi nó :arrow_right: không lãng phí vùng nhớ và tận dụng được mã nguồn cũ.\n\nTrong phương thức khởi tạo đối tượng YellowCat chúng ta khởi tạo biến instance mới, còn 2 instance variable được kế thừa từ lớp cha thì ta truyền tham số vào **super()** để truyền lên lớp cha và mặc kệ lớp cha xử lý thế nào thì tuỳ.\n\n## Tham khảo\n\n[1][https://odetocode.com/blogs/scott/archive/2010/07/13/ruby-initialize-and-super.aspx](https://odetocode.com/blogs/scott/archive/2010/07/13/ruby-initialize-and-super.aspx)\n","source":"_posts/2019-06-16-tu-khoa-super-trong-ruby.md","raw":"---\ntitle: \"Từ Khoá Super Trong Ruby?\"\ndate: 2019-06-16\ndraft: false\ntags: [\"RUBY\"]\ncategories: [\"RUBY\"]\n\n---\n\n## Đặt vấn đề\n\nKế thừa là một 1 trong 4 yếu tố cốt lõi tạo nên đặc tính hướng đối tượng của một ngôn ngữ (như những gì chúng ta đã được dạy ở trường). Riêng điều đó thôi đã đủ để thể hiện tầm quan trọng của nó (có thật không nhỉ :grimacing:).\n\nTrong ngôn ngữ ruby có một từ khoá thường xuyên xuất hiện khi cần kế thừa hay override lại phương thức lớp cha đó là **super**.\n\nQua bài viết chúng ta sẽ cùng tìm hiểu về nó.\n\n## Luận bàn\n\n## 1. Định nghĩa\n\n```\nIt calls a method on the parent class with the same name as the method that calls super.\n```\n\nVí dụ:\n\n```ruby\nclass Dog < Pig\n  def testing\n    super\n  end\nend\n```\n\n=> Khi ta gọi phương thức **testing** với một instance của lớp Dog, ruby sẽ đi đến class cha/ông/cụ/kỵ... của **Dog** để tìm và chạy phương thức **testing** được implement ở lớp cha/ông/cụ/kỵ... đó.\n\n## 2. So sánh super và super()\n\nVới những bạn mới học, chúng ta đôi lúc sẽ nhầm lẫn là 2 cách gọi này thực chất là một, cũng bởi vì ruby cho phép sử dụng **()** như một optional, tức là có cũng được mà không có cũng được.\n\nNhưng thực ra không phải vậy, 2 cách sử dụng này sẽ dẫn đến các kết qủa khác nhau.\n\nCùng xét một ví dụ: Giả sử tôi có class Cat và một class con của Cat tên là YellowCat, mã nguồn như sau.\n\nSử dụng super\n\n```ruby\nclass Cat\n  def initialize\n    puts \"i'm meo\"\n  end\nend\n\nclass YellowCat < Cat\n  def initialize\n    super\n  end\nend\n\nYellowCat.new\n\n# => i'm meo\n```\n\nSử dụng super()\n\n```ruby\nclass Cat\n  def initialize\n    puts \"i'm meo\"\n  end\nend\n\nclass YellowCat < Cat\n  def initialize\n    super\n  end\nend\n\nYellowCat.new\n\n# => i'm meo\n```\n\n**Kết quả là tương tự nhau, điều này giúp chúng ta ghi nhớ một ý, đó là khi không có tham số truyền vào method thì dùng **super** hay **super()** là tương đương nhau**\n\nTa xét một ví dụ khác:\n\nSử dụng super\n\n```ruby\nclass Cat\n  attr_accessor :name\n\n  def initialize(name)\n    @name = name\n  end\nend\n\nclass YellowCat < Cat\n  def initialize(name)\n    super\n  end\nend\n\nmeo = YellowCat.new('mi mi')\n\nputs \"ten meo: #{meo.name}\"\n# => ten meo: mi mi\n```\n\nSử dụng super()\n\n```ruby\nclass Cat\n  attr_accessor :name\n\n  def initialize(name)\n    @name = name\n  end\nend\n\nclass YellowCat < Cat\n  def initialize(name)\n    super()\n  end\nend\n\nmeo = YellowCat.new('mi mi')\n\nputs \"ten meo: #{meo.name}\"\n# => ten meo: mi mi\n```\n\nĐến bây giờ chúng ta đã phát sinh một lỗi **wrong number of arguments (given 0, expected 1)**.\nĐiều này xảy ra là vì:\n\n**Với từ khoá **super** bạn sẽ truyền TẤT CẢ tham số lên method đó ở lớp cha. Còn với **super()** bạn chỉ truyền lên lớp cha những tham số mà bạn bỏ vào trong **super()**.**\n\nNhư ta thấy trong ví dụ trên, ta không bỏ gì vào **super()** => khi lên lớp cha (lớp Cat) method initialize yêu cầu tham số name nhưng chúng ta không truyền gì lên và từ đó dẫn đến lỗi wrong number of arguments.\n\nĐể khắc phục chúng ta chỉ cần truyền tham số vào super() để lớp Cat nhân được tham số đó.\n\n```ruby\nclass YellowCat < Cat\n  def initialize(name)\n    super(name)\n  end\nend\n```\n\n## 3. Sự hữu ích của super()\n\nTôi có một bài toán:\n\n:one: Tôi có 1 lớp Cat với 2 instance variable là name và age.\n:two: Lớp YellowCat là lớp con của Cat.\n:three: Lớp YellowCat có thêm 1 instance variable là role.\n\nXây dựng lớp Cat có vẻ đơn giản, ta làm như sau:\n\n```ruby\nclass Cat < Animal\n  attr_accessor :name, :age\n\n  def initialize(name, age)\n    @name = name\n    @age = age\n  end\nend\n\n# => hoàn thành yêu cầu\n```\n\nTiếp theo đến lớp  YellowCat, xem chừng cũng không khó:\n\n```ruby\nclass YellowCat < Cat\n  attr_accessor :yellow_cat_name, :yellow_cat_age, :role\n\n  def initialize(yellow_cat_name, yellow_cat_age, role)\n    @yellow_cat_name = yellow_cat_name\n    @yellow_cat_age = yellow_cat_age\n    @role = role\n  end\nend\n\n# => Cũng hoàn thành yêu cầu.\n```\n\nCách này cũng hoàn thành được yêu cầu của bài toán, nhưng nó không ổn tí nào. Vì sao? Vì khi bạn tạo một instance thuộc lớp YellowCat nó sẽ có tổng cộng 5 instance variable bao gồm 3 instance variable khai báo trong lớp YellowCat, và 2 trong lớp Cat (bị thừa 2 instance variable).\n\nĐiều này đi ngược lại với các quy tắc lập trình quan trọng chúng ta cần tuần thủ như DRY.\n\nĐến đây sức mạnh **super()** sẽ được thời cơ để thể hiện. Ta sẽ optimize lại mã nguồn của YellowCat như sau:\n\n```ruby\nclass YellowCat < Cat\n  # thêm một instance variable\n  attr_accessor :role\n\n  def initialize(name, age, role)\n    super(name, age)\n    @role = role\n  end\nend\n\nmeo2 = YellowCat.new('ni ni', 10, 'admin')\nputs \"ten meo la: #{meo2.name} \\ntuoi meo la: #{meo2.age} \\nrole cua meo la: #{meo2.role}\"\n\n# => ten meo la: ni ni\n# => tuoi meo la: 10\n# => role cua meo la: admin\n```\n\nỞ lớp con chúng ta có thêm 1 instance variable, chúng ta khai báo cho mình nó và duy nhất mỗi nó :arrow_right: không lãng phí vùng nhớ và tận dụng được mã nguồn cũ.\n\nTrong phương thức khởi tạo đối tượng YellowCat chúng ta khởi tạo biến instance mới, còn 2 instance variable được kế thừa từ lớp cha thì ta truyền tham số vào **super()** để truyền lên lớp cha và mặc kệ lớp cha xử lý thế nào thì tuỳ.\n\n## Tham khảo\n\n[1][https://odetocode.com/blogs/scott/archive/2010/07/13/ruby-initialize-and-super.aspx](https://odetocode.com/blogs/scott/archive/2010/07/13/ruby-initialize-and-super.aspx)\n","slug":"2019-06-16-tu-khoa-super-trong-ruby","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsb70028p3m22412dup0","content":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Kế thừa là một 1 trong 4 yếu tố cốt lõi tạo nên đặc tính hướng đối tượng của một ngôn ngữ (như những gì chúng ta đã được dạy ở trường). Riêng điều đó thôi đã đủ để thể hiện tầm quan trọng của nó (có thật không nhỉ :grimacing:).</p>\n<p>Trong ngôn ngữ ruby có một từ khoá thường xuyên xuất hiện khi cần kế thừa hay override lại phương thức lớp cha đó là <strong>super</strong>.</p>\n<p>Qua bài viết chúng ta sẽ cùng tìm hiểu về nó.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Dinh-nghia\"><a href=\"#1-Dinh-nghia\" class=\"headerlink\" title=\"1. Định nghĩa\"></a>1. Định nghĩa</h2><figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">It</span> calls a method on the parent <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"keyword\">with</span> <span class=\"title\">the</span> <span class=\"title\">same</span> <span class=\"title\">name</span> <span class=\"title\">as</span> <span class=\"title\">the</span> <span class=\"title\">method</span> <span class=\"title\">that</span> <span class=\"title\">calls</span> <span class=\"title\">super</span>.</span></span><br></pre></td></tr></table></figure>\n\n<p>Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dog</span> &lt; Pig</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">testing</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>=&gt; Khi ta gọi phương thức <strong>testing</strong> với một instance của lớp Dog, ruby sẽ đi đến class cha/ông/cụ/kỵ… của <strong>Dog</strong> để tìm và chạy phương thức <strong>testing</strong> được implement ở lớp cha/ông/cụ/kỵ… đó.</p>\n<h2 id=\"2-So-sanh-super-va-super\"><a href=\"#2-So-sanh-super-va-super\" class=\"headerlink\" title=\"2. So sánh super và super()\"></a>2. So sánh super và super()</h2><p>Với những bạn mới học, chúng ta đôi lúc sẽ nhầm lẫn là 2 cách gọi này thực chất là một, cũng bởi vì ruby cho phép sử dụng <strong>()</strong> như một optional, tức là có cũng được mà không có cũng được.</p>\n<p>Nhưng thực ra không phải vậy, 2 cách sử dụng này sẽ dẫn đến các kết qủa khác nhau.</p>\n<p>Cùng xét một ví dụ: Giả sử tôi có class Cat và một class con của Cat tên là YellowCat, mã nguồn như sau.</p>\n<p>Sử dụng super</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"i'm meo\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">YellowCat.new</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =&gt; i'm meo</span></span><br></pre></td></tr></table></figure>\n\n<p>Sử dụng super()</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"i'm meo\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">YellowCat.new</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =&gt; i'm meo</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Kết quả là tương tự nhau, điều này giúp chúng ta ghi nhớ một ý, đó là khi không có tham số truyền vào method thì dùng **super</strong> hay <strong>super()</strong> là tương đương nhau**</p>\n<p>Ta xét một ví dụ khác:</p>\n<p>Sử dụng super</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:name</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    @name = name</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">meo = YellowCat.new(<span class=\"string\">'mi mi'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"ten meo: <span class=\"subst\">#&#123;meo.name&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; ten meo: mi mi</span></span><br></pre></td></tr></table></figure>\n\n<p>Sử dụng super()</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:name</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    @name = name</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>()</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">meo = YellowCat.new(<span class=\"string\">'mi mi'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"ten meo: <span class=\"subst\">#&#123;meo.name&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; ten meo: mi mi</span></span><br></pre></td></tr></table></figure>\n\n<p>Đến bây giờ chúng ta đã phát sinh một lỗi <strong>wrong number of arguments (given 0, expected 1)</strong>.<br>Điều này xảy ra là vì:</p>\n<p><strong>Với từ khoá **super</strong> bạn sẽ truyền TẤT CẢ tham số lên method đó ở lớp cha. Còn với <strong>super()</strong> bạn chỉ truyền lên lớp cha những tham số mà bạn bỏ vào trong <strong>super()</strong>.**</p>\n<p>Như ta thấy trong ví dụ trên, ta không bỏ gì vào <strong>super()</strong> =&gt; khi lên lớp cha (lớp Cat) method initialize yêu cầu tham số name nhưng chúng ta không truyền gì lên và từ đó dẫn đến lỗi wrong number of arguments.</p>\n<p>Để khắc phục chúng ta chỉ cần truyền tham số vào super() để lớp Cat nhân được tham số đó.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>(name)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-Su-huu-ich-cua-super\"><a href=\"#3-Su-huu-ich-cua-super\" class=\"headerlink\" title=\"3. Sự hữu ích của super()\"></a>3. Sự hữu ích của super()</h2><p>Tôi có một bài toán:</p>\n<p>:one: Tôi có 1 lớp Cat với 2 instance variable là name và age.<br>:two: Lớp YellowCat là lớp con của Cat.<br>:three: Lớp YellowCat có thêm 1 instance variable là role.</p>\n<p>Xây dựng lớp Cat có vẻ đơn giản, ta làm như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:name</span>, <span class=\"symbol\">:age</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name, age)</span></span></span><br><span class=\"line\">    @name = name</span><br><span class=\"line\">    @age = age</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =&gt; hoàn thành yêu cầu</span></span><br></pre></td></tr></table></figure>\n\n<p>Tiếp theo đến lớp  YellowCat, xem chừng cũng không khó:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:yellow_cat_name</span>, <span class=\"symbol\">:yellow_cat_age</span>, <span class=\"symbol\">:role</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(yellow_cat_name, yellow_cat_age, role)</span></span></span><br><span class=\"line\">    @yellow_cat_name = yellow_cat_name</span><br><span class=\"line\">    @yellow_cat_age = yellow_cat_age</span><br><span class=\"line\">    @role = role</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =&gt; Cũng hoàn thành yêu cầu.</span></span><br></pre></td></tr></table></figure>\n\n<p>Cách này cũng hoàn thành được yêu cầu của bài toán, nhưng nó không ổn tí nào. Vì sao? Vì khi bạn tạo một instance thuộc lớp YellowCat nó sẽ có tổng cộng 5 instance variable bao gồm 3 instance variable khai báo trong lớp YellowCat, và 2 trong lớp Cat (bị thừa 2 instance variable).</p>\n<p>Điều này đi ngược lại với các quy tắc lập trình quan trọng chúng ta cần tuần thủ như DRY.</p>\n<p>Đến đây sức mạnh <strong>super()</strong> sẽ được thời cơ để thể hiện. Ta sẽ optimize lại mã nguồn của YellowCat như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"comment\"># thêm một instance variable</span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:role</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name, age, role)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>(name, age)</span><br><span class=\"line\">    @role = role</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">meo2 = YellowCat.new(<span class=\"string\">'ni ni'</span>, <span class=\"number\">10</span>, <span class=\"string\">'admin'</span>)</span><br><span class=\"line\">puts <span class=\"string\">\"ten meo la: <span class=\"subst\">#&#123;meo2.name&#125;</span> \\ntuoi meo la: <span class=\"subst\">#&#123;meo2.age&#125;</span> \\nrole cua meo la: <span class=\"subst\">#&#123;meo2.role&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =&gt; ten meo la: ni ni</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; tuoi meo la: 10</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; role cua meo la: admin</span></span><br></pre></td></tr></table></figure>\n\n<p>Ở lớp con chúng ta có thêm 1 instance variable, chúng ta khai báo cho mình nó và duy nhất mỗi nó :arrow_right: không lãng phí vùng nhớ và tận dụng được mã nguồn cũ.</p>\n<p>Trong phương thức khởi tạo đối tượng YellowCat chúng ta khởi tạo biến instance mới, còn 2 instance variable được kế thừa từ lớp cha thì ta truyền tham số vào <strong>super()</strong> để truyền lên lớp cha và mặc kệ lớp cha xử lý thế nào thì tuỳ.</p>\n<h2 id=\"Tham-khao\"><a href=\"#Tham-khao\" class=\"headerlink\" title=\"Tham khảo\"></a>Tham khảo</h2><p>[1]<a href=\"https://odetocode.com/blogs/scott/archive/2010/07/13/ruby-initialize-and-super.aspx\" target=\"_blank\" rel=\"noopener\">https://odetocode.com/blogs/scott/archive/2010/07/13/ruby-initialize-and-super.aspx</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Dat-van-de\"><a href=\"#Dat-van-de\" class=\"headerlink\" title=\"Đặt vấn đề\"></a>Đặt vấn đề</h2><p>Kế thừa là một 1 trong 4 yếu tố cốt lõi tạo nên đặc tính hướng đối tượng của một ngôn ngữ (như những gì chúng ta đã được dạy ở trường). Riêng điều đó thôi đã đủ để thể hiện tầm quan trọng của nó (có thật không nhỉ :grimacing:).</p>\n<p>Trong ngôn ngữ ruby có một từ khoá thường xuyên xuất hiện khi cần kế thừa hay override lại phương thức lớp cha đó là <strong>super</strong>.</p>\n<p>Qua bài viết chúng ta sẽ cùng tìm hiểu về nó.</p>\n<h2 id=\"Luan-ban\"><a href=\"#Luan-ban\" class=\"headerlink\" title=\"Luận bàn\"></a>Luận bàn</h2><h2 id=\"1-Dinh-nghia\"><a href=\"#1-Dinh-nghia\" class=\"headerlink\" title=\"1. Định nghĩa\"></a>1. Định nghĩa</h2><figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">It</span> calls a method on the parent <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"keyword\">with</span> <span class=\"title\">the</span> <span class=\"title\">same</span> <span class=\"title\">name</span> <span class=\"title\">as</span> <span class=\"title\">the</span> <span class=\"title\">method</span> <span class=\"title\">that</span> <span class=\"title\">calls</span> <span class=\"title\">super</span>.</span></span><br></pre></td></tr></table></figure>\n\n<p>Ví dụ:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Dog</span> &lt; Pig</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">testing</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>=&gt; Khi ta gọi phương thức <strong>testing</strong> với một instance của lớp Dog, ruby sẽ đi đến class cha/ông/cụ/kỵ… của <strong>Dog</strong> để tìm và chạy phương thức <strong>testing</strong> được implement ở lớp cha/ông/cụ/kỵ… đó.</p>\n<h2 id=\"2-So-sanh-super-va-super\"><a href=\"#2-So-sanh-super-va-super\" class=\"headerlink\" title=\"2. So sánh super và super()\"></a>2. So sánh super và super()</h2><p>Với những bạn mới học, chúng ta đôi lúc sẽ nhầm lẫn là 2 cách gọi này thực chất là một, cũng bởi vì ruby cho phép sử dụng <strong>()</strong> như một optional, tức là có cũng được mà không có cũng được.</p>\n<p>Nhưng thực ra không phải vậy, 2 cách sử dụng này sẽ dẫn đến các kết qủa khác nhau.</p>\n<p>Cùng xét một ví dụ: Giả sử tôi có class Cat và một class con của Cat tên là YellowCat, mã nguồn như sau.</p>\n<p>Sử dụng super</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"i'm meo\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">YellowCat.new</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =&gt; i'm meo</span></span><br></pre></td></tr></table></figure>\n\n<p>Sử dụng super()</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"i'm meo\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">YellowCat.new</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =&gt; i'm meo</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Kết quả là tương tự nhau, điều này giúp chúng ta ghi nhớ một ý, đó là khi không có tham số truyền vào method thì dùng **super</strong> hay <strong>super()</strong> là tương đương nhau**</p>\n<p>Ta xét một ví dụ khác:</p>\n<p>Sử dụng super</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:name</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    @name = name</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">meo = YellowCat.new(<span class=\"string\">'mi mi'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"ten meo: <span class=\"subst\">#&#123;meo.name&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; ten meo: mi mi</span></span><br></pre></td></tr></table></figure>\n\n<p>Sử dụng super()</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:name</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    @name = name</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>()</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">meo = YellowCat.new(<span class=\"string\">'mi mi'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"ten meo: <span class=\"subst\">#&#123;meo.name&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; ten meo: mi mi</span></span><br></pre></td></tr></table></figure>\n\n<p>Đến bây giờ chúng ta đã phát sinh một lỗi <strong>wrong number of arguments (given 0, expected 1)</strong>.<br>Điều này xảy ra là vì:</p>\n<p><strong>Với từ khoá **super</strong> bạn sẽ truyền TẤT CẢ tham số lên method đó ở lớp cha. Còn với <strong>super()</strong> bạn chỉ truyền lên lớp cha những tham số mà bạn bỏ vào trong <strong>super()</strong>.**</p>\n<p>Như ta thấy trong ví dụ trên, ta không bỏ gì vào <strong>super()</strong> =&gt; khi lên lớp cha (lớp Cat) method initialize yêu cầu tham số name nhưng chúng ta không truyền gì lên và từ đó dẫn đến lỗi wrong number of arguments.</p>\n<p>Để khắc phục chúng ta chỉ cần truyền tham số vào super() để lớp Cat nhân được tham số đó.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>(name)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-Su-huu-ich-cua-super\"><a href=\"#3-Su-huu-ich-cua-super\" class=\"headerlink\" title=\"3. Sự hữu ích của super()\"></a>3. Sự hữu ích của super()</h2><p>Tôi có một bài toán:</p>\n<p>:one: Tôi có 1 lớp Cat với 2 instance variable là name và age.<br>:two: Lớp YellowCat là lớp con của Cat.<br>:three: Lớp YellowCat có thêm 1 instance variable là role.</p>\n<p>Xây dựng lớp Cat có vẻ đơn giản, ta làm như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Cat</span> &lt; Animal</span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:name</span>, <span class=\"symbol\">:age</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name, age)</span></span></span><br><span class=\"line\">    @name = name</span><br><span class=\"line\">    @age = age</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =&gt; hoàn thành yêu cầu</span></span><br></pre></td></tr></table></figure>\n\n<p>Tiếp theo đến lớp  YellowCat, xem chừng cũng không khó:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:yellow_cat_name</span>, <span class=\"symbol\">:yellow_cat_age</span>, <span class=\"symbol\">:role</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(yellow_cat_name, yellow_cat_age, role)</span></span></span><br><span class=\"line\">    @yellow_cat_name = yellow_cat_name</span><br><span class=\"line\">    @yellow_cat_age = yellow_cat_age</span><br><span class=\"line\">    @role = role</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =&gt; Cũng hoàn thành yêu cầu.</span></span><br></pre></td></tr></table></figure>\n\n<p>Cách này cũng hoàn thành được yêu cầu của bài toán, nhưng nó không ổn tí nào. Vì sao? Vì khi bạn tạo một instance thuộc lớp YellowCat nó sẽ có tổng cộng 5 instance variable bao gồm 3 instance variable khai báo trong lớp YellowCat, và 2 trong lớp Cat (bị thừa 2 instance variable).</p>\n<p>Điều này đi ngược lại với các quy tắc lập trình quan trọng chúng ta cần tuần thủ như DRY.</p>\n<p>Đến đây sức mạnh <strong>super()</strong> sẽ được thời cơ để thể hiện. Ta sẽ optimize lại mã nguồn của YellowCat như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">YellowCat</span> &lt; Cat</span></span><br><span class=\"line\">  <span class=\"comment\"># thêm một instance variable</span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:role</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(name, age, role)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>(name, age)</span><br><span class=\"line\">    @role = role</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">meo2 = YellowCat.new(<span class=\"string\">'ni ni'</span>, <span class=\"number\">10</span>, <span class=\"string\">'admin'</span>)</span><br><span class=\"line\">puts <span class=\"string\">\"ten meo la: <span class=\"subst\">#&#123;meo2.name&#125;</span> \\ntuoi meo la: <span class=\"subst\">#&#123;meo2.age&#125;</span> \\nrole cua meo la: <span class=\"subst\">#&#123;meo2.role&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># =&gt; ten meo la: ni ni</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; tuoi meo la: 10</span></span><br><span class=\"line\"><span class=\"comment\"># =&gt; role cua meo la: admin</span></span><br></pre></td></tr></table></figure>\n\n<p>Ở lớp con chúng ta có thêm 1 instance variable, chúng ta khai báo cho mình nó và duy nhất mỗi nó :arrow_right: không lãng phí vùng nhớ và tận dụng được mã nguồn cũ.</p>\n<p>Trong phương thức khởi tạo đối tượng YellowCat chúng ta khởi tạo biến instance mới, còn 2 instance variable được kế thừa từ lớp cha thì ta truyền tham số vào <strong>super()</strong> để truyền lên lớp cha và mặc kệ lớp cha xử lý thế nào thì tuỳ.</p>\n<h2 id=\"Tham-khao\"><a href=\"#Tham-khao\" class=\"headerlink\" title=\"Tham khảo\"></a>Tham khảo</h2><p>[1]<a href=\"https://odetocode.com/blogs/scott/archive/2010/07/13/ruby-initialize-and-super.aspx\" target=\"_blank\" rel=\"noopener\">https://odetocode.com/blogs/scott/archive/2010/07/13/ruby-initialize-and-super.aspx</a></p>\n"},{"title":"Terminal macOS Tricks","date":"2019-08-04T17:00:00.000Z","draft":false,"mytag":"#TIL","label":"#til","_content":"\n## 1. Config to show branch in Terminal\n\nOpen **.bash_profile** file then add:\n\n```shell\nparse_git_branch() {\n    git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \\(.*\\)/ (\\1)/'\n}\n\nexport PS1=\"\\u@\\h \\[\\033[32m\\]\\w - \\$(parse_git_branch)\\[\\033[00m\\] $ \"\n```\n\n## 2. Setup to use *subl* command in macOS\n\nRun:\n\n```\nsudo ln -s /Applications/Sublime\\ Text.app/Contents/SharedSupport/bin/subl /usr/local/bin/subl\n```\n\n## 3. Setup to use code command in macOS\n\nIn VSCode Window, press **command** + **shift** + **P** to open package install. Type **shell** to find package **Shell Command : Install code in PATH**, install and done.\n\nReferences:\n\n[1][https://stackoverflow.com/questions/17333531/how-can-i-display-the-current-branch-and-folder-path-in-terminal](https://stackoverflow.com/questions/17333531/how-can-i-display-the-current-branch-and-folder-path-in-terminal)\n\n[2][https://www.tunnelsup.com/how-to-open-sublime-text-from-the-command-line-using-mac-osx/](https://www.tunnelsup.com/how-to-open-sublime-text-from-the-command-line-using-mac-osx/)\n","source":"_posts/2019-08-05-setup-terminal-macos.md","raw":"---\ntitle: \"Terminal macOS Tricks\"\ndate: 2019-08-05\ndraft: false\ntags: [\"TIl\"]\ncategories: [\"TIL\"]\nmytag: \"#TIL\"\nlabel: \"#til\"\n---\n\n## 1. Config to show branch in Terminal\n\nOpen **.bash_profile** file then add:\n\n```shell\nparse_git_branch() {\n    git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \\(.*\\)/ (\\1)/'\n}\n\nexport PS1=\"\\u@\\h \\[\\033[32m\\]\\w - \\$(parse_git_branch)\\[\\033[00m\\] $ \"\n```\n\n## 2. Setup to use *subl* command in macOS\n\nRun:\n\n```\nsudo ln -s /Applications/Sublime\\ Text.app/Contents/SharedSupport/bin/subl /usr/local/bin/subl\n```\n\n## 3. Setup to use code command in macOS\n\nIn VSCode Window, press **command** + **shift** + **P** to open package install. Type **shell** to find package **Shell Command : Install code in PATH**, install and done.\n\nReferences:\n\n[1][https://stackoverflow.com/questions/17333531/how-can-i-display-the-current-branch-and-folder-path-in-terminal](https://stackoverflow.com/questions/17333531/how-can-i-display-the-current-branch-and-folder-path-in-terminal)\n\n[2][https://www.tunnelsup.com/how-to-open-sublime-text-from-the-command-line-using-mac-osx/](https://www.tunnelsup.com/how-to-open-sublime-text-from-the-command-line-using-mac-osx/)\n","slug":"2019-08-05-setup-terminal-macos","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsb7002cp3m20yle4b0o","content":"<h2 id=\"1-Config-to-show-branch-in-Terminal\"><a href=\"#1-Config-to-show-branch-in-Terminal\" class=\"headerlink\" title=\"1. Config to show branch in Terminal\"></a>1. Config to show branch in Terminal</h2><p>Open <strong>.bash_profile</strong> file then add:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">parse_git_branch() &#123;</span><br><span class=\"line\">    git branch 2&gt; /dev/null | sed -e '/^[^*]/d' -e 's/* \\(.*\\)/ (\\1)/'</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export PS1=\"\\u@\\h \\[\\033[32m\\]\\w - \\$(parse_git_branch)\\[\\033[00m\\] $ \"</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Setup-to-use-subl-command-in-macOS\"><a href=\"#2-Setup-to-use-subl-command-in-macOS\" class=\"headerlink\" title=\"2. Setup to use subl command in macOS\"></a>2. Setup to use <em>subl</em> command in macOS</h2><p>Run:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ln -s <span class=\"regexp\">/Applications/</span>Sublime\\ Text.app<span class=\"regexp\">/Contents/</span>SharedSupport<span class=\"regexp\">/bin/</span>subl <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/bin/</span>subl</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-Setup-to-use-code-command-in-macOS\"><a href=\"#3-Setup-to-use-code-command-in-macOS\" class=\"headerlink\" title=\"3. Setup to use code command in macOS\"></a>3. Setup to use code command in macOS</h2><p>In VSCode Window, press <strong>command</strong> + <strong>shift</strong> + <strong>P</strong> to open package install. Type <strong>shell</strong> to find package <strong>Shell Command : Install code in PATH</strong>, install and done.</p>\n<p>References:</p>\n<p>[1]<a href=\"https://stackoverflow.com/questions/17333531/how-can-i-display-the-current-branch-and-folder-path-in-terminal\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/17333531/how-can-i-display-the-current-branch-and-folder-path-in-terminal</a></p>\n<p>[2]<a href=\"https://www.tunnelsup.com/how-to-open-sublime-text-from-the-command-line-using-mac-osx/\" target=\"_blank\" rel=\"noopener\">https://www.tunnelsup.com/how-to-open-sublime-text-from-the-command-line-using-mac-osx/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Config-to-show-branch-in-Terminal\"><a href=\"#1-Config-to-show-branch-in-Terminal\" class=\"headerlink\" title=\"1. Config to show branch in Terminal\"></a>1. Config to show branch in Terminal</h2><p>Open <strong>.bash_profile</strong> file then add:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">parse_git_branch() &#123;</span><br><span class=\"line\">    git branch 2&gt; /dev/null | sed -e '/^[^*]/d' -e 's/* \\(.*\\)/ (\\1)/'</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">export PS1=\"\\u@\\h \\[\\033[32m\\]\\w - \\$(parse_git_branch)\\[\\033[00m\\] $ \"</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Setup-to-use-subl-command-in-macOS\"><a href=\"#2-Setup-to-use-subl-command-in-macOS\" class=\"headerlink\" title=\"2. Setup to use subl command in macOS\"></a>2. Setup to use <em>subl</em> command in macOS</h2><p>Run:</p>\n<figure class=\"highlight awk\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo ln -s <span class=\"regexp\">/Applications/</span>Sublime\\ Text.app<span class=\"regexp\">/Contents/</span>SharedSupport<span class=\"regexp\">/bin/</span>subl <span class=\"regexp\">/usr/</span>local<span class=\"regexp\">/bin/</span>subl</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-Setup-to-use-code-command-in-macOS\"><a href=\"#3-Setup-to-use-code-command-in-macOS\" class=\"headerlink\" title=\"3. Setup to use code command in macOS\"></a>3. Setup to use code command in macOS</h2><p>In VSCode Window, press <strong>command</strong> + <strong>shift</strong> + <strong>P</strong> to open package install. Type <strong>shell</strong> to find package <strong>Shell Command : Install code in PATH</strong>, install and done.</p>\n<p>References:</p>\n<p>[1]<a href=\"https://stackoverflow.com/questions/17333531/how-can-i-display-the-current-branch-and-folder-path-in-terminal\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/17333531/how-can-i-display-the-current-branch-and-folder-path-in-terminal</a></p>\n<p>[2]<a href=\"https://www.tunnelsup.com/how-to-open-sublime-text-from-the-command-line-using-mac-osx/\" target=\"_blank\" rel=\"noopener\">https://www.tunnelsup.com/how-to-open-sublime-text-from-the-command-line-using-mac-osx/</a></p>\n"},{"title":"My Favourite Vscode Extensions","date":"2019-09-19T17:00:00.000Z","draft":false,"label":"#til","_content":"\n1. Leetcode (https://marketplace.visualstudio.com/items?itemName=shengchen.vscode-leetcode)\n2. Turbo console log ( https://marketplace.visualstudio.com/items?itemName=ChakrounAnas.turbo-console-log)\n3. Polacode ( https://marketplace.visualstudio.com/items?itemName=pnp.polacode)\n4. Path intellisence (https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense)\n5. Vscode-iocns (https://marketplace.visualstudio.com/items?itemName=vscode-icons-team.vscode-icons)\n6. Ident-rainbow (https://marketplace.visualstudio.com/items?itemName=oderwat.indent-rainbow)\n7. Bracket Pair Colorizer 2 (https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer-2)\n8. Markdown preview (https://marketplace.visualstudio.com/items?itemName=shd101wyy.markdown-preview-enhanced)\n","source":"_posts/2019-09-20-vscode-extension.md","raw":"---\ntitle: \"My Favourite Vscode Extensions\"\ndate: 2019-09-20\ndraft: false\ntags: [\"TIl\"]\ncategories: [\"TIL\"]\nlabel: \"#til\"\n---\n\n1. Leetcode (https://marketplace.visualstudio.com/items?itemName=shengchen.vscode-leetcode)\n2. Turbo console log ( https://marketplace.visualstudio.com/items?itemName=ChakrounAnas.turbo-console-log)\n3. Polacode ( https://marketplace.visualstudio.com/items?itemName=pnp.polacode)\n4. Path intellisence (https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense)\n5. Vscode-iocns (https://marketplace.visualstudio.com/items?itemName=vscode-icons-team.vscode-icons)\n6. Ident-rainbow (https://marketplace.visualstudio.com/items?itemName=oderwat.indent-rainbow)\n7. Bracket Pair Colorizer 2 (https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer-2)\n8. Markdown preview (https://marketplace.visualstudio.com/items?itemName=shd101wyy.markdown-preview-enhanced)\n","slug":"2019-09-20-vscode-extension","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsb8002gp3m24gb8hzd4","content":"<ol>\n<li>Leetcode (<a href=\"https://marketplace.visualstudio.com/items?itemName=shengchen.vscode-leetcode\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=shengchen.vscode-leetcode</a>)</li>\n<li>Turbo console log ( <a href=\"https://marketplace.visualstudio.com/items?itemName=ChakrounAnas.turbo-console-log\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=ChakrounAnas.turbo-console-log</a>)</li>\n<li>Polacode ( <a href=\"https://marketplace.visualstudio.com/items?itemName=pnp.polacode\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=pnp.polacode</a>)</li>\n<li>Path intellisence (<a href=\"https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense</a>)</li>\n<li>Vscode-iocns (<a href=\"https://marketplace.visualstudio.com/items?itemName=vscode-icons-team.vscode-icons\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=vscode-icons-team.vscode-icons</a>)</li>\n<li>Ident-rainbow (<a href=\"https://marketplace.visualstudio.com/items?itemName=oderwat.indent-rainbow\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=oderwat.indent-rainbow</a>)</li>\n<li>Bracket Pair Colorizer 2 (<a href=\"https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer-2\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer-2</a>)</li>\n<li>Markdown preview (<a href=\"https://marketplace.visualstudio.com/items?itemName=shd101wyy.markdown-preview-enhanced\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=shd101wyy.markdown-preview-enhanced</a>)</li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li>Leetcode (<a href=\"https://marketplace.visualstudio.com/items?itemName=shengchen.vscode-leetcode\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=shengchen.vscode-leetcode</a>)</li>\n<li>Turbo console log ( <a href=\"https://marketplace.visualstudio.com/items?itemName=ChakrounAnas.turbo-console-log\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=ChakrounAnas.turbo-console-log</a>)</li>\n<li>Polacode ( <a href=\"https://marketplace.visualstudio.com/items?itemName=pnp.polacode\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=pnp.polacode</a>)</li>\n<li>Path intellisence (<a href=\"https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=christian-kohler.path-intellisense</a>)</li>\n<li>Vscode-iocns (<a href=\"https://marketplace.visualstudio.com/items?itemName=vscode-icons-team.vscode-icons\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=vscode-icons-team.vscode-icons</a>)</li>\n<li>Ident-rainbow (<a href=\"https://marketplace.visualstudio.com/items?itemName=oderwat.indent-rainbow\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=oderwat.indent-rainbow</a>)</li>\n<li>Bracket Pair Colorizer 2 (<a href=\"https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer-2\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=CoenraadS.bracket-pair-colorizer-2</a>)</li>\n<li>Markdown preview (<a href=\"https://marketplace.visualstudio.com/items?itemName=shd101wyy.markdown-preview-enhanced\" target=\"_blank\" rel=\"noopener\">https://marketplace.visualstudio.com/items?itemName=shd101wyy.markdown-preview-enhanced</a>)</li>\n</ol>\n"},{"title":"Basic Vim Setup","date":"2019-09-19T17:00:00.000Z","draft":false,"mytag":"#TIL","_content":"\n1. Plugin management: https://github.com/junegunn/vim-plug#installation\n2. Tree project: https://github.com/scrooloose/nerdtree\n3. Code complete: https://github.com/ycm-core/YouCompleteMe#installation\n4. Control + P: https://github.com/ctrlpvim/ctrlp.vim\n5. Monakai theme: https://github.com/sickill/vim-monokai\n6. Vimfile:\n\n```vim\ncall plug#begin('~/.vim/plugged')\n\nPlug 'https://github.com/scrooloose/nerdtree.git'\nPlug 'morhetz/gruvbox'\nPlug 'vim-airline/vim-airline'\nPlug 'scrooloose/nerdcommenter'\n\" Plug 'dracula/vim', { 'as': 'dracula' }\n\n\" Initialize plugin system\ncall plug#end()\n\n\" Set colorscheme\n\" colorscheme gruvbox\n\n\" Set dark background\n\"set background=dark\n\n\" Use monokai\n\" syntax enable\ncolorscheme monokai\n\n\" Copy clibboard\nset clipboard=unnamedplus\n\n\" Use ctrlp\nset runtimepath^=~/.vim/bundle/ctrlp.vim\n\nif has('mouse')\n  set mouse=a\nendif\n\nset nu\n\nset autoindent\nset si \"smart indent\"\n\nsyntax on\n\nautocmd StdinReadPre * let s:std_in=1\nautocmd VimEnter * if argc() == 0 && !exists(\"s:std_in\") | NERDTree | endif\n\nautocmd bufenter * if (winnr(\"$\") == 1 && exists(\"b:NERDTree\") && b:NERDTree.isTabTree()) | q | endif\nmap <C-n> :NERDTreeToggle<CR>\n\nset expandtab\nset tabstop=2\nset softtabstop=2\n\n```\n","source":"_posts/2019-10-30-basic-vim-setup.md","raw":"---\ntitle: \"Basic Vim Setup\"\ndate: 2019-09-20\ndraft: false\ntags: [\"TIl\"]\ncategories: [\"til\"]\nmytag: \"#TIL\"\n---\n\n1. Plugin management: https://github.com/junegunn/vim-plug#installation\n2. Tree project: https://github.com/scrooloose/nerdtree\n3. Code complete: https://github.com/ycm-core/YouCompleteMe#installation\n4. Control + P: https://github.com/ctrlpvim/ctrlp.vim\n5. Monakai theme: https://github.com/sickill/vim-monokai\n6. Vimfile:\n\n```vim\ncall plug#begin('~/.vim/plugged')\n\nPlug 'https://github.com/scrooloose/nerdtree.git'\nPlug 'morhetz/gruvbox'\nPlug 'vim-airline/vim-airline'\nPlug 'scrooloose/nerdcommenter'\n\" Plug 'dracula/vim', { 'as': 'dracula' }\n\n\" Initialize plugin system\ncall plug#end()\n\n\" Set colorscheme\n\" colorscheme gruvbox\n\n\" Set dark background\n\"set background=dark\n\n\" Use monokai\n\" syntax enable\ncolorscheme monokai\n\n\" Copy clibboard\nset clipboard=unnamedplus\n\n\" Use ctrlp\nset runtimepath^=~/.vim/bundle/ctrlp.vim\n\nif has('mouse')\n  set mouse=a\nendif\n\nset nu\n\nset autoindent\nset si \"smart indent\"\n\nsyntax on\n\nautocmd StdinReadPre * let s:std_in=1\nautocmd VimEnter * if argc() == 0 && !exists(\"s:std_in\") | NERDTree | endif\n\nautocmd bufenter * if (winnr(\"$\") == 1 && exists(\"b:NERDTree\") && b:NERDTree.isTabTree()) | q | endif\nmap <C-n> :NERDTreeToggle<CR>\n\nset expandtab\nset tabstop=2\nset softtabstop=2\n\n```\n","slug":"2019-10-30-basic-vim-setup","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsb8002kp3m266czc1nn","content":"<ol>\n<li>Plugin management: <a href=\"https://github.com/junegunn/vim-plug#installation\" target=\"_blank\" rel=\"noopener\">https://github.com/junegunn/vim-plug#installation</a></li>\n<li>Tree project: <a href=\"https://github.com/scrooloose/nerdtree\" target=\"_blank\" rel=\"noopener\">https://github.com/scrooloose/nerdtree</a></li>\n<li>Code complete: <a href=\"https://github.com/ycm-core/YouCompleteMe#installation\" target=\"_blank\" rel=\"noopener\">https://github.com/ycm-core/YouCompleteMe#installation</a></li>\n<li>Control + P: <a href=\"https://github.com/ctrlpvim/ctrlp.vim\" target=\"_blank\" rel=\"noopener\">https://github.com/ctrlpvim/ctrlp.vim</a></li>\n<li>Monakai theme: <a href=\"https://github.com/sickill/vim-monokai\" target=\"_blank\" rel=\"noopener\">https://github.com/sickill/vim-monokai</a></li>\n<li>Vimfile:</li>\n</ol>\n<figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">call</span> plug#begin(<span class=\"string\">'~/.vim/plugged'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">Plug <span class=\"string\">'https://github.com/scrooloose/nerdtree.git'</span></span><br><span class=\"line\">Plug <span class=\"string\">'morhetz/gruvbox'</span></span><br><span class=\"line\">Plug <span class=\"string\">'vim-airline/vim-airline'</span></span><br><span class=\"line\">Plug <span class=\"string\">'scrooloose/nerdcommenter'</span></span><br><span class=\"line\"><span class=\"comment\">\" Plug 'dracula/vim', &#123; 'as': 'dracula' &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Initialize plugin system</span></span><br><span class=\"line\"><span class=\"keyword\">call</span> plug#end()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Set colorscheme</span></span><br><span class=\"line\"><span class=\"comment\">\" colorscheme gruvbox</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Set dark background</span></span><br><span class=\"line\"><span class=\"comment\">\"set background=dark</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Use monokai</span></span><br><span class=\"line\"><span class=\"comment\">\" syntax enable</span></span><br><span class=\"line\"><span class=\"keyword\">colorscheme</span> monokai</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Copy clibboard</span></span><br><span class=\"line\"><span class=\"keyword\">set</span> clipboard=unnamedplus</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Use ctrlp</span></span><br><span class=\"line\"><span class=\"keyword\">set</span> runtimepath^=~/.<span class=\"keyword\">vim</span>/bundle/ctrlp.<span class=\"keyword\">vim</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">has</span>(<span class=\"string\">'mouse'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">set</span> mouse=<span class=\"keyword\">a</span></span><br><span class=\"line\"><span class=\"keyword\">endif</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">set</span> <span class=\"keyword\">nu</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">set</span> autoindent</span><br><span class=\"line\"><span class=\"keyword\">set</span> si <span class=\"string\">\"smart indent\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">syntax</span> <span class=\"keyword\">on</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">autocmd</span> StdinReadPre * <span class=\"keyword\">let</span> <span class=\"variable\">s:std_in</span>=<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">autocmd</span> VimEnter * <span class=\"keyword\">if</span> <span class=\"built_in\">argc</span>() == <span class=\"number\">0</span> &amp;&amp; !exists(<span class=\"string\">\"s:std_in\"</span>) | NERDTree | <span class=\"keyword\">endif</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">autocmd</span> bufenter * <span class=\"keyword\">if</span> (<span class=\"built_in\">winnr</span>(<span class=\"string\">\"$\"</span>) == <span class=\"number\">1</span> &amp;&amp; <span class=\"built_in\">exists</span>(<span class=\"string\">\"b:NERDTree\"</span>) &amp;&amp; <span class=\"variable\">b:NERDTree</span>.isTabTree()) | q | <span class=\"keyword\">endif</span></span><br><span class=\"line\"><span class=\"keyword\">map</span> <span class=\"symbol\">&lt;C-n&gt;</span> :NERDTreeToggle<span class=\"symbol\">&lt;CR&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">set</span> expandtab</span><br><span class=\"line\"><span class=\"keyword\">set</span> tabstop=<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">set</span> softtabstop=<span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<ol>\n<li>Plugin management: <a href=\"https://github.com/junegunn/vim-plug#installation\" target=\"_blank\" rel=\"noopener\">https://github.com/junegunn/vim-plug#installation</a></li>\n<li>Tree project: <a href=\"https://github.com/scrooloose/nerdtree\" target=\"_blank\" rel=\"noopener\">https://github.com/scrooloose/nerdtree</a></li>\n<li>Code complete: <a href=\"https://github.com/ycm-core/YouCompleteMe#installation\" target=\"_blank\" rel=\"noopener\">https://github.com/ycm-core/YouCompleteMe#installation</a></li>\n<li>Control + P: <a href=\"https://github.com/ctrlpvim/ctrlp.vim\" target=\"_blank\" rel=\"noopener\">https://github.com/ctrlpvim/ctrlp.vim</a></li>\n<li>Monakai theme: <a href=\"https://github.com/sickill/vim-monokai\" target=\"_blank\" rel=\"noopener\">https://github.com/sickill/vim-monokai</a></li>\n<li>Vimfile:</li>\n</ol>\n<figure class=\"highlight vim\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">call</span> plug#begin(<span class=\"string\">'~/.vim/plugged'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">Plug <span class=\"string\">'https://github.com/scrooloose/nerdtree.git'</span></span><br><span class=\"line\">Plug <span class=\"string\">'morhetz/gruvbox'</span></span><br><span class=\"line\">Plug <span class=\"string\">'vim-airline/vim-airline'</span></span><br><span class=\"line\">Plug <span class=\"string\">'scrooloose/nerdcommenter'</span></span><br><span class=\"line\"><span class=\"comment\">\" Plug 'dracula/vim', &#123; 'as': 'dracula' &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Initialize plugin system</span></span><br><span class=\"line\"><span class=\"keyword\">call</span> plug#end()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Set colorscheme</span></span><br><span class=\"line\"><span class=\"comment\">\" colorscheme gruvbox</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Set dark background</span></span><br><span class=\"line\"><span class=\"comment\">\"set background=dark</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Use monokai</span></span><br><span class=\"line\"><span class=\"comment\">\" syntax enable</span></span><br><span class=\"line\"><span class=\"keyword\">colorscheme</span> monokai</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Copy clibboard</span></span><br><span class=\"line\"><span class=\"keyword\">set</span> clipboard=unnamedplus</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">\" Use ctrlp</span></span><br><span class=\"line\"><span class=\"keyword\">set</span> runtimepath^=~/.<span class=\"keyword\">vim</span>/bundle/ctrlp.<span class=\"keyword\">vim</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"built_in\">has</span>(<span class=\"string\">'mouse'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">set</span> mouse=<span class=\"keyword\">a</span></span><br><span class=\"line\"><span class=\"keyword\">endif</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">set</span> <span class=\"keyword\">nu</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">set</span> autoindent</span><br><span class=\"line\"><span class=\"keyword\">set</span> si <span class=\"string\">\"smart indent\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">syntax</span> <span class=\"keyword\">on</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">autocmd</span> StdinReadPre * <span class=\"keyword\">let</span> <span class=\"variable\">s:std_in</span>=<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">autocmd</span> VimEnter * <span class=\"keyword\">if</span> <span class=\"built_in\">argc</span>() == <span class=\"number\">0</span> &amp;&amp; !exists(<span class=\"string\">\"s:std_in\"</span>) | NERDTree | <span class=\"keyword\">endif</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">autocmd</span> bufenter * <span class=\"keyword\">if</span> (<span class=\"built_in\">winnr</span>(<span class=\"string\">\"$\"</span>) == <span class=\"number\">1</span> &amp;&amp; <span class=\"built_in\">exists</span>(<span class=\"string\">\"b:NERDTree\"</span>) &amp;&amp; <span class=\"variable\">b:NERDTree</span>.isTabTree()) | q | <span class=\"keyword\">endif</span></span><br><span class=\"line\"><span class=\"keyword\">map</span> <span class=\"symbol\">&lt;C-n&gt;</span> :NERDTreeToggle<span class=\"symbol\">&lt;CR&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">set</span> expandtab</span><br><span class=\"line\"><span class=\"keyword\">set</span> tabstop=<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"keyword\">set</span> softtabstop=<span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Deploy My Blog Use Script","date":"2019-11-30T17:00:00.000Z","label":"#til","_content":"\n## 1. Example\n\n```bash\n#!/bin/bash\nGREEN='\\033[0;32m'\nNC='\\033[0m'\n\nhexo_clean=\"hexo clean\"\nhexo_generate=\"hexo generate\"\ncd_public=\"cd public\"\ncreate_file=\"touch CNAME\"\nadd_content=\"echo \"hdchinh.com\" >> CNAME\"\ndeploy=\"hexo deploy\"\n\necho \"${GREEN}============ Starting Gengerate ===============${NC}\"\neval $hexo_clean\neval $hexo_generate\neval $cd_public\n\necho \"${GREEN}============ Starting Create CNAME ============${NC}\"\neval $create_file\neval $add_content\n\necho \"${GREEN}============ Starting Deploy ==================${NC}\"\neval $deploy\necho \"${GREEN}============ Done =============================${NC}\"\n\n```\n\n## 2. Use multiple command in oneline\n\nWe have two commands need to execute:\n\neg: A, B\n\nWe have three ways to execute A, B in one line.\n\n```bash\nA; B (always run A, B)\n\nA && B (run B if A execute successful)\n\nA || B (run B if A execute failure)\n```\n","source":"_posts/2019-12-01-basic-bash-file-to-deploy-my-blog.md","raw":"---\ntitle: Deploy My Blog Use Script\ndate: 2019-12-01\ntags: [\"TIL\"]\nlabel: \"#til\"\n---\n\n## 1. Example\n\n```bash\n#!/bin/bash\nGREEN='\\033[0;32m'\nNC='\\033[0m'\n\nhexo_clean=\"hexo clean\"\nhexo_generate=\"hexo generate\"\ncd_public=\"cd public\"\ncreate_file=\"touch CNAME\"\nadd_content=\"echo \"hdchinh.com\" >> CNAME\"\ndeploy=\"hexo deploy\"\n\necho \"${GREEN}============ Starting Gengerate ===============${NC}\"\neval $hexo_clean\neval $hexo_generate\neval $cd_public\n\necho \"${GREEN}============ Starting Create CNAME ============${NC}\"\neval $create_file\neval $add_content\n\necho \"${GREEN}============ Starting Deploy ==================${NC}\"\neval $deploy\necho \"${GREEN}============ Done =============================${NC}\"\n\n```\n\n## 2. Use multiple command in oneline\n\nWe have two commands need to execute:\n\neg: A, B\n\nWe have three ways to execute A, B in one line.\n\n```bash\nA; B (always run A, B)\n\nA && B (run B if A execute successful)\n\nA || B (run B if A execute failure)\n```\n","slug":"2019-12-01-basic-bash-file-to-deploy-my-blog","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsb9002np3m22gwieq4f","content":"<h2 id=\"1-Example\"><a href=\"#1-Example\" class=\"headerlink\" title=\"1. Example\"></a>1. Example</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">GREEN=<span class=\"string\">'\\033[0;32m'</span></span><br><span class=\"line\">NC=<span class=\"string\">'\\033[0m'</span></span><br><span class=\"line\"></span><br><span class=\"line\">hexo_clean=<span class=\"string\">\"hexo clean\"</span></span><br><span class=\"line\">hexo_generate=<span class=\"string\">\"hexo generate\"</span></span><br><span class=\"line\">cd_public=<span class=\"string\">\"cd public\"</span></span><br><span class=\"line\">create_file=<span class=\"string\">\"touch CNAME\"</span></span><br><span class=\"line\">add_content=<span class=\"string\">\"echo \"</span>hdchinh.com<span class=\"string\">\" &gt;&gt; CNAME\"</span></span><br><span class=\"line\">deploy=<span class=\"string\">\"hexo deploy\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;GREEN&#125;</span>============ Starting Gengerate ===============<span class=\"variable\">$&#123;NC&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$hexo_clean</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$hexo_generate</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$cd_public</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;GREEN&#125;</span>============ Starting Create CNAME ============<span class=\"variable\">$&#123;NC&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$create_file</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$add_content</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;GREEN&#125;</span>============ Starting Deploy ==================<span class=\"variable\">$&#123;NC&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$deploy</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;GREEN&#125;</span>============ Done =============================<span class=\"variable\">$&#123;NC&#125;</span>\"</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Use-multiple-command-in-oneline\"><a href=\"#2-Use-multiple-command-in-oneline\" class=\"headerlink\" title=\"2. Use multiple command in oneline\"></a>2. Use multiple command in oneline</h2><p>We have two commands need to execute:</p>\n<p>eg: A, B</p>\n<p>We have three ways to execute A, B in one line.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A; B (always run A, B)</span><br><span class=\"line\"></span><br><span class=\"line\">A &amp;&amp; B (run B <span class=\"keyword\">if</span> A execute successful)</span><br><span class=\"line\"></span><br><span class=\"line\">A || B (run B <span class=\"keyword\">if</span> A execute failure)</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Example\"><a href=\"#1-Example\" class=\"headerlink\" title=\"1. Example\"></a>1. Example</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/bash</span></span><br><span class=\"line\">GREEN=<span class=\"string\">'\\033[0;32m'</span></span><br><span class=\"line\">NC=<span class=\"string\">'\\033[0m'</span></span><br><span class=\"line\"></span><br><span class=\"line\">hexo_clean=<span class=\"string\">\"hexo clean\"</span></span><br><span class=\"line\">hexo_generate=<span class=\"string\">\"hexo generate\"</span></span><br><span class=\"line\">cd_public=<span class=\"string\">\"cd public\"</span></span><br><span class=\"line\">create_file=<span class=\"string\">\"touch CNAME\"</span></span><br><span class=\"line\">add_content=<span class=\"string\">\"echo \"</span>hdchinh.com<span class=\"string\">\" &gt;&gt; CNAME\"</span></span><br><span class=\"line\">deploy=<span class=\"string\">\"hexo deploy\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;GREEN&#125;</span>============ Starting Gengerate ===============<span class=\"variable\">$&#123;NC&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$hexo_clean</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$hexo_generate</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$cd_public</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;GREEN&#125;</span>============ Starting Create CNAME ============<span class=\"variable\">$&#123;NC&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$create_file</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$add_content</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;GREEN&#125;</span>============ Starting Deploy ==================<span class=\"variable\">$&#123;NC&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"built_in\">eval</span> <span class=\"variable\">$deploy</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"<span class=\"variable\">$&#123;GREEN&#125;</span>============ Done =============================<span class=\"variable\">$&#123;NC&#125;</span>\"</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Use-multiple-command-in-oneline\"><a href=\"#2-Use-multiple-command-in-oneline\" class=\"headerlink\" title=\"2. Use multiple command in oneline\"></a>2. Use multiple command in oneline</h2><p>We have two commands need to execute:</p>\n<p>eg: A, B</p>\n<p>We have three ways to execute A, B in one line.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A; B (always run A, B)</span><br><span class=\"line\"></span><br><span class=\"line\">A &amp;&amp; B (run B <span class=\"keyword\">if</span> A execute successful)</span><br><span class=\"line\"></span><br><span class=\"line\">A || B (run B <span class=\"keyword\">if</span> A execute failure)</span><br></pre></td></tr></table></figure>\n"},{"title":"Use multiple accounts with SSH","date":"2019-11-30T17:00:00.000Z","_content":"\n## 1. Generate keys\n\n```bash\nssh-keygen -t rsa -C \"YOUr_EMAIL_OR_YOUR_INFO\" -f \"YOUR_NAME_YOU_WANT_TO_SET_FOR_THIS_KEY\"\n```\n\neg.\n```bash\nssh-keygen -t rsa -C \"hduychinh@gmail.com\" -f \"primary_github\"\n```\n\n\n## 2. Add key to ssh-agent\n\neg.\n```bash\nssh-add ~/.ssh/your_file_ssh\n```\n\nwhat is ssh-agent?\n\neazy way, we can think it like a stack. When you access to server with ssh connection type.\nSo your device will send this stack to server. And if the valid key (private key) stored in this stack, you can access to server.\n\nIf you use ssh-agent. You can access like this:\n\n```bash\nssh ubuntu@123.456.789\n```\n\ninstead of:\n\n```bash\nssh -i ~/.ssh/your_valid_private_key ubuntu@123.456.789\n```\n\n## 3. ssh-agent\n\nRemove all entries in ssh-agent:\n```bash\nssh-add -D\n```\n\nShow all entries in ssh-agent:\n```bash\nssh-add -l\n```\n\n## 4. Create config file\n\n> ~/.ssh/config\n\neg:\n\n```\nHost primary_github.github.com\nHostName github.com\nPreferredAuthentications publickey\nIdentityFile ~/.ssh/primary_github\n\nHost secondary_github.github.com\nHostName github.com\nPreferredAuthentications publickey\nIdentityFile ~/.ssh/secondary_github\n```\n## 5. Add remote with prefix\n\neg:\n```bash\ngit remote add origin git@primary_github.github.com:1312047/nus-overview.git\n```\n","source":"_posts/2019-12-01-how-to-use-multi-account-with-ssh.md","raw":"---\ntitle: Use multiple accounts with SSH\ndate: 2019-12-01\ntags: [\"TIL\"]\n---\n\n## 1. Generate keys\n\n```bash\nssh-keygen -t rsa -C \"YOUr_EMAIL_OR_YOUR_INFO\" -f \"YOUR_NAME_YOU_WANT_TO_SET_FOR_THIS_KEY\"\n```\n\neg.\n```bash\nssh-keygen -t rsa -C \"hduychinh@gmail.com\" -f \"primary_github\"\n```\n\n\n## 2. Add key to ssh-agent\n\neg.\n```bash\nssh-add ~/.ssh/your_file_ssh\n```\n\nwhat is ssh-agent?\n\neazy way, we can think it like a stack. When you access to server with ssh connection type.\nSo your device will send this stack to server. And if the valid key (private key) stored in this stack, you can access to server.\n\nIf you use ssh-agent. You can access like this:\n\n```bash\nssh ubuntu@123.456.789\n```\n\ninstead of:\n\n```bash\nssh -i ~/.ssh/your_valid_private_key ubuntu@123.456.789\n```\n\n## 3. ssh-agent\n\nRemove all entries in ssh-agent:\n```bash\nssh-add -D\n```\n\nShow all entries in ssh-agent:\n```bash\nssh-add -l\n```\n\n## 4. Create config file\n\n> ~/.ssh/config\n\neg:\n\n```\nHost primary_github.github.com\nHostName github.com\nPreferredAuthentications publickey\nIdentityFile ~/.ssh/primary_github\n\nHost secondary_github.github.com\nHostName github.com\nPreferredAuthentications publickey\nIdentityFile ~/.ssh/secondary_github\n```\n## 5. Add remote with prefix\n\neg:\n```bash\ngit remote add origin git@primary_github.github.com:1312047/nus-overview.git\n```\n","slug":"2019-12-01-how-to-use-multi-account-with-ssh","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsba002sp3m26niucg7s","content":"<h2 id=\"1-Generate-keys\"><a href=\"#1-Generate-keys\" class=\"headerlink\" title=\"1. Generate keys\"></a>1. Generate keys</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">\"YOUr_EMAIL_OR_YOUR_INFO\"</span> -f <span class=\"string\">\"YOUR_NAME_YOU_WANT_TO_SET_FOR_THIS_KEY\"</span></span><br></pre></td></tr></table></figure>\n\n<p>eg.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">\"hduychinh@gmail.com\"</span> -f <span class=\"string\">\"primary_github\"</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"2-Add-key-to-ssh-agent\"><a href=\"#2-Add-key-to-ssh-agent\" class=\"headerlink\" title=\"2. Add key to ssh-agent\"></a>2. Add key to ssh-agent</h2><p>eg.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-add ~/.ssh/your_file_ssh</span><br></pre></td></tr></table></figure>\n\n<p>what is ssh-agent?</p>\n<p>eazy way, we can think it like a stack. When you access to server with ssh connection type.<br>So your device will send this stack to server. And if the valid key (private key) stored in this stack, you can access to server.</p>\n<p>If you use ssh-agent. You can access like this:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh ubuntu@123.456.789</span><br></pre></td></tr></table></figure>\n\n<p>instead of:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -i ~/.ssh/your_valid_private_key ubuntu@123.456.789</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-ssh-agent\"><a href=\"#3-ssh-agent\" class=\"headerlink\" title=\"3. ssh-agent\"></a>3. ssh-agent</h2><p>Remove all entries in ssh-agent:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-add -D</span><br></pre></td></tr></table></figure>\n\n<p>Show all entries in ssh-agent:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-add -l</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Create-config-file\"><a href=\"#4-Create-config-file\" class=\"headerlink\" title=\"4. Create config file\"></a>4. Create config file</h2><blockquote>\n<p>~/.ssh/config</p>\n</blockquote>\n<p>eg:</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">Host</span> <span class=\"string\">primary_github.github.com</span></span><br><span class=\"line\"><span class=\"attr\">HostName</span> <span class=\"string\">github.com</span></span><br><span class=\"line\"><span class=\"attr\">PreferredAuthentications</span> <span class=\"string\">publickey</span></span><br><span class=\"line\"><span class=\"attr\">IdentityFile</span> <span class=\"string\">~/.ssh/primary_github</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">Host</span> <span class=\"string\">secondary_github.github.com</span></span><br><span class=\"line\"><span class=\"attr\">HostName</span> <span class=\"string\">github.com</span></span><br><span class=\"line\"><span class=\"attr\">PreferredAuthentications</span> <span class=\"string\">publickey</span></span><br><span class=\"line\"><span class=\"attr\">IdentityFile</span> <span class=\"string\">~/.ssh/secondary_github</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"5-Add-remote-with-prefix\"><a href=\"#5-Add-remote-with-prefix\" class=\"headerlink\" title=\"5. Add remote with prefix\"></a>5. Add remote with prefix</h2><p>eg:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote add origin git@primary_github.github.com:1312047/nus-overview.git</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Generate-keys\"><a href=\"#1-Generate-keys\" class=\"headerlink\" title=\"1. Generate keys\"></a>1. Generate keys</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">\"YOUr_EMAIL_OR_YOUR_INFO\"</span> -f <span class=\"string\">\"YOUR_NAME_YOU_WANT_TO_SET_FOR_THIS_KEY\"</span></span><br></pre></td></tr></table></figure>\n\n<p>eg.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">\"hduychinh@gmail.com\"</span> -f <span class=\"string\">\"primary_github\"</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"2-Add-key-to-ssh-agent\"><a href=\"#2-Add-key-to-ssh-agent\" class=\"headerlink\" title=\"2. Add key to ssh-agent\"></a>2. Add key to ssh-agent</h2><p>eg.</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-add ~/.ssh/your_file_ssh</span><br></pre></td></tr></table></figure>\n\n<p>what is ssh-agent?</p>\n<p>eazy way, we can think it like a stack. When you access to server with ssh connection type.<br>So your device will send this stack to server. And if the valid key (private key) stored in this stack, you can access to server.</p>\n<p>If you use ssh-agent. You can access like this:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh ubuntu@123.456.789</span><br></pre></td></tr></table></figure>\n\n<p>instead of:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh -i ~/.ssh/your_valid_private_key ubuntu@123.456.789</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-ssh-agent\"><a href=\"#3-ssh-agent\" class=\"headerlink\" title=\"3. ssh-agent\"></a>3. ssh-agent</h2><p>Remove all entries in ssh-agent:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-add -D</span><br></pre></td></tr></table></figure>\n\n<p>Show all entries in ssh-agent:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-add -l</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Create-config-file\"><a href=\"#4-Create-config-file\" class=\"headerlink\" title=\"4. Create config file\"></a>4. Create config file</h2><blockquote>\n<p>~/.ssh/config</p>\n</blockquote>\n<p>eg:</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">Host</span> <span class=\"string\">primary_github.github.com</span></span><br><span class=\"line\"><span class=\"attr\">HostName</span> <span class=\"string\">github.com</span></span><br><span class=\"line\"><span class=\"attr\">PreferredAuthentications</span> <span class=\"string\">publickey</span></span><br><span class=\"line\"><span class=\"attr\">IdentityFile</span> <span class=\"string\">~/.ssh/primary_github</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">Host</span> <span class=\"string\">secondary_github.github.com</span></span><br><span class=\"line\"><span class=\"attr\">HostName</span> <span class=\"string\">github.com</span></span><br><span class=\"line\"><span class=\"attr\">PreferredAuthentications</span> <span class=\"string\">publickey</span></span><br><span class=\"line\"><span class=\"attr\">IdentityFile</span> <span class=\"string\">~/.ssh/secondary_github</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"5-Add-remote-with-prefix\"><a href=\"#5-Add-remote-with-prefix\" class=\"headerlink\" title=\"5. Add remote with prefix\"></a>5. Add remote with prefix</h2><p>eg:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git remote add origin git@primary_github.github.com:1312047/nus-overview.git</span><br></pre></td></tr></table></figure>\n"},{"title":"How To Use Arguments In Ruby","date":"2019-12-04T17:00:00.000Z","_content":"\n## How Many Kind Of Arguments In Ruby?\n\nWe can answer: **Three**\n\n1. Required arguments\n\neg:\n\n```ruby\ndef hello(name)\n  puts \"Hello #{name}\"\nend\n```\n\nIn there, *name* is a required argument. it mean if you call **hello** method and do not pass an argument, the output that you see should like:\n\n```ruby\nhello()\n\n=> ArgumentError: wrong number of arguments (given 0, expected 1)\n\n```\n\nLet pass an argument and this error will gone.\n\n```ruby\nhello('Meo Meo')\n\n=> \"Hello Meo Meo\"\n```\n\nIt's very simple, I think we are make sence now.\n\n2. Default arguments\n\nAlmost like **Required arguments**. It has one more thing different:\n\nThat is when we pass argument in a method, we can set default value for it, and then when you call this method and unlucky forgot pass arguments for this method, your method still working, if it's not received arguments when it is called, it will use the default value.\n\neg:\n\n```ruby\ndef hello(name = \"Meo Meo\")\n  puts \"Hello #{name}\"\nend\n\nhello(\"Chinh\")\n=> \"Hello Chinh\"\n\n# if you don't pass an argument\nhello()\n=> \"Hello Meo Meo\"\n```\n\n3. Optional arguments\n\nDo you ever want to create a method and have no idea how many arguments does this method need?\n\nYes, we use optional arguments for this case, take a looke at the example below:\n\n```ruby\ndef hello(*family)\n  family.each do |name|\n    puts \"Hello #{name}\\n\"\n  end\nend\n\nhello('Chinh', 'Chuot', 'Cho')\n\n# The output:\n# Hello Chinh\n# Hello Chuot\n# Hello Cho\n```\n\n## Keyword Arguments\n\nIt's a new feature has come from ruby 2.0 to higher. It like pass arguments as a hash but more powerful.\n\neg:\n\n```ruby\ndef hello(name: 'Chinh', age: 25)\n  puts \"Name: #{name} - Age: #{age}\\n\"\nend\n```\n\nif you call **hello** method with no arguments:\n\n```ruby\nhello()\n```\n\nIt will use default value.\n\nAnd then\n\nIf you pass argumets for it:\n\n```ruby\nhello('Chinh', 25)\n```\n\nwhat will it return?\n\n**Error**: yes, it will response an error, but why?\n\nBecause, with **keyword arguments**, you need to pass argumetns like a hash you declare when initial method. (**same key**).\n\n```ruby\nhello(name: 'Meo')\n# Hello Meo - Age: 25\n\nhello(age: 10)\n# Hello Chinh - Age: 10\n\nhello(name: 'Chuot', age: 11)\n# Hello Chuot - Age: 11\n```\n\nIf you want to required an argument with no default value, try this:\n\n```ruby\ndef hello(name:, age:)\n  puts \"Name: #{name} - Age: #{age}\\n\"\nend\n```\n\nIt mean the method need to receive \"a hash\" with two key *name* and *age*. if it does not revieve, error will raise.\n","source":"_posts/2019-12-05-ruby-argument.md","raw":"---\ntitle: How To Use Arguments In Ruby\ndate: 2019-12-05\ntags: [\"RUBY\", \"TIL\"]\n---\n\n## How Many Kind Of Arguments In Ruby?\n\nWe can answer: **Three**\n\n1. Required arguments\n\neg:\n\n```ruby\ndef hello(name)\n  puts \"Hello #{name}\"\nend\n```\n\nIn there, *name* is a required argument. it mean if you call **hello** method and do not pass an argument, the output that you see should like:\n\n```ruby\nhello()\n\n=> ArgumentError: wrong number of arguments (given 0, expected 1)\n\n```\n\nLet pass an argument and this error will gone.\n\n```ruby\nhello('Meo Meo')\n\n=> \"Hello Meo Meo\"\n```\n\nIt's very simple, I think we are make sence now.\n\n2. Default arguments\n\nAlmost like **Required arguments**. It has one more thing different:\n\nThat is when we pass argument in a method, we can set default value for it, and then when you call this method and unlucky forgot pass arguments for this method, your method still working, if it's not received arguments when it is called, it will use the default value.\n\neg:\n\n```ruby\ndef hello(name = \"Meo Meo\")\n  puts \"Hello #{name}\"\nend\n\nhello(\"Chinh\")\n=> \"Hello Chinh\"\n\n# if you don't pass an argument\nhello()\n=> \"Hello Meo Meo\"\n```\n\n3. Optional arguments\n\nDo you ever want to create a method and have no idea how many arguments does this method need?\n\nYes, we use optional arguments for this case, take a looke at the example below:\n\n```ruby\ndef hello(*family)\n  family.each do |name|\n    puts \"Hello #{name}\\n\"\n  end\nend\n\nhello('Chinh', 'Chuot', 'Cho')\n\n# The output:\n# Hello Chinh\n# Hello Chuot\n# Hello Cho\n```\n\n## Keyword Arguments\n\nIt's a new feature has come from ruby 2.0 to higher. It like pass arguments as a hash but more powerful.\n\neg:\n\n```ruby\ndef hello(name: 'Chinh', age: 25)\n  puts \"Name: #{name} - Age: #{age}\\n\"\nend\n```\n\nif you call **hello** method with no arguments:\n\n```ruby\nhello()\n```\n\nIt will use default value.\n\nAnd then\n\nIf you pass argumets for it:\n\n```ruby\nhello('Chinh', 25)\n```\n\nwhat will it return?\n\n**Error**: yes, it will response an error, but why?\n\nBecause, with **keyword arguments**, you need to pass argumetns like a hash you declare when initial method. (**same key**).\n\n```ruby\nhello(name: 'Meo')\n# Hello Meo - Age: 25\n\nhello(age: 10)\n# Hello Chinh - Age: 10\n\nhello(name: 'Chuot', age: 11)\n# Hello Chuot - Age: 11\n```\n\nIf you want to required an argument with no default value, try this:\n\n```ruby\ndef hello(name:, age:)\n  puts \"Name: #{name} - Age: #{age}\\n\"\nend\n```\n\nIt mean the method need to receive \"a hash\" with two key *name* and *age*. if it does not revieve, error will raise.\n","slug":"2019-12-05-ruby-argument","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsba002vp3m2f8iogfvu","content":"<h2 id=\"How-Many-Kind-Of-Arguments-In-Ruby\"><a href=\"#How-Many-Kind-Of-Arguments-In-Ruby\" class=\"headerlink\" title=\"How Many Kind Of Arguments In Ruby?\"></a>How Many Kind Of Arguments In Ruby?</h2><p>We can answer: <strong>Three</strong></p>\n<ol>\n<li>Required arguments</li>\n</ol>\n<p>eg:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">  puts <span class=\"string\">\"Hello <span class=\"subst\">#&#123;name&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>In there, <em>name</em> is a required argument. it mean if you call <strong>hello</strong> method and do not pass an argument, the output that you see should like:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello()</span><br><span class=\"line\"></span><br><span class=\"line\">=&gt; <span class=\"symbol\">ArgumentError:</span> wrong number of arguments (given <span class=\"number\">0</span>, expected <span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Let pass an argument and this error will gone.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello(<span class=\"string\">'Meo Meo'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">=&gt; <span class=\"string\">\"Hello Meo Meo\"</span></span><br></pre></td></tr></table></figure>\n\n<p>It’s very simple, I think we are make sence now.</p>\n<ol start=\"2\">\n<li>Default arguments</li>\n</ol>\n<p>Almost like <strong>Required arguments</strong>. It has one more thing different:</p>\n<p>That is when we pass argument in a method, we can set default value for it, and then when you call this method and unlucky forgot pass arguments for this method, your method still working, if it’s not received arguments when it is called, it will use the default value.</p>\n<p>eg:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span><span class=\"params\">(name = <span class=\"string\">\"Meo Meo\"</span>)</span></span></span><br><span class=\"line\">  puts <span class=\"string\">\"Hello <span class=\"subst\">#&#123;name&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">hello(<span class=\"string\">\"Chinh\"</span>)</span><br><span class=\"line\">=&gt; <span class=\"string\">\"Hello Chinh\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># if you don't pass an argument</span></span><br><span class=\"line\">hello()</span><br><span class=\"line\">=&gt; <span class=\"string\">\"Hello Meo Meo\"</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>Optional arguments</li>\n</ol>\n<p>Do you ever want to create a method and have no idea how many arguments does this method need?</p>\n<p>Yes, we use optional arguments for this case, take a looke at the example below:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span><span class=\"params\">(*family)</span></span></span><br><span class=\"line\">  family.each <span class=\"keyword\">do</span> <span class=\"params\">|name|</span></span><br><span class=\"line\">    puts <span class=\"string\">\"Hello <span class=\"subst\">#&#123;name&#125;</span>\\n\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">hello(<span class=\"string\">'Chinh'</span>, <span class=\"string\">'Chuot'</span>, <span class=\"string\">'Cho'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The output:</span></span><br><span class=\"line\"><span class=\"comment\"># Hello Chinh</span></span><br><span class=\"line\"><span class=\"comment\"># Hello Chuot</span></span><br><span class=\"line\"><span class=\"comment\"># Hello Cho</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Keyword-Arguments\"><a href=\"#Keyword-Arguments\" class=\"headerlink\" title=\"Keyword Arguments\"></a>Keyword Arguments</h2><p>It’s a new feature has come from ruby 2.0 to higher. It like pass arguments as a hash but more powerful.</p>\n<p>eg:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span><span class=\"params\">(<span class=\"symbol\">name:</span> <span class=\"string\">'Chinh'</span>, <span class=\"symbol\">age:</span> <span class=\"number\">25</span>)</span></span></span><br><span class=\"line\">  puts <span class=\"string\">\"Name: <span class=\"subst\">#&#123;name&#125;</span> - Age: <span class=\"subst\">#&#123;age&#125;</span>\\n\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>if you call <strong>hello</strong> method with no arguments:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello()</span><br></pre></td></tr></table></figure>\n\n<p>It will use default value.</p>\n<p>And then</p>\n<p>If you pass argumets for it:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello(<span class=\"string\">'Chinh'</span>, <span class=\"number\">25</span>)</span><br></pre></td></tr></table></figure>\n\n<p>what will it return?</p>\n<p><strong>Error</strong>: yes, it will response an error, but why?</p>\n<p>Because, with <strong>keyword arguments</strong>, you need to pass argumetns like a hash you declare when initial method. (<strong>same key</strong>).</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello(<span class=\"symbol\">name:</span> <span class=\"string\">'Meo'</span>)</span><br><span class=\"line\"><span class=\"comment\"># Hello Meo - Age: 25</span></span><br><span class=\"line\"></span><br><span class=\"line\">hello(<span class=\"symbol\">age:</span> <span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"comment\"># Hello Chinh - Age: 10</span></span><br><span class=\"line\"></span><br><span class=\"line\">hello(<span class=\"symbol\">name:</span> <span class=\"string\">'Chuot'</span>, <span class=\"symbol\">age:</span> <span class=\"number\">11</span>)</span><br><span class=\"line\"><span class=\"comment\"># Hello Chuot - Age: 11</span></span><br></pre></td></tr></table></figure>\n\n<p>If you want to required an argument with no default value, try this:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span><span class=\"params\">(<span class=\"symbol\">name:</span>, <span class=\"symbol\">age:</span>)</span></span></span><br><span class=\"line\">  puts <span class=\"string\">\"Name: <span class=\"subst\">#&#123;name&#125;</span> - Age: <span class=\"subst\">#&#123;age&#125;</span>\\n\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>It mean the method need to receive “a hash” with two key <em>name</em> and <em>age</em>. if it does not revieve, error will raise.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"How-Many-Kind-Of-Arguments-In-Ruby\"><a href=\"#How-Many-Kind-Of-Arguments-In-Ruby\" class=\"headerlink\" title=\"How Many Kind Of Arguments In Ruby?\"></a>How Many Kind Of Arguments In Ruby?</h2><p>We can answer: <strong>Three</strong></p>\n<ol>\n<li>Required arguments</li>\n</ol>\n<p>eg:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">  puts <span class=\"string\">\"Hello <span class=\"subst\">#&#123;name&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>In there, <em>name</em> is a required argument. it mean if you call <strong>hello</strong> method and do not pass an argument, the output that you see should like:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello()</span><br><span class=\"line\"></span><br><span class=\"line\">=&gt; <span class=\"symbol\">ArgumentError:</span> wrong number of arguments (given <span class=\"number\">0</span>, expected <span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Let pass an argument and this error will gone.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello(<span class=\"string\">'Meo Meo'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">=&gt; <span class=\"string\">\"Hello Meo Meo\"</span></span><br></pre></td></tr></table></figure>\n\n<p>It’s very simple, I think we are make sence now.</p>\n<ol start=\"2\">\n<li>Default arguments</li>\n</ol>\n<p>Almost like <strong>Required arguments</strong>. It has one more thing different:</p>\n<p>That is when we pass argument in a method, we can set default value for it, and then when you call this method and unlucky forgot pass arguments for this method, your method still working, if it’s not received arguments when it is called, it will use the default value.</p>\n<p>eg:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span><span class=\"params\">(name = <span class=\"string\">\"Meo Meo\"</span>)</span></span></span><br><span class=\"line\">  puts <span class=\"string\">\"Hello <span class=\"subst\">#&#123;name&#125;</span>\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">hello(<span class=\"string\">\"Chinh\"</span>)</span><br><span class=\"line\">=&gt; <span class=\"string\">\"Hello Chinh\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># if you don't pass an argument</span></span><br><span class=\"line\">hello()</span><br><span class=\"line\">=&gt; <span class=\"string\">\"Hello Meo Meo\"</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>Optional arguments</li>\n</ol>\n<p>Do you ever want to create a method and have no idea how many arguments does this method need?</p>\n<p>Yes, we use optional arguments for this case, take a looke at the example below:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span><span class=\"params\">(*family)</span></span></span><br><span class=\"line\">  family.each <span class=\"keyword\">do</span> <span class=\"params\">|name|</span></span><br><span class=\"line\">    puts <span class=\"string\">\"Hello <span class=\"subst\">#&#123;name&#125;</span>\\n\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">hello(<span class=\"string\">'Chinh'</span>, <span class=\"string\">'Chuot'</span>, <span class=\"string\">'Cho'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># The output:</span></span><br><span class=\"line\"><span class=\"comment\"># Hello Chinh</span></span><br><span class=\"line\"><span class=\"comment\"># Hello Chuot</span></span><br><span class=\"line\"><span class=\"comment\"># Hello Cho</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Keyword-Arguments\"><a href=\"#Keyword-Arguments\" class=\"headerlink\" title=\"Keyword Arguments\"></a>Keyword Arguments</h2><p>It’s a new feature has come from ruby 2.0 to higher. It like pass arguments as a hash but more powerful.</p>\n<p>eg:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span><span class=\"params\">(<span class=\"symbol\">name:</span> <span class=\"string\">'Chinh'</span>, <span class=\"symbol\">age:</span> <span class=\"number\">25</span>)</span></span></span><br><span class=\"line\">  puts <span class=\"string\">\"Name: <span class=\"subst\">#&#123;name&#125;</span> - Age: <span class=\"subst\">#&#123;age&#125;</span>\\n\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>if you call <strong>hello</strong> method with no arguments:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello()</span><br></pre></td></tr></table></figure>\n\n<p>It will use default value.</p>\n<p>And then</p>\n<p>If you pass argumets for it:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello(<span class=\"string\">'Chinh'</span>, <span class=\"number\">25</span>)</span><br></pre></td></tr></table></figure>\n\n<p>what will it return?</p>\n<p><strong>Error</strong>: yes, it will response an error, but why?</p>\n<p>Because, with <strong>keyword arguments</strong>, you need to pass argumetns like a hash you declare when initial method. (<strong>same key</strong>).</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hello(<span class=\"symbol\">name:</span> <span class=\"string\">'Meo'</span>)</span><br><span class=\"line\"><span class=\"comment\"># Hello Meo - Age: 25</span></span><br><span class=\"line\"></span><br><span class=\"line\">hello(<span class=\"symbol\">age:</span> <span class=\"number\">10</span>)</span><br><span class=\"line\"><span class=\"comment\"># Hello Chinh - Age: 10</span></span><br><span class=\"line\"></span><br><span class=\"line\">hello(<span class=\"symbol\">name:</span> <span class=\"string\">'Chuot'</span>, <span class=\"symbol\">age:</span> <span class=\"number\">11</span>)</span><br><span class=\"line\"><span class=\"comment\"># Hello Chuot - Age: 11</span></span><br></pre></td></tr></table></figure>\n\n<p>If you want to required an argument with no default value, try this:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">hello</span><span class=\"params\">(<span class=\"symbol\">name:</span>, <span class=\"symbol\">age:</span>)</span></span></span><br><span class=\"line\">  puts <span class=\"string\">\"Name: <span class=\"subst\">#&#123;name&#125;</span> - Age: <span class=\"subst\">#&#123;age&#125;</span>\\n\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>It mean the method need to receive “a hash” with two key <em>name</em> and <em>age</em>. if it does not revieve, error will raise.</p>\n"},{"title":"Searching In Array","date":"2019-12-15T17:00:00.000Z","_content":"\n## Binary Search\n\n```ruby\na = [1, 2, 3, 4, 5, 6, 7, 8, 9]\n\ndef binary_search(nums, left, right, target)\n  while left <= right\n    mid = (left + right) / 2\n\n    return mid if nums[mid] == target\n\n    if target < nums[mid]\n      right = mid - 1\n      return binary_search(nums, left, right, target)\n    else\n      left = mid + 1\n      return binary_search(nums, left, right, target)\n    end\n  end\n\n  return -1\nend\n\nbinary_search(a, 0, 8, 5)\n\n```\n\n> ...\n","source":"_posts/2019-12-16-search-in-array.md","raw":"---\ntitle: Searching In Array\ndate: 2019-12-16\ntags: [\"RUBY\"]\n---\n\n## Binary Search\n\n```ruby\na = [1, 2, 3, 4, 5, 6, 7, 8, 9]\n\ndef binary_search(nums, left, right, target)\n  while left <= right\n    mid = (left + right) / 2\n\n    return mid if nums[mid] == target\n\n    if target < nums[mid]\n      right = mid - 1\n      return binary_search(nums, left, right, target)\n    else\n      left = mid + 1\n      return binary_search(nums, left, right, target)\n    end\n  end\n\n  return -1\nend\n\nbinary_search(a, 0, 8, 5)\n\n```\n\n> ...\n","slug":"2019-12-16-search-in-array","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbb002zp3m2hk1p8ar8","content":"<h2 id=\"Binary-Search\"><a href=\"#Binary-Search\" class=\"headerlink\" title=\"Binary Search\"></a>Binary Search</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binary_search</span><span class=\"params\">(nums, left, right, target)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> left &lt;= right</span><br><span class=\"line\">    mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> mid <span class=\"keyword\">if</span> nums[mid] == target</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> target &lt; nums[mid]</span><br><span class=\"line\">      right = mid - <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> binary_search(nums, left, right, target)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      left = mid + <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> binary_search(nums, left, right, target)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">binary_search(a, <span class=\"number\">0</span>, <span class=\"number\">8</span>, <span class=\"number\">5</span>)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>…</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Binary-Search\"><a href=\"#Binary-Search\" class=\"headerlink\" title=\"Binary Search\"></a>Binary Search</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">binary_search</span><span class=\"params\">(nums, left, right, target)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">while</span> left &lt;= right</span><br><span class=\"line\">    mid = (left + right) / <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> mid <span class=\"keyword\">if</span> nums[mid] == target</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> target &lt; nums[mid]</span><br><span class=\"line\">      right = mid - <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> binary_search(nums, left, right, target)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      left = mid + <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> binary_search(nums, left, right, target)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> -<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">binary_search(a, <span class=\"number\">0</span>, <span class=\"number\">8</span>, <span class=\"number\">5</span>)</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>…</p>\n</blockquote>\n"},{"title":"Implement Linked List With Ruby","date":"2019-12-05T17:00:00.000Z","_content":"\n## Define Node\n\n```ruby\nclass Node\n  attr_accessor :next, :value\n\n  def initialize(value)\n    @value = value\n    @next  = nil\n  end\nend\n```\n\n## Define Linked List\n\n```ruby\nclass LinkedList\n  attr_accessor :head, :length\n\n  def initialize\n    @head = nil\n    @length = 0\n  end\nend\n```\n\n## Display Linked List\n\n```ruby\ndef show_all\n  current_node = @head\n  puts \":----- Linked List: ----->\"\n\n  while(current_node)\n    puts \"object_id: #{current_node.object_id} - value: #{current_node.value}\\n\"\n    current_node = current_node.next\n  end\nend\n```\n\n## Add New Node\n\n```ruby\ndef add(value)\n  current_node = @head\n\n  if current_node\n    while(current_node.next)\n      current_node = current_node.next\n    end\n    current_node.next = Node.new(value)\n  else\n    @head = Node.new(value)\n  end\n\n  @length += 1\nend\n```\n\n## Delete A Node At Position\n\n```ruby\ndef delete(position)\n  return false if(!@head || position > @length)\n\n  prev_node = current_node = @head\n  i = 0\n\n  while(current_node)\n    if(i == position)\n      prev_node.next = current_node.next\n      return true\n    end\n\n    prev_node = current_node\n    current_node = current_node.next\n    i += 1\n  end\n\n  return false\nend\n```\n\n## Reverse Linked List\n\n```ruby\ndef reverse\n  mid = @length / 2\n  i = 1\n  current_node = @head\n\n  while(i <= mid)\n    swap(current_node, find_nth_from_end_list(i))\n    current_node = current_node.next\n    i += 1\n  end\nend\n```\n\n## Check Circular Linked List\n\n```ruby\ndef is_circular_linked_list?\n  return false if !@head\n  hash = {}\n\n  current_node = @head\n  while(current_node)\n    return false if(hash.key?(current_node.object_id))\n\n    hash[current_node.object_id] = true\n    current_node = current_node.next\n  end\n\n  return false\nend\n```\n\n## Full Example\n\n```ruby\nclass Node\n  attr_accessor :next, :value\n\n  def initialize(value)\n    @value = value\n    @next  = nil\n  end\nend\n\nclass LinkedList\n  attr_accessor :head, :length\n\n  def initialize\n    @head = nil\n    @length = 0\n  end\n\n  def show_all\n    current_node = @head\n    puts \":----- Linked List: ----->\"\n\n    while(current_node)\n      puts \"object_id: #{current_node.object_id} - value: #{current_node.value}\\n\"\n      current_node = current_node.next\n    end\n  end\n\n  def add(value)\n    current_node = @head\n\n    if current_node\n      while(current_node.next)\n        current_node = current_node.next\n      end\n      current_node.next = Node.new(value)\n    else\n      @head = Node.new(value)\n    end\n\n    @length += 1\n  end\n\n  def delete(position)\n    return false if(!@head || position > @length)\n\n    prev_node = current_node = @head\n    i = 0\n\n    while(current_node)\n      if(i == position)\n        prev_node.next = current_node.next\n        return true\n      end\n\n      prev_node = current_node\n      current_node = current_node.next\n      i += 1\n    end\n\n    return false\n  end\n\n  # find node nth from the end of linked list\n  def find_nth_from_end_list(n)\n    return nil if (n < 0 || n > @length || !@head)\n\n    current_node = @head\n    i = 0\n\n    while(current_node)\n      if(i + n == @length)\n        return current_node\n      else\n        i += 1\n        current_node = current_node.next\n      end\n    end\n  end\n\n  # remove duplicate node\n  def remove_duplicate\n    current_node = @head\n    hash = {}\n    i = 0\n    sum_of_deleted = 0\n\n    while(current_node)\n      if(hash.key?(current_node.value))\n        # position in the next duplicate  will change after we remove any items\n        delete(i - sum_of_deleted)\n        sum_of_deleted += 1\n      else\n        hash[current_node.value] = true\n      end\n\n      i += 1\n      current_node = current_node.next\n    end\n  end\n\n  # remove middle node\n  def remove_middle_node\n    position = @length/2\n\n    i = 0\n    prev_node = current_node = @head\n\n    while(current_node)\n      if(i == position)\n        prev_node.next = current_node.next\n        break\n      else\n        prev_node = current_node\n        current_node = current_node.next\n        i += 1\n      end\n    end\n  end\n\n  def reverse\n    mid = @length / 2\n    i = 1\n    current_node = @head\n\n    while(i <= mid)\n      swap(current_node, find_nth_from_end_list(i))\n      current_node = current_node.next\n      i += 1\n    end\n  end\n\n  # plus two linked list\n  def plus(l2)\n    result = LinkedList.new\n    curr1 = @head\n    curr2 = l2.head\n    remember_number = 0\n\n    while(curr1 || curr2)\n      val1 = curr1 ? curr1.value : 0\n      val2 = curr2 ? curr2.value : 0\n\n      sum = val1 + val2 + remember_number\n\n      if sum >= 10\n        sum %= 10\n        remember_number = 1\n      end\n\n      result.add(sum)\n\n      curr1 = curr1.next\n      curr2 = curr2.next\n    end\n\n    result\n  end\n\n  def is_circular_linked_list?\n    return false if !@head\n    hash = {}\n\n    current_node = @head\n    while(current_node)\n      return false if(hash.key?(current_node.object_id))\n\n      hash[current_node.object_id] = true\n      current_node = current_node.next\n    end\n\n    return false\n  end\n\n  private\n\n  def swap(node1, node2)\n    tmp_value = node2.value\n    node2.value = node1.value\n    node1.value = tmp_value\n  end\nend\n```\n\n## Source\n\n> [https://github.com/hdchinh/ruby_cracking_code/tree/master/linked_lists](https://github.com/hdchinh/ruby_cracking_code/tree/master/linked_lists)\n","source":"_posts/2019-12-06-linked-list-with-ruby.md","raw":"---\ntitle: Implement Linked List With Ruby\ndate: 2019-12-06\ntags: [\"RUBY\"]\n---\n\n## Define Node\n\n```ruby\nclass Node\n  attr_accessor :next, :value\n\n  def initialize(value)\n    @value = value\n    @next  = nil\n  end\nend\n```\n\n## Define Linked List\n\n```ruby\nclass LinkedList\n  attr_accessor :head, :length\n\n  def initialize\n    @head = nil\n    @length = 0\n  end\nend\n```\n\n## Display Linked List\n\n```ruby\ndef show_all\n  current_node = @head\n  puts \":----- Linked List: ----->\"\n\n  while(current_node)\n    puts \"object_id: #{current_node.object_id} - value: #{current_node.value}\\n\"\n    current_node = current_node.next\n  end\nend\n```\n\n## Add New Node\n\n```ruby\ndef add(value)\n  current_node = @head\n\n  if current_node\n    while(current_node.next)\n      current_node = current_node.next\n    end\n    current_node.next = Node.new(value)\n  else\n    @head = Node.new(value)\n  end\n\n  @length += 1\nend\n```\n\n## Delete A Node At Position\n\n```ruby\ndef delete(position)\n  return false if(!@head || position > @length)\n\n  prev_node = current_node = @head\n  i = 0\n\n  while(current_node)\n    if(i == position)\n      prev_node.next = current_node.next\n      return true\n    end\n\n    prev_node = current_node\n    current_node = current_node.next\n    i += 1\n  end\n\n  return false\nend\n```\n\n## Reverse Linked List\n\n```ruby\ndef reverse\n  mid = @length / 2\n  i = 1\n  current_node = @head\n\n  while(i <= mid)\n    swap(current_node, find_nth_from_end_list(i))\n    current_node = current_node.next\n    i += 1\n  end\nend\n```\n\n## Check Circular Linked List\n\n```ruby\ndef is_circular_linked_list?\n  return false if !@head\n  hash = {}\n\n  current_node = @head\n  while(current_node)\n    return false if(hash.key?(current_node.object_id))\n\n    hash[current_node.object_id] = true\n    current_node = current_node.next\n  end\n\n  return false\nend\n```\n\n## Full Example\n\n```ruby\nclass Node\n  attr_accessor :next, :value\n\n  def initialize(value)\n    @value = value\n    @next  = nil\n  end\nend\n\nclass LinkedList\n  attr_accessor :head, :length\n\n  def initialize\n    @head = nil\n    @length = 0\n  end\n\n  def show_all\n    current_node = @head\n    puts \":----- Linked List: ----->\"\n\n    while(current_node)\n      puts \"object_id: #{current_node.object_id} - value: #{current_node.value}\\n\"\n      current_node = current_node.next\n    end\n  end\n\n  def add(value)\n    current_node = @head\n\n    if current_node\n      while(current_node.next)\n        current_node = current_node.next\n      end\n      current_node.next = Node.new(value)\n    else\n      @head = Node.new(value)\n    end\n\n    @length += 1\n  end\n\n  def delete(position)\n    return false if(!@head || position > @length)\n\n    prev_node = current_node = @head\n    i = 0\n\n    while(current_node)\n      if(i == position)\n        prev_node.next = current_node.next\n        return true\n      end\n\n      prev_node = current_node\n      current_node = current_node.next\n      i += 1\n    end\n\n    return false\n  end\n\n  # find node nth from the end of linked list\n  def find_nth_from_end_list(n)\n    return nil if (n < 0 || n > @length || !@head)\n\n    current_node = @head\n    i = 0\n\n    while(current_node)\n      if(i + n == @length)\n        return current_node\n      else\n        i += 1\n        current_node = current_node.next\n      end\n    end\n  end\n\n  # remove duplicate node\n  def remove_duplicate\n    current_node = @head\n    hash = {}\n    i = 0\n    sum_of_deleted = 0\n\n    while(current_node)\n      if(hash.key?(current_node.value))\n        # position in the next duplicate  will change after we remove any items\n        delete(i - sum_of_deleted)\n        sum_of_deleted += 1\n      else\n        hash[current_node.value] = true\n      end\n\n      i += 1\n      current_node = current_node.next\n    end\n  end\n\n  # remove middle node\n  def remove_middle_node\n    position = @length/2\n\n    i = 0\n    prev_node = current_node = @head\n\n    while(current_node)\n      if(i == position)\n        prev_node.next = current_node.next\n        break\n      else\n        prev_node = current_node\n        current_node = current_node.next\n        i += 1\n      end\n    end\n  end\n\n  def reverse\n    mid = @length / 2\n    i = 1\n    current_node = @head\n\n    while(i <= mid)\n      swap(current_node, find_nth_from_end_list(i))\n      current_node = current_node.next\n      i += 1\n    end\n  end\n\n  # plus two linked list\n  def plus(l2)\n    result = LinkedList.new\n    curr1 = @head\n    curr2 = l2.head\n    remember_number = 0\n\n    while(curr1 || curr2)\n      val1 = curr1 ? curr1.value : 0\n      val2 = curr2 ? curr2.value : 0\n\n      sum = val1 + val2 + remember_number\n\n      if sum >= 10\n        sum %= 10\n        remember_number = 1\n      end\n\n      result.add(sum)\n\n      curr1 = curr1.next\n      curr2 = curr2.next\n    end\n\n    result\n  end\n\n  def is_circular_linked_list?\n    return false if !@head\n    hash = {}\n\n    current_node = @head\n    while(current_node)\n      return false if(hash.key?(current_node.object_id))\n\n      hash[current_node.object_id] = true\n      current_node = current_node.next\n    end\n\n    return false\n  end\n\n  private\n\n  def swap(node1, node2)\n    tmp_value = node2.value\n    node2.value = node1.value\n    node1.value = tmp_value\n  end\nend\n```\n\n## Source\n\n> [https://github.com/hdchinh/ruby_cracking_code/tree/master/linked_lists](https://github.com/hdchinh/ruby_cracking_code/tree/master/linked_lists)\n","slug":"2019-12-06-linked-list-with-ruby","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbb0031p3m24p19gzbh","content":"<h2 id=\"Define-Node\"><a href=\"#Define-Node\" class=\"headerlink\" title=\"Define Node\"></a>Define Node</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:next</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(value)</span></span></span><br><span class=\"line\">    @value = value</span><br><span class=\"line\">    @next  = <span class=\"literal\">nil</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Define-Linked-List\"><a href=\"#Define-Linked-List\" class=\"headerlink\" title=\"Define Linked List\"></a>Define Linked List</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LinkedList</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:head</span>, <span class=\"symbol\">:length</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    @head = <span class=\"literal\">nil</span></span><br><span class=\"line\">    @length = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Display-Linked-List\"><a href=\"#Display-Linked-List\" class=\"headerlink\" title=\"Display Linked List\"></a>Display Linked List</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show_all</span></span></span><br><span class=\"line\">  current_node = @head</span><br><span class=\"line\">  puts <span class=\"string\">\":----- Linked List: -----&gt;\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">    puts <span class=\"string\">\"object_id: <span class=\"subst\">#&#123;current_node.object_id&#125;</span> - value: <span class=\"subst\">#&#123;current_node.value&#125;</span>\\n\"</span></span><br><span class=\"line\">    current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Add-New-Node\"><a href=\"#Add-New-Node\" class=\"headerlink\" title=\"Add New Node\"></a>Add New Node</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(value)</span></span></span><br><span class=\"line\">  current_node = @head</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> current_node</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node.<span class=\"keyword\">next</span>)</span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    current_node.<span class=\"keyword\">next</span> = Node.new(value)</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    @head = Node.new(value)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  @length += <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Delete-A-Node-At-Position\"><a href=\"#Delete-A-Node-At-Position\" class=\"headerlink\" title=\"Delete A Node At Position\"></a>Delete A Node At Position</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">delete</span><span class=\"params\">(position)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span>(!@head <span class=\"params\">||</span> position &gt; @length)</span><br><span class=\"line\"></span><br><span class=\"line\">  prev_node = current_node = @head</span><br><span class=\"line\">  i = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(i == position)</span><br><span class=\"line\">      prev_node.<span class=\"keyword\">next</span> = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    prev_node = current_node</span><br><span class=\"line\">    current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    i += <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Reverse-Linked-List\"><a href=\"#Reverse-Linked-List\" class=\"headerlink\" title=\"Reverse Linked List\"></a>Reverse Linked List</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverse</span></span></span><br><span class=\"line\">  mid = @length / <span class=\"number\">2</span></span><br><span class=\"line\">  i = <span class=\"number\">1</span></span><br><span class=\"line\">  current_node = @head</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(i &lt;= mid)</span><br><span class=\"line\">    swap(current_node, find_nth_from_end_list(i))</span><br><span class=\"line\">    current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    i += <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Check-Circular-Linked-List\"><a href=\"#Check-Circular-Linked-List\" class=\"headerlink\" title=\"Check Circular Linked List\"></a>Check Circular Linked List</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">is_circular_linked_list?</span></span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@head</span><br><span class=\"line\">  hash = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  current_node = @head</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span>(hash.key?(current_node.object_id))</span><br><span class=\"line\"></span><br><span class=\"line\">    hash[current_node.object_id] = <span class=\"literal\">true</span></span><br><span class=\"line\">    current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Full-Example\"><a href=\"#Full-Example\" class=\"headerlink\" title=\"Full Example\"></a>Full Example</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:next</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(value)</span></span></span><br><span class=\"line\">    @value = value</span><br><span class=\"line\">    @next  = <span class=\"literal\">nil</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LinkedList</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:head</span>, <span class=\"symbol\">:length</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    @head = <span class=\"literal\">nil</span></span><br><span class=\"line\">    @length = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show_all</span></span></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\">    puts <span class=\"string\">\":----- Linked List: -----&gt;\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      puts <span class=\"string\">\"object_id: <span class=\"subst\">#&#123;current_node.object_id&#125;</span> - value: <span class=\"subst\">#&#123;current_node.value&#125;</span>\\n\"</span></span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(value)</span></span></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> current_node</span><br><span class=\"line\">      <span class=\"keyword\">while</span>(current_node.<span class=\"keyword\">next</span>)</span><br><span class=\"line\">        current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">      current_node.<span class=\"keyword\">next</span> = Node.new(value)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      @head = Node.new(value)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    @length += <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">delete</span><span class=\"params\">(position)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span>(!@head <span class=\"params\">||</span> position &gt; @length)</span><br><span class=\"line\"></span><br><span class=\"line\">    prev_node = current_node = @head</span><br><span class=\"line\">    i = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(i == position)</span><br><span class=\"line\">        prev_node.<span class=\"keyword\">next</span> = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">      prev_node = current_node</span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">      i += <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># find node nth from the end of linked list</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">find_nth_from_end_list</span><span class=\"params\">(n)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span> <span class=\"keyword\">if</span> (n &lt; <span class=\"number\">0</span> <span class=\"params\">||</span> n &gt; @length <span class=\"params\">||</span> !@head)</span><br><span class=\"line\"></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\">    i = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(i + n == @length)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> current_node</span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        i += <span class=\"number\">1</span></span><br><span class=\"line\">        current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># remove duplicate node</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">remove_duplicate</span></span></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\">    hash = &#123;&#125;</span><br><span class=\"line\">    i = <span class=\"number\">0</span></span><br><span class=\"line\">    sum_of_deleted = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(hash.key?(current_node.value))</span><br><span class=\"line\">        <span class=\"comment\"># position in the next duplicate  will change after we remove any items</span></span><br><span class=\"line\">        delete(i - sum_of_deleted)</span><br><span class=\"line\">        sum_of_deleted += <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        hash[current_node.value] = <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">      i += <span class=\"number\">1</span></span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># remove middle node</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">remove_middle_node</span></span></span><br><span class=\"line\">    position = @length/<span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">    i = <span class=\"number\">0</span></span><br><span class=\"line\">    prev_node = current_node = @head</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(i == position)</span><br><span class=\"line\">        prev_node.<span class=\"keyword\">next</span> = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        prev_node = current_node</span><br><span class=\"line\">        current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">        i += <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverse</span></span></span><br><span class=\"line\">    mid = @length / <span class=\"number\">2</span></span><br><span class=\"line\">    i = <span class=\"number\">1</span></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(i &lt;= mid)</span><br><span class=\"line\">      swap(current_node, find_nth_from_end_list(i))</span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">      i += <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># plus two linked list</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">plus</span><span class=\"params\">(l2)</span></span></span><br><span class=\"line\">    result = LinkedList.new</span><br><span class=\"line\">    curr1 = @head</span><br><span class=\"line\">    curr2 = l2.head</span><br><span class=\"line\">    remember_number = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(curr1 <span class=\"params\">||</span> curr2)</span><br><span class=\"line\">      val1 = curr1 ? curr1.value : <span class=\"number\">0</span></span><br><span class=\"line\">      val2 = curr2 ? curr2.value : <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">      sum = val1 + val2 + remember_number</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> sum &gt;= <span class=\"number\">10</span></span><br><span class=\"line\">        sum %= <span class=\"number\">10</span></span><br><span class=\"line\">        remember_number = <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">      result.add(sum)</span><br><span class=\"line\"></span><br><span class=\"line\">      curr1 = curr1.<span class=\"keyword\">next</span></span><br><span class=\"line\">      curr2 = curr2.<span class=\"keyword\">next</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">is_circular_linked_list?</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@head</span><br><span class=\"line\">    hash = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span>(hash.key?(current_node.object_id))</span><br><span class=\"line\"></span><br><span class=\"line\">      hash[current_node.object_id] = <span class=\"literal\">true</span></span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">swap</span><span class=\"params\">(node1, node2)</span></span></span><br><span class=\"line\">    tmp_value = node2.value</span><br><span class=\"line\">    node2.value = node1.value</span><br><span class=\"line\">    node1.value = tmp_value</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Source\"><a href=\"#Source\" class=\"headerlink\" title=\"Source\"></a>Source</h2><blockquote>\n<p><a href=\"https://github.com/hdchinh/ruby_cracking_code/tree/master/linked_lists\" target=\"_blank\" rel=\"noopener\">https://github.com/hdchinh/ruby_cracking_code/tree/master/linked_lists</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Define-Node\"><a href=\"#Define-Node\" class=\"headerlink\" title=\"Define Node\"></a>Define Node</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:next</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(value)</span></span></span><br><span class=\"line\">    @value = value</span><br><span class=\"line\">    @next  = <span class=\"literal\">nil</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Define-Linked-List\"><a href=\"#Define-Linked-List\" class=\"headerlink\" title=\"Define Linked List\"></a>Define Linked List</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LinkedList</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:head</span>, <span class=\"symbol\">:length</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    @head = <span class=\"literal\">nil</span></span><br><span class=\"line\">    @length = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Display-Linked-List\"><a href=\"#Display-Linked-List\" class=\"headerlink\" title=\"Display Linked List\"></a>Display Linked List</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show_all</span></span></span><br><span class=\"line\">  current_node = @head</span><br><span class=\"line\">  puts <span class=\"string\">\":----- Linked List: -----&gt;\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">    puts <span class=\"string\">\"object_id: <span class=\"subst\">#&#123;current_node.object_id&#125;</span> - value: <span class=\"subst\">#&#123;current_node.value&#125;</span>\\n\"</span></span><br><span class=\"line\">    current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Add-New-Node\"><a href=\"#Add-New-Node\" class=\"headerlink\" title=\"Add New Node\"></a>Add New Node</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(value)</span></span></span><br><span class=\"line\">  current_node = @head</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> current_node</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node.<span class=\"keyword\">next</span>)</span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    current_node.<span class=\"keyword\">next</span> = Node.new(value)</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    @head = Node.new(value)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  @length += <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Delete-A-Node-At-Position\"><a href=\"#Delete-A-Node-At-Position\" class=\"headerlink\" title=\"Delete A Node At Position\"></a>Delete A Node At Position</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">delete</span><span class=\"params\">(position)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span>(!@head <span class=\"params\">||</span> position &gt; @length)</span><br><span class=\"line\"></span><br><span class=\"line\">  prev_node = current_node = @head</span><br><span class=\"line\">  i = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(i == position)</span><br><span class=\"line\">      prev_node.<span class=\"keyword\">next</span> = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    prev_node = current_node</span><br><span class=\"line\">    current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    i += <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Reverse-Linked-List\"><a href=\"#Reverse-Linked-List\" class=\"headerlink\" title=\"Reverse Linked List\"></a>Reverse Linked List</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverse</span></span></span><br><span class=\"line\">  mid = @length / <span class=\"number\">2</span></span><br><span class=\"line\">  i = <span class=\"number\">1</span></span><br><span class=\"line\">  current_node = @head</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span>(i &lt;= mid)</span><br><span class=\"line\">    swap(current_node, find_nth_from_end_list(i))</span><br><span class=\"line\">    current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    i += <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Check-Circular-Linked-List\"><a href=\"#Check-Circular-Linked-List\" class=\"headerlink\" title=\"Check Circular Linked List\"></a>Check Circular Linked List</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">is_circular_linked_list?</span></span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@head</span><br><span class=\"line\">  hash = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  current_node = @head</span><br><span class=\"line\">  <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span>(hash.key?(current_node.object_id))</span><br><span class=\"line\"></span><br><span class=\"line\">    hash[current_node.object_id] = <span class=\"literal\">true</span></span><br><span class=\"line\">    current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Full-Example\"><a href=\"#Full-Example\" class=\"headerlink\" title=\"Full Example\"></a>Full Example</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:next</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(value)</span></span></span><br><span class=\"line\">    @value = value</span><br><span class=\"line\">    @next  = <span class=\"literal\">nil</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LinkedList</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:head</span>, <span class=\"symbol\">:length</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span></span></span><br><span class=\"line\">    @head = <span class=\"literal\">nil</span></span><br><span class=\"line\">    @length = <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show_all</span></span></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\">    puts <span class=\"string\">\":----- Linked List: -----&gt;\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      puts <span class=\"string\">\"object_id: <span class=\"subst\">#&#123;current_node.object_id&#125;</span> - value: <span class=\"subst\">#&#123;current_node.value&#125;</span>\\n\"</span></span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(value)</span></span></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> current_node</span><br><span class=\"line\">      <span class=\"keyword\">while</span>(current_node.<span class=\"keyword\">next</span>)</span><br><span class=\"line\">        current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">      current_node.<span class=\"keyword\">next</span> = Node.new(value)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      @head = Node.new(value)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    @length += <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">delete</span><span class=\"params\">(position)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span>(!@head <span class=\"params\">||</span> position &gt; @length)</span><br><span class=\"line\"></span><br><span class=\"line\">    prev_node = current_node = @head</span><br><span class=\"line\">    i = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(i == position)</span><br><span class=\"line\">        prev_node.<span class=\"keyword\">next</span> = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">      prev_node = current_node</span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">      i += <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># find node nth from the end of linked list</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">find_nth_from_end_list</span><span class=\"params\">(n)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">nil</span> <span class=\"keyword\">if</span> (n &lt; <span class=\"number\">0</span> <span class=\"params\">||</span> n &gt; @length <span class=\"params\">||</span> !@head)</span><br><span class=\"line\"></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\">    i = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(i + n == @length)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> current_node</span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        i += <span class=\"number\">1</span></span><br><span class=\"line\">        current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># remove duplicate node</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">remove_duplicate</span></span></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\">    hash = &#123;&#125;</span><br><span class=\"line\">    i = <span class=\"number\">0</span></span><br><span class=\"line\">    sum_of_deleted = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(hash.key?(current_node.value))</span><br><span class=\"line\">        <span class=\"comment\"># position in the next duplicate  will change after we remove any items</span></span><br><span class=\"line\">        delete(i - sum_of_deleted)</span><br><span class=\"line\">        sum_of_deleted += <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        hash[current_node.value] = <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">      i += <span class=\"number\">1</span></span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># remove middle node</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">remove_middle_node</span></span></span><br><span class=\"line\">    position = @length/<span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">    i = <span class=\"number\">0</span></span><br><span class=\"line\">    prev_node = current_node = @head</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(i == position)</span><br><span class=\"line\">        prev_node.<span class=\"keyword\">next</span> = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">        <span class=\"keyword\">break</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        prev_node = current_node</span><br><span class=\"line\">        current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">        i += <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">reverse</span></span></span><br><span class=\"line\">    mid = @length / <span class=\"number\">2</span></span><br><span class=\"line\">    i = <span class=\"number\">1</span></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(i &lt;= mid)</span><br><span class=\"line\">      swap(current_node, find_nth_from_end_list(i))</span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">      i += <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># plus two linked list</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">plus</span><span class=\"params\">(l2)</span></span></span><br><span class=\"line\">    result = LinkedList.new</span><br><span class=\"line\">    curr1 = @head</span><br><span class=\"line\">    curr2 = l2.head</span><br><span class=\"line\">    remember_number = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(curr1 <span class=\"params\">||</span> curr2)</span><br><span class=\"line\">      val1 = curr1 ? curr1.value : <span class=\"number\">0</span></span><br><span class=\"line\">      val2 = curr2 ? curr2.value : <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">      sum = val1 + val2 + remember_number</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> sum &gt;= <span class=\"number\">10</span></span><br><span class=\"line\">        sum %= <span class=\"number\">10</span></span><br><span class=\"line\">        remember_number = <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">      result.add(sum)</span><br><span class=\"line\"></span><br><span class=\"line\">      curr1 = curr1.<span class=\"keyword\">next</span></span><br><span class=\"line\">      curr2 = curr2.<span class=\"keyword\">next</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">is_circular_linked_list?</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@head</span><br><span class=\"line\">    hash = &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    current_node = @head</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(current_node)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span>(hash.key?(current_node.object_id))</span><br><span class=\"line\"></span><br><span class=\"line\">      hash[current_node.object_id] = <span class=\"literal\">true</span></span><br><span class=\"line\">      current_node = current_node.<span class=\"keyword\">next</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">swap</span><span class=\"params\">(node1, node2)</span></span></span><br><span class=\"line\">    tmp_value = node2.value</span><br><span class=\"line\">    node2.value = node1.value</span><br><span class=\"line\">    node1.value = tmp_value</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Source\"><a href=\"#Source\" class=\"headerlink\" title=\"Source\"></a>Source</h2><blockquote>\n<p><a href=\"https://github.com/hdchinh/ruby_cracking_code/tree/master/linked_lists\" target=\"_blank\" rel=\"noopener\">https://github.com/hdchinh/ruby_cracking_code/tree/master/linked_lists</a></p>\n</blockquote>\n"},{"title":"Example Of Two Pointer With Ruby","date":"2019-12-19T17:00:00.000Z","_content":"\n## [3sum-closest](https://leetcode.com/problems/3sum-closest/submissions/)\n\n![bai giai](/../images/3sum_2.jpeg)\n\n```ruby\ndef three_sum_closest(nums, target)\n  nums.sort!\n\n  length = nums.size\n  kq = nums[0] + nums[1] + nums[length - 1]\n\n  0.upto(length - 2) do |i|\n    ptr1 = i + 1\n    ptr2 = length - 1\n\n    while ptr1 < ptr2\n      sum = nums[i] + nums[ptr1] + nums[ptr2]\n\n      return target if (target - sum).abs == 0\n\n      kq = sum if (target - sum).abs < (target - kq).abs\n\n      if sum > target\n        ptr2 -= 1\n      else\n        ptr1 += 1\n      end\n    end\n\n  end\n\n  kq\nend\n```\n\n\n## [container-with-most-water](https://leetcode.com/problems/container-with-most-water/submissions/)\n\n![bai giai](/../images/question_11.jpg)\n\n```ruby\ndef get_container_water(arr, a, b)\n  h = arr[a] >= arr[b] ? arr[b] : arr[a]\n  h * (b - a).abs\nend\n\ndef max_area(height)\n  start = 0\n  finish = height.size - 1\n\n  max = get_container_water(height, start, finish)\n\n  while start < finish\n    if height[start] >= height[finish]\n      finish -= 1\n      return max if finish <= start\n    else\n      start += 1\n      return max if start >= finish\n    end\n\n    max = get_container_water(height, start, finish) if get_container_water(height, start, finish) > max\n  end\n\n  max\nend\n```\n","source":"_posts/2019-12-20-example-of-two-pointer.md","raw":"---\ntitle: Example Of Two Pointer With Ruby\ndate: 2019-12-20\ntags: [\"RUBY\"]\n---\n\n## [3sum-closest](https://leetcode.com/problems/3sum-closest/submissions/)\n\n![bai giai](/../images/3sum_2.jpeg)\n\n```ruby\ndef three_sum_closest(nums, target)\n  nums.sort!\n\n  length = nums.size\n  kq = nums[0] + nums[1] + nums[length - 1]\n\n  0.upto(length - 2) do |i|\n    ptr1 = i + 1\n    ptr2 = length - 1\n\n    while ptr1 < ptr2\n      sum = nums[i] + nums[ptr1] + nums[ptr2]\n\n      return target if (target - sum).abs == 0\n\n      kq = sum if (target - sum).abs < (target - kq).abs\n\n      if sum > target\n        ptr2 -= 1\n      else\n        ptr1 += 1\n      end\n    end\n\n  end\n\n  kq\nend\n```\n\n\n## [container-with-most-water](https://leetcode.com/problems/container-with-most-water/submissions/)\n\n![bai giai](/../images/question_11.jpg)\n\n```ruby\ndef get_container_water(arr, a, b)\n  h = arr[a] >= arr[b] ? arr[b] : arr[a]\n  h * (b - a).abs\nend\n\ndef max_area(height)\n  start = 0\n  finish = height.size - 1\n\n  max = get_container_water(height, start, finish)\n\n  while start < finish\n    if height[start] >= height[finish]\n      finish -= 1\n      return max if finish <= start\n    else\n      start += 1\n      return max if start >= finish\n    end\n\n    max = get_container_water(height, start, finish) if get_container_water(height, start, finish) > max\n  end\n\n  max\nend\n```\n","slug":"2019-12-20-example-of-two-pointer","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbc0036p3m243osdgse","content":"<h2 id=\"3sum-closest\"><a href=\"#3sum-closest\" class=\"headerlink\" title=\"3sum-closest\"></a><a href=\"https://leetcode.com/problems/3sum-closest/submissions/\" target=\"_blank\" rel=\"noopener\">3sum-closest</a></h2><p><img src=\"/../images/3sum_2.jpeg\" alt=\"bai giai\"></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">three_sum_closest</span><span class=\"params\">(nums, target)</span></span></span><br><span class=\"line\">  nums.sort!</span><br><span class=\"line\"></span><br><span class=\"line\">  length = nums.size</span><br><span class=\"line\">  kq = nums[<span class=\"number\">0</span>] + nums[<span class=\"number\">1</span>] + nums[length - <span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"number\">0</span>.upto(length - <span class=\"number\">2</span>) <span class=\"keyword\">do</span> <span class=\"params\">|i|</span></span><br><span class=\"line\">    ptr1 = i + <span class=\"number\">1</span></span><br><span class=\"line\">    ptr2 = length - <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> ptr1 &lt; ptr2</span><br><span class=\"line\">      sum = nums[i] + nums[ptr1] + nums[ptr2]</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> target <span class=\"keyword\">if</span> (target - sum).abs == <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">      kq = sum <span class=\"keyword\">if</span> (target - sum).abs &lt; (target - kq).abs</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> sum &gt; target</span><br><span class=\"line\">        ptr2 -= <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        ptr1 += <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  kq</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"container-with-most-water\"><a href=\"#container-with-most-water\" class=\"headerlink\" title=\"container-with-most-water\"></a><a href=\"https://leetcode.com/problems/container-with-most-water/submissions/\" target=\"_blank\" rel=\"noopener\">container-with-most-water</a></h2><p><img src=\"/../images/question_11.jpg\" alt=\"bai giai\"></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_container_water</span><span class=\"params\">(arr, a, b)</span></span></span><br><span class=\"line\">  h = arr[a] &gt;= arr[b] ? arr[b] : arr[a]</span><br><span class=\"line\">  h * (b - a).abs</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">max_area</span><span class=\"params\">(height)</span></span></span><br><span class=\"line\">  start = <span class=\"number\">0</span></span><br><span class=\"line\">  finish = height.size - <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">  max = get_container_water(height, start, finish)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span> start &lt; finish</span><br><span class=\"line\">    <span class=\"keyword\">if</span> height[start] &gt;= height[finish]</span><br><span class=\"line\">      finish -= <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> max <span class=\"keyword\">if</span> finish &lt;= start</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      start += <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> max <span class=\"keyword\">if</span> start &gt;= finish</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    max = get_container_water(height, start, finish) <span class=\"keyword\">if</span> get_container_water(height, start, finish) &gt; max</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  max</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"3sum-closest\"><a href=\"#3sum-closest\" class=\"headerlink\" title=\"3sum-closest\"></a><a href=\"https://leetcode.com/problems/3sum-closest/submissions/\" target=\"_blank\" rel=\"noopener\">3sum-closest</a></h2><p><img src=\"/../images/3sum_2.jpeg\" alt=\"bai giai\"></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">three_sum_closest</span><span class=\"params\">(nums, target)</span></span></span><br><span class=\"line\">  nums.sort!</span><br><span class=\"line\"></span><br><span class=\"line\">  length = nums.size</span><br><span class=\"line\">  kq = nums[<span class=\"number\">0</span>] + nums[<span class=\"number\">1</span>] + nums[length - <span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"number\">0</span>.upto(length - <span class=\"number\">2</span>) <span class=\"keyword\">do</span> <span class=\"params\">|i|</span></span><br><span class=\"line\">    ptr1 = i + <span class=\"number\">1</span></span><br><span class=\"line\">    ptr2 = length - <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> ptr1 &lt; ptr2</span><br><span class=\"line\">      sum = nums[i] + nums[ptr1] + nums[ptr2]</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> target <span class=\"keyword\">if</span> (target - sum).abs == <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">      kq = sum <span class=\"keyword\">if</span> (target - sum).abs &lt; (target - kq).abs</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">if</span> sum &gt; target</span><br><span class=\"line\">        ptr2 -= <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">        ptr1 += <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  kq</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"container-with-most-water\"><a href=\"#container-with-most-water\" class=\"headerlink\" title=\"container-with-most-water\"></a><a href=\"https://leetcode.com/problems/container-with-most-water/submissions/\" target=\"_blank\" rel=\"noopener\">container-with-most-water</a></h2><p><img src=\"/../images/question_11.jpg\" alt=\"bai giai\"></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_container_water</span><span class=\"params\">(arr, a, b)</span></span></span><br><span class=\"line\">  h = arr[a] &gt;= arr[b] ? arr[b] : arr[a]</span><br><span class=\"line\">  h * (b - a).abs</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">max_area</span><span class=\"params\">(height)</span></span></span><br><span class=\"line\">  start = <span class=\"number\">0</span></span><br><span class=\"line\">  finish = height.size - <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">  max = get_container_water(height, start, finish)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">while</span> start &lt; finish</span><br><span class=\"line\">    <span class=\"keyword\">if</span> height[start] &gt;= height[finish]</span><br><span class=\"line\">      finish -= <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> max <span class=\"keyword\">if</span> finish &lt;= start</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      start += <span class=\"number\">1</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> max <span class=\"keyword\">if</span> start &gt;= finish</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    max = get_container_water(height, start, finish) <span class=\"keyword\">if</span> get_container_water(height, start, finish) &gt; max</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  max</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Simple BST With Ruby","date":"2019-11-30T17:00:00.000Z","_content":"\n![vang con](/../images/vangcon.jpeg)\n\n## Init\n\n```ruby\nclass Node\n  attr_accessor :left, :right, :value\n\n  def initialize(val)\n    @value = val\n  end\nend\n```\n\n## Display Tree\n\n```ruby\ndef get_tree\n  puts \"#{value}\\n\"\n  @left.get_tree() if @left\n  @right.get_tree() if @right\nend\n```\n\n## Add Node\n\n```ruby\nclass Node\n  attr_accessor :left, :right, :value\n\n  def initialize(val)\n    @value = val\n  end\n\n  def add(new_val)\n    return if @value == new_val\n    if(@value > new_val)\n      add_left(new_val)\n    else\n      add_right(new_val)\n    end\n  end\n\n  private\n\n  def add_left(val)\n    if(@left)\n      @left.add(val)\n    else\n      @left = Node.new(val)\n    end\n  end\n\n  def add_right(val)\n    if(@right)\n      @right.add(val)\n    else\n      @right = Node.new(val)\n    end\n  end\n\nend\n```\n\n## Check existing?\n\n```ruby\nclass Node\n  attr_accessor :left, :right, :value\n\n  def initialize(val)\n    @value = val\n  end\n\n  def include?(val)\n    return true if(@value == val)\n\n    if(@value > val)\n      return false if !@left\n      @left.include?(val)\n    else\n      return false if !@right\n      @right.include?(val)\n    end\n  end\nend\n```\n\n## Update Node\n\n```ruby\ndef update(current_value, new_value)\n  if(@value == current_value)\n    @value = new_value\n    return true\n  end\n\n  if(@value > current_value)\n    return false if !@left\n    @left.update(current_value, new_value)\n  else\n    return false if !@right\n    @right.update(current_value, new_value)\n  end\nend\n```\n\n## Get Depth\n\n```ruby\ndef max_depth(root)\n  return 0 if root.nil?\n  return [max_depth(root.left), max_depth(root.right)].max + 1\nend\n```\n\n## Example\n\n```ruby\nclass Node\n  attr_accessor :left, :right, :value\n\n  def initialize(val)\n    @value = val\n  end\n\n  def get_tree\n    puts \"#{value}\\n\"\n    @left.get_tree() if @left\n    @right.get_tree() if @right\n  end\n\n  def add(new_val)\n    return if @value == new_val\n    if(@value > new_val)\n      add_left(new_val)\n    else\n      add_right(new_val)\n    end\n  end\n\n  def include?(val)\n    return true if(@value == val)\n\n    if(@value > val)\n      return false if !@left\n      @left.include?(val)\n    else\n      return false if !@right\n      @right.include?(val)\n    end\n  end\n\n  def update(current_value, new_value)\n    if(@value == current_value)\n      @value = new_value\n      return true\n    end\n\n    if(@value > current_value)\n      return false if !@left\n      @left.update(current_value, new_value)\n    else\n      return false if !@right\n      @right.update(current_value, new_value)\n    end\n  end\n\n  private\n\n  def add_left(val)\n    if(@left)\n      @left.add(val)\n    else\n      @left = Node.new(val)\n    end\n  end\n\n  def add_right(val)\n    if(@right)\n      @right.add(val)\n    else\n      @right = Node.new(val)\n    end\n  end\n\nend\n\na = Node.new(5)\nputs \"#{a.value} | #{a.left ? a.left.value : nil} | #{a.right ? a.right.value : nil}\"\n\na.add(2)\na.add(7)\na.add(9)\n\na.get_tree()\n\na.update(7, 6)\n\nputs \"#{a.value} | #{a.left ? a.left.value : nil} | #{a.right ? a.right.value : nil}\"\n\na.get_tree()\n\nb = a.right\nputs \"#{b.value} | #{b.left ? b.left.value : nil} | #{b.right ? b.right.value : nil}\"\n\n```\n","source":"_posts/2019-12-01-simple-bst-in-ruby.md","raw":"---\ntitle: Simple BST With Ruby\ndate: 2019-12-01\ntags: [\"RUBY\"]\n---\n\n![vang con](/../images/vangcon.jpeg)\n\n## Init\n\n```ruby\nclass Node\n  attr_accessor :left, :right, :value\n\n  def initialize(val)\n    @value = val\n  end\nend\n```\n\n## Display Tree\n\n```ruby\ndef get_tree\n  puts \"#{value}\\n\"\n  @left.get_tree() if @left\n  @right.get_tree() if @right\nend\n```\n\n## Add Node\n\n```ruby\nclass Node\n  attr_accessor :left, :right, :value\n\n  def initialize(val)\n    @value = val\n  end\n\n  def add(new_val)\n    return if @value == new_val\n    if(@value > new_val)\n      add_left(new_val)\n    else\n      add_right(new_val)\n    end\n  end\n\n  private\n\n  def add_left(val)\n    if(@left)\n      @left.add(val)\n    else\n      @left = Node.new(val)\n    end\n  end\n\n  def add_right(val)\n    if(@right)\n      @right.add(val)\n    else\n      @right = Node.new(val)\n    end\n  end\n\nend\n```\n\n## Check existing?\n\n```ruby\nclass Node\n  attr_accessor :left, :right, :value\n\n  def initialize(val)\n    @value = val\n  end\n\n  def include?(val)\n    return true if(@value == val)\n\n    if(@value > val)\n      return false if !@left\n      @left.include?(val)\n    else\n      return false if !@right\n      @right.include?(val)\n    end\n  end\nend\n```\n\n## Update Node\n\n```ruby\ndef update(current_value, new_value)\n  if(@value == current_value)\n    @value = new_value\n    return true\n  end\n\n  if(@value > current_value)\n    return false if !@left\n    @left.update(current_value, new_value)\n  else\n    return false if !@right\n    @right.update(current_value, new_value)\n  end\nend\n```\n\n## Get Depth\n\n```ruby\ndef max_depth(root)\n  return 0 if root.nil?\n  return [max_depth(root.left), max_depth(root.right)].max + 1\nend\n```\n\n## Example\n\n```ruby\nclass Node\n  attr_accessor :left, :right, :value\n\n  def initialize(val)\n    @value = val\n  end\n\n  def get_tree\n    puts \"#{value}\\n\"\n    @left.get_tree() if @left\n    @right.get_tree() if @right\n  end\n\n  def add(new_val)\n    return if @value == new_val\n    if(@value > new_val)\n      add_left(new_val)\n    else\n      add_right(new_val)\n    end\n  end\n\n  def include?(val)\n    return true if(@value == val)\n\n    if(@value > val)\n      return false if !@left\n      @left.include?(val)\n    else\n      return false if !@right\n      @right.include?(val)\n    end\n  end\n\n  def update(current_value, new_value)\n    if(@value == current_value)\n      @value = new_value\n      return true\n    end\n\n    if(@value > current_value)\n      return false if !@left\n      @left.update(current_value, new_value)\n    else\n      return false if !@right\n      @right.update(current_value, new_value)\n    end\n  end\n\n  private\n\n  def add_left(val)\n    if(@left)\n      @left.add(val)\n    else\n      @left = Node.new(val)\n    end\n  end\n\n  def add_right(val)\n    if(@right)\n      @right.add(val)\n    else\n      @right = Node.new(val)\n    end\n  end\n\nend\n\na = Node.new(5)\nputs \"#{a.value} | #{a.left ? a.left.value : nil} | #{a.right ? a.right.value : nil}\"\n\na.add(2)\na.add(7)\na.add(9)\n\na.get_tree()\n\na.update(7, 6)\n\nputs \"#{a.value} | #{a.left ? a.left.value : nil} | #{a.right ? a.right.value : nil}\"\n\na.get_tree()\n\nb = a.right\nputs \"#{b.value} | #{b.left ? b.left.value : nil} | #{b.right ? b.right.value : nil}\"\n\n```\n","slug":"2019-12-01-simple-bst-in-ruby","published":1,"updated":"2022-02-01T13:10:20.981Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbc0038p3m20kvy4mx1","content":"<p><img src=\"/../images/vangcon.jpeg\" alt=\"vang con\"></p>\n<h2 id=\"Init\"><a href=\"#Init\" class=\"headerlink\" title=\"Init\"></a>Init</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:left</span>, <span class=\"symbol\">:right</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    @value = val</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Display-Tree\"><a href=\"#Display-Tree\" class=\"headerlink\" title=\"Display Tree\"></a>Display Tree</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tree</span></span></span><br><span class=\"line\">  puts <span class=\"string\">\"<span class=\"subst\">#&#123;value&#125;</span>\\n\"</span></span><br><span class=\"line\">  @left.get_tree() <span class=\"keyword\">if</span> @left</span><br><span class=\"line\">  @right.get_tree() <span class=\"keyword\">if</span> @right</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Add-Node\"><a href=\"#Add-Node\" class=\"headerlink\" title=\"Add Node\"></a>Add Node</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:left</span>, <span class=\"symbol\">:right</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    @value = val</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(new_val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">if</span> @value == new_val</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value &gt; new_val)</span><br><span class=\"line\">      add_left(new_val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      add_right(new_val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add_left</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@left)</span><br><span class=\"line\">      @left.add(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      @left = Node.new(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add_right</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@right)</span><br><span class=\"line\">      @right.add(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      @right = Node.new(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Check-existing\"><a href=\"#Check-existing\" class=\"headerlink\" title=\"Check existing?\"></a>Check existing?</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:left</span>, <span class=\"symbol\">:right</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    @value = val</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">include?</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span> <span class=\"keyword\">if</span>(@value == val)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value &gt; val)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@left</span><br><span class=\"line\">      @left.<span class=\"keyword\">include</span>?(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@right</span><br><span class=\"line\">      @right.<span class=\"keyword\">include</span>?(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Update-Node\"><a href=\"#Update-Node\" class=\"headerlink\" title=\"Update Node\"></a>Update Node</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">update</span><span class=\"params\">(current_value, new_value)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(@value == current_value)</span><br><span class=\"line\">    @value = new_value</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(@value &gt; current_value)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@left</span><br><span class=\"line\">    @left.update(current_value, new_value)</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@right</span><br><span class=\"line\">    @right.update(current_value, new_value)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Get-Depth\"><a href=\"#Get-Depth\" class=\"headerlink\" title=\"Get Depth\"></a>Get Depth</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">max_depth</span><span class=\"params\">(root)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span> <span class=\"keyword\">if</span> root.<span class=\"literal\">nil</span>?</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [max_depth(root.left), max_depth(root.right)].max + <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Example\"><a href=\"#Example\" class=\"headerlink\" title=\"Example\"></a>Example</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:left</span>, <span class=\"symbol\">:right</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    @value = val</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tree</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"<span class=\"subst\">#&#123;value&#125;</span>\\n\"</span></span><br><span class=\"line\">    @left.get_tree() <span class=\"keyword\">if</span> @left</span><br><span class=\"line\">    @right.get_tree() <span class=\"keyword\">if</span> @right</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(new_val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">if</span> @value == new_val</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value &gt; new_val)</span><br><span class=\"line\">      add_left(new_val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      add_right(new_val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">include?</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span> <span class=\"keyword\">if</span>(@value == val)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value &gt; val)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@left</span><br><span class=\"line\">      @left.<span class=\"keyword\">include</span>?(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@right</span><br><span class=\"line\">      @right.<span class=\"keyword\">include</span>?(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">update</span><span class=\"params\">(current_value, new_value)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value == current_value)</span><br><span class=\"line\">      @value = new_value</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value &gt; current_value)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@left</span><br><span class=\"line\">      @left.update(current_value, new_value)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@right</span><br><span class=\"line\">      @right.update(current_value, new_value)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add_left</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@left)</span><br><span class=\"line\">      @left.add(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      @left = Node.new(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add_right</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@right)</span><br><span class=\"line\">      @right.add(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      @right = Node.new(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">a = Node.new(<span class=\"number\">5</span>)</span><br><span class=\"line\">puts <span class=\"string\">\"<span class=\"subst\">#&#123;a.value&#125;</span> | <span class=\"subst\">#&#123;a.left ? a.left.value : <span class=\"literal\">nil</span>&#125;</span> | <span class=\"subst\">#&#123;a.right ? a.right.value : <span class=\"literal\">nil</span>&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">a.add(<span class=\"number\">2</span>)</span><br><span class=\"line\">a.add(<span class=\"number\">7</span>)</span><br><span class=\"line\">a.add(<span class=\"number\">9</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">a.get_tree()</span><br><span class=\"line\"></span><br><span class=\"line\">a.update(<span class=\"number\">7</span>, <span class=\"number\">6</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"<span class=\"subst\">#&#123;a.value&#125;</span> | <span class=\"subst\">#&#123;a.left ? a.left.value : <span class=\"literal\">nil</span>&#125;</span> | <span class=\"subst\">#&#123;a.right ? a.right.value : <span class=\"literal\">nil</span>&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">a.get_tree()</span><br><span class=\"line\"></span><br><span class=\"line\">b = a.right</span><br><span class=\"line\">puts <span class=\"string\">\"<span class=\"subst\">#&#123;b.value&#125;</span> | <span class=\"subst\">#&#123;b.left ? b.left.value : <span class=\"literal\">nil</span>&#125;</span> | <span class=\"subst\">#&#123;b.right ? b.right.value : <span class=\"literal\">nil</span>&#125;</span>\"</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/../images/vangcon.jpeg\" alt=\"vang con\"></p>\n<h2 id=\"Init\"><a href=\"#Init\" class=\"headerlink\" title=\"Init\"></a>Init</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:left</span>, <span class=\"symbol\">:right</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    @value = val</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Display-Tree\"><a href=\"#Display-Tree\" class=\"headerlink\" title=\"Display Tree\"></a>Display Tree</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tree</span></span></span><br><span class=\"line\">  puts <span class=\"string\">\"<span class=\"subst\">#&#123;value&#125;</span>\\n\"</span></span><br><span class=\"line\">  @left.get_tree() <span class=\"keyword\">if</span> @left</span><br><span class=\"line\">  @right.get_tree() <span class=\"keyword\">if</span> @right</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Add-Node\"><a href=\"#Add-Node\" class=\"headerlink\" title=\"Add Node\"></a>Add Node</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:left</span>, <span class=\"symbol\">:right</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    @value = val</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(new_val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">if</span> @value == new_val</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value &gt; new_val)</span><br><span class=\"line\">      add_left(new_val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      add_right(new_val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add_left</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@left)</span><br><span class=\"line\">      @left.add(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      @left = Node.new(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add_right</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@right)</span><br><span class=\"line\">      @right.add(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      @right = Node.new(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Check-existing\"><a href=\"#Check-existing\" class=\"headerlink\" title=\"Check existing?\"></a>Check existing?</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:left</span>, <span class=\"symbol\">:right</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    @value = val</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">include?</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span> <span class=\"keyword\">if</span>(@value == val)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value &gt; val)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@left</span><br><span class=\"line\">      @left.<span class=\"keyword\">include</span>?(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@right</span><br><span class=\"line\">      @right.<span class=\"keyword\">include</span>?(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Update-Node\"><a href=\"#Update-Node\" class=\"headerlink\" title=\"Update Node\"></a>Update Node</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">update</span><span class=\"params\">(current_value, new_value)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(@value == current_value)</span><br><span class=\"line\">    @value = new_value</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(@value &gt; current_value)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@left</span><br><span class=\"line\">    @left.update(current_value, new_value)</span><br><span class=\"line\">  <span class=\"keyword\">else</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@right</span><br><span class=\"line\">    @right.update(current_value, new_value)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Get-Depth\"><a href=\"#Get-Depth\" class=\"headerlink\" title=\"Get Depth\"></a>Get Depth</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">max_depth</span><span class=\"params\">(root)</span></span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"number\">0</span> <span class=\"keyword\">if</span> root.<span class=\"literal\">nil</span>?</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [max_depth(root.left), max_depth(root.right)].max + <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Example\"><a href=\"#Example\" class=\"headerlink\" title=\"Example\"></a>Example</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Node</span></span></span><br><span class=\"line\">  <span class=\"keyword\">attr_accessor</span> <span class=\"symbol\">:left</span>, <span class=\"symbol\">:right</span>, <span class=\"symbol\">:value</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    @value = val</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_tree</span></span></span><br><span class=\"line\">    puts <span class=\"string\">\"<span class=\"subst\">#&#123;value&#125;</span>\\n\"</span></span><br><span class=\"line\">    @left.get_tree() <span class=\"keyword\">if</span> @left</span><br><span class=\"line\">    @right.get_tree() <span class=\"keyword\">if</span> @right</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add</span><span class=\"params\">(new_val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">if</span> @value == new_val</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value &gt; new_val)</span><br><span class=\"line\">      add_left(new_val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      add_right(new_val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">include?</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span> <span class=\"keyword\">if</span>(@value == val)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value &gt; val)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@left</span><br><span class=\"line\">      @left.<span class=\"keyword\">include</span>?(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@right</span><br><span class=\"line\">      @right.<span class=\"keyword\">include</span>?(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">update</span><span class=\"params\">(current_value, new_value)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value == current_value)</span><br><span class=\"line\">      @value = new_value</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@value &gt; current_value)</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@left</span><br><span class=\"line\">      @left.update(current_value, new_value)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">false</span> <span class=\"keyword\">if</span> !@right</span><br><span class=\"line\">      @right.update(current_value, new_value)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add_left</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@left)</span><br><span class=\"line\">      @left.add(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      @left = Node.new(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add_right</span><span class=\"params\">(val)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(@right)</span><br><span class=\"line\">      @right.add(val)</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">      @right = Node.new(val)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">a = Node.new(<span class=\"number\">5</span>)</span><br><span class=\"line\">puts <span class=\"string\">\"<span class=\"subst\">#&#123;a.value&#125;</span> | <span class=\"subst\">#&#123;a.left ? a.left.value : <span class=\"literal\">nil</span>&#125;</span> | <span class=\"subst\">#&#123;a.right ? a.right.value : <span class=\"literal\">nil</span>&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">a.add(<span class=\"number\">2</span>)</span><br><span class=\"line\">a.add(<span class=\"number\">7</span>)</span><br><span class=\"line\">a.add(<span class=\"number\">9</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">a.get_tree()</span><br><span class=\"line\"></span><br><span class=\"line\">a.update(<span class=\"number\">7</span>, <span class=\"number\">6</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">puts <span class=\"string\">\"<span class=\"subst\">#&#123;a.value&#125;</span> | <span class=\"subst\">#&#123;a.left ? a.left.value : <span class=\"literal\">nil</span>&#125;</span> | <span class=\"subst\">#&#123;a.right ? a.right.value : <span class=\"literal\">nil</span>&#125;</span>\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">a.get_tree()</span><br><span class=\"line\"></span><br><span class=\"line\">b = a.right</span><br><span class=\"line\">puts <span class=\"string\">\"<span class=\"subst\">#&#123;b.value&#125;</span> | <span class=\"subst\">#&#123;b.left ? b.left.value : <span class=\"literal\">nil</span>&#125;</span> | <span class=\"subst\">#&#123;b.right ? b.right.value : <span class=\"literal\">nil</span>&#125;</span>\"</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Clone Object And Array In JS","date":"2019-12-27T17:00:00.000Z","_content":"\n> Recommend from some developers who have more exp than me: 'Should use LoDash library'\n\n## Why do we have to clone?\n\nIn fact, when we working on our projects, many times we need to get data from an object or an array and use it for some features what we want. In some cases, we need to change data from original object, but some other cases we need a version copy because we must keep original data not change.\n\nSo, in this case, what do you do? Do you ever think we can do it easy by some code below:\n\n```javascript\nlet obj = {name: 'Chinh', age: 25}\n\nlet copy_obj = obj\n```\n\nAnd we now can free to change **copy_obj** without fear of changing **obj**?\n\nSo sad, the above way cannot work right. Why? why it is wrong? Everything same like fine, what's problem we have?\n\n> The problem at here is **Objects(array is an object) are reference types**.\n\nWhat does that mean?\n\nThat mean: Reference types doesn't hold any data, it's only contains a pointer to the value of object in memory.\n\nWhen you use **=**, **copy_obj** will contains a pointer to the value of **obj**. So, if you change anything in **copy_obj** or **obj**, the other variable will change too.\n\n## Clone Object and Array\n> We have many ways to clone an object, but there are three main ways need to know.\n\n1. Use spread syntax.\n\n```javascript\nlet obj = {name: 'Chinh', age: 25}\n\nlet copy_obj = {...obj}\n```\n\n2. Use Object.assign\n\n```javascript\nlet obj = {name: 'Chinh', age: 25}\n\nlet copy_obj = Object.assign({}, obj)\n```\n\n3. Use JSON\n\n```javascript\nlet obj = {name: 'Chinh', age: 25}\n\nlet copy_obj = JSON.parse(JSON.stringify(obj))\n```\n\n> We know in javascript, array is also an object, thus all approach that we use for object above can apply for array too.\n\n## Deep Clone And Shallow Clone\n\n> Deep Clone is mean copy everything to another memory.\n\n> Shallow Clone is mean it's only copy first level of original object to another memory.From second level it's references to original object.\n\n> Use Object.asign or JSON are deep clone. In the most cases, using Object.assign show a lot faster than JSON.\n\n> Use spread is shallow clone.\n\nTake a look to the sample code below to know why use spread is shallow clone:\n\n```javascript\nobj = {\n  name: 'Chinh',\n  age: 25\n  location: {\n    city: 'Saigon'\n  }\n}\n\nclone_obj = {...obj}\n\nclone_obj.name = \"Duy Chinh\"\n\nclone_obj.location.city = \"Nam Dinh\"\n\nconsole.log(obj)\n```\n\nThe result will be:\n\n```javascript\n{\n  name: \"Chinh\",\n  age: 25,\n  location: {\n    city: \"Nam Dinh\"\n  }\n}\n```\n\nCity in original object has changed\n\n## References\n\n[1][https://www.samanthaming.com/tidbits/50-how-to-deep-clone-an-array](https://www.samanthaming.com/tidbits/50-how-to-deep-clone-an-array)\n\n[2][https://www.samanthaming.com/tidbits/70-3-ways-to-clone-objects](https://www.samanthaming.com/tidbits/70-3-ways-to-clone-objects)\n","source":"_posts/2019-12-28-clone-object-and-array-in-javascript.md","raw":"---\ntitle: Clone Object And Array In JS\ndate: 2019-12-28\ntags: [\"JS\"]\n---\n\n> Recommend from some developers who have more exp than me: 'Should use LoDash library'\n\n## Why do we have to clone?\n\nIn fact, when we working on our projects, many times we need to get data from an object or an array and use it for some features what we want. In some cases, we need to change data from original object, but some other cases we need a version copy because we must keep original data not change.\n\nSo, in this case, what do you do? Do you ever think we can do it easy by some code below:\n\n```javascript\nlet obj = {name: 'Chinh', age: 25}\n\nlet copy_obj = obj\n```\n\nAnd we now can free to change **copy_obj** without fear of changing **obj**?\n\nSo sad, the above way cannot work right. Why? why it is wrong? Everything same like fine, what's problem we have?\n\n> The problem at here is **Objects(array is an object) are reference types**.\n\nWhat does that mean?\n\nThat mean: Reference types doesn't hold any data, it's only contains a pointer to the value of object in memory.\n\nWhen you use **=**, **copy_obj** will contains a pointer to the value of **obj**. So, if you change anything in **copy_obj** or **obj**, the other variable will change too.\n\n## Clone Object and Array\n> We have many ways to clone an object, but there are three main ways need to know.\n\n1. Use spread syntax.\n\n```javascript\nlet obj = {name: 'Chinh', age: 25}\n\nlet copy_obj = {...obj}\n```\n\n2. Use Object.assign\n\n```javascript\nlet obj = {name: 'Chinh', age: 25}\n\nlet copy_obj = Object.assign({}, obj)\n```\n\n3. Use JSON\n\n```javascript\nlet obj = {name: 'Chinh', age: 25}\n\nlet copy_obj = JSON.parse(JSON.stringify(obj))\n```\n\n> We know in javascript, array is also an object, thus all approach that we use for object above can apply for array too.\n\n## Deep Clone And Shallow Clone\n\n> Deep Clone is mean copy everything to another memory.\n\n> Shallow Clone is mean it's only copy first level of original object to another memory.From second level it's references to original object.\n\n> Use Object.asign or JSON are deep clone. In the most cases, using Object.assign show a lot faster than JSON.\n\n> Use spread is shallow clone.\n\nTake a look to the sample code below to know why use spread is shallow clone:\n\n```javascript\nobj = {\n  name: 'Chinh',\n  age: 25\n  location: {\n    city: 'Saigon'\n  }\n}\n\nclone_obj = {...obj}\n\nclone_obj.name = \"Duy Chinh\"\n\nclone_obj.location.city = \"Nam Dinh\"\n\nconsole.log(obj)\n```\n\nThe result will be:\n\n```javascript\n{\n  name: \"Chinh\",\n  age: 25,\n  location: {\n    city: \"Nam Dinh\"\n  }\n}\n```\n\nCity in original object has changed\n\n## References\n\n[1][https://www.samanthaming.com/tidbits/50-how-to-deep-clone-an-array](https://www.samanthaming.com/tidbits/50-how-to-deep-clone-an-array)\n\n[2][https://www.samanthaming.com/tidbits/70-3-ways-to-clone-objects](https://www.samanthaming.com/tidbits/70-3-ways-to-clone-objects)\n","slug":"2019-12-28-clone-object-and-array-in-javascript","published":1,"updated":"2022-01-29T09:29:59.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbd003dp3m27o2udrvk","content":"<blockquote>\n<p>Recommend from some developers who have more exp than me: ‘Should use LoDash library’</p>\n</blockquote>\n<h2 id=\"Why-do-we-have-to-clone\"><a href=\"#Why-do-we-have-to-clone\" class=\"headerlink\" title=\"Why do we have to clone?\"></a>Why do we have to clone?</h2><p>In fact, when we working on our projects, many times we need to get data from an object or an array and use it for some features what we want. In some cases, we need to change data from original object, but some other cases we need a version copy because we must keep original data not change.</p>\n<p>So, in this case, what do you do? Do you ever think we can do it easy by some code below:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Chinh'</span>, <span class=\"attr\">age</span>: <span class=\"number\">25</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> copy_obj = obj</span><br></pre></td></tr></table></figure>\n\n<p>And we now can free to change <strong>copy_obj</strong> without fear of changing <strong>obj</strong>?</p>\n<p>So sad, the above way cannot work right. Why? why it is wrong? Everything same like fine, what’s problem we have?</p>\n<blockquote>\n<p>The problem at here is <strong>Objects(array is an object) are reference types</strong>.</p>\n</blockquote>\n<p>What does that mean?</p>\n<p>That mean: Reference types doesn’t hold any data, it’s only contains a pointer to the value of object in memory.</p>\n<p>When you use <strong>=</strong>, <strong>copy_obj</strong> will contains a pointer to the value of <strong>obj</strong>. So, if you change anything in <strong>copy_obj</strong> or <strong>obj</strong>, the other variable will change too.</p>\n<h2 id=\"Clone-Object-and-Array\"><a href=\"#Clone-Object-and-Array\" class=\"headerlink\" title=\"Clone Object and Array\"></a>Clone Object and Array</h2><blockquote>\n<p>We have many ways to clone an object, but there are three main ways need to know.</p>\n</blockquote>\n<ol>\n<li>Use spread syntax.</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Chinh'</span>, <span class=\"attr\">age</span>: <span class=\"number\">25</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> copy_obj = &#123;...obj&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>Use Object.assign</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Chinh'</span>, <span class=\"attr\">age</span>: <span class=\"number\">25</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> copy_obj = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, obj)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>Use JSON</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Chinh'</span>, <span class=\"attr\">age</span>: <span class=\"number\">25</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> copy_obj = <span class=\"built_in\">JSON</span>.parse(<span class=\"built_in\">JSON</span>.stringify(obj))</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>We know in javascript, array is also an object, thus all approach that we use for object above can apply for array too.</p>\n</blockquote>\n<h2 id=\"Deep-Clone-And-Shallow-Clone\"><a href=\"#Deep-Clone-And-Shallow-Clone\" class=\"headerlink\" title=\"Deep Clone And Shallow Clone\"></a>Deep Clone And Shallow Clone</h2><blockquote>\n<p>Deep Clone is mean copy everything to another memory.</p>\n</blockquote>\n<blockquote>\n<p>Shallow Clone is mean it’s only copy first level of original object to another memory.From second level it’s references to original object.</p>\n</blockquote>\n<blockquote>\n<p>Use Object.asign or JSON are deep clone. In the most cases, using Object.assign show a lot faster than JSON.</p>\n</blockquote>\n<blockquote>\n<p>Use spread is shallow clone.</p>\n</blockquote>\n<p>Take a look to the sample code below to know why use spread is shallow clone:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'Chinh'</span>,</span><br><span class=\"line\">  age: <span class=\"number\">25</span></span><br><span class=\"line\">  location: &#123;</span><br><span class=\"line\">    city: <span class=\"string\">'Saigon'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">clone_obj = &#123;...obj&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">clone_obj.name = <span class=\"string\">\"Duy Chinh\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">clone_obj.location.city = <span class=\"string\">\"Nam Dinh\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(obj)</span><br></pre></td></tr></table></figure>\n\n<p>The result will be:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  name: <span class=\"string\">\"Chinh\"</span>,</span><br><span class=\"line\">  age: <span class=\"number\">25</span>,</span><br><span class=\"line\">  location: &#123;</span><br><span class=\"line\">    city: <span class=\"string\">\"Nam Dinh\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>City in original object has changed</p>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><p>[1]<a href=\"https://www.samanthaming.com/tidbits/50-how-to-deep-clone-an-array\" target=\"_blank\" rel=\"noopener\">https://www.samanthaming.com/tidbits/50-how-to-deep-clone-an-array</a></p>\n<p>[2]<a href=\"https://www.samanthaming.com/tidbits/70-3-ways-to-clone-objects\" target=\"_blank\" rel=\"noopener\">https://www.samanthaming.com/tidbits/70-3-ways-to-clone-objects</a></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Recommend from some developers who have more exp than me: ‘Should use LoDash library’</p>\n</blockquote>\n<h2 id=\"Why-do-we-have-to-clone\"><a href=\"#Why-do-we-have-to-clone\" class=\"headerlink\" title=\"Why do we have to clone?\"></a>Why do we have to clone?</h2><p>In fact, when we working on our projects, many times we need to get data from an object or an array and use it for some features what we want. In some cases, we need to change data from original object, but some other cases we need a version copy because we must keep original data not change.</p>\n<p>So, in this case, what do you do? Do you ever think we can do it easy by some code below:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Chinh'</span>, <span class=\"attr\">age</span>: <span class=\"number\">25</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> copy_obj = obj</span><br></pre></td></tr></table></figure>\n\n<p>And we now can free to change <strong>copy_obj</strong> without fear of changing <strong>obj</strong>?</p>\n<p>So sad, the above way cannot work right. Why? why it is wrong? Everything same like fine, what’s problem we have?</p>\n<blockquote>\n<p>The problem at here is <strong>Objects(array is an object) are reference types</strong>.</p>\n</blockquote>\n<p>What does that mean?</p>\n<p>That mean: Reference types doesn’t hold any data, it’s only contains a pointer to the value of object in memory.</p>\n<p>When you use <strong>=</strong>, <strong>copy_obj</strong> will contains a pointer to the value of <strong>obj</strong>. So, if you change anything in <strong>copy_obj</strong> or <strong>obj</strong>, the other variable will change too.</p>\n<h2 id=\"Clone-Object-and-Array\"><a href=\"#Clone-Object-and-Array\" class=\"headerlink\" title=\"Clone Object and Array\"></a>Clone Object and Array</h2><blockquote>\n<p>We have many ways to clone an object, but there are three main ways need to know.</p>\n</blockquote>\n<ol>\n<li>Use spread syntax.</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Chinh'</span>, <span class=\"attr\">age</span>: <span class=\"number\">25</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> copy_obj = &#123;...obj&#125;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li>Use Object.assign</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Chinh'</span>, <span class=\"attr\">age</span>: <span class=\"number\">25</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> copy_obj = <span class=\"built_in\">Object</span>.assign(&#123;&#125;, obj)</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>Use JSON</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;<span class=\"attr\">name</span>: <span class=\"string\">'Chinh'</span>, <span class=\"attr\">age</span>: <span class=\"number\">25</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> copy_obj = <span class=\"built_in\">JSON</span>.parse(<span class=\"built_in\">JSON</span>.stringify(obj))</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>We know in javascript, array is also an object, thus all approach that we use for object above can apply for array too.</p>\n</blockquote>\n<h2 id=\"Deep-Clone-And-Shallow-Clone\"><a href=\"#Deep-Clone-And-Shallow-Clone\" class=\"headerlink\" title=\"Deep Clone And Shallow Clone\"></a>Deep Clone And Shallow Clone</h2><blockquote>\n<p>Deep Clone is mean copy everything to another memory.</p>\n</blockquote>\n<blockquote>\n<p>Shallow Clone is mean it’s only copy first level of original object to another memory.From second level it’s references to original object.</p>\n</blockquote>\n<blockquote>\n<p>Use Object.asign or JSON are deep clone. In the most cases, using Object.assign show a lot faster than JSON.</p>\n</blockquote>\n<blockquote>\n<p>Use spread is shallow clone.</p>\n</blockquote>\n<p>Take a look to the sample code below to know why use spread is shallow clone:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">obj = &#123;</span><br><span class=\"line\">  name: <span class=\"string\">'Chinh'</span>,</span><br><span class=\"line\">  age: <span class=\"number\">25</span></span><br><span class=\"line\">  location: &#123;</span><br><span class=\"line\">    city: <span class=\"string\">'Saigon'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">clone_obj = &#123;...obj&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">clone_obj.name = <span class=\"string\">\"Duy Chinh\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">clone_obj.location.city = <span class=\"string\">\"Nam Dinh\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(obj)</span><br></pre></td></tr></table></figure>\n\n<p>The result will be:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  name: <span class=\"string\">\"Chinh\"</span>,</span><br><span class=\"line\">  age: <span class=\"number\">25</span>,</span><br><span class=\"line\">  location: &#123;</span><br><span class=\"line\">    city: <span class=\"string\">\"Nam Dinh\"</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>City in original object has changed</p>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><p>[1]<a href=\"https://www.samanthaming.com/tidbits/50-how-to-deep-clone-an-array\" target=\"_blank\" rel=\"noopener\">https://www.samanthaming.com/tidbits/50-how-to-deep-clone-an-array</a></p>\n<p>[2]<a href=\"https://www.samanthaming.com/tidbits/70-3-ways-to-clone-objects\" target=\"_blank\" rel=\"noopener\">https://www.samanthaming.com/tidbits/70-3-ways-to-clone-objects</a></p>\n"},{"title":"Metaprograming Ruby 2","date":"2019-09-20T17:00:00.000Z","draft":false,"label":"#book","_content":"\n## IMAGES\n\n![hoa](/images/meta2/1.png)\n\n![hoa](/images/meta2/2.png)\n\n![hoa](/images/meta2/3.png)\n\n![hoa](/images/meta2/4.png)\n\n![hoa](/images/meta2/5.png)\n\n<!-- ![hoa](/images/meta2/6.png) -->\n\n![hoa](/images/meta2/7.png)\n\n![hoa](/images/meta2/8.png)\n\n![hoa](/images/meta2/9.png)\n\n\n\n## RUBY OBJECT MODEL\n\n### Open Classes\n\n\n**rails g model Movie title:string director:string**\n\n```ruby\nclass Movie < ActiveRecord:Base; end\n```\n\n1) What about methods such as **title=** and title, which access object attributes (accessor methods for short)? This is where metaprogramming comes in: Bob doesn’t have to write those methods. Active Record defines them automatically, after inferring their names from the database schema. ActiveRecord::Base reads the schema at runtime, discovers that the movies table has two columns named title and director, and defines accessor methods for two attributes of the same name. This means that Active Record defines methods such as **Movie#title** and **Movie#director=** out of thin air while the program runs.\n\nOpen Class\n```ruby\nclass Numeric\n  def to_money(currency = nil)\n    Money.from_numeric(self, currency || Money.default_currency)\n  end\nend\n```\n\n2) As cool as they are, however, Open Classes have a dark side—one that you’re about to experience.\n\n| This can override the method of superclass and make wrong result in somewhere (monkeypath). So we need be careful when set the name for the override method.\n\n### Inside the Object Model\n\n3) Objects that share the same class also share the same methods, so the methods must be stored in the class, not the object.\n\n4) The \"false\" argument here means: ignore inherited methods Class.instance_methods(false) # => [:allocate, :new, :superclass]\n\n5) The superclass of Class is Module—which is to say, every class is also a module.\nTo be precise, a class is a module with three additional instance methods (new, allocate, and superclass)\n\n6) All the constants in a program are arranged in a tree similar to a file system.\n\n7) The Module class also provides an instance method and a class method that, confusingly, are both called constants.\n\n8) What’s an object? It’s a bunch of instance variables, plus a link to a class. The object’s methods don’t live in the object—they live in the object’s class, where they’re called the instance methods of the class.\n\n9) What’s a class? It’s an object (an instance of Class), plus a list of instance methods and a link to a superclass. Class is a subclass of Module, so a class is also a module\n\n10) These are instance methods of the Class class. Like any object, a class has its own methods, such as new. Also like any object, classes must be accessed through references. You already have a constant reference to each class: the class’s name.\n\n11) Using load, however, has a side effect. The motd.rb file probably defines variables and classes. Although variables fall out of scope when the file has finished loading, constants don’t. As a result, motd.rb can pollute your program with the names of its own constants—in particular, class names. You can force motd.rb to keep its constants to itself by passing a second, optional argument to load: **load('motd.rb', true)** If you load a file this way, Ruby creates **an anonymous module**, uses that module as a Namespace to contain all the constants from motd.rb, and then destroys the module. The require method is quite similar to load, but it’s meant for a different purpose. You use load to execute code, and you use require to import libraries. That’s why require has no second argument: those leftover class names are probably the reason why you imported the file in the first place. Also, that’s why require tries only once to load each file, while load executes the file again every time you call it.\n\nWhat’s the class of Object?\nWhat’s the superclass of Module?\nWhat’s the class of Class?\n\n### What Happens When You Call a Method?\n\n12) When you call a method, Ruby does two things:\n1. It finds the method. This is a process called method lookup.\n2. It executes the method. To do that, Ruby needs something called self.\n\n13) Before you look at a more complicated example, though, you need to know about two new concepts: the receiver and the ancestors chain.The receiver is the object that you call a method on. For example, if you write **my_string.reverse()**, then **my_string** is the receiver. To understand the concept of an ancestors chain, look at any Ruby class. Then imagine moving from the class into its superclass, then into the superclass’s superclass, and so on, until you reach BasicObject, the root of the Ruby class hierarchy. The path of classes you just traversed is the ancestors chain of the class.\nMySubclass.ancestors # => [MySubclass, MyClass, Object, Kernel, BasicObject]\n\n14) When you include a module in a class (or even in another module), Ruby inserts the module in the ancestors chain, right above the including class itself:\n\n15) Starting from Ruby 2.0, you also have a second way to insert a module in a class’s chain of ancestors: **the prepend method**. It works like include, but it inserts the module below the including class (sometimes called the includer).\n\n```ruby\nclass C2\n prepend M2\nend\nclass D2 < C2; end\nD2.ancestors # => [D2, M2, C2, Object, Kernel, BasicObject]\n```\n\n16) This is true every time you include or prepend a module: if that module is already in the chain, Ruby silently ignores the second inclusion.\n\nKernel.private_instance_methods.grep(/^pr/) # => [:printf, :print, :proc]\n\n17) The trick here is that class Object includes Kernel, so Kernel gets into every object’s ancestors chain. Every line of Ruby is always executed inside an object, so you can call the instance methods in Kernel from anywhere.\n\n18) You can take advantage of this mechanism yourself: if you add a method to Spell: Kernel Method Kernel, this Kernel Method will be available to all objects. To prove that Kernel Methods are actually useful, you can look at the way some Ruby libraries use them.\n\n19) Every line of Ruby code is executed inside an object—the so-called current object. The current object is also known as self, because you can access it with the self keyword.\n\n20) Only one object can take the role of self at a given time, but no object holds that role for a long time. In particular, when you call a method, the receiver becomes self. From that moment on, all instance variables are instance variables of self, and all methods called without an explicit receiver are called on self.\n\n21) As soon as you start a Ruby program, you’re sitting within an object named main that the Ruby interpreter created for you. This object is sometimes called the top-level context, because it’s the object you’re in when you’re at the top level of the call stack: either you haven’t called any method yet or all the methods that you called have returned.\n\n22) This code refines the String class with a new to_alphanumeric method. Differently from a regular Open Class, however, a Refinement is not active by default. If you try to call   **String#to_alphanumeric**, you’ll get an error: **\"my *1st* refinement!\".to_alphanumeric ❮ NoMethodError: undefined method 'to_alphanumeric' [...]** To activate the changes, you have to do so explicitly, with the using method: using StringExtensions\n\n23) you can call refine in a regular module, but you cannot call it in a class, even if a class is itself a module.\n\n## METHODS\n\n### Dynamic Methods\n\n24) If that kind of breaching of encapsulation makes you uneasy, you can use public_send instead. It’s like send, but it makes a point of respecting the receiver’s privacy. Be prepared, however, for the fact that Ruby code in the wild rarely bothers with this concern. If anything, a lot of Ruby programmers use send exactly because it allows calling private methods, not in spite of that\n\n```ruby\nclass DS\n  def initialize # connect to data source...\n  def get_cpu_info(workstation_id) # ...\n  def get_cpu_price(workstation_id) # ...\n  def get_mouse_info(workstation_id) # ...\n  def get_mouse_price(workstation_id) # ...\n  def get_keyboard_info(workstation_id) # ...\n  def get_keyboard_price(workstation_id) # ...\n  def get_display_info(workstation_id) # ...\n  def get_display_price(workstation_id) # ...\n  # ...and so on\nend\n```\n\n```ruby\nclass Computer\n  def initialize(computer_id, data_source)\n    @id = computer_id\n    @data_source = data_source\n  end\n  \n  def mouse\n    info = @data_source.get_mouse_info(@id)\n    price = @data_source.get_mouse_price(@id)\n    result = \"Mouse: #{info} ($#{price})\"\n    return \"* #{result}\" if price >= 100\n    result\n  end\n   \n  def cpu\n    info = @data_source.get_cpu_info(@id)\n    price = @data_source.get_cpu_price(@id)\n    result = \"Cpu: #{info} ($#{price})\"\n    return \"* #{result}\" if price >= 100\n    result\n  end\n    \n  def keyboard\n    info = @data_source.get_keyboard_info(@id)\n    price = @data_source.get_keyboard_price(@id)\n    result = \"Keyboard: #{info} ($#{price})\"\n    return \"* #{result}\" if price >= 100\n    result\n  end\n   # ...\nend\n```\n\nDYNAMIC DISPATCH\n\n```ruby\nclass Computer\n  def initialize(computer_id, data_source)\n  @id = computer_id\n  @data_source = data_source\n  end\n  \n  def mouse\n    component :mouse\n  end\n\n  def cpu\n    component :cpu\n  end\n    \n  def keyboard\n    component :keyboard\n  end\n    \n  def component(name)\n    info = @data_source.send \"get_#{name}_info\", @id\n    price = @data_source.send \"get_#{name}_price\", @id\n    result = \"#{name.capitalize}: #{info} ($#{price})\"\n    return \"* #{result}\" if price >= 100\n    result\n  end\nend\n```\n\nDYNAMIC METHOD\n\n```ruby\nclass Computer\n  def initialize(computer_id, data_source)\n    @id = computer_id\n    @data_source = data_source\n  end\n  \n  def self.define_component(name)\n    define_method(name) do\n      info = @data_source.send \"get_#{name}_info\", @id\n      price = @data_source.send \"get_#{name}_price\", @id\n      result = \"#{name.capitalize}: #{info} ($#{price})\"\n      return \"* #{result}\" if price >= 100\n      result\n    end\n  end\n     \n  define_component :mouse\n  define_component :cpu\n  define_component :keyboard\nend\n\n```\n\nBEST WAY\n\n```ruby\nclass Computer\n  def initialize(computer_id, data_source)\n    @id = computer_id\n    @data_source = data_source\n    data_source.methods.grep(/^get_(.*)_info$/) { Computer.define_component $1 }\n  end\n    \n  def self.define_component(name)\n    define_method(name) do\n      # ...\n    end\n  end\nend\n```\n\n### method_missing\n\n25) The Hashie gem contains a little bit of magic called Hashie::Mash. A Mash is a more powerful version of Ruby’s standard OpenStruct class: a hash-like object whose attributes work like Ruby variables. If you want a new attribute, just assign a value to the attribute, and it will spring into existence:\n\n```ruby\nrequire 'hashie'\nicecream = Hashie::Mash.new\nicecream.flavor = \"strawberry\"\nicecream.flavor # => \"strawberry\"\n```\n\nWhat hanppen inside?\n\n```ruby\nmodule Hashie\n  class Mash < Hashie::Hash\n    def method_missing(method_name, *args, &blk)\n      return self.[](method_name, &blk) if key?(method_name)\n      match = method_name.to_s.match(/(.*?)([?=!]?)$/)\n      case match[2]\n      when \"=\"\n      self[match[1]] = args.first\n      # ...\n      else\n      default(method_name, *args, &blk)\n      end\n    end\n    # ...\n  end\nend\n```\n\n26) **Ghost Methods** (57) are usually icing on the cake, but some objects actually rely almost exclusively on them. These objects are often wrappers for something else—maybe another object, a web service, or code written in a different language. They collect method calls through method_missing and forward them to the wrapped object. Let’s look at a complex real-life example.\n\nRefactor:\n\n```ruby\nclass Computer\n  def initialize(computer_id, data_source)\n    @id = computer_id\n    @data_source = data_source\n  end\n  \n  def method_missing(name)\n    super if !@data_source.respond_to?(\"get_#{name}_info\")\n    info = @data_source.send(\"get_#{name}_info\", @id)\n    price = @data_source.send(\"get_#{name}_price\", @id)\n    result = \"#{name.capitalize}: #{info} ($#{price})\"\n    return \"* #{result}\" if price >= 100\n    result\n  end\nend\n```\n\n27) Khi dùng ghost method, giả sử trong method_missing chúng ta muốn tạo ra 1 method x, tuy nhiên x lại có trong cây kế thừa => x trong method missing sẽ không được gọi. Lúc này ta cần Blank Slates.\n\n### Blank Slates\n\n28) If you don’t need the inherited method, you can fix the problem by removing it. While you’re at it, you might want to remove most methods from the class, preventing such name clashes from ever happening again. A skinny class Spell: Blank Slate with a minimal number of methods is called a Blank Slate. As it turns out, Ruby has a ready-made Blank Slate for you to use\n\n29) If you don’t specify a superclass, your classes inherit by default from Object, which is itself a subclass of BasicObject. If you want a Blank Slate (66), you can inherit directly from BasicObject instead. For example, if Computer inherited directly from BasicObject, then it wouldn’t have a problematic display method.\n=> không lấy nhầm method trong class Object, vì lớp Computer được kế thừa trực tiếp từ BasicObject\n\n30) Inheriting from BasicObject is the quicker way to define a Blank Slate in Ruby.\n**class Computer < BasicObject**\n\n31) You can remove a method from a class by using either Module#undef_method or Module#remove_method. The drastic undef_method removes any method, including the inherited ones. The kinder remove_method removes the method from the receiver, but it leaves inherited methods alone. Let’s look at a real-life library that uses undef_method to create a Blank Slate.\n\n```ruby\nclass BlankSlate\n  # Hide the method named +name+ in the BlankSlate class. Don't\n  # hide +instance_eval+ or any method beginning with \"__\".\n  def self.hide(name)\n    # ...\n    if instance_methods.include?(name._blankslate_as_name) &&\n      name !~ /^(__|instance_eval$)/\n      undef_method name\n    end\n  end\n  # ...\n  instance_methods.each { |m| hide(m) }\nend\n```\n\n32) **use Dynamic Methods if you can and Ghost Methods if you have to**\n\n\n## BLOCKS\n\n### Blocks Are Closures\n\n```ruby\ndef my_method\n  x = \"Goodbye\"\n  yield(\"cruel\")\nend\n\nx = \"Hello\"\nmy_method {|y| \"#{x}, #{y} world\" } # => \"Hello, cruel world\"\n```\n\n33) When you create the block, you capture the local bindings, such as x. Then you pass the block to a method that has its own separate set of bindings. In the previous example, those bindings also include a variable named x. Still, the code in the block sees the x that was around when the block was defined, not the method’s x, which is not visible at all in the block.\n\n34) khi gọi 1 block, nó lưu vết lại các ràng buộc cục bộ nơi block được gọi, sau đó block được truyền cho 1 method, mà method đó sẽ có các ràng cuộc cục bộ của riêng nó, và block sẽ sử dụng ràng buộc của mình (ví dụ như biến x ở trên).\n\n```ruby\ndef just_yield\n  yield\nend\n\ntop_level_variable = 1\njust_yield do\n  top_level_variable += 1\n  local_to_block = 1\nend\n\ntop_level_variable # => 2\nlocal_to_block # => Error!\n```\nTrong ví dụ này thì local_to_block là 1 binding thuộc block, và ra ngoài ngữ cảnh block nó không có giá trị.\n\n35) This example shows how scope changes as your program runs, tracking the names of bindings with the Kernel#local_variables method:\n\n```ruby\nv1 = 1\n\nclass MyClass\n  v2 = 2\n  local_variables # => [:v2]\n  def my_method\n    v3 = 3\n    local_variables\n  end\n  local_variables # => [:v2]\nend\n  \nobj = MyClass.new\nobj.my_method # => [:v3]\nobj.my_method # => [:v3]\nlocal_variables # => [:v1, :obj]\n```\n\n36) There are exactly three places where a program leaves the previous scope behind and opens a new one:\nClass definitions\nModule definitions\nMethods\n\n37) Scope changes whenever the program enters (or exits) a class or module definition or a method. These three borders are marked by the keywords class, module, and def, respectively. Each of these keywords acts like a **Scope Gate**.\n\n```ruby\nv1 = 1\nclass MyClass # SCOPE GATE: entering class\n  v2 = 2\n  local_variables # => [\"v2\"]\n  def my_method # SCOPE GATE: entering def\n    v3 = 3\n    local_variables\n  end # SCOPE GATE: leaving def\n  \n  local_variables # => [\"v2\"]\nend # SCOPE GATE: leaving class\n  \nobj = MyClass.new\nobj.my_method # => [:v3]\nlocal_variables # => [:v1, :obj]\n```\n\n```ruby\nmy_var = \"Success\"\n  \nMyClass = Class.new do\n  \"#{my_var} in the class definition\"\n  \n  define_method :my_method do\n    \"#{my_var} in the method\"\n  end\nend\n```\n\nkhai báo thông thường thì my_var không thể sử dụng trong class hoặc def (vì nó mở ra  1 scope mới). Nên dùng call method gọi là **flat scope**.\n\n38) If you replace Scope Gates with method calls, you allow one scope to see variables from another scope. Technically, this trick should be called nested lexical scopes, but many Ruby coders refer to it simply as “flattening the scope,” meaning that the two scopes share variables as if the scopes were squeezed together. For short, you can call this spell a Flat Scope.\n\n39) Once you know about Flat Scopes (83), you can do pretty much whatever you want with scopes. For example, assume that you want to share a variable among a few methods, and you don’t want anybody else to see that variable. You can do that by defining all the methods in the same Flat Scope as the variable:\n\n```ruby\ndef define_methods\n  shared = 0\n  Kernel.send :define_method, :counter do\n    shared\n  end\n\n  Kernel.send :define_method, :inc do |x|\n    shared += x\n  end\nend\n\nMuốn chỉ share variable cho 1 vài method nhất định, dùng các phương thức support bởi kernel và gọi đây là **Flat Scope**.\n\n```\n\n### instance_eval()\n\n```ruby\nv = 2\nobj.instance_eval { @v = v }\nobj.instance_eval { @v } # => 2\n```\n\n40) The three lines in the previous example are evaluated in the same Flat Scope (83), so they can all access the local variable v—but the blocks are evaluated with the object as self, so they can also access obj’s instance variable @v. In all these cases, you can call the block that you pass to instance_eval a Context Probe, because it’s like a snippet of code that you dip inside an object to do Spell: Context Probe something in there\n\n41) To solve this problem Ruby provides the standard library class Proc. \nA Proc isa block that has been turned into an object. You can create a Proc by passing\nthe block to Proc.new\n\n### Callable Objects\n\n42) To attach a binding to the block, you can add one special argument to the method. This argument must be the last in the list of arguments and prefixed by an & sign.\n\n```ruby\ndef my_method(&the_proc)\n  the_proc\nend\n    \np = my_method {|name| \"Hello, #{name}!\" }\np.class # => Proc\np.call(\"Bill\") # => \"Hello, Bill!\"\n\n\ndef my_method(greeting)\n  \"#{greeting}, #{yield}!\"\nend\n    \nmy_proc = proc { \"Bill\" }\nmy_method(\"Hello\", &my_proc)\n```\nWhen you call my_method, the & converts my_proc to a block and passes that block to the method.\n\n43) There are two differences between procs and lambdas. One has to do with the return keyword, and the other concerns the checking of arguments.\n\nIn a lambda, return just returns from the lambda.\nIn a proc, return behaves differently. Rather than return from the proc, it returns from the scope where the proc itself was defined:\n\nlambdas tend to be less tolerant than procs (and regular blocks) when it comes to arguments. Call a lambda with the wrong arity, and it fails with an ArgumentError. On the other hand, a proc fits the argument list to its own expectations:\n\n```ruby\nclass MyClass\n  def initialize(value)\n    @x = value\n  end\n    \n  def my_method\n    @x\n  end\nend\n    \nobject = MyClass.new(1)\nm = object.method :my_method\nm.call # => 1\n```\n\n44) By calling Kernel#method, you get the method itself as a Method object, which you can later execute with Method#call.\n\n### Writing a Domain-Specific Language\n\nN/A\n\n## CLASS DEFINITIONS\n\n### Class Definitions Demystified\n\n### Singleton Methods\n\n### Singleton Classes\n\n### Method Wrappers\n\n45) At the top level of your program, the current class is Object, the class of main. (**That’s why, if you define a method at the top level, that method becomes an instance method of Object.**)\n\n46) Module#class_eval is very different from BasicObject#instance_eval, which you learned about earlier in instance_eval(), on page 85. instance_eval only changes self, **while class_eval changes both self and the current class.**\n\n```ruby\ndef add_method_to(a_class)\n  a_class.class_eval do\n    def m; 'Hello!'; end\n  end\nend\n\nadd_method_to String\n\"abc\".m # => \"Hello!\"\n```\n","source":"_posts/2019-8-10-meta-programming-ruby.md","raw":"---\ntitle: \"Metaprograming Ruby 2\"\ndate: 2019-09-21\ndraft: false\ntags: [\"NOTES\"]\nlabel: \"#book\"\n---\n\n## IMAGES\n\n![hoa](/images/meta2/1.png)\n\n![hoa](/images/meta2/2.png)\n\n![hoa](/images/meta2/3.png)\n\n![hoa](/images/meta2/4.png)\n\n![hoa](/images/meta2/5.png)\n\n<!-- ![hoa](/images/meta2/6.png) -->\n\n![hoa](/images/meta2/7.png)\n\n![hoa](/images/meta2/8.png)\n\n![hoa](/images/meta2/9.png)\n\n\n\n## RUBY OBJECT MODEL\n\n### Open Classes\n\n\n**rails g model Movie title:string director:string**\n\n```ruby\nclass Movie < ActiveRecord:Base; end\n```\n\n1) What about methods such as **title=** and title, which access object attributes (accessor methods for short)? This is where metaprogramming comes in: Bob doesn’t have to write those methods. Active Record defines them automatically, after inferring their names from the database schema. ActiveRecord::Base reads the schema at runtime, discovers that the movies table has two columns named title and director, and defines accessor methods for two attributes of the same name. This means that Active Record defines methods such as **Movie#title** and **Movie#director=** out of thin air while the program runs.\n\nOpen Class\n```ruby\nclass Numeric\n  def to_money(currency = nil)\n    Money.from_numeric(self, currency || Money.default_currency)\n  end\nend\n```\n\n2) As cool as they are, however, Open Classes have a dark side—one that you’re about to experience.\n\n| This can override the method of superclass and make wrong result in somewhere (monkeypath). So we need be careful when set the name for the override method.\n\n### Inside the Object Model\n\n3) Objects that share the same class also share the same methods, so the methods must be stored in the class, not the object.\n\n4) The \"false\" argument here means: ignore inherited methods Class.instance_methods(false) # => [:allocate, :new, :superclass]\n\n5) The superclass of Class is Module—which is to say, every class is also a module.\nTo be precise, a class is a module with three additional instance methods (new, allocate, and superclass)\n\n6) All the constants in a program are arranged in a tree similar to a file system.\n\n7) The Module class also provides an instance method and a class method that, confusingly, are both called constants.\n\n8) What’s an object? It’s a bunch of instance variables, plus a link to a class. The object’s methods don’t live in the object—they live in the object’s class, where they’re called the instance methods of the class.\n\n9) What’s a class? It’s an object (an instance of Class), plus a list of instance methods and a link to a superclass. Class is a subclass of Module, so a class is also a module\n\n10) These are instance methods of the Class class. Like any object, a class has its own methods, such as new. Also like any object, classes must be accessed through references. You already have a constant reference to each class: the class’s name.\n\n11) Using load, however, has a side effect. The motd.rb file probably defines variables and classes. Although variables fall out of scope when the file has finished loading, constants don’t. As a result, motd.rb can pollute your program with the names of its own constants—in particular, class names. You can force motd.rb to keep its constants to itself by passing a second, optional argument to load: **load('motd.rb', true)** If you load a file this way, Ruby creates **an anonymous module**, uses that module as a Namespace to contain all the constants from motd.rb, and then destroys the module. The require method is quite similar to load, but it’s meant for a different purpose. You use load to execute code, and you use require to import libraries. That’s why require has no second argument: those leftover class names are probably the reason why you imported the file in the first place. Also, that’s why require tries only once to load each file, while load executes the file again every time you call it.\n\nWhat’s the class of Object?\nWhat’s the superclass of Module?\nWhat’s the class of Class?\n\n### What Happens When You Call a Method?\n\n12) When you call a method, Ruby does two things:\n1. It finds the method. This is a process called method lookup.\n2. It executes the method. To do that, Ruby needs something called self.\n\n13) Before you look at a more complicated example, though, you need to know about two new concepts: the receiver and the ancestors chain.The receiver is the object that you call a method on. For example, if you write **my_string.reverse()**, then **my_string** is the receiver. To understand the concept of an ancestors chain, look at any Ruby class. Then imagine moving from the class into its superclass, then into the superclass’s superclass, and so on, until you reach BasicObject, the root of the Ruby class hierarchy. The path of classes you just traversed is the ancestors chain of the class.\nMySubclass.ancestors # => [MySubclass, MyClass, Object, Kernel, BasicObject]\n\n14) When you include a module in a class (or even in another module), Ruby inserts the module in the ancestors chain, right above the including class itself:\n\n15) Starting from Ruby 2.0, you also have a second way to insert a module in a class’s chain of ancestors: **the prepend method**. It works like include, but it inserts the module below the including class (sometimes called the includer).\n\n```ruby\nclass C2\n prepend M2\nend\nclass D2 < C2; end\nD2.ancestors # => [D2, M2, C2, Object, Kernel, BasicObject]\n```\n\n16) This is true every time you include or prepend a module: if that module is already in the chain, Ruby silently ignores the second inclusion.\n\nKernel.private_instance_methods.grep(/^pr/) # => [:printf, :print, :proc]\n\n17) The trick here is that class Object includes Kernel, so Kernel gets into every object’s ancestors chain. Every line of Ruby is always executed inside an object, so you can call the instance methods in Kernel from anywhere.\n\n18) You can take advantage of this mechanism yourself: if you add a method to Spell: Kernel Method Kernel, this Kernel Method will be available to all objects. To prove that Kernel Methods are actually useful, you can look at the way some Ruby libraries use them.\n\n19) Every line of Ruby code is executed inside an object—the so-called current object. The current object is also known as self, because you can access it with the self keyword.\n\n20) Only one object can take the role of self at a given time, but no object holds that role for a long time. In particular, when you call a method, the receiver becomes self. From that moment on, all instance variables are instance variables of self, and all methods called without an explicit receiver are called on self.\n\n21) As soon as you start a Ruby program, you’re sitting within an object named main that the Ruby interpreter created for you. This object is sometimes called the top-level context, because it’s the object you’re in when you’re at the top level of the call stack: either you haven’t called any method yet or all the methods that you called have returned.\n\n22) This code refines the String class with a new to_alphanumeric method. Differently from a regular Open Class, however, a Refinement is not active by default. If you try to call   **String#to_alphanumeric**, you’ll get an error: **\"my *1st* refinement!\".to_alphanumeric ❮ NoMethodError: undefined method 'to_alphanumeric' [...]** To activate the changes, you have to do so explicitly, with the using method: using StringExtensions\n\n23) you can call refine in a regular module, but you cannot call it in a class, even if a class is itself a module.\n\n## METHODS\n\n### Dynamic Methods\n\n24) If that kind of breaching of encapsulation makes you uneasy, you can use public_send instead. It’s like send, but it makes a point of respecting the receiver’s privacy. Be prepared, however, for the fact that Ruby code in the wild rarely bothers with this concern. If anything, a lot of Ruby programmers use send exactly because it allows calling private methods, not in spite of that\n\n```ruby\nclass DS\n  def initialize # connect to data source...\n  def get_cpu_info(workstation_id) # ...\n  def get_cpu_price(workstation_id) # ...\n  def get_mouse_info(workstation_id) # ...\n  def get_mouse_price(workstation_id) # ...\n  def get_keyboard_info(workstation_id) # ...\n  def get_keyboard_price(workstation_id) # ...\n  def get_display_info(workstation_id) # ...\n  def get_display_price(workstation_id) # ...\n  # ...and so on\nend\n```\n\n```ruby\nclass Computer\n  def initialize(computer_id, data_source)\n    @id = computer_id\n    @data_source = data_source\n  end\n  \n  def mouse\n    info = @data_source.get_mouse_info(@id)\n    price = @data_source.get_mouse_price(@id)\n    result = \"Mouse: #{info} ($#{price})\"\n    return \"* #{result}\" if price >= 100\n    result\n  end\n   \n  def cpu\n    info = @data_source.get_cpu_info(@id)\n    price = @data_source.get_cpu_price(@id)\n    result = \"Cpu: #{info} ($#{price})\"\n    return \"* #{result}\" if price >= 100\n    result\n  end\n    \n  def keyboard\n    info = @data_source.get_keyboard_info(@id)\n    price = @data_source.get_keyboard_price(@id)\n    result = \"Keyboard: #{info} ($#{price})\"\n    return \"* #{result}\" if price >= 100\n    result\n  end\n   # ...\nend\n```\n\nDYNAMIC DISPATCH\n\n```ruby\nclass Computer\n  def initialize(computer_id, data_source)\n  @id = computer_id\n  @data_source = data_source\n  end\n  \n  def mouse\n    component :mouse\n  end\n\n  def cpu\n    component :cpu\n  end\n    \n  def keyboard\n    component :keyboard\n  end\n    \n  def component(name)\n    info = @data_source.send \"get_#{name}_info\", @id\n    price = @data_source.send \"get_#{name}_price\", @id\n    result = \"#{name.capitalize}: #{info} ($#{price})\"\n    return \"* #{result}\" if price >= 100\n    result\n  end\nend\n```\n\nDYNAMIC METHOD\n\n```ruby\nclass Computer\n  def initialize(computer_id, data_source)\n    @id = computer_id\n    @data_source = data_source\n  end\n  \n  def self.define_component(name)\n    define_method(name) do\n      info = @data_source.send \"get_#{name}_info\", @id\n      price = @data_source.send \"get_#{name}_price\", @id\n      result = \"#{name.capitalize}: #{info} ($#{price})\"\n      return \"* #{result}\" if price >= 100\n      result\n    end\n  end\n     \n  define_component :mouse\n  define_component :cpu\n  define_component :keyboard\nend\n\n```\n\nBEST WAY\n\n```ruby\nclass Computer\n  def initialize(computer_id, data_source)\n    @id = computer_id\n    @data_source = data_source\n    data_source.methods.grep(/^get_(.*)_info$/) { Computer.define_component $1 }\n  end\n    \n  def self.define_component(name)\n    define_method(name) do\n      # ...\n    end\n  end\nend\n```\n\n### method_missing\n\n25) The Hashie gem contains a little bit of magic called Hashie::Mash. A Mash is a more powerful version of Ruby’s standard OpenStruct class: a hash-like object whose attributes work like Ruby variables. If you want a new attribute, just assign a value to the attribute, and it will spring into existence:\n\n```ruby\nrequire 'hashie'\nicecream = Hashie::Mash.new\nicecream.flavor = \"strawberry\"\nicecream.flavor # => \"strawberry\"\n```\n\nWhat hanppen inside?\n\n```ruby\nmodule Hashie\n  class Mash < Hashie::Hash\n    def method_missing(method_name, *args, &blk)\n      return self.[](method_name, &blk) if key?(method_name)\n      match = method_name.to_s.match(/(.*?)([?=!]?)$/)\n      case match[2]\n      when \"=\"\n      self[match[1]] = args.first\n      # ...\n      else\n      default(method_name, *args, &blk)\n      end\n    end\n    # ...\n  end\nend\n```\n\n26) **Ghost Methods** (57) are usually icing on the cake, but some objects actually rely almost exclusively on them. These objects are often wrappers for something else—maybe another object, a web service, or code written in a different language. They collect method calls through method_missing and forward them to the wrapped object. Let’s look at a complex real-life example.\n\nRefactor:\n\n```ruby\nclass Computer\n  def initialize(computer_id, data_source)\n    @id = computer_id\n    @data_source = data_source\n  end\n  \n  def method_missing(name)\n    super if !@data_source.respond_to?(\"get_#{name}_info\")\n    info = @data_source.send(\"get_#{name}_info\", @id)\n    price = @data_source.send(\"get_#{name}_price\", @id)\n    result = \"#{name.capitalize}: #{info} ($#{price})\"\n    return \"* #{result}\" if price >= 100\n    result\n  end\nend\n```\n\n27) Khi dùng ghost method, giả sử trong method_missing chúng ta muốn tạo ra 1 method x, tuy nhiên x lại có trong cây kế thừa => x trong method missing sẽ không được gọi. Lúc này ta cần Blank Slates.\n\n### Blank Slates\n\n28) If you don’t need the inherited method, you can fix the problem by removing it. While you’re at it, you might want to remove most methods from the class, preventing such name clashes from ever happening again. A skinny class Spell: Blank Slate with a minimal number of methods is called a Blank Slate. As it turns out, Ruby has a ready-made Blank Slate for you to use\n\n29) If you don’t specify a superclass, your classes inherit by default from Object, which is itself a subclass of BasicObject. If you want a Blank Slate (66), you can inherit directly from BasicObject instead. For example, if Computer inherited directly from BasicObject, then it wouldn’t have a problematic display method.\n=> không lấy nhầm method trong class Object, vì lớp Computer được kế thừa trực tiếp từ BasicObject\n\n30) Inheriting from BasicObject is the quicker way to define a Blank Slate in Ruby.\n**class Computer < BasicObject**\n\n31) You can remove a method from a class by using either Module#undef_method or Module#remove_method. The drastic undef_method removes any method, including the inherited ones. The kinder remove_method removes the method from the receiver, but it leaves inherited methods alone. Let’s look at a real-life library that uses undef_method to create a Blank Slate.\n\n```ruby\nclass BlankSlate\n  # Hide the method named +name+ in the BlankSlate class. Don't\n  # hide +instance_eval+ or any method beginning with \"__\".\n  def self.hide(name)\n    # ...\n    if instance_methods.include?(name._blankslate_as_name) &&\n      name !~ /^(__|instance_eval$)/\n      undef_method name\n    end\n  end\n  # ...\n  instance_methods.each { |m| hide(m) }\nend\n```\n\n32) **use Dynamic Methods if you can and Ghost Methods if you have to**\n\n\n## BLOCKS\n\n### Blocks Are Closures\n\n```ruby\ndef my_method\n  x = \"Goodbye\"\n  yield(\"cruel\")\nend\n\nx = \"Hello\"\nmy_method {|y| \"#{x}, #{y} world\" } # => \"Hello, cruel world\"\n```\n\n33) When you create the block, you capture the local bindings, such as x. Then you pass the block to a method that has its own separate set of bindings. In the previous example, those bindings also include a variable named x. Still, the code in the block sees the x that was around when the block was defined, not the method’s x, which is not visible at all in the block.\n\n34) khi gọi 1 block, nó lưu vết lại các ràng buộc cục bộ nơi block được gọi, sau đó block được truyền cho 1 method, mà method đó sẽ có các ràng cuộc cục bộ của riêng nó, và block sẽ sử dụng ràng buộc của mình (ví dụ như biến x ở trên).\n\n```ruby\ndef just_yield\n  yield\nend\n\ntop_level_variable = 1\njust_yield do\n  top_level_variable += 1\n  local_to_block = 1\nend\n\ntop_level_variable # => 2\nlocal_to_block # => Error!\n```\nTrong ví dụ này thì local_to_block là 1 binding thuộc block, và ra ngoài ngữ cảnh block nó không có giá trị.\n\n35) This example shows how scope changes as your program runs, tracking the names of bindings with the Kernel#local_variables method:\n\n```ruby\nv1 = 1\n\nclass MyClass\n  v2 = 2\n  local_variables # => [:v2]\n  def my_method\n    v3 = 3\n    local_variables\n  end\n  local_variables # => [:v2]\nend\n  \nobj = MyClass.new\nobj.my_method # => [:v3]\nobj.my_method # => [:v3]\nlocal_variables # => [:v1, :obj]\n```\n\n36) There are exactly three places where a program leaves the previous scope behind and opens a new one:\nClass definitions\nModule definitions\nMethods\n\n37) Scope changes whenever the program enters (or exits) a class or module definition or a method. These three borders are marked by the keywords class, module, and def, respectively. Each of these keywords acts like a **Scope Gate**.\n\n```ruby\nv1 = 1\nclass MyClass # SCOPE GATE: entering class\n  v2 = 2\n  local_variables # => [\"v2\"]\n  def my_method # SCOPE GATE: entering def\n    v3 = 3\n    local_variables\n  end # SCOPE GATE: leaving def\n  \n  local_variables # => [\"v2\"]\nend # SCOPE GATE: leaving class\n  \nobj = MyClass.new\nobj.my_method # => [:v3]\nlocal_variables # => [:v1, :obj]\n```\n\n```ruby\nmy_var = \"Success\"\n  \nMyClass = Class.new do\n  \"#{my_var} in the class definition\"\n  \n  define_method :my_method do\n    \"#{my_var} in the method\"\n  end\nend\n```\n\nkhai báo thông thường thì my_var không thể sử dụng trong class hoặc def (vì nó mở ra  1 scope mới). Nên dùng call method gọi là **flat scope**.\n\n38) If you replace Scope Gates with method calls, you allow one scope to see variables from another scope. Technically, this trick should be called nested lexical scopes, but many Ruby coders refer to it simply as “flattening the scope,” meaning that the two scopes share variables as if the scopes were squeezed together. For short, you can call this spell a Flat Scope.\n\n39) Once you know about Flat Scopes (83), you can do pretty much whatever you want with scopes. For example, assume that you want to share a variable among a few methods, and you don’t want anybody else to see that variable. You can do that by defining all the methods in the same Flat Scope as the variable:\n\n```ruby\ndef define_methods\n  shared = 0\n  Kernel.send :define_method, :counter do\n    shared\n  end\n\n  Kernel.send :define_method, :inc do |x|\n    shared += x\n  end\nend\n\nMuốn chỉ share variable cho 1 vài method nhất định, dùng các phương thức support bởi kernel và gọi đây là **Flat Scope**.\n\n```\n\n### instance_eval()\n\n```ruby\nv = 2\nobj.instance_eval { @v = v }\nobj.instance_eval { @v } # => 2\n```\n\n40) The three lines in the previous example are evaluated in the same Flat Scope (83), so they can all access the local variable v—but the blocks are evaluated with the object as self, so they can also access obj’s instance variable @v. In all these cases, you can call the block that you pass to instance_eval a Context Probe, because it’s like a snippet of code that you dip inside an object to do Spell: Context Probe something in there\n\n41) To solve this problem Ruby provides the standard library class Proc. \nA Proc isa block that has been turned into an object. You can create a Proc by passing\nthe block to Proc.new\n\n### Callable Objects\n\n42) To attach a binding to the block, you can add one special argument to the method. This argument must be the last in the list of arguments and prefixed by an & sign.\n\n```ruby\ndef my_method(&the_proc)\n  the_proc\nend\n    \np = my_method {|name| \"Hello, #{name}!\" }\np.class # => Proc\np.call(\"Bill\") # => \"Hello, Bill!\"\n\n\ndef my_method(greeting)\n  \"#{greeting}, #{yield}!\"\nend\n    \nmy_proc = proc { \"Bill\" }\nmy_method(\"Hello\", &my_proc)\n```\nWhen you call my_method, the & converts my_proc to a block and passes that block to the method.\n\n43) There are two differences between procs and lambdas. One has to do with the return keyword, and the other concerns the checking of arguments.\n\nIn a lambda, return just returns from the lambda.\nIn a proc, return behaves differently. Rather than return from the proc, it returns from the scope where the proc itself was defined:\n\nlambdas tend to be less tolerant than procs (and regular blocks) when it comes to arguments. Call a lambda with the wrong arity, and it fails with an ArgumentError. On the other hand, a proc fits the argument list to its own expectations:\n\n```ruby\nclass MyClass\n  def initialize(value)\n    @x = value\n  end\n    \n  def my_method\n    @x\n  end\nend\n    \nobject = MyClass.new(1)\nm = object.method :my_method\nm.call # => 1\n```\n\n44) By calling Kernel#method, you get the method itself as a Method object, which you can later execute with Method#call.\n\n### Writing a Domain-Specific Language\n\nN/A\n\n## CLASS DEFINITIONS\n\n### Class Definitions Demystified\n\n### Singleton Methods\n\n### Singleton Classes\n\n### Method Wrappers\n\n45) At the top level of your program, the current class is Object, the class of main. (**That’s why, if you define a method at the top level, that method becomes an instance method of Object.**)\n\n46) Module#class_eval is very different from BasicObject#instance_eval, which you learned about earlier in instance_eval(), on page 85. instance_eval only changes self, **while class_eval changes both self and the current class.**\n\n```ruby\ndef add_method_to(a_class)\n  a_class.class_eval do\n    def m; 'Hello!'; end\n  end\nend\n\nadd_method_to String\n\"abc\".m # => \"Hello!\"\n```\n","slug":"2019-8-10-meta-programming-ruby","published":1,"updated":"2022-01-29T09:29:59.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbd003fp3m2bjflbkyu","content":"<h2 id=\"IMAGES\"><a href=\"#IMAGES\" class=\"headerlink\" title=\"IMAGES\"></a>IMAGES</h2><p><img src=\"/images/meta2/1.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/2.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/3.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/4.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/5.png\" alt=\"hoa\"></p>\n<!-- ![hoa](/images/meta2/6.png) -->\n\n<p><img src=\"/images/meta2/7.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/8.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/9.png\" alt=\"hoa\"></p>\n<h2 id=\"RUBY-OBJECT-MODEL\"><a href=\"#RUBY-OBJECT-MODEL\" class=\"headerlink\" title=\"RUBY OBJECT MODEL\"></a>RUBY OBJECT MODEL</h2><h3 id=\"Open-Classes\"><a href=\"#Open-Classes\" class=\"headerlink\" title=\"Open Classes\"></a>Open Classes</h3><p><strong>rails g model Movie title:string director:string</strong></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Movie</span> &lt; ActiveRecord:<span class=\"title\">Base</span>;</span> <span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>1) What about methods such as <strong>title=</strong> and title, which access object attributes (accessor methods for short)? This is where metaprogramming comes in: Bob doesn’t have to write those methods. Active Record defines them automatically, after inferring their names from the database schema. ActiveRecord::Base reads the schema at runtime, discovers that the movies table has two columns named title and director, and defines accessor methods for two attributes of the same name. This means that Active Record defines methods such as <strong>Movie#title</strong> and <strong>Movie#director=</strong> out of thin air while the program runs.</p>\n<p>Open Class</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Numeric</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">to_money</span><span class=\"params\">(currency = <span class=\"literal\">nil</span>)</span></span></span><br><span class=\"line\">    Money.from_numeric(<span class=\"keyword\">self</span>, currency <span class=\"params\">||</span> Money.default_currency)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>2) As cool as they are, however, Open Classes have a dark side—one that you’re about to experience.</p>\n<p>| This can override the method of superclass and make wrong result in somewhere (monkeypath). So we need be careful when set the name for the override method.</p>\n<h3 id=\"Inside-the-Object-Model\"><a href=\"#Inside-the-Object-Model\" class=\"headerlink\" title=\"Inside the Object Model\"></a>Inside the Object Model</h3><p>3) Objects that share the same class also share the same methods, so the methods must be stored in the class, not the object.</p>\n<p>4) The “false” argument here means: ignore inherited methods Class.instance_methods(false) # =&gt; [:allocate, :new, :superclass]</p>\n<p>5) The superclass of Class is Module—which is to say, every class is also a module.<br>To be precise, a class is a module with three additional instance methods (new, allocate, and superclass)</p>\n<p>6) All the constants in a program are arranged in a tree similar to a file system.</p>\n<p>7) The Module class also provides an instance method and a class method that, confusingly, are both called constants.</p>\n<p>8) What’s an object? It’s a bunch of instance variables, plus a link to a class. The object’s methods don’t live in the object—they live in the object’s class, where they’re called the instance methods of the class.</p>\n<p>9) What’s a class? It’s an object (an instance of Class), plus a list of instance methods and a link to a superclass. Class is a subclass of Module, so a class is also a module</p>\n<p>10) These are instance methods of the Class class. Like any object, a class has its own methods, such as new. Also like any object, classes must be accessed through references. You already have a constant reference to each class: the class’s name.</p>\n<p>11) Using load, however, has a side effect. The motd.rb file probably defines variables and classes. Although variables fall out of scope when the file has finished loading, constants don’t. As a result, motd.rb can pollute your program with the names of its own constants—in particular, class names. You can force motd.rb to keep its constants to itself by passing a second, optional argument to load: <strong>load(‘motd.rb’, true)</strong> If you load a file this way, Ruby creates <strong>an anonymous module</strong>, uses that module as a Namespace to contain all the constants from motd.rb, and then destroys the module. The require method is quite similar to load, but it’s meant for a different purpose. You use load to execute code, and you use require to import libraries. That’s why require has no second argument: those leftover class names are probably the reason why you imported the file in the first place. Also, that’s why require tries only once to load each file, while load executes the file again every time you call it.</p>\n<p>What’s the class of Object?<br>What’s the superclass of Module?<br>What’s the class of Class?</p>\n<h3 id=\"What-Happens-When-You-Call-a-Method\"><a href=\"#What-Happens-When-You-Call-a-Method\" class=\"headerlink\" title=\"What Happens When You Call a Method?\"></a>What Happens When You Call a Method?</h3><p>12) When you call a method, Ruby does two things:</p>\n<ol>\n<li>It finds the method. This is a process called method lookup.</li>\n<li>It executes the method. To do that, Ruby needs something called self.</li>\n</ol>\n<p>13) Before you look at a more complicated example, though, you need to know about two new concepts: the receiver and the ancestors chain.The receiver is the object that you call a method on. For example, if you write <strong>my_string.reverse()</strong>, then <strong>my_string</strong> is the receiver. To understand the concept of an ancestors chain, look at any Ruby class. Then imagine moving from the class into its superclass, then into the superclass’s superclass, and so on, until you reach BasicObject, the root of the Ruby class hierarchy. The path of classes you just traversed is the ancestors chain of the class.<br>MySubclass.ancestors # =&gt; [MySubclass, MyClass, Object, Kernel, BasicObject]</p>\n<p>14) When you include a module in a class (or even in another module), Ruby inserts the module in the ancestors chain, right above the including class itself:</p>\n<p>15) Starting from Ruby 2.0, you also have a second way to insert a module in a class’s chain of ancestors: <strong>the prepend method</strong>. It works like include, but it inserts the module below the including class (sometimes called the includer).</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">C2</span></span></span><br><span class=\"line\"> prepend M2</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">D2</span> &lt; C2;</span> <span class=\"keyword\">end</span></span><br><span class=\"line\">D2.ancestors <span class=\"comment\"># =&gt; [D2, M2, C2, Object, Kernel, BasicObject]</span></span><br></pre></td></tr></table></figure>\n\n<p>16) This is true every time you include or prepend a module: if that module is already in the chain, Ruby silently ignores the second inclusion.</p>\n<p>Kernel.private_instance_methods.grep(/^pr/) # =&gt; [:printf, :print, :proc]</p>\n<p>17) The trick here is that class Object includes Kernel, so Kernel gets into every object’s ancestors chain. Every line of Ruby is always executed inside an object, so you can call the instance methods in Kernel from anywhere.</p>\n<p>18) You can take advantage of this mechanism yourself: if you add a method to Spell: Kernel Method Kernel, this Kernel Method will be available to all objects. To prove that Kernel Methods are actually useful, you can look at the way some Ruby libraries use them.</p>\n<p>19) Every line of Ruby code is executed inside an object—the so-called current object. The current object is also known as self, because you can access it with the self keyword.</p>\n<p>20) Only one object can take the role of self at a given time, but no object holds that role for a long time. In particular, when you call a method, the receiver becomes self. From that moment on, all instance variables are instance variables of self, and all methods called without an explicit receiver are called on self.</p>\n<p>21) As soon as you start a Ruby program, you’re sitting within an object named main that the Ruby interpreter created for you. This object is sometimes called the top-level context, because it’s the object you’re in when you’re at the top level of the call stack: either you haven’t called any method yet or all the methods that you called have returned.</p>\n<p>22) This code refines the String class with a new to_alphanumeric method. Differently from a regular Open Class, however, a Refinement is not active by default. If you try to call   <strong>String#to_alphanumeric</strong>, you’ll get an error: <strong>“my <em>1st</em> refinement!”.to_alphanumeric ❮ NoMethodError: undefined method ‘to_alphanumeric’ […]</strong> To activate the changes, you have to do so explicitly, with the using method: using StringExtensions</p>\n<p>23) you can call refine in a regular module, but you cannot call it in a class, even if a class is itself a module.</p>\n<h2 id=\"METHODS\"><a href=\"#METHODS\" class=\"headerlink\" title=\"METHODS\"></a>METHODS</h2><h3 id=\"Dynamic-Methods\"><a href=\"#Dynamic-Methods\" class=\"headerlink\" title=\"Dynamic Methods\"></a>Dynamic Methods</h3><p>24) If that kind of breaching of encapsulation makes you uneasy, you can use public_send instead. It’s like send, but it makes a point of respecting the receiver’s privacy. Be prepared, however, for the fact that Ruby code in the wild rarely bothers with this concern. If anything, a lot of Ruby programmers use send exactly because it allows calling private methods, not in spite of that</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DS</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span> <span class=\"comment\"># connect to data source...</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_cpu_info</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_cpu_price</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_mouse_info</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_mouse_price</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_keyboard_info</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_keyboard_price</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_display_info</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_display_price</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"comment\"># ...and so on</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(computer_id, data_source)</span></span></span><br><span class=\"line\">    @id = computer_id</span><br><span class=\"line\">    @data_source = data_source</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">mouse</span></span></span><br><span class=\"line\">    info = @data_source.get_mouse_info(@id)</span><br><span class=\"line\">    price = @data_source.get_mouse_price(@id)</span><br><span class=\"line\">    result = <span class=\"string\">\"Mouse: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">   </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cpu</span></span></span><br><span class=\"line\">    info = @data_source.get_cpu_info(@id)</span><br><span class=\"line\">    price = @data_source.get_cpu_price(@id)</span><br><span class=\"line\">    result = <span class=\"string\">\"Cpu: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span></span></span><br><span class=\"line\">    info = @data_source.get_keyboard_info(@id)</span><br><span class=\"line\">    price = @data_source.get_keyboard_price(@id)</span><br><span class=\"line\">    result = <span class=\"string\">\"Keyboard: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">   <span class=\"comment\"># ...</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>DYNAMIC DISPATCH</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(computer_id, data_source)</span></span></span><br><span class=\"line\">  @id = computer_id</span><br><span class=\"line\">  @data_source = data_source</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">mouse</span></span></span><br><span class=\"line\">    component <span class=\"symbol\">:mouse</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cpu</span></span></span><br><span class=\"line\">    component <span class=\"symbol\">:cpu</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span></span></span><br><span class=\"line\">    component <span class=\"symbol\">:keyboard</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">component</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    info = @data_source.send <span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_info\"</span>, @id</span><br><span class=\"line\">    price = @data_source.send <span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_price\"</span>, @id</span><br><span class=\"line\">    result = <span class=\"string\">\"<span class=\"subst\">#&#123;name.capitalize&#125;</span>: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>DYNAMIC METHOD</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(computer_id, data_source)</span></span></span><br><span class=\"line\">    @id = computer_id</span><br><span class=\"line\">    @data_source = data_source</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">define_component</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    define_method(name) <span class=\"keyword\">do</span></span><br><span class=\"line\">      info = @data_source.send <span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_info\"</span>, @id</span><br><span class=\"line\">      price = @data_source.send <span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_price\"</span>, @id</span><br><span class=\"line\">      result = <span class=\"string\">\"<span class=\"subst\">#&#123;name.capitalize&#125;</span>: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">      result</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">     </span><br><span class=\"line\">  define_component <span class=\"symbol\">:mouse</span></span><br><span class=\"line\">  define_component <span class=\"symbol\">:cpu</span></span><br><span class=\"line\">  define_component <span class=\"symbol\">:keyboard</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>BEST WAY</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(computer_id, data_source)</span></span></span><br><span class=\"line\">    @id = computer_id</span><br><span class=\"line\">    @data_source = data_source</span><br><span class=\"line\">    data_source.methods.grep(<span class=\"regexp\">/^get_(.*)_info$/</span>) &#123; Computer.define_component $1 &#125;</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">define_component</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    define_method(name) <span class=\"keyword\">do</span></span><br><span class=\"line\">      <span class=\"comment\"># ...</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"method-missing\"><a href=\"#method-missing\" class=\"headerlink\" title=\"method_missing\"></a>method_missing</h3><p>25) The Hashie gem contains a little bit of magic called Hashie::Mash. A Mash is a more powerful version of Ruby’s standard OpenStruct class: a hash-like object whose attributes work like Ruby variables. If you want a new attribute, just assign a value to the attribute, and it will spring into existence:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'hashie'</span></span><br><span class=\"line\">icecream = Hashie::Mash.new</span><br><span class=\"line\">icecream.flavor = <span class=\"string\">\"strawberry\"</span></span><br><span class=\"line\">icecream.flavor <span class=\"comment\"># =&gt; \"strawberry\"</span></span><br></pre></td></tr></table></figure>\n\n<p>What hanppen inside?</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">Hashie</span></span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Mash</span> &lt; Hashie::Hash</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">method_missing</span><span class=\"params\">(method_name, *args, &amp;blk)</span></span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.[](method_name, &amp;blk) <span class=\"keyword\">if</span> key?(method_name)</span><br><span class=\"line\">      match = method_name.to_s.match(<span class=\"regexp\">/(.*?)([?=!]?)$/</span>)</span><br><span class=\"line\">      <span class=\"keyword\">case</span> match[<span class=\"number\">2</span>]</span><br><span class=\"line\">      <span class=\"keyword\">when</span> <span class=\"string\">\"=\"</span></span><br><span class=\"line\">      <span class=\"keyword\">self</span>[match[<span class=\"number\">1</span>]] = args.first</span><br><span class=\"line\">      <span class=\"comment\"># ...</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">      default(method_name, *args, &amp;blk)</span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>26) <strong>Ghost Methods</strong> (57) are usually icing on the cake, but some objects actually rely almost exclusively on them. These objects are often wrappers for something else—maybe another object, a web service, or code written in a different language. They collect method calls through method_missing and forward them to the wrapped object. Let’s look at a complex real-life example.</p>\n<p>Refactor:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(computer_id, data_source)</span></span></span><br><span class=\"line\">    @id = computer_id</span><br><span class=\"line\">    @data_source = data_source</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">method_missing</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span> <span class=\"keyword\">if</span> !@data_source.respond_to?(<span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_info\"</span>)</span><br><span class=\"line\">    info = @data_source.send(<span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_info\"</span>, @id)</span><br><span class=\"line\">    price = @data_source.send(<span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_price\"</span>, @id)</span><br><span class=\"line\">    result = <span class=\"string\">\"<span class=\"subst\">#&#123;name.capitalize&#125;</span>: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>27) Khi dùng ghost method, giả sử trong method_missing chúng ta muốn tạo ra 1 method x, tuy nhiên x lại có trong cây kế thừa =&gt; x trong method missing sẽ không được gọi. Lúc này ta cần Blank Slates.</p>\n<h3 id=\"Blank-Slates\"><a href=\"#Blank-Slates\" class=\"headerlink\" title=\"Blank Slates\"></a>Blank Slates</h3><p>28) If you don’t need the inherited method, you can fix the problem by removing it. While you’re at it, you might want to remove most methods from the class, preventing such name clashes from ever happening again. A skinny class Spell: Blank Slate with a minimal number of methods is called a Blank Slate. As it turns out, Ruby has a ready-made Blank Slate for you to use</p>\n<p>29) If you don’t specify a superclass, your classes inherit by default from Object, which is itself a subclass of BasicObject. If you want a Blank Slate (66), you can inherit directly from BasicObject instead. For example, if Computer inherited directly from BasicObject, then it wouldn’t have a problematic display method.<br>=&gt; không lấy nhầm method trong class Object, vì lớp Computer được kế thừa trực tiếp từ BasicObject</p>\n<p>30) Inheriting from BasicObject is the quicker way to define a Blank Slate in Ruby.<br><strong>class Computer &lt; BasicObject</strong></p>\n<p>31) You can remove a method from a class by using either Module#undef_method or Module#remove_method. The drastic undef_method removes any method, including the inherited ones. The kinder remove_method removes the method from the receiver, but it leaves inherited methods alone. Let’s look at a real-life library that uses undef_method to create a Blank Slate.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BlankSlate</span></span></span><br><span class=\"line\">  <span class=\"comment\"># Hide the method named +name+ in the BlankSlate class. Don't</span></span><br><span class=\"line\">  <span class=\"comment\"># hide +instance_eval+ or any method beginning with \"__\".</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">hide</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    <span class=\"comment\"># ...</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> instance_methods.<span class=\"keyword\">include</span>?(name._blankslate_as_name) &amp;&amp;</span><br><span class=\"line\">      name !~ <span class=\"regexp\">/^(__|instance_eval$)/</span></span><br><span class=\"line\">      undef_method name</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"comment\"># ...</span></span><br><span class=\"line\">  instance_methods.each &#123; <span class=\"params\">|m|</span> hide(m) &#125;</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>32) <strong>use Dynamic Methods if you can and Ghost Methods if you have to</strong></p>\n<h2 id=\"BLOCKS\"><a href=\"#BLOCKS\" class=\"headerlink\" title=\"BLOCKS\"></a>BLOCKS</h2><h3 id=\"Blocks-Are-Closures\"><a href=\"#Blocks-Are-Closures\" class=\"headerlink\" title=\"Blocks Are Closures\"></a>Blocks Are Closures</h3><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span></span></span><br><span class=\"line\">  x = <span class=\"string\">\"Goodbye\"</span></span><br><span class=\"line\">  <span class=\"keyword\">yield</span>(<span class=\"string\">\"cruel\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">x = <span class=\"string\">\"Hello\"</span></span><br><span class=\"line\">my_method &#123;<span class=\"params\">|y|</span> <span class=\"string\">\"<span class=\"subst\">#&#123;x&#125;</span>, <span class=\"subst\">#&#123;y&#125;</span> world\"</span> &#125; <span class=\"comment\"># =&gt; \"Hello, cruel world\"</span></span><br></pre></td></tr></table></figure>\n\n<p>33) When you create the block, you capture the local bindings, such as x. Then you pass the block to a method that has its own separate set of bindings. In the previous example, those bindings also include a variable named x. Still, the code in the block sees the x that was around when the block was defined, not the method’s x, which is not visible at all in the block.</p>\n<p>34) khi gọi 1 block, nó lưu vết lại các ràng buộc cục bộ nơi block được gọi, sau đó block được truyền cho 1 method, mà method đó sẽ có các ràng cuộc cục bộ của riêng nó, và block sẽ sử dụng ràng buộc của mình (ví dụ như biến x ở trên).</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">just_yield</span></span></span><br><span class=\"line\">  <span class=\"keyword\">yield</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">top_level_variable = <span class=\"number\">1</span></span><br><span class=\"line\">just_yield <span class=\"keyword\">do</span></span><br><span class=\"line\">  top_level_variable += <span class=\"number\">1</span></span><br><span class=\"line\">  local_to_block = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">top_level_variable <span class=\"comment\"># =&gt; 2</span></span><br><span class=\"line\">local_to_block <span class=\"comment\"># =&gt; Error!</span></span><br></pre></td></tr></table></figure>\n<p>Trong ví dụ này thì local_to_block là 1 binding thuộc block, và ra ngoài ngữ cảnh block nó không có giá trị.</p>\n<p>35) This example shows how scope changes as your program runs, tracking the names of bindings with the Kernel#local_variables method:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v1 = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span></span></span><br><span class=\"line\">  v2 = <span class=\"number\">2</span></span><br><span class=\"line\">  local_variables <span class=\"comment\"># =&gt; [:v2]</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span></span></span><br><span class=\"line\">    v3 = <span class=\"number\">3</span></span><br><span class=\"line\">    local_variables</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  local_variables <span class=\"comment\"># =&gt; [:v2]</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">obj = MyClass.new</span><br><span class=\"line\">obj.my_method <span class=\"comment\"># =&gt; [:v3]</span></span><br><span class=\"line\">obj.my_method <span class=\"comment\"># =&gt; [:v3]</span></span><br><span class=\"line\">local_variables <span class=\"comment\"># =&gt; [:v1, :obj]</span></span><br></pre></td></tr></table></figure>\n\n<p>36) There are exactly three places where a program leaves the previous scope behind and opens a new one:<br>Class definitions<br>Module definitions<br>Methods</p>\n<p>37) Scope changes whenever the program enters (or exits) a class or module definition or a method. These three borders are marked by the keywords class, module, and def, respectively. Each of these keywords acts like a <strong>Scope Gate</strong>.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v1 = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span> <span class=\"comment\"># SCOPE GATE: entering class</span></span></span><br><span class=\"line\">  v2 = <span class=\"number\">2</span></span><br><span class=\"line\">  local_variables <span class=\"comment\"># =&gt; [\"v2\"]</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span> <span class=\"comment\"># SCOPE GATE: entering def</span></span></span><br><span class=\"line\">    v3 = <span class=\"number\">3</span></span><br><span class=\"line\">    local_variables</span><br><span class=\"line\">  <span class=\"keyword\">end</span> <span class=\"comment\"># SCOPE GATE: leaving def</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  local_variables <span class=\"comment\"># =&gt; [\"v2\"]</span></span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"comment\"># SCOPE GATE: leaving class</span></span><br><span class=\"line\">  </span><br><span class=\"line\">obj = MyClass.new</span><br><span class=\"line\">obj.my_method <span class=\"comment\"># =&gt; [:v3]</span></span><br><span class=\"line\">local_variables <span class=\"comment\"># =&gt; [:v1, :obj]</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">my_var = <span class=\"string\">\"Success\"</span></span><br><span class=\"line\">  </span><br><span class=\"line\">MyClass = Class.new <span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"string\">\"<span class=\"subst\">#&#123;my_var&#125;</span> in the class definition\"</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  define_method <span class=\"symbol\">:my_method</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"string\">\"<span class=\"subst\">#&#123;my_var&#125;</span> in the method\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>khai báo thông thường thì my_var không thể sử dụng trong class hoặc def (vì nó mở ra  1 scope mới). Nên dùng call method gọi là <strong>flat scope</strong>.</p>\n<p>38) If you replace Scope Gates with method calls, you allow one scope to see variables from another scope. Technically, this trick should be called nested lexical scopes, but many Ruby coders refer to it simply as “flattening the scope,” meaning that the two scopes share variables as if the scopes were squeezed together. For short, you can call this spell a Flat Scope.</p>\n<p>39) Once you know about Flat Scopes (83), you can do pretty much whatever you want with scopes. For example, assume that you want to share a variable among a few methods, and you don’t want anybody else to see that variable. You can do that by defining all the methods in the same Flat Scope as the variable:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">define_methods</span></span></span><br><span class=\"line\">  shared = <span class=\"number\">0</span></span><br><span class=\"line\">  Kernel.send <span class=\"symbol\">:define_method</span>, <span class=\"symbol\">:counter</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    shared</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  Kernel.send <span class=\"symbol\">:define_method</span>, <span class=\"symbol\">:inc</span> <span class=\"keyword\">do</span> <span class=\"params\">|x|</span></span><br><span class=\"line\">    shared += x</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">Muốn chỉ share variable cho <span class=\"number\">1</span> vài method nhất định, dùng các phương thức support bởi kernel và gọi đây là **Flat Scope**.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"instance-eval\"><a href=\"#instance-eval\" class=\"headerlink\" title=\"instance_eval()\"></a>instance_eval()</h3><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v = <span class=\"number\">2</span></span><br><span class=\"line\">obj.instance_eval &#123; @v = v &#125;</span><br><span class=\"line\">obj.instance_eval &#123; @v &#125; <span class=\"comment\"># =&gt; 2</span></span><br></pre></td></tr></table></figure>\n\n<p>40) The three lines in the previous example are evaluated in the same Flat Scope (83), so they can all access the local variable v—but the blocks are evaluated with the object as self, so they can also access obj’s instance variable @v. In all these cases, you can call the block that you pass to instance_eval a Context Probe, because it’s like a snippet of code that you dip inside an object to do Spell: Context Probe something in there</p>\n<p>41) To solve this problem Ruby provides the standard library class Proc.<br>A Proc isa block that has been turned into an object. You can create a Proc by passing<br>the block to Proc.new</p>\n<h3 id=\"Callable-Objects\"><a href=\"#Callable-Objects\" class=\"headerlink\" title=\"Callable Objects\"></a>Callable Objects</h3><p>42) To attach a binding to the block, you can add one special argument to the method. This argument must be the last in the list of arguments and prefixed by an &amp; sign.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span><span class=\"params\">(&amp;the_proc)</span></span></span><br><span class=\"line\">  the_proc</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">p = my_method &#123;<span class=\"params\">|name|</span> <span class=\"string\">\"Hello, <span class=\"subst\">#&#123;name&#125;</span>!\"</span> &#125;</span><br><span class=\"line\">p<span class=\"class\">.<span class=\"keyword\">class</span> <span class=\"comment\"># =&gt; Proc</span></span></span><br><span class=\"line\">p.call(<span class=\"string\">\"Bill\"</span>) <span class=\"comment\"># =&gt; \"Hello, Bill!\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span><span class=\"params\">(greeting)</span></span></span><br><span class=\"line\">  <span class=\"string\">\"<span class=\"subst\">#&#123;greeting&#125;</span>, <span class=\"subst\">#&#123;<span class=\"keyword\">yield</span>&#125;</span>!\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">my_proc = proc &#123; <span class=\"string\">\"Bill\"</span> &#125;</span><br><span class=\"line\">my_method(<span class=\"string\">\"Hello\"</span>, &amp;my_proc)</span><br></pre></td></tr></table></figure>\n<p>When you call my_method, the &amp; converts my_proc to a block and passes that block to the method.</p>\n<p>43) There are two differences between procs and lambdas. One has to do with the return keyword, and the other concerns the checking of arguments.</p>\n<p>In a lambda, return just returns from the lambda.<br>In a proc, return behaves differently. Rather than return from the proc, it returns from the scope where the proc itself was defined:</p>\n<p>lambdas tend to be less tolerant than procs (and regular blocks) when it comes to arguments. Call a lambda with the wrong arity, and it fails with an ArgumentError. On the other hand, a proc fits the argument list to its own expectations:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(value)</span></span></span><br><span class=\"line\">    @x = value</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span></span></span><br><span class=\"line\">    @x</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">object = MyClass.new(<span class=\"number\">1</span>)</span><br><span class=\"line\">m = object.method <span class=\"symbol\">:my_method</span></span><br><span class=\"line\">m.call <span class=\"comment\"># =&gt; 1</span></span><br></pre></td></tr></table></figure>\n\n<p>44) By calling Kernel#method, you get the method itself as a Method object, which you can later execute with Method#call.</p>\n<h3 id=\"Writing-a-Domain-Specific-Language\"><a href=\"#Writing-a-Domain-Specific-Language\" class=\"headerlink\" title=\"Writing a Domain-Specific Language\"></a>Writing a Domain-Specific Language</h3><p>N/A</p>\n<h2 id=\"CLASS-DEFINITIONS\"><a href=\"#CLASS-DEFINITIONS\" class=\"headerlink\" title=\"CLASS DEFINITIONS\"></a>CLASS DEFINITIONS</h2><h3 id=\"Class-Definitions-Demystified\"><a href=\"#Class-Definitions-Demystified\" class=\"headerlink\" title=\"Class Definitions Demystified\"></a>Class Definitions Demystified</h3><h3 id=\"Singleton-Methods\"><a href=\"#Singleton-Methods\" class=\"headerlink\" title=\"Singleton Methods\"></a>Singleton Methods</h3><h3 id=\"Singleton-Classes\"><a href=\"#Singleton-Classes\" class=\"headerlink\" title=\"Singleton Classes\"></a>Singleton Classes</h3><h3 id=\"Method-Wrappers\"><a href=\"#Method-Wrappers\" class=\"headerlink\" title=\"Method Wrappers\"></a>Method Wrappers</h3><p>45) At the top level of your program, the current class is Object, the class of main. (<strong>That’s why, if you define a method at the top level, that method becomes an instance method of Object.</strong>)</p>\n<p>46) Module#class_eval is very different from BasicObject#instance_eval, which you learned about earlier in instance_eval(), on page 85. instance_eval only changes self, <strong>while class_eval changes both self and the current class.</strong></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add_method_to</span><span class=\"params\">(a_class)</span></span></span><br><span class=\"line\">  a_class.class_eval <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">m</span>;</span> <span class=\"string\">'Hello!'</span>; <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">add_method_to String</span><br><span class=\"line\"><span class=\"string\">\"abc\"</span>.m <span class=\"comment\"># =&gt; \"Hello!\"</span></span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"IMAGES\"><a href=\"#IMAGES\" class=\"headerlink\" title=\"IMAGES\"></a>IMAGES</h2><p><img src=\"/images/meta2/1.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/2.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/3.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/4.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/5.png\" alt=\"hoa\"></p>\n<!-- ![hoa](/images/meta2/6.png) -->\n\n<p><img src=\"/images/meta2/7.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/8.png\" alt=\"hoa\"></p>\n<p><img src=\"/images/meta2/9.png\" alt=\"hoa\"></p>\n<h2 id=\"RUBY-OBJECT-MODEL\"><a href=\"#RUBY-OBJECT-MODEL\" class=\"headerlink\" title=\"RUBY OBJECT MODEL\"></a>RUBY OBJECT MODEL</h2><h3 id=\"Open-Classes\"><a href=\"#Open-Classes\" class=\"headerlink\" title=\"Open Classes\"></a>Open Classes</h3><p><strong>rails g model Movie title:string director:string</strong></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Movie</span> &lt; ActiveRecord:<span class=\"title\">Base</span>;</span> <span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>1) What about methods such as <strong>title=</strong> and title, which access object attributes (accessor methods for short)? This is where metaprogramming comes in: Bob doesn’t have to write those methods. Active Record defines them automatically, after inferring their names from the database schema. ActiveRecord::Base reads the schema at runtime, discovers that the movies table has two columns named title and director, and defines accessor methods for two attributes of the same name. This means that Active Record defines methods such as <strong>Movie#title</strong> and <strong>Movie#director=</strong> out of thin air while the program runs.</p>\n<p>Open Class</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Numeric</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">to_money</span><span class=\"params\">(currency = <span class=\"literal\">nil</span>)</span></span></span><br><span class=\"line\">    Money.from_numeric(<span class=\"keyword\">self</span>, currency <span class=\"params\">||</span> Money.default_currency)</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>2) As cool as they are, however, Open Classes have a dark side—one that you’re about to experience.</p>\n<p>| This can override the method of superclass and make wrong result in somewhere (monkeypath). So we need be careful when set the name for the override method.</p>\n<h3 id=\"Inside-the-Object-Model\"><a href=\"#Inside-the-Object-Model\" class=\"headerlink\" title=\"Inside the Object Model\"></a>Inside the Object Model</h3><p>3) Objects that share the same class also share the same methods, so the methods must be stored in the class, not the object.</p>\n<p>4) The “false” argument here means: ignore inherited methods Class.instance_methods(false) # =&gt; [:allocate, :new, :superclass]</p>\n<p>5) The superclass of Class is Module—which is to say, every class is also a module.<br>To be precise, a class is a module with three additional instance methods (new, allocate, and superclass)</p>\n<p>6) All the constants in a program are arranged in a tree similar to a file system.</p>\n<p>7) The Module class also provides an instance method and a class method that, confusingly, are both called constants.</p>\n<p>8) What’s an object? It’s a bunch of instance variables, plus a link to a class. The object’s methods don’t live in the object—they live in the object’s class, where they’re called the instance methods of the class.</p>\n<p>9) What’s a class? It’s an object (an instance of Class), plus a list of instance methods and a link to a superclass. Class is a subclass of Module, so a class is also a module</p>\n<p>10) These are instance methods of the Class class. Like any object, a class has its own methods, such as new. Also like any object, classes must be accessed through references. You already have a constant reference to each class: the class’s name.</p>\n<p>11) Using load, however, has a side effect. The motd.rb file probably defines variables and classes. Although variables fall out of scope when the file has finished loading, constants don’t. As a result, motd.rb can pollute your program with the names of its own constants—in particular, class names. You can force motd.rb to keep its constants to itself by passing a second, optional argument to load: <strong>load(‘motd.rb’, true)</strong> If you load a file this way, Ruby creates <strong>an anonymous module</strong>, uses that module as a Namespace to contain all the constants from motd.rb, and then destroys the module. The require method is quite similar to load, but it’s meant for a different purpose. You use load to execute code, and you use require to import libraries. That’s why require has no second argument: those leftover class names are probably the reason why you imported the file in the first place. Also, that’s why require tries only once to load each file, while load executes the file again every time you call it.</p>\n<p>What’s the class of Object?<br>What’s the superclass of Module?<br>What’s the class of Class?</p>\n<h3 id=\"What-Happens-When-You-Call-a-Method\"><a href=\"#What-Happens-When-You-Call-a-Method\" class=\"headerlink\" title=\"What Happens When You Call a Method?\"></a>What Happens When You Call a Method?</h3><p>12) When you call a method, Ruby does two things:</p>\n<ol>\n<li>It finds the method. This is a process called method lookup.</li>\n<li>It executes the method. To do that, Ruby needs something called self.</li>\n</ol>\n<p>13) Before you look at a more complicated example, though, you need to know about two new concepts: the receiver and the ancestors chain.The receiver is the object that you call a method on. For example, if you write <strong>my_string.reverse()</strong>, then <strong>my_string</strong> is the receiver. To understand the concept of an ancestors chain, look at any Ruby class. Then imagine moving from the class into its superclass, then into the superclass’s superclass, and so on, until you reach BasicObject, the root of the Ruby class hierarchy. The path of classes you just traversed is the ancestors chain of the class.<br>MySubclass.ancestors # =&gt; [MySubclass, MyClass, Object, Kernel, BasicObject]</p>\n<p>14) When you include a module in a class (or even in another module), Ruby inserts the module in the ancestors chain, right above the including class itself:</p>\n<p>15) Starting from Ruby 2.0, you also have a second way to insert a module in a class’s chain of ancestors: <strong>the prepend method</strong>. It works like include, but it inserts the module below the including class (sometimes called the includer).</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">C2</span></span></span><br><span class=\"line\"> prepend M2</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">D2</span> &lt; C2;</span> <span class=\"keyword\">end</span></span><br><span class=\"line\">D2.ancestors <span class=\"comment\"># =&gt; [D2, M2, C2, Object, Kernel, BasicObject]</span></span><br></pre></td></tr></table></figure>\n\n<p>16) This is true every time you include or prepend a module: if that module is already in the chain, Ruby silently ignores the second inclusion.</p>\n<p>Kernel.private_instance_methods.grep(/^pr/) # =&gt; [:printf, :print, :proc]</p>\n<p>17) The trick here is that class Object includes Kernel, so Kernel gets into every object’s ancestors chain. Every line of Ruby is always executed inside an object, so you can call the instance methods in Kernel from anywhere.</p>\n<p>18) You can take advantage of this mechanism yourself: if you add a method to Spell: Kernel Method Kernel, this Kernel Method will be available to all objects. To prove that Kernel Methods are actually useful, you can look at the way some Ruby libraries use them.</p>\n<p>19) Every line of Ruby code is executed inside an object—the so-called current object. The current object is also known as self, because you can access it with the self keyword.</p>\n<p>20) Only one object can take the role of self at a given time, but no object holds that role for a long time. In particular, when you call a method, the receiver becomes self. From that moment on, all instance variables are instance variables of self, and all methods called without an explicit receiver are called on self.</p>\n<p>21) As soon as you start a Ruby program, you’re sitting within an object named main that the Ruby interpreter created for you. This object is sometimes called the top-level context, because it’s the object you’re in when you’re at the top level of the call stack: either you haven’t called any method yet or all the methods that you called have returned.</p>\n<p>22) This code refines the String class with a new to_alphanumeric method. Differently from a regular Open Class, however, a Refinement is not active by default. If you try to call   <strong>String#to_alphanumeric</strong>, you’ll get an error: <strong>“my <em>1st</em> refinement!”.to_alphanumeric ❮ NoMethodError: undefined method ‘to_alphanumeric’ […]</strong> To activate the changes, you have to do so explicitly, with the using method: using StringExtensions</p>\n<p>23) you can call refine in a regular module, but you cannot call it in a class, even if a class is itself a module.</p>\n<h2 id=\"METHODS\"><a href=\"#METHODS\" class=\"headerlink\" title=\"METHODS\"></a>METHODS</h2><h3 id=\"Dynamic-Methods\"><a href=\"#Dynamic-Methods\" class=\"headerlink\" title=\"Dynamic Methods\"></a>Dynamic Methods</h3><p>24) If that kind of breaching of encapsulation makes you uneasy, you can use public_send instead. It’s like send, but it makes a point of respecting the receiver’s privacy. Be prepared, however, for the fact that Ruby code in the wild rarely bothers with this concern. If anything, a lot of Ruby programmers use send exactly because it allows calling private methods, not in spite of that</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DS</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span> <span class=\"comment\"># connect to data source...</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_cpu_info</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_cpu_price</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_mouse_info</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_mouse_price</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_keyboard_info</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_keyboard_price</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_display_info</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">get_display_price</span><span class=\"params\">(workstation_id)</span></span> <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"comment\"># ...and so on</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(computer_id, data_source)</span></span></span><br><span class=\"line\">    @id = computer_id</span><br><span class=\"line\">    @data_source = data_source</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">mouse</span></span></span><br><span class=\"line\">    info = @data_source.get_mouse_info(@id)</span><br><span class=\"line\">    price = @data_source.get_mouse_price(@id)</span><br><span class=\"line\">    result = <span class=\"string\">\"Mouse: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">   </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cpu</span></span></span><br><span class=\"line\">    info = @data_source.get_cpu_info(@id)</span><br><span class=\"line\">    price = @data_source.get_cpu_price(@id)</span><br><span class=\"line\">    result = <span class=\"string\">\"Cpu: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span></span></span><br><span class=\"line\">    info = @data_source.get_keyboard_info(@id)</span><br><span class=\"line\">    price = @data_source.get_keyboard_price(@id)</span><br><span class=\"line\">    result = <span class=\"string\">\"Keyboard: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">   <span class=\"comment\"># ...</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>DYNAMIC DISPATCH</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(computer_id, data_source)</span></span></span><br><span class=\"line\">  @id = computer_id</span><br><span class=\"line\">  @data_source = data_source</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">mouse</span></span></span><br><span class=\"line\">    component <span class=\"symbol\">:mouse</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">cpu</span></span></span><br><span class=\"line\">    component <span class=\"symbol\">:cpu</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">keyboard</span></span></span><br><span class=\"line\">    component <span class=\"symbol\">:keyboard</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">component</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    info = @data_source.send <span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_info\"</span>, @id</span><br><span class=\"line\">    price = @data_source.send <span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_price\"</span>, @id</span><br><span class=\"line\">    result = <span class=\"string\">\"<span class=\"subst\">#&#123;name.capitalize&#125;</span>: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>DYNAMIC METHOD</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(computer_id, data_source)</span></span></span><br><span class=\"line\">    @id = computer_id</span><br><span class=\"line\">    @data_source = data_source</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">define_component</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    define_method(name) <span class=\"keyword\">do</span></span><br><span class=\"line\">      info = @data_source.send <span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_info\"</span>, @id</span><br><span class=\"line\">      price = @data_source.send <span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_price\"</span>, @id</span><br><span class=\"line\">      result = <span class=\"string\">\"<span class=\"subst\">#&#123;name.capitalize&#125;</span>: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">      result</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">     </span><br><span class=\"line\">  define_component <span class=\"symbol\">:mouse</span></span><br><span class=\"line\">  define_component <span class=\"symbol\">:cpu</span></span><br><span class=\"line\">  define_component <span class=\"symbol\">:keyboard</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>BEST WAY</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(computer_id, data_source)</span></span></span><br><span class=\"line\">    @id = computer_id</span><br><span class=\"line\">    @data_source = data_source</span><br><span class=\"line\">    data_source.methods.grep(<span class=\"regexp\">/^get_(.*)_info$/</span>) &#123; Computer.define_component $1 &#125;</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">define_component</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    define_method(name) <span class=\"keyword\">do</span></span><br><span class=\"line\">      <span class=\"comment\"># ...</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"method-missing\"><a href=\"#method-missing\" class=\"headerlink\" title=\"method_missing\"></a>method_missing</h3><p>25) The Hashie gem contains a little bit of magic called Hashie::Mash. A Mash is a more powerful version of Ruby’s standard OpenStruct class: a hash-like object whose attributes work like Ruby variables. If you want a new attribute, just assign a value to the attribute, and it will spring into existence:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">require</span> <span class=\"string\">'hashie'</span></span><br><span class=\"line\">icecream = Hashie::Mash.new</span><br><span class=\"line\">icecream.flavor = <span class=\"string\">\"strawberry\"</span></span><br><span class=\"line\">icecream.flavor <span class=\"comment\"># =&gt; \"strawberry\"</span></span><br></pre></td></tr></table></figure>\n\n<p>What hanppen inside?</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">Hashie</span></span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Mash</span> &lt; Hashie::Hash</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">method_missing</span><span class=\"params\">(method_name, *args, &amp;blk)</span></span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>.[](method_name, &amp;blk) <span class=\"keyword\">if</span> key?(method_name)</span><br><span class=\"line\">      match = method_name.to_s.match(<span class=\"regexp\">/(.*?)([?=!]?)$/</span>)</span><br><span class=\"line\">      <span class=\"keyword\">case</span> match[<span class=\"number\">2</span>]</span><br><span class=\"line\">      <span class=\"keyword\">when</span> <span class=\"string\">\"=\"</span></span><br><span class=\"line\">      <span class=\"keyword\">self</span>[match[<span class=\"number\">1</span>]] = args.first</span><br><span class=\"line\">      <span class=\"comment\"># ...</span></span><br><span class=\"line\">      <span class=\"keyword\">else</span></span><br><span class=\"line\">      default(method_name, *args, &amp;blk)</span><br><span class=\"line\">      <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">    <span class=\"comment\"># ...</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>26) <strong>Ghost Methods</strong> (57) are usually icing on the cake, but some objects actually rely almost exclusively on them. These objects are often wrappers for something else—maybe another object, a web service, or code written in a different language. They collect method calls through method_missing and forward them to the wrapped object. Let’s look at a complex real-life example.</p>\n<p>Refactor:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Computer</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(computer_id, data_source)</span></span></span><br><span class=\"line\">    @id = computer_id</span><br><span class=\"line\">    @data_source = data_source</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">method_missing</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    <span class=\"keyword\">super</span> <span class=\"keyword\">if</span> !@data_source.respond_to?(<span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_info\"</span>)</span><br><span class=\"line\">    info = @data_source.send(<span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_info\"</span>, @id)</span><br><span class=\"line\">    price = @data_source.send(<span class=\"string\">\"get_<span class=\"subst\">#&#123;name&#125;</span>_price\"</span>, @id)</span><br><span class=\"line\">    result = <span class=\"string\">\"<span class=\"subst\">#&#123;name.capitalize&#125;</span>: <span class=\"subst\">#&#123;info&#125;</span> ($<span class=\"subst\">#&#123;price&#125;</span>)\"</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">\"* <span class=\"subst\">#&#123;result&#125;</span>\"</span> <span class=\"keyword\">if</span> price &gt;= <span class=\"number\">100</span></span><br><span class=\"line\">    result</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>27) Khi dùng ghost method, giả sử trong method_missing chúng ta muốn tạo ra 1 method x, tuy nhiên x lại có trong cây kế thừa =&gt; x trong method missing sẽ không được gọi. Lúc này ta cần Blank Slates.</p>\n<h3 id=\"Blank-Slates\"><a href=\"#Blank-Slates\" class=\"headerlink\" title=\"Blank Slates\"></a>Blank Slates</h3><p>28) If you don’t need the inherited method, you can fix the problem by removing it. While you’re at it, you might want to remove most methods from the class, preventing such name clashes from ever happening again. A skinny class Spell: Blank Slate with a minimal number of methods is called a Blank Slate. As it turns out, Ruby has a ready-made Blank Slate for you to use</p>\n<p>29) If you don’t specify a superclass, your classes inherit by default from Object, which is itself a subclass of BasicObject. If you want a Blank Slate (66), you can inherit directly from BasicObject instead. For example, if Computer inherited directly from BasicObject, then it wouldn’t have a problematic display method.<br>=&gt; không lấy nhầm method trong class Object, vì lớp Computer được kế thừa trực tiếp từ BasicObject</p>\n<p>30) Inheriting from BasicObject is the quicker way to define a Blank Slate in Ruby.<br><strong>class Computer &lt; BasicObject</strong></p>\n<p>31) You can remove a method from a class by using either Module#undef_method or Module#remove_method. The drastic undef_method removes any method, including the inherited ones. The kinder remove_method removes the method from the receiver, but it leaves inherited methods alone. Let’s look at a real-life library that uses undef_method to create a Blank Slate.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BlankSlate</span></span></span><br><span class=\"line\">  <span class=\"comment\"># Hide the method named +name+ in the BlankSlate class. Don't</span></span><br><span class=\"line\">  <span class=\"comment\"># hide +instance_eval+ or any method beginning with \"__\".</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">self</span>.<span class=\"title\">hide</span><span class=\"params\">(name)</span></span></span><br><span class=\"line\">    <span class=\"comment\"># ...</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> instance_methods.<span class=\"keyword\">include</span>?(name._blankslate_as_name) &amp;&amp;</span><br><span class=\"line\">      name !~ <span class=\"regexp\">/^(__|instance_eval$)/</span></span><br><span class=\"line\">      undef_method name</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"comment\"># ...</span></span><br><span class=\"line\">  instance_methods.each &#123; <span class=\"params\">|m|</span> hide(m) &#125;</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>32) <strong>use Dynamic Methods if you can and Ghost Methods if you have to</strong></p>\n<h2 id=\"BLOCKS\"><a href=\"#BLOCKS\" class=\"headerlink\" title=\"BLOCKS\"></a>BLOCKS</h2><h3 id=\"Blocks-Are-Closures\"><a href=\"#Blocks-Are-Closures\" class=\"headerlink\" title=\"Blocks Are Closures\"></a>Blocks Are Closures</h3><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span></span></span><br><span class=\"line\">  x = <span class=\"string\">\"Goodbye\"</span></span><br><span class=\"line\">  <span class=\"keyword\">yield</span>(<span class=\"string\">\"cruel\"</span>)</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">x = <span class=\"string\">\"Hello\"</span></span><br><span class=\"line\">my_method &#123;<span class=\"params\">|y|</span> <span class=\"string\">\"<span class=\"subst\">#&#123;x&#125;</span>, <span class=\"subst\">#&#123;y&#125;</span> world\"</span> &#125; <span class=\"comment\"># =&gt; \"Hello, cruel world\"</span></span><br></pre></td></tr></table></figure>\n\n<p>33) When you create the block, you capture the local bindings, such as x. Then you pass the block to a method that has its own separate set of bindings. In the previous example, those bindings also include a variable named x. Still, the code in the block sees the x that was around when the block was defined, not the method’s x, which is not visible at all in the block.</p>\n<p>34) khi gọi 1 block, nó lưu vết lại các ràng buộc cục bộ nơi block được gọi, sau đó block được truyền cho 1 method, mà method đó sẽ có các ràng cuộc cục bộ của riêng nó, và block sẽ sử dụng ràng buộc của mình (ví dụ như biến x ở trên).</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">just_yield</span></span></span><br><span class=\"line\">  <span class=\"keyword\">yield</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">top_level_variable = <span class=\"number\">1</span></span><br><span class=\"line\">just_yield <span class=\"keyword\">do</span></span><br><span class=\"line\">  top_level_variable += <span class=\"number\">1</span></span><br><span class=\"line\">  local_to_block = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">top_level_variable <span class=\"comment\"># =&gt; 2</span></span><br><span class=\"line\">local_to_block <span class=\"comment\"># =&gt; Error!</span></span><br></pre></td></tr></table></figure>\n<p>Trong ví dụ này thì local_to_block là 1 binding thuộc block, và ra ngoài ngữ cảnh block nó không có giá trị.</p>\n<p>35) This example shows how scope changes as your program runs, tracking the names of bindings with the Kernel#local_variables method:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v1 = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span></span></span><br><span class=\"line\">  v2 = <span class=\"number\">2</span></span><br><span class=\"line\">  local_variables <span class=\"comment\"># =&gt; [:v2]</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span></span></span><br><span class=\"line\">    v3 = <span class=\"number\">3</span></span><br><span class=\"line\">    local_variables</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">  local_variables <span class=\"comment\"># =&gt; [:v2]</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\">  </span><br><span class=\"line\">obj = MyClass.new</span><br><span class=\"line\">obj.my_method <span class=\"comment\"># =&gt; [:v3]</span></span><br><span class=\"line\">obj.my_method <span class=\"comment\"># =&gt; [:v3]</span></span><br><span class=\"line\">local_variables <span class=\"comment\"># =&gt; [:v1, :obj]</span></span><br></pre></td></tr></table></figure>\n\n<p>36) There are exactly three places where a program leaves the previous scope behind and opens a new one:<br>Class definitions<br>Module definitions<br>Methods</p>\n<p>37) Scope changes whenever the program enters (or exits) a class or module definition or a method. These three borders are marked by the keywords class, module, and def, respectively. Each of these keywords acts like a <strong>Scope Gate</strong>.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v1 = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span> <span class=\"comment\"># SCOPE GATE: entering class</span></span></span><br><span class=\"line\">  v2 = <span class=\"number\">2</span></span><br><span class=\"line\">  local_variables <span class=\"comment\"># =&gt; [\"v2\"]</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span> <span class=\"comment\"># SCOPE GATE: entering def</span></span></span><br><span class=\"line\">    v3 = <span class=\"number\">3</span></span><br><span class=\"line\">    local_variables</span><br><span class=\"line\">  <span class=\"keyword\">end</span> <span class=\"comment\"># SCOPE GATE: leaving def</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  local_variables <span class=\"comment\"># =&gt; [\"v2\"]</span></span><br><span class=\"line\"><span class=\"keyword\">end</span> <span class=\"comment\"># SCOPE GATE: leaving class</span></span><br><span class=\"line\">  </span><br><span class=\"line\">obj = MyClass.new</span><br><span class=\"line\">obj.my_method <span class=\"comment\"># =&gt; [:v3]</span></span><br><span class=\"line\">local_variables <span class=\"comment\"># =&gt; [:v1, :obj]</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">my_var = <span class=\"string\">\"Success\"</span></span><br><span class=\"line\">  </span><br><span class=\"line\">MyClass = Class.new <span class=\"keyword\">do</span></span><br><span class=\"line\">  <span class=\"string\">\"<span class=\"subst\">#&#123;my_var&#125;</span> in the class definition\"</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  define_method <span class=\"symbol\">:my_method</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"string\">\"<span class=\"subst\">#&#123;my_var&#125;</span> in the method\"</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>khai báo thông thường thì my_var không thể sử dụng trong class hoặc def (vì nó mở ra  1 scope mới). Nên dùng call method gọi là <strong>flat scope</strong>.</p>\n<p>38) If you replace Scope Gates with method calls, you allow one scope to see variables from another scope. Technically, this trick should be called nested lexical scopes, but many Ruby coders refer to it simply as “flattening the scope,” meaning that the two scopes share variables as if the scopes were squeezed together. For short, you can call this spell a Flat Scope.</p>\n<p>39) Once you know about Flat Scopes (83), you can do pretty much whatever you want with scopes. For example, assume that you want to share a variable among a few methods, and you don’t want anybody else to see that variable. You can do that by defining all the methods in the same Flat Scope as the variable:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">define_methods</span></span></span><br><span class=\"line\">  shared = <span class=\"number\">0</span></span><br><span class=\"line\">  Kernel.send <span class=\"symbol\">:define_method</span>, <span class=\"symbol\">:counter</span> <span class=\"keyword\">do</span></span><br><span class=\"line\">    shared</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  Kernel.send <span class=\"symbol\">:define_method</span>, <span class=\"symbol\">:inc</span> <span class=\"keyword\">do</span> <span class=\"params\">|x|</span></span><br><span class=\"line\">    shared += x</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">Muốn chỉ share variable cho <span class=\"number\">1</span> vài method nhất định, dùng các phương thức support bởi kernel và gọi đây là **Flat Scope**.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"instance-eval\"><a href=\"#instance-eval\" class=\"headerlink\" title=\"instance_eval()\"></a>instance_eval()</h3><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v = <span class=\"number\">2</span></span><br><span class=\"line\">obj.instance_eval &#123; @v = v &#125;</span><br><span class=\"line\">obj.instance_eval &#123; @v &#125; <span class=\"comment\"># =&gt; 2</span></span><br></pre></td></tr></table></figure>\n\n<p>40) The three lines in the previous example are evaluated in the same Flat Scope (83), so they can all access the local variable v—but the blocks are evaluated with the object as self, so they can also access obj’s instance variable @v. In all these cases, you can call the block that you pass to instance_eval a Context Probe, because it’s like a snippet of code that you dip inside an object to do Spell: Context Probe something in there</p>\n<p>41) To solve this problem Ruby provides the standard library class Proc.<br>A Proc isa block that has been turned into an object. You can create a Proc by passing<br>the block to Proc.new</p>\n<h3 id=\"Callable-Objects\"><a href=\"#Callable-Objects\" class=\"headerlink\" title=\"Callable Objects\"></a>Callable Objects</h3><p>42) To attach a binding to the block, you can add one special argument to the method. This argument must be the last in the list of arguments and prefixed by an &amp; sign.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span><span class=\"params\">(&amp;the_proc)</span></span></span><br><span class=\"line\">  the_proc</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">p = my_method &#123;<span class=\"params\">|name|</span> <span class=\"string\">\"Hello, <span class=\"subst\">#&#123;name&#125;</span>!\"</span> &#125;</span><br><span class=\"line\">p<span class=\"class\">.<span class=\"keyword\">class</span> <span class=\"comment\"># =&gt; Proc</span></span></span><br><span class=\"line\">p.call(<span class=\"string\">\"Bill\"</span>) <span class=\"comment\"># =&gt; \"Hello, Bill!\"</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span><span class=\"params\">(greeting)</span></span></span><br><span class=\"line\">  <span class=\"string\">\"<span class=\"subst\">#&#123;greeting&#125;</span>, <span class=\"subst\">#&#123;<span class=\"keyword\">yield</span>&#125;</span>!\"</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">my_proc = proc &#123; <span class=\"string\">\"Bill\"</span> &#125;</span><br><span class=\"line\">my_method(<span class=\"string\">\"Hello\"</span>, &amp;my_proc)</span><br></pre></td></tr></table></figure>\n<p>When you call my_method, the &amp; converts my_proc to a block and passes that block to the method.</p>\n<p>43) There are two differences between procs and lambdas. One has to do with the return keyword, and the other concerns the checking of arguments.</p>\n<p>In a lambda, return just returns from the lambda.<br>In a proc, return behaves differently. Rather than return from the proc, it returns from the scope where the proc itself was defined:</p>\n<p>lambdas tend to be less tolerant than procs (and regular blocks) when it comes to arguments. Call a lambda with the wrong arity, and it fails with an ArgumentError. On the other hand, a proc fits the argument list to its own expectations:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyClass</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">initialize</span><span class=\"params\">(value)</span></span></span><br><span class=\"line\">    @x = value</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">my_method</span></span></span><br><span class=\"line\">    @x</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\">    </span><br><span class=\"line\">object = MyClass.new(<span class=\"number\">1</span>)</span><br><span class=\"line\">m = object.method <span class=\"symbol\">:my_method</span></span><br><span class=\"line\">m.call <span class=\"comment\"># =&gt; 1</span></span><br></pre></td></tr></table></figure>\n\n<p>44) By calling Kernel#method, you get the method itself as a Method object, which you can later execute with Method#call.</p>\n<h3 id=\"Writing-a-Domain-Specific-Language\"><a href=\"#Writing-a-Domain-Specific-Language\" class=\"headerlink\" title=\"Writing a Domain-Specific Language\"></a>Writing a Domain-Specific Language</h3><p>N/A</p>\n<h2 id=\"CLASS-DEFINITIONS\"><a href=\"#CLASS-DEFINITIONS\" class=\"headerlink\" title=\"CLASS DEFINITIONS\"></a>CLASS DEFINITIONS</h2><h3 id=\"Class-Definitions-Demystified\"><a href=\"#Class-Definitions-Demystified\" class=\"headerlink\" title=\"Class Definitions Demystified\"></a>Class Definitions Demystified</h3><h3 id=\"Singleton-Methods\"><a href=\"#Singleton-Methods\" class=\"headerlink\" title=\"Singleton Methods\"></a>Singleton Methods</h3><h3 id=\"Singleton-Classes\"><a href=\"#Singleton-Classes\" class=\"headerlink\" title=\"Singleton Classes\"></a>Singleton Classes</h3><h3 id=\"Method-Wrappers\"><a href=\"#Method-Wrappers\" class=\"headerlink\" title=\"Method Wrappers\"></a>Method Wrappers</h3><p>45) At the top level of your program, the current class is Object, the class of main. (<strong>That’s why, if you define a method at the top level, that method becomes an instance method of Object.</strong>)</p>\n<p>46) Module#class_eval is very different from BasicObject#instance_eval, which you learned about earlier in instance_eval(), on page 85. instance_eval only changes self, <strong>while class_eval changes both self and the current class.</strong></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">add_method_to</span><span class=\"params\">(a_class)</span></span></span><br><span class=\"line\">  a_class.class_eval <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">m</span>;</span> <span class=\"string\">'Hello!'</span>; <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">add_method_to String</span><br><span class=\"line\"><span class=\"string\">\"abc\"</span>.m <span class=\"comment\"># =&gt; \"Hello!\"</span></span><br></pre></td></tr></table></figure>\n"},{"title":"Hello Hexo!","date":"2019-11-12T03:38:22.000Z","label":"#til","_content":"\n![the con](/../images/thecon.jpg)\n\n1. `hexo init new_project`\n\n2. `hexo s`\n\n3. `hexo clean` (remove public folder)\n\n4. `hexo generate` (generate static site from your post and something related)\n\n5. `hexo deploy` (install and use hexo-deployer-git)\n\n6. Config _config.yml to use hexo-deployer-git and add some information\n\n-----\n","source":"_posts/2019-8-21-hello-hexo.md","raw":"---\ntitle: Hello Hexo!\ndate: 2019-11-12 10:38:22\ntags:\nlabel: \"#til\"\n---\n\n![the con](/../images/thecon.jpg)\n\n1. `hexo init new_project`\n\n2. `hexo s`\n\n3. `hexo clean` (remove public folder)\n\n4. `hexo generate` (generate static site from your post and something related)\n\n5. `hexo deploy` (install and use hexo-deployer-git)\n\n6. Config _config.yml to use hexo-deployer-git and add some information\n\n-----\n","slug":"2019-8-21-hello-hexo","published":1,"updated":"2022-01-29T09:29:59.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbe003jp3m22kjv8s4y","content":"<p><img src=\"/../images/thecon.jpg\" alt=\"the con\"></p>\n<ol>\n<li><p><code>hexo init new_project</code></p>\n</li>\n<li><p><code>hexo s</code></p>\n</li>\n<li><p><code>hexo clean</code> (remove public folder)</p>\n</li>\n<li><p><code>hexo generate</code> (generate static site from your post and something related)</p>\n</li>\n<li><p><code>hexo deploy</code> (install and use hexo-deployer-git)</p>\n</li>\n<li><p>Config _config.yml to use hexo-deployer-git and add some information</p>\n</li>\n</ol>\n<hr>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/../images/thecon.jpg\" alt=\"the con\"></p>\n<ol>\n<li><p><code>hexo init new_project</code></p>\n</li>\n<li><p><code>hexo s</code></p>\n</li>\n<li><p><code>hexo clean</code> (remove public folder)</p>\n</li>\n<li><p><code>hexo generate</code> (generate static site from your post and something related)</p>\n</li>\n<li><p><code>hexo deploy</code> (install and use hexo-deployer-git)</p>\n</li>\n<li><p>Config _config.yml to use hexo-deployer-git and add some information</p>\n</li>\n</ol>\n<hr>\n"},{"title":"SQL Performance Explained","date":"2020-01-04T17:00:00.000Z","label":"#book","_content":"\n> The notes of mine after read SQL Performance Explained Ebook (boring, but helpful).\n\n## Anatomy of an Index\n\nCơ sở dữ liệu sử dụng 2 loại cấu trúc để lưu trữ index. **B-Tree** và **Doubly Linked List**. Vì vậy cách sử dụng 2 loại cấu trúc này sẽ giải thích cho phần lớn các đặc tính của SQL.\n\n### Doubly Linked List\n\n1. Mỗi một node (node chứa index) sẽ là một node trong 1 **Doubly Linked List**, vì vậy nó sẽ có liên kết tới đến 2 node lân cận (một trước và một sau). Khi ta muốn chèn thêm 1 node mới vào dslk đôi này. Ta sẽ tìm vị trí 2 node cần chèn node mới vào giữa chúng, đơn giản chỉ thay đổi con trỏ của 2 node đó. Vì thế vị trí vật lý của node mới không quan trọng. Lợi ích của việc này là giúp việc chèn thêm dữ liệu không tốn quá nhiều công sức, chỉ thay đổi vài con trỏ.\n\n2. Mỗi **leaf node** được lưu chữ trong 1 block/page. Mỗi block sẽ thườn là 1 vài KB, csdl sẽ cố gắng lưu nhiều node (node chưa index) nhất có thể trong mỗi block/page. Vậy csdl sẽ dùng dsdl đôi để quản lý trong 2 cấp (Dùng trong các node thuộc 1 block/page và dùng giữa các blog với nhau). Hiểu đơn giản như ta chia Việt Nam thành 63 block ứng với 63 tỉnh thành. Mỗi khi ta muốn tìm 1 tỉnh nào đó thì tìm trong sdl đôi của 63 tỉnh. Khi đã tìm thấy tỉnh cần tìm ta muốn tìm đến huyện (các huyện trong tỉnh đó cũng dùng dslk đôi để kết nối). Nhìn hình dưới đây.\n\n![2 level doubly linked list](/../images/leaf-node.png)\n\n### The Search Tree (B-Tree)\n\n1. Dslk đôi giúp thực hiện nhanh các thao tác chèn, xoá node, tuy nhiên vậy còn tìm kiếm thì sao. Nhớ lại cấu trúc dslk thì việc tìm kiếm là tuyến tính, vì vậy chúng ta cần một cấu trúc dữ liệu bổ sung để giúp csdl biết được đối tượng cần tìm đang nằm trong block/page nào 1 cách nhanh chóng. Và cấu trúc dữ liệu được chọn là B-Tree. Nhìn hình dưới đây:\n\n![b-tree](/../images/b-tree-sql.png)\n\n2. Như hình trên. Dslk đôi giúp sắp xếp các node và các block/page. Root và **branch node** giúp đẩy nhanh quá trình tìm kiếm 1 block/page cần thiết.\n\n3. Lý do B-Tree được lựa chọn và sử dụng rộng rãi là vì đặc tính cân bằng của cây. Độ cao của cây là không đổi từ root đến bất kể node lá nào. Tính tăng trưởng chiều cao của cây theo Logarit khi tăng node lá dẫn đến 1 cây bậc 4, 5 có thể chứa hàng triệu node và trong thực tế gần như không có trường hợp nào có độ sâu lên đến 6.\n\n## The Where Clause\n\n### Concatenated Indexes\n\n1. Các hệ quản trị cơ sở dữ liệu hiện nay sẽ đánh index cho khoá chính một cách tự động.\n\n2. **Concatenated Indexes**: Index được tạo bằng nhiều cột.\n\n3. Một index được tạo từ 2 cột ví dụ **col-1** và **col-2** thì trong 1 câu truy vấn where dùng với 2 cột trên, index sẽ hoạt động không khác gì so với index một cột cả. Tuy nhiên thứ tự 2 cột trong câu lệnh tạo index sẽ rất quan trọng.\n\ne.g:\n\n```sql\nCREATE UNIQUE INDEX employee_pk\n  ON employees (employee_id, subsidiary_id);\n```\n\nKhi này nếu chúng ta dùng truy vấn sau:\n\n```sql\nSELECT first_name, last_name\n  FROM employees\n  WHERE subsidiary_id = 20;\n```\n\nIndex sẽ tạo bên trên vô dụng và csdl sẽ full scan toàn bộ bảng employees.\n\n> Cột đầu tiên sẽ là tiêu chí chính để xác định record cần tìm, chỉ sử dụng cột thứ 2 khi mà có nhiều hơn 1 record đáp ứng được tiêu chí về cột đầu tiên. Vì vậy 1 truy vấn với cột thứ 2 sẽ là vô nghĩa.\n\n![2-col](/../images/2-col.png)\n\nTrong hình trên ta có thể thấy, B-Tree được sắp xếp theo cột đầu tiên, và ta chỉ sử dụng cột thứ 2 khi có nhiều hơn 1 record đáp ứng được điều kiện với cột đầu tiên. Ví dụ như record có id = 123, B-Tree sẽ dẫn chúng ta tới block chứa id này, ở đây vì có nhiều hơn 1 record có id = 123. Nó mới dựa vào cột thứ 2 để lấy record cần tìm. Vậy nếu ta query với điều kiện where chỉ có cột thứ 2 thì rõ ràng là hoàn toàn vô nghĩa.\n\n4. Bản thân B-Tree trong trường hớp này cũng chỉ lưu cột thứ 2 ở node lá mà thôi, những node trung gian không có thông tin của cột 2.\n\n> Điều quan trọng nhất khi tạo một index gồm nhiều cột là xác định xem nên chọn cột nào làm cột đầu tiên trong index.\n\n### Function-base index\n\nTrong trường hợp đã đánh index cho cột **last_name**, vì không kiểm soát được dữ liệu của người dùng nhập và dữ liệu trong csdl, chữ hoa và chữ thường trong trường hợp này không phân biệt. Vậy ta nên làm gì?\n\n```sql\nSELECT first_name, last_name, phone_number\n  FROM employees\n  WHERE UPPER(last_name) = UPPER('winand');\n```\n\nTìm các record có last_name = 'winand', trước khi tìm kiếm thì sẽ dùng hàm UPPER để covert dữ liệu sang chữ hoa khi so khớp. Nhớ điều kiện bên trên, chúng ta đã đánh index cho field **last_name** tuy nhiên trong trường hợp này index sẽ không còn hoạt động, thay vào đó là 1 full scan toàn bộ bảng.\n\nMô tuýt:\n\n```sql\nSELECT first_name, last_name, phone_number\n  FROM employees\n  WHERE BLACKBOX(...) = 'WINAND';\n```\n\nTrong đó thay **BLACKBOX** bằng một function bất kỳ, ứng với việc index không còn hoạt động.\n\nGiải pháp: Đánh index luôn giá trị thực sự sẽ dùng khi tìm kiếm, ở đây là last_name dưới dạng viết hoa.\n\n```sql\nCREATE INDEX emp_up_name\n  ON employees (UPPER(last_name));\n```\n\n> Ta gọi chỉ mục được tạo trên là function-based index (FBI), chỉ mục dựa trên function.\n\nThay vì copy luôn dữ liệu cột được đánh vào cây index. Một function-based index sẽ apply function vào dữ liệu trước khi ghi vào cây index. Vậy trong ví dụ trên, cây index sẽ chứa toàn bộ last_name dưới dạng chữ hoa.\n\n> Một số ORM dùng upper/lower 1 cách ngầm và mặc định, chớ không cần dev phải trực tiếp thực hiện, ví dụ như Hibernate sẽ tự động thực hiện function-based index với lower của cột cần đánh.\n\nTrên là kiến thức SQL, với các hệ quản trị cơ sở dữ liệu trong thực tế, cách thực hiện không phải lúc nào cũng như vậy.\n\n### User-Defined Functions\n\nKhông phải function nào cũng có thể dùng cho function-based index.\n\nChỉ những function là **deterministic** mới có thể dùng trong function-based index.\n\n> deterministic: những function trả về cùng một kết quả khi nhận tham số giống nhau.\n\n```sql\nCREATE FUNCTION get_age(date_of_birth DATE)\nRETURN NUMBER\nAS\nBEGIN\n RETURN\n TRUNC(MONTHS_BETWEEN(SYSDATE, date_of_birth)/12);\nEND;\n```\n\nKhông thể dùng **get_age** cho function-based index. Vì ví dụ tôi sinh ngày 30/08/1995. Ứng với mỗi thời điểm khác nhau output của hàm này sẽ khác nhau với cùng một đối số truyền vào là ngày sinh của tôi. Vậy nên nó không dùng để function-based index được.\n\n> Các function khác không thể dụng cho index là function random hoặc function dựa trên biến môi trường.\n\nNotes: Giả sử chúng ta đánh index cho cột **last_name** rồi đánh tiếp cho **UPPER(last_name)**, với mỗi lần update đối tượng có trường last_name, đồng nghĩa chúng ta phải update cho 2 index. Ứng với 2 index đã đánh, vì vậy không nên đánh index quá nhiều, nhất là với function-based index.\n\n### Parameterized Queries\n\n> Bind parameters/dynamic parameters/ bind variables là một cách truyền tham số vào câu query gián tiếp bằng các ký hiệu như **?**, **:name**, **@name**.\n\n> Bind variables are the best way to prevent SQL injection.\n\n> Các hệ quản trị csdl sẽ cache lại các dữ liệu đường truy cập y hệt nhau. Khi ta thay đổi tham số truyền vào hệ cơ sở dữ liệu sẽ query mới và không còn dùng cache.\n\n> Not using bind parameters is like recompiling a program every time.\n\n### Searching for Ranges\n\n> Rủi do hiệu suất lớn nhất với INDEX RANGE SCAN là quá trình duyệt qua nút lá.\n\n```sql\nSELECT first_name, last_name, date_of_birth\n  FROM employees\n  WHERE date_of_birth >= TO_DATE(?, 'YYYY-MM-DD')\n  AND date_of_birth <= TO_DATE(?, 'YYYY-MM-DD')\n  AND subsidiary_id = ?\n```\n\nOk, giờ chúng ta có một câu truy vấn như trên, tìm tất cả nhân viên có subsidiary_id = 27 và ngày sinh nằm trong khoảng 1/1/1971 và 9/1/1971.\n\nChúng ta sẽ đánh index cho 2 cột trên, đánh như bên trên đã ghi. Tuy nhiên **thứ tự đánh index** như nào?\n\n**Trường hợp xếp date_or_birth trước**:\n\n![date- first](/../images/date-first.png)\n\n**Trường hợp xếp subsidiary_id trước**:\n\n![sub- first](/../images/sub-first.png)\n\n**Tại sao trường hợp cho subsidiary_id đầu tiên trong index lại đem lại performance tốt hơn?**\n\nLý giải: khi dùng range first, kiểu gì cũng phải duyệt hết range đó thôi, record nào trong range đó là sẽ được duyệt qua rồi so khớp với điều kiện so bằng thứ hai.\n\nKhi dùng trường so bằng đầu tiên, ta làm giảm phạm vì số record cần quét qua (theo quy tắc của B-Tree).\n\n> Rule of thumb: index for equality first—then for ranges.\n\n### Indexing LIKE Filters\n\nVới các query với **LIKE**, chúng ta vẫn có thể đánh index bình thường lên trường được truy vấn. Tuy nhiên trong một số trường hợp chúng ta sẽ gặp vấn đề ví dụ như:\n\nDùng ký tự **%** trong từ cần tìm.\n\n```sql\nSELECT first_name, last_name, date_of_birth\n  FROM employees\n  WHERE UPPER(last_name) LIKE 'WINND'\n```\n\nĐánh index trên last_name và ngon.\n\n```sql\nSELECT first_name, last_name, date_of_birth\n  FROM employees\n  WHERE UPPER(last_name) LIKE 'WIN%D'\n```\n\nKý tự **%** xuất hiện và không ngon nữa rồi. Vì lúc này, **index** chỉ sử dụng phần trước **%** để tính khoảng range cần quét, còn phần đằng sau **%** chỉ dùng nhiệm vụ so khớp.\n\nTức là phải quét qua bao nhiêu phần tử sẽ hoàn toàn do phần đầu tiên quyết định. Từ có ta có 2 định nghĩa tác giả nêu ra:\n\n1. **access predicate**: phần đầu\n2. **filter predicate**: phần còn lại\n\nVí dụ hình dưới đây:\n\n![like-query](/../images/like-query.png)\n\nKhi thay cụm từ đứng trước **%** từ WI -> WIN -> WINA thì scan range đã thay đổi từ:\n\n18 -> 2 -> 1 (trong cơ sở dữ liệu mẫu).\n\n### Index Merge\n\n> One index scan is faster than two.\n\nLiệu nên tạo mỗi index cho một column, hay tạo một index cho tất cả column, trường hợp nào hiệu quả hơn? Câu trả lời của tác giả là nhiều cột cho một index sẽ hiệu quả hơn trong truy vấn where.\n\nTại sao lại như vậy?\n\nQuay trở lại định nghĩa, chúng ta đã được đọc rằng index dùng B-Tree kết hợp với dslk đôi để cover các trường hợp.\n\nVậy giả sử, ta đánh index lên 2 column (last_name và date_of_bird) theo đúng thứ tự sắp xếp. Khi này hệ quản trị csdl sẽ đánh sắp khoảng theo last_name, tức là node lá sẽ bắt đầu tới last_name có ký tự nhỏ nhất (ví dụ là A) và node lá cuối cùng sẽ là ký tự lớn nhất (ví dụ là Z). Khi này, trường thứ 2 trong index chỉ dùng để so khớp khi ta có 2 last_name bằng nhau mà thôi.\n\n\nVậy nếu ta đánh 2 index riêng biệt cho last_name và date_of_bird thì sao? Lúc này với một câu truy vấn dưới đây:\n\n```sql\nSELECT first_name, last_name, date_of_birth\n  FROM employees\n  WHERE UPPER(last_name) < ?\n  AND date_of_birth < ?\n```\n\nhệ quản trị csdl sẽ phải duyệt qua 2 cây index (1 cây ứng với index cho last_name và cây còn lại ứng với index cho date_of_birth). Sau đó combine kết quả của 2 lần duyệt ở trên lại.\n\nSẽ tốn resource hơn rất nhiều so với đánh 1 index cho last_name + date_of_birth.\n\n> Có một loại index giúp giải quyết bài toán trên gọi là bitmap index, tuy nhiên bitmap index gặp vấn đề lớn trong việc ghi đồng thời, vì thế nó không thể sử dụng trong các csdl thanh toán online.\n\n### Partial Indexes\n\nĐánh chỉ mục cho 1 nhóm phần tử thuộc 1 bảng.\n\n```sql\nCREATE INDEX messages_todo\n  ON messages (receiver)\n  WHERE processed = 'N'\n```\n\nĐánh index cho các row thuộc bảng messages mà có column processed có giá trị bằng N.\n\nVậy ta dùng được index này khi nào. Câu trả lời là chúng ta có thể dùng mọi lúc khi query với mệnh đề where.\n\n## Performance and Scalability\n\n## The Join Operation\n\n## Clustering Data\n","source":"_posts/2020-01-05-sql-performance-explained-notes.md","raw":"---\ntitle: \"SQL Performance Explained\"\ndate: 2020-01-05\ntags: [\"NOTES\"]\nlabel: \"#book\"\n---\n\n> The notes of mine after read SQL Performance Explained Ebook (boring, but helpful).\n\n## Anatomy of an Index\n\nCơ sở dữ liệu sử dụng 2 loại cấu trúc để lưu trữ index. **B-Tree** và **Doubly Linked List**. Vì vậy cách sử dụng 2 loại cấu trúc này sẽ giải thích cho phần lớn các đặc tính của SQL.\n\n### Doubly Linked List\n\n1. Mỗi một node (node chứa index) sẽ là một node trong 1 **Doubly Linked List**, vì vậy nó sẽ có liên kết tới đến 2 node lân cận (một trước và một sau). Khi ta muốn chèn thêm 1 node mới vào dslk đôi này. Ta sẽ tìm vị trí 2 node cần chèn node mới vào giữa chúng, đơn giản chỉ thay đổi con trỏ của 2 node đó. Vì thế vị trí vật lý của node mới không quan trọng. Lợi ích của việc này là giúp việc chèn thêm dữ liệu không tốn quá nhiều công sức, chỉ thay đổi vài con trỏ.\n\n2. Mỗi **leaf node** được lưu chữ trong 1 block/page. Mỗi block sẽ thườn là 1 vài KB, csdl sẽ cố gắng lưu nhiều node (node chưa index) nhất có thể trong mỗi block/page. Vậy csdl sẽ dùng dsdl đôi để quản lý trong 2 cấp (Dùng trong các node thuộc 1 block/page và dùng giữa các blog với nhau). Hiểu đơn giản như ta chia Việt Nam thành 63 block ứng với 63 tỉnh thành. Mỗi khi ta muốn tìm 1 tỉnh nào đó thì tìm trong sdl đôi của 63 tỉnh. Khi đã tìm thấy tỉnh cần tìm ta muốn tìm đến huyện (các huyện trong tỉnh đó cũng dùng dslk đôi để kết nối). Nhìn hình dưới đây.\n\n![2 level doubly linked list](/../images/leaf-node.png)\n\n### The Search Tree (B-Tree)\n\n1. Dslk đôi giúp thực hiện nhanh các thao tác chèn, xoá node, tuy nhiên vậy còn tìm kiếm thì sao. Nhớ lại cấu trúc dslk thì việc tìm kiếm là tuyến tính, vì vậy chúng ta cần một cấu trúc dữ liệu bổ sung để giúp csdl biết được đối tượng cần tìm đang nằm trong block/page nào 1 cách nhanh chóng. Và cấu trúc dữ liệu được chọn là B-Tree. Nhìn hình dưới đây:\n\n![b-tree](/../images/b-tree-sql.png)\n\n2. Như hình trên. Dslk đôi giúp sắp xếp các node và các block/page. Root và **branch node** giúp đẩy nhanh quá trình tìm kiếm 1 block/page cần thiết.\n\n3. Lý do B-Tree được lựa chọn và sử dụng rộng rãi là vì đặc tính cân bằng của cây. Độ cao của cây là không đổi từ root đến bất kể node lá nào. Tính tăng trưởng chiều cao của cây theo Logarit khi tăng node lá dẫn đến 1 cây bậc 4, 5 có thể chứa hàng triệu node và trong thực tế gần như không có trường hợp nào có độ sâu lên đến 6.\n\n## The Where Clause\n\n### Concatenated Indexes\n\n1. Các hệ quản trị cơ sở dữ liệu hiện nay sẽ đánh index cho khoá chính một cách tự động.\n\n2. **Concatenated Indexes**: Index được tạo bằng nhiều cột.\n\n3. Một index được tạo từ 2 cột ví dụ **col-1** và **col-2** thì trong 1 câu truy vấn where dùng với 2 cột trên, index sẽ hoạt động không khác gì so với index một cột cả. Tuy nhiên thứ tự 2 cột trong câu lệnh tạo index sẽ rất quan trọng.\n\ne.g:\n\n```sql\nCREATE UNIQUE INDEX employee_pk\n  ON employees (employee_id, subsidiary_id);\n```\n\nKhi này nếu chúng ta dùng truy vấn sau:\n\n```sql\nSELECT first_name, last_name\n  FROM employees\n  WHERE subsidiary_id = 20;\n```\n\nIndex sẽ tạo bên trên vô dụng và csdl sẽ full scan toàn bộ bảng employees.\n\n> Cột đầu tiên sẽ là tiêu chí chính để xác định record cần tìm, chỉ sử dụng cột thứ 2 khi mà có nhiều hơn 1 record đáp ứng được tiêu chí về cột đầu tiên. Vì vậy 1 truy vấn với cột thứ 2 sẽ là vô nghĩa.\n\n![2-col](/../images/2-col.png)\n\nTrong hình trên ta có thể thấy, B-Tree được sắp xếp theo cột đầu tiên, và ta chỉ sử dụng cột thứ 2 khi có nhiều hơn 1 record đáp ứng được điều kiện với cột đầu tiên. Ví dụ như record có id = 123, B-Tree sẽ dẫn chúng ta tới block chứa id này, ở đây vì có nhiều hơn 1 record có id = 123. Nó mới dựa vào cột thứ 2 để lấy record cần tìm. Vậy nếu ta query với điều kiện where chỉ có cột thứ 2 thì rõ ràng là hoàn toàn vô nghĩa.\n\n4. Bản thân B-Tree trong trường hớp này cũng chỉ lưu cột thứ 2 ở node lá mà thôi, những node trung gian không có thông tin của cột 2.\n\n> Điều quan trọng nhất khi tạo một index gồm nhiều cột là xác định xem nên chọn cột nào làm cột đầu tiên trong index.\n\n### Function-base index\n\nTrong trường hợp đã đánh index cho cột **last_name**, vì không kiểm soát được dữ liệu của người dùng nhập và dữ liệu trong csdl, chữ hoa và chữ thường trong trường hợp này không phân biệt. Vậy ta nên làm gì?\n\n```sql\nSELECT first_name, last_name, phone_number\n  FROM employees\n  WHERE UPPER(last_name) = UPPER('winand');\n```\n\nTìm các record có last_name = 'winand', trước khi tìm kiếm thì sẽ dùng hàm UPPER để covert dữ liệu sang chữ hoa khi so khớp. Nhớ điều kiện bên trên, chúng ta đã đánh index cho field **last_name** tuy nhiên trong trường hợp này index sẽ không còn hoạt động, thay vào đó là 1 full scan toàn bộ bảng.\n\nMô tuýt:\n\n```sql\nSELECT first_name, last_name, phone_number\n  FROM employees\n  WHERE BLACKBOX(...) = 'WINAND';\n```\n\nTrong đó thay **BLACKBOX** bằng một function bất kỳ, ứng với việc index không còn hoạt động.\n\nGiải pháp: Đánh index luôn giá trị thực sự sẽ dùng khi tìm kiếm, ở đây là last_name dưới dạng viết hoa.\n\n```sql\nCREATE INDEX emp_up_name\n  ON employees (UPPER(last_name));\n```\n\n> Ta gọi chỉ mục được tạo trên là function-based index (FBI), chỉ mục dựa trên function.\n\nThay vì copy luôn dữ liệu cột được đánh vào cây index. Một function-based index sẽ apply function vào dữ liệu trước khi ghi vào cây index. Vậy trong ví dụ trên, cây index sẽ chứa toàn bộ last_name dưới dạng chữ hoa.\n\n> Một số ORM dùng upper/lower 1 cách ngầm và mặc định, chớ không cần dev phải trực tiếp thực hiện, ví dụ như Hibernate sẽ tự động thực hiện function-based index với lower của cột cần đánh.\n\nTrên là kiến thức SQL, với các hệ quản trị cơ sở dữ liệu trong thực tế, cách thực hiện không phải lúc nào cũng như vậy.\n\n### User-Defined Functions\n\nKhông phải function nào cũng có thể dùng cho function-based index.\n\nChỉ những function là **deterministic** mới có thể dùng trong function-based index.\n\n> deterministic: những function trả về cùng một kết quả khi nhận tham số giống nhau.\n\n```sql\nCREATE FUNCTION get_age(date_of_birth DATE)\nRETURN NUMBER\nAS\nBEGIN\n RETURN\n TRUNC(MONTHS_BETWEEN(SYSDATE, date_of_birth)/12);\nEND;\n```\n\nKhông thể dùng **get_age** cho function-based index. Vì ví dụ tôi sinh ngày 30/08/1995. Ứng với mỗi thời điểm khác nhau output của hàm này sẽ khác nhau với cùng một đối số truyền vào là ngày sinh của tôi. Vậy nên nó không dùng để function-based index được.\n\n> Các function khác không thể dụng cho index là function random hoặc function dựa trên biến môi trường.\n\nNotes: Giả sử chúng ta đánh index cho cột **last_name** rồi đánh tiếp cho **UPPER(last_name)**, với mỗi lần update đối tượng có trường last_name, đồng nghĩa chúng ta phải update cho 2 index. Ứng với 2 index đã đánh, vì vậy không nên đánh index quá nhiều, nhất là với function-based index.\n\n### Parameterized Queries\n\n> Bind parameters/dynamic parameters/ bind variables là một cách truyền tham số vào câu query gián tiếp bằng các ký hiệu như **?**, **:name**, **@name**.\n\n> Bind variables are the best way to prevent SQL injection.\n\n> Các hệ quản trị csdl sẽ cache lại các dữ liệu đường truy cập y hệt nhau. Khi ta thay đổi tham số truyền vào hệ cơ sở dữ liệu sẽ query mới và không còn dùng cache.\n\n> Not using bind parameters is like recompiling a program every time.\n\n### Searching for Ranges\n\n> Rủi do hiệu suất lớn nhất với INDEX RANGE SCAN là quá trình duyệt qua nút lá.\n\n```sql\nSELECT first_name, last_name, date_of_birth\n  FROM employees\n  WHERE date_of_birth >= TO_DATE(?, 'YYYY-MM-DD')\n  AND date_of_birth <= TO_DATE(?, 'YYYY-MM-DD')\n  AND subsidiary_id = ?\n```\n\nOk, giờ chúng ta có một câu truy vấn như trên, tìm tất cả nhân viên có subsidiary_id = 27 và ngày sinh nằm trong khoảng 1/1/1971 và 9/1/1971.\n\nChúng ta sẽ đánh index cho 2 cột trên, đánh như bên trên đã ghi. Tuy nhiên **thứ tự đánh index** như nào?\n\n**Trường hợp xếp date_or_birth trước**:\n\n![date- first](/../images/date-first.png)\n\n**Trường hợp xếp subsidiary_id trước**:\n\n![sub- first](/../images/sub-first.png)\n\n**Tại sao trường hợp cho subsidiary_id đầu tiên trong index lại đem lại performance tốt hơn?**\n\nLý giải: khi dùng range first, kiểu gì cũng phải duyệt hết range đó thôi, record nào trong range đó là sẽ được duyệt qua rồi so khớp với điều kiện so bằng thứ hai.\n\nKhi dùng trường so bằng đầu tiên, ta làm giảm phạm vì số record cần quét qua (theo quy tắc của B-Tree).\n\n> Rule of thumb: index for equality first—then for ranges.\n\n### Indexing LIKE Filters\n\nVới các query với **LIKE**, chúng ta vẫn có thể đánh index bình thường lên trường được truy vấn. Tuy nhiên trong một số trường hợp chúng ta sẽ gặp vấn đề ví dụ như:\n\nDùng ký tự **%** trong từ cần tìm.\n\n```sql\nSELECT first_name, last_name, date_of_birth\n  FROM employees\n  WHERE UPPER(last_name) LIKE 'WINND'\n```\n\nĐánh index trên last_name và ngon.\n\n```sql\nSELECT first_name, last_name, date_of_birth\n  FROM employees\n  WHERE UPPER(last_name) LIKE 'WIN%D'\n```\n\nKý tự **%** xuất hiện và không ngon nữa rồi. Vì lúc này, **index** chỉ sử dụng phần trước **%** để tính khoảng range cần quét, còn phần đằng sau **%** chỉ dùng nhiệm vụ so khớp.\n\nTức là phải quét qua bao nhiêu phần tử sẽ hoàn toàn do phần đầu tiên quyết định. Từ có ta có 2 định nghĩa tác giả nêu ra:\n\n1. **access predicate**: phần đầu\n2. **filter predicate**: phần còn lại\n\nVí dụ hình dưới đây:\n\n![like-query](/../images/like-query.png)\n\nKhi thay cụm từ đứng trước **%** từ WI -> WIN -> WINA thì scan range đã thay đổi từ:\n\n18 -> 2 -> 1 (trong cơ sở dữ liệu mẫu).\n\n### Index Merge\n\n> One index scan is faster than two.\n\nLiệu nên tạo mỗi index cho một column, hay tạo một index cho tất cả column, trường hợp nào hiệu quả hơn? Câu trả lời của tác giả là nhiều cột cho một index sẽ hiệu quả hơn trong truy vấn where.\n\nTại sao lại như vậy?\n\nQuay trở lại định nghĩa, chúng ta đã được đọc rằng index dùng B-Tree kết hợp với dslk đôi để cover các trường hợp.\n\nVậy giả sử, ta đánh index lên 2 column (last_name và date_of_bird) theo đúng thứ tự sắp xếp. Khi này hệ quản trị csdl sẽ đánh sắp khoảng theo last_name, tức là node lá sẽ bắt đầu tới last_name có ký tự nhỏ nhất (ví dụ là A) và node lá cuối cùng sẽ là ký tự lớn nhất (ví dụ là Z). Khi này, trường thứ 2 trong index chỉ dùng để so khớp khi ta có 2 last_name bằng nhau mà thôi.\n\n\nVậy nếu ta đánh 2 index riêng biệt cho last_name và date_of_bird thì sao? Lúc này với một câu truy vấn dưới đây:\n\n```sql\nSELECT first_name, last_name, date_of_birth\n  FROM employees\n  WHERE UPPER(last_name) < ?\n  AND date_of_birth < ?\n```\n\nhệ quản trị csdl sẽ phải duyệt qua 2 cây index (1 cây ứng với index cho last_name và cây còn lại ứng với index cho date_of_birth). Sau đó combine kết quả của 2 lần duyệt ở trên lại.\n\nSẽ tốn resource hơn rất nhiều so với đánh 1 index cho last_name + date_of_birth.\n\n> Có một loại index giúp giải quyết bài toán trên gọi là bitmap index, tuy nhiên bitmap index gặp vấn đề lớn trong việc ghi đồng thời, vì thế nó không thể sử dụng trong các csdl thanh toán online.\n\n### Partial Indexes\n\nĐánh chỉ mục cho 1 nhóm phần tử thuộc 1 bảng.\n\n```sql\nCREATE INDEX messages_todo\n  ON messages (receiver)\n  WHERE processed = 'N'\n```\n\nĐánh index cho các row thuộc bảng messages mà có column processed có giá trị bằng N.\n\nVậy ta dùng được index này khi nào. Câu trả lời là chúng ta có thể dùng mọi lúc khi query với mệnh đề where.\n\n## Performance and Scalability\n\n## The Join Operation\n\n## Clustering Data\n","slug":"2020-01-05-sql-performance-explained-notes","published":1,"updated":"2022-01-29T09:29:59.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbe003lp3m2fx8adqn7","content":"<blockquote>\n<p>The notes of mine after read SQL Performance Explained Ebook (boring, but helpful).</p>\n</blockquote>\n<h2 id=\"Anatomy-of-an-Index\"><a href=\"#Anatomy-of-an-Index\" class=\"headerlink\" title=\"Anatomy of an Index\"></a>Anatomy of an Index</h2><p>Cơ sở dữ liệu sử dụng 2 loại cấu trúc để lưu trữ index. <strong>B-Tree</strong> và <strong>Doubly Linked List</strong>. Vì vậy cách sử dụng 2 loại cấu trúc này sẽ giải thích cho phần lớn các đặc tính của SQL.</p>\n<h3 id=\"Doubly-Linked-List\"><a href=\"#Doubly-Linked-List\" class=\"headerlink\" title=\"Doubly Linked List\"></a>Doubly Linked List</h3><ol>\n<li><p>Mỗi một node (node chứa index) sẽ là một node trong 1 <strong>Doubly Linked List</strong>, vì vậy nó sẽ có liên kết tới đến 2 node lân cận (một trước và một sau). Khi ta muốn chèn thêm 1 node mới vào dslk đôi này. Ta sẽ tìm vị trí 2 node cần chèn node mới vào giữa chúng, đơn giản chỉ thay đổi con trỏ của 2 node đó. Vì thế vị trí vật lý của node mới không quan trọng. Lợi ích của việc này là giúp việc chèn thêm dữ liệu không tốn quá nhiều công sức, chỉ thay đổi vài con trỏ.</p>\n</li>\n<li><p>Mỗi <strong>leaf node</strong> được lưu chữ trong 1 block/page. Mỗi block sẽ thườn là 1 vài KB, csdl sẽ cố gắng lưu nhiều node (node chưa index) nhất có thể trong mỗi block/page. Vậy csdl sẽ dùng dsdl đôi để quản lý trong 2 cấp (Dùng trong các node thuộc 1 block/page và dùng giữa các blog với nhau). Hiểu đơn giản như ta chia Việt Nam thành 63 block ứng với 63 tỉnh thành. Mỗi khi ta muốn tìm 1 tỉnh nào đó thì tìm trong sdl đôi của 63 tỉnh. Khi đã tìm thấy tỉnh cần tìm ta muốn tìm đến huyện (các huyện trong tỉnh đó cũng dùng dslk đôi để kết nối). Nhìn hình dưới đây.</p>\n</li>\n</ol>\n<p><img src=\"/../images/leaf-node.png\" alt=\"2 level doubly linked list\"></p>\n<h3 id=\"The-Search-Tree-B-Tree\"><a href=\"#The-Search-Tree-B-Tree\" class=\"headerlink\" title=\"The Search Tree (B-Tree)\"></a>The Search Tree (B-Tree)</h3><ol>\n<li>Dslk đôi giúp thực hiện nhanh các thao tác chèn, xoá node, tuy nhiên vậy còn tìm kiếm thì sao. Nhớ lại cấu trúc dslk thì việc tìm kiếm là tuyến tính, vì vậy chúng ta cần một cấu trúc dữ liệu bổ sung để giúp csdl biết được đối tượng cần tìm đang nằm trong block/page nào 1 cách nhanh chóng. Và cấu trúc dữ liệu được chọn là B-Tree. Nhìn hình dưới đây:</li>\n</ol>\n<p><img src=\"/../images/b-tree-sql.png\" alt=\"b-tree\"></p>\n<ol start=\"2\">\n<li><p>Như hình trên. Dslk đôi giúp sắp xếp các node và các block/page. Root và <strong>branch node</strong> giúp đẩy nhanh quá trình tìm kiếm 1 block/page cần thiết.</p>\n</li>\n<li><p>Lý do B-Tree được lựa chọn và sử dụng rộng rãi là vì đặc tính cân bằng của cây. Độ cao của cây là không đổi từ root đến bất kể node lá nào. Tính tăng trưởng chiều cao của cây theo Logarit khi tăng node lá dẫn đến 1 cây bậc 4, 5 có thể chứa hàng triệu node và trong thực tế gần như không có trường hợp nào có độ sâu lên đến 6.</p>\n</li>\n</ol>\n<h2 id=\"The-Where-Clause\"><a href=\"#The-Where-Clause\" class=\"headerlink\" title=\"The Where Clause\"></a>The Where Clause</h2><h3 id=\"Concatenated-Indexes\"><a href=\"#Concatenated-Indexes\" class=\"headerlink\" title=\"Concatenated Indexes\"></a>Concatenated Indexes</h3><ol>\n<li><p>Các hệ quản trị cơ sở dữ liệu hiện nay sẽ đánh index cho khoá chính một cách tự động.</p>\n</li>\n<li><p><strong>Concatenated Indexes</strong>: Index được tạo bằng nhiều cột.</p>\n</li>\n<li><p>Một index được tạo từ 2 cột ví dụ <strong>col-1</strong> và <strong>col-2</strong> thì trong 1 câu truy vấn where dùng với 2 cột trên, index sẽ hoạt động không khác gì so với index một cột cả. Tuy nhiên thứ tự 2 cột trong câu lệnh tạo index sẽ rất quan trọng.</p>\n</li>\n</ol>\n<p>e.g:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">INDEX</span> employee_pk</span><br><span class=\"line\">  <span class=\"keyword\">ON</span> employees (employee_id, subsidiary_id);</span><br></pre></td></tr></table></figure>\n\n<p>Khi này nếu chúng ta dùng truy vấn sau:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> subsidiary_id = <span class=\"number\">20</span>;</span><br></pre></td></tr></table></figure>\n\n<p>Index sẽ tạo bên trên vô dụng và csdl sẽ full scan toàn bộ bảng employees.</p>\n<blockquote>\n<p>Cột đầu tiên sẽ là tiêu chí chính để xác định record cần tìm, chỉ sử dụng cột thứ 2 khi mà có nhiều hơn 1 record đáp ứng được tiêu chí về cột đầu tiên. Vì vậy 1 truy vấn với cột thứ 2 sẽ là vô nghĩa.</p>\n</blockquote>\n<p><img src=\"/../images/2-col.png\" alt=\"2-col\"></p>\n<p>Trong hình trên ta có thể thấy, B-Tree được sắp xếp theo cột đầu tiên, và ta chỉ sử dụng cột thứ 2 khi có nhiều hơn 1 record đáp ứng được điều kiện với cột đầu tiên. Ví dụ như record có id = 123, B-Tree sẽ dẫn chúng ta tới block chứa id này, ở đây vì có nhiều hơn 1 record có id = 123. Nó mới dựa vào cột thứ 2 để lấy record cần tìm. Vậy nếu ta query với điều kiện where chỉ có cột thứ 2 thì rõ ràng là hoàn toàn vô nghĩa.</p>\n<ol start=\"4\">\n<li>Bản thân B-Tree trong trường hớp này cũng chỉ lưu cột thứ 2 ở node lá mà thôi, những node trung gian không có thông tin của cột 2.</li>\n</ol>\n<blockquote>\n<p>Điều quan trọng nhất khi tạo một index gồm nhiều cột là xác định xem nên chọn cột nào làm cột đầu tiên trong index.</p>\n</blockquote>\n<h3 id=\"Function-base-index\"><a href=\"#Function-base-index\" class=\"headerlink\" title=\"Function-base index\"></a>Function-base index</h3><p>Trong trường hợp đã đánh index cho cột <strong>last_name</strong>, vì không kiểm soát được dữ liệu của người dùng nhập và dữ liệu trong csdl, chữ hoa và chữ thường trong trường hợp này không phân biệt. Vậy ta nên làm gì?</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, phone_number</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> <span class=\"keyword\">UPPER</span>(last_name) = <span class=\"keyword\">UPPER</span>(<span class=\"string\">'winand'</span>);</span><br></pre></td></tr></table></figure>\n\n<p>Tìm các record có last_name = ‘winand’, trước khi tìm kiếm thì sẽ dùng hàm UPPER để covert dữ liệu sang chữ hoa khi so khớp. Nhớ điều kiện bên trên, chúng ta đã đánh index cho field <strong>last_name</strong> tuy nhiên trong trường hợp này index sẽ không còn hoạt động, thay vào đó là 1 full scan toàn bộ bảng.</p>\n<p>Mô tuýt:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, phone_number</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> BLACKBOX(...) = <span class=\"string\">'WINAND'</span>;</span><br></pre></td></tr></table></figure>\n\n<p>Trong đó thay <strong>BLACKBOX</strong> bằng một function bất kỳ, ứng với việc index không còn hoạt động.</p>\n<p>Giải pháp: Đánh index luôn giá trị thực sự sẽ dùng khi tìm kiếm, ở đây là last_name dưới dạng viết hoa.</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">INDEX</span> emp_up_name</span><br><span class=\"line\">  <span class=\"keyword\">ON</span> employees (<span class=\"keyword\">UPPER</span>(last_name));</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Ta gọi chỉ mục được tạo trên là function-based index (FBI), chỉ mục dựa trên function.</p>\n</blockquote>\n<p>Thay vì copy luôn dữ liệu cột được đánh vào cây index. Một function-based index sẽ apply function vào dữ liệu trước khi ghi vào cây index. Vậy trong ví dụ trên, cây index sẽ chứa toàn bộ last_name dưới dạng chữ hoa.</p>\n<blockquote>\n<p>Một số ORM dùng upper/lower 1 cách ngầm và mặc định, chớ không cần dev phải trực tiếp thực hiện, ví dụ như Hibernate sẽ tự động thực hiện function-based index với lower của cột cần đánh.</p>\n</blockquote>\n<p>Trên là kiến thức SQL, với các hệ quản trị cơ sở dữ liệu trong thực tế, cách thực hiện không phải lúc nào cũng như vậy.</p>\n<h3 id=\"User-Defined-Functions\"><a href=\"#User-Defined-Functions\" class=\"headerlink\" title=\"User-Defined Functions\"></a>User-Defined Functions</h3><p>Không phải function nào cũng có thể dùng cho function-based index.</p>\n<p>Chỉ những function là <strong>deterministic</strong> mới có thể dùng trong function-based index.</p>\n<blockquote>\n<p>deterministic: những function trả về cùng một kết quả khi nhận tham số giống nhau.</p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">FUNCTION</span> get_age(date_of_birth <span class=\"built_in\">DATE</span>)</span><br><span class=\"line\"><span class=\"keyword\">RETURN</span> <span class=\"built_in\">NUMBER</span></span><br><span class=\"line\"><span class=\"keyword\">AS</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\"> <span class=\"keyword\">RETURN</span></span><br><span class=\"line\"> TRUNC(MONTHS_BETWEEN(<span class=\"keyword\">SYSDATE</span>, date_of_birth)/<span class=\"number\">12</span>);</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br></pre></td></tr></table></figure>\n\n<p>Không thể dùng <strong>get_age</strong> cho function-based index. Vì ví dụ tôi sinh ngày 30/08/1995. Ứng với mỗi thời điểm khác nhau output của hàm này sẽ khác nhau với cùng một đối số truyền vào là ngày sinh của tôi. Vậy nên nó không dùng để function-based index được.</p>\n<blockquote>\n<p>Các function khác không thể dụng cho index là function random hoặc function dựa trên biến môi trường.</p>\n</blockquote>\n<p>Notes: Giả sử chúng ta đánh index cho cột <strong>last_name</strong> rồi đánh tiếp cho <strong>UPPER(last_name)</strong>, với mỗi lần update đối tượng có trường last_name, đồng nghĩa chúng ta phải update cho 2 index. Ứng với 2 index đã đánh, vì vậy không nên đánh index quá nhiều, nhất là với function-based index.</p>\n<h3 id=\"Parameterized-Queries\"><a href=\"#Parameterized-Queries\" class=\"headerlink\" title=\"Parameterized Queries\"></a>Parameterized Queries</h3><blockquote>\n<p>Bind parameters/dynamic parameters/ bind variables là một cách truyền tham số vào câu query gián tiếp bằng các ký hiệu như <strong>?</strong>, <strong>:name</strong>, <strong>@name</strong>.</p>\n</blockquote>\n<blockquote>\n<p>Bind variables are the best way to prevent SQL injection.</p>\n</blockquote>\n<blockquote>\n<p>Các hệ quản trị csdl sẽ cache lại các dữ liệu đường truy cập y hệt nhau. Khi ta thay đổi tham số truyền vào hệ cơ sở dữ liệu sẽ query mới và không còn dùng cache.</p>\n</blockquote>\n<blockquote>\n<p>Not using bind parameters is like recompiling a program every time.</p>\n</blockquote>\n<h3 id=\"Searching-for-Ranges\"><a href=\"#Searching-for-Ranges\" class=\"headerlink\" title=\"Searching for Ranges\"></a>Searching for Ranges</h3><blockquote>\n<p>Rủi do hiệu suất lớn nhất với INDEX RANGE SCAN là quá trình duyệt qua nút lá.</p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, date_of_birth</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> date_of_birth &gt;= <span class=\"keyword\">TO_DATE</span>(?, <span class=\"string\">'YYYY-MM-DD'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">AND</span> date_of_birth &lt;= <span class=\"keyword\">TO_DATE</span>(?, <span class=\"string\">'YYYY-MM-DD'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">AND</span> subsidiary_id = ?</span><br></pre></td></tr></table></figure>\n\n<p>Ok, giờ chúng ta có một câu truy vấn như trên, tìm tất cả nhân viên có subsidiary_id = 27 và ngày sinh nằm trong khoảng 1/1/1971 và 9/1/1971.</p>\n<p>Chúng ta sẽ đánh index cho 2 cột trên, đánh như bên trên đã ghi. Tuy nhiên <strong>thứ tự đánh index</strong> như nào?</p>\n<p><strong>Trường hợp xếp date_or_birth trước</strong>:</p>\n<p><img src=\"/../images/date-first.png\" alt=\"date- first\"></p>\n<p><strong>Trường hợp xếp subsidiary_id trước</strong>:</p>\n<p><img src=\"/../images/sub-first.png\" alt=\"sub- first\"></p>\n<p><strong>Tại sao trường hợp cho subsidiary_id đầu tiên trong index lại đem lại performance tốt hơn?</strong></p>\n<p>Lý giải: khi dùng range first, kiểu gì cũng phải duyệt hết range đó thôi, record nào trong range đó là sẽ được duyệt qua rồi so khớp với điều kiện so bằng thứ hai.</p>\n<p>Khi dùng trường so bằng đầu tiên, ta làm giảm phạm vì số record cần quét qua (theo quy tắc của B-Tree).</p>\n<blockquote>\n<p>Rule of thumb: index for equality first—then for ranges.</p>\n</blockquote>\n<h3 id=\"Indexing-LIKE-Filters\"><a href=\"#Indexing-LIKE-Filters\" class=\"headerlink\" title=\"Indexing LIKE Filters\"></a>Indexing LIKE Filters</h3><p>Với các query với <strong>LIKE</strong>, chúng ta vẫn có thể đánh index bình thường lên trường được truy vấn. Tuy nhiên trong một số trường hợp chúng ta sẽ gặp vấn đề ví dụ như:</p>\n<p>Dùng ký tự <strong>%</strong> trong từ cần tìm.</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, date_of_birth</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> <span class=\"keyword\">UPPER</span>(last_name) <span class=\"keyword\">LIKE</span> <span class=\"string\">'WINND'</span></span><br></pre></td></tr></table></figure>\n\n<p>Đánh index trên last_name và ngon.</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, date_of_birth</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> <span class=\"keyword\">UPPER</span>(last_name) <span class=\"keyword\">LIKE</span> <span class=\"string\">'WIN%D'</span></span><br></pre></td></tr></table></figure>\n\n<p>Ký tự <strong>%</strong> xuất hiện và không ngon nữa rồi. Vì lúc này, <strong>index</strong> chỉ sử dụng phần trước <strong>%</strong> để tính khoảng range cần quét, còn phần đằng sau <strong>%</strong> chỉ dùng nhiệm vụ so khớp.</p>\n<p>Tức là phải quét qua bao nhiêu phần tử sẽ hoàn toàn do phần đầu tiên quyết định. Từ có ta có 2 định nghĩa tác giả nêu ra:</p>\n<ol>\n<li><strong>access predicate</strong>: phần đầu</li>\n<li><strong>filter predicate</strong>: phần còn lại</li>\n</ol>\n<p>Ví dụ hình dưới đây:</p>\n<p><img src=\"/../images/like-query.png\" alt=\"like-query\"></p>\n<p>Khi thay cụm từ đứng trước <strong>%</strong> từ WI -&gt; WIN -&gt; WINA thì scan range đã thay đổi từ:</p>\n<p>18 -&gt; 2 -&gt; 1 (trong cơ sở dữ liệu mẫu).</p>\n<h3 id=\"Index-Merge\"><a href=\"#Index-Merge\" class=\"headerlink\" title=\"Index Merge\"></a>Index Merge</h3><blockquote>\n<p>One index scan is faster than two.</p>\n</blockquote>\n<p>Liệu nên tạo mỗi index cho một column, hay tạo một index cho tất cả column, trường hợp nào hiệu quả hơn? Câu trả lời của tác giả là nhiều cột cho một index sẽ hiệu quả hơn trong truy vấn where.</p>\n<p>Tại sao lại như vậy?</p>\n<p>Quay trở lại định nghĩa, chúng ta đã được đọc rằng index dùng B-Tree kết hợp với dslk đôi để cover các trường hợp.</p>\n<p>Vậy giả sử, ta đánh index lên 2 column (last_name và date_of_bird) theo đúng thứ tự sắp xếp. Khi này hệ quản trị csdl sẽ đánh sắp khoảng theo last_name, tức là node lá sẽ bắt đầu tới last_name có ký tự nhỏ nhất (ví dụ là A) và node lá cuối cùng sẽ là ký tự lớn nhất (ví dụ là Z). Khi này, trường thứ 2 trong index chỉ dùng để so khớp khi ta có 2 last_name bằng nhau mà thôi.</p>\n<p>Vậy nếu ta đánh 2 index riêng biệt cho last_name và date_of_bird thì sao? Lúc này với một câu truy vấn dưới đây:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, date_of_birth</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> <span class=\"keyword\">UPPER</span>(last_name) &lt; ?</span><br><span class=\"line\">  <span class=\"keyword\">AND</span> date_of_birth &lt; ?</span><br></pre></td></tr></table></figure>\n\n<p>hệ quản trị csdl sẽ phải duyệt qua 2 cây index (1 cây ứng với index cho last_name và cây còn lại ứng với index cho date_of_birth). Sau đó combine kết quả của 2 lần duyệt ở trên lại.</p>\n<p>Sẽ tốn resource hơn rất nhiều so với đánh 1 index cho last_name + date_of_birth.</p>\n<blockquote>\n<p>Có một loại index giúp giải quyết bài toán trên gọi là bitmap index, tuy nhiên bitmap index gặp vấn đề lớn trong việc ghi đồng thời, vì thế nó không thể sử dụng trong các csdl thanh toán online.</p>\n</blockquote>\n<h3 id=\"Partial-Indexes\"><a href=\"#Partial-Indexes\" class=\"headerlink\" title=\"Partial Indexes\"></a>Partial Indexes</h3><p>Đánh chỉ mục cho 1 nhóm phần tử thuộc 1 bảng.</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">INDEX</span> messages_todo</span><br><span class=\"line\">  <span class=\"keyword\">ON</span> messages (receiver)</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> processed = <span class=\"string\">'N'</span></span><br></pre></td></tr></table></figure>\n\n<p>Đánh index cho các row thuộc bảng messages mà có column processed có giá trị bằng N.</p>\n<p>Vậy ta dùng được index này khi nào. Câu trả lời là chúng ta có thể dùng mọi lúc khi query với mệnh đề where.</p>\n<h2 id=\"Performance-and-Scalability\"><a href=\"#Performance-and-Scalability\" class=\"headerlink\" title=\"Performance and Scalability\"></a>Performance and Scalability</h2><h2 id=\"The-Join-Operation\"><a href=\"#The-Join-Operation\" class=\"headerlink\" title=\"The Join Operation\"></a>The Join Operation</h2><h2 id=\"Clustering-Data\"><a href=\"#Clustering-Data\" class=\"headerlink\" title=\"Clustering Data\"></a>Clustering Data</h2>","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>The notes of mine after read SQL Performance Explained Ebook (boring, but helpful).</p>\n</blockquote>\n<h2 id=\"Anatomy-of-an-Index\"><a href=\"#Anatomy-of-an-Index\" class=\"headerlink\" title=\"Anatomy of an Index\"></a>Anatomy of an Index</h2><p>Cơ sở dữ liệu sử dụng 2 loại cấu trúc để lưu trữ index. <strong>B-Tree</strong> và <strong>Doubly Linked List</strong>. Vì vậy cách sử dụng 2 loại cấu trúc này sẽ giải thích cho phần lớn các đặc tính của SQL.</p>\n<h3 id=\"Doubly-Linked-List\"><a href=\"#Doubly-Linked-List\" class=\"headerlink\" title=\"Doubly Linked List\"></a>Doubly Linked List</h3><ol>\n<li><p>Mỗi một node (node chứa index) sẽ là một node trong 1 <strong>Doubly Linked List</strong>, vì vậy nó sẽ có liên kết tới đến 2 node lân cận (một trước và một sau). Khi ta muốn chèn thêm 1 node mới vào dslk đôi này. Ta sẽ tìm vị trí 2 node cần chèn node mới vào giữa chúng, đơn giản chỉ thay đổi con trỏ của 2 node đó. Vì thế vị trí vật lý của node mới không quan trọng. Lợi ích của việc này là giúp việc chèn thêm dữ liệu không tốn quá nhiều công sức, chỉ thay đổi vài con trỏ.</p>\n</li>\n<li><p>Mỗi <strong>leaf node</strong> được lưu chữ trong 1 block/page. Mỗi block sẽ thườn là 1 vài KB, csdl sẽ cố gắng lưu nhiều node (node chưa index) nhất có thể trong mỗi block/page. Vậy csdl sẽ dùng dsdl đôi để quản lý trong 2 cấp (Dùng trong các node thuộc 1 block/page và dùng giữa các blog với nhau). Hiểu đơn giản như ta chia Việt Nam thành 63 block ứng với 63 tỉnh thành. Mỗi khi ta muốn tìm 1 tỉnh nào đó thì tìm trong sdl đôi của 63 tỉnh. Khi đã tìm thấy tỉnh cần tìm ta muốn tìm đến huyện (các huyện trong tỉnh đó cũng dùng dslk đôi để kết nối). Nhìn hình dưới đây.</p>\n</li>\n</ol>\n<p><img src=\"/../images/leaf-node.png\" alt=\"2 level doubly linked list\"></p>\n<h3 id=\"The-Search-Tree-B-Tree\"><a href=\"#The-Search-Tree-B-Tree\" class=\"headerlink\" title=\"The Search Tree (B-Tree)\"></a>The Search Tree (B-Tree)</h3><ol>\n<li>Dslk đôi giúp thực hiện nhanh các thao tác chèn, xoá node, tuy nhiên vậy còn tìm kiếm thì sao. Nhớ lại cấu trúc dslk thì việc tìm kiếm là tuyến tính, vì vậy chúng ta cần một cấu trúc dữ liệu bổ sung để giúp csdl biết được đối tượng cần tìm đang nằm trong block/page nào 1 cách nhanh chóng. Và cấu trúc dữ liệu được chọn là B-Tree. Nhìn hình dưới đây:</li>\n</ol>\n<p><img src=\"/../images/b-tree-sql.png\" alt=\"b-tree\"></p>\n<ol start=\"2\">\n<li><p>Như hình trên. Dslk đôi giúp sắp xếp các node và các block/page. Root và <strong>branch node</strong> giúp đẩy nhanh quá trình tìm kiếm 1 block/page cần thiết.</p>\n</li>\n<li><p>Lý do B-Tree được lựa chọn và sử dụng rộng rãi là vì đặc tính cân bằng của cây. Độ cao của cây là không đổi từ root đến bất kể node lá nào. Tính tăng trưởng chiều cao của cây theo Logarit khi tăng node lá dẫn đến 1 cây bậc 4, 5 có thể chứa hàng triệu node và trong thực tế gần như không có trường hợp nào có độ sâu lên đến 6.</p>\n</li>\n</ol>\n<h2 id=\"The-Where-Clause\"><a href=\"#The-Where-Clause\" class=\"headerlink\" title=\"The Where Clause\"></a>The Where Clause</h2><h3 id=\"Concatenated-Indexes\"><a href=\"#Concatenated-Indexes\" class=\"headerlink\" title=\"Concatenated Indexes\"></a>Concatenated Indexes</h3><ol>\n<li><p>Các hệ quản trị cơ sở dữ liệu hiện nay sẽ đánh index cho khoá chính một cách tự động.</p>\n</li>\n<li><p><strong>Concatenated Indexes</strong>: Index được tạo bằng nhiều cột.</p>\n</li>\n<li><p>Một index được tạo từ 2 cột ví dụ <strong>col-1</strong> và <strong>col-2</strong> thì trong 1 câu truy vấn where dùng với 2 cột trên, index sẽ hoạt động không khác gì so với index một cột cả. Tuy nhiên thứ tự 2 cột trong câu lệnh tạo index sẽ rất quan trọng.</p>\n</li>\n</ol>\n<p>e.g:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">UNIQUE</span> <span class=\"keyword\">INDEX</span> employee_pk</span><br><span class=\"line\">  <span class=\"keyword\">ON</span> employees (employee_id, subsidiary_id);</span><br></pre></td></tr></table></figure>\n\n<p>Khi này nếu chúng ta dùng truy vấn sau:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> subsidiary_id = <span class=\"number\">20</span>;</span><br></pre></td></tr></table></figure>\n\n<p>Index sẽ tạo bên trên vô dụng và csdl sẽ full scan toàn bộ bảng employees.</p>\n<blockquote>\n<p>Cột đầu tiên sẽ là tiêu chí chính để xác định record cần tìm, chỉ sử dụng cột thứ 2 khi mà có nhiều hơn 1 record đáp ứng được tiêu chí về cột đầu tiên. Vì vậy 1 truy vấn với cột thứ 2 sẽ là vô nghĩa.</p>\n</blockquote>\n<p><img src=\"/../images/2-col.png\" alt=\"2-col\"></p>\n<p>Trong hình trên ta có thể thấy, B-Tree được sắp xếp theo cột đầu tiên, và ta chỉ sử dụng cột thứ 2 khi có nhiều hơn 1 record đáp ứng được điều kiện với cột đầu tiên. Ví dụ như record có id = 123, B-Tree sẽ dẫn chúng ta tới block chứa id này, ở đây vì có nhiều hơn 1 record có id = 123. Nó mới dựa vào cột thứ 2 để lấy record cần tìm. Vậy nếu ta query với điều kiện where chỉ có cột thứ 2 thì rõ ràng là hoàn toàn vô nghĩa.</p>\n<ol start=\"4\">\n<li>Bản thân B-Tree trong trường hớp này cũng chỉ lưu cột thứ 2 ở node lá mà thôi, những node trung gian không có thông tin của cột 2.</li>\n</ol>\n<blockquote>\n<p>Điều quan trọng nhất khi tạo một index gồm nhiều cột là xác định xem nên chọn cột nào làm cột đầu tiên trong index.</p>\n</blockquote>\n<h3 id=\"Function-base-index\"><a href=\"#Function-base-index\" class=\"headerlink\" title=\"Function-base index\"></a>Function-base index</h3><p>Trong trường hợp đã đánh index cho cột <strong>last_name</strong>, vì không kiểm soát được dữ liệu của người dùng nhập và dữ liệu trong csdl, chữ hoa và chữ thường trong trường hợp này không phân biệt. Vậy ta nên làm gì?</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, phone_number</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> <span class=\"keyword\">UPPER</span>(last_name) = <span class=\"keyword\">UPPER</span>(<span class=\"string\">'winand'</span>);</span><br></pre></td></tr></table></figure>\n\n<p>Tìm các record có last_name = ‘winand’, trước khi tìm kiếm thì sẽ dùng hàm UPPER để covert dữ liệu sang chữ hoa khi so khớp. Nhớ điều kiện bên trên, chúng ta đã đánh index cho field <strong>last_name</strong> tuy nhiên trong trường hợp này index sẽ không còn hoạt động, thay vào đó là 1 full scan toàn bộ bảng.</p>\n<p>Mô tuýt:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, phone_number</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> BLACKBOX(...) = <span class=\"string\">'WINAND'</span>;</span><br></pre></td></tr></table></figure>\n\n<p>Trong đó thay <strong>BLACKBOX</strong> bằng một function bất kỳ, ứng với việc index không còn hoạt động.</p>\n<p>Giải pháp: Đánh index luôn giá trị thực sự sẽ dùng khi tìm kiếm, ở đây là last_name dưới dạng viết hoa.</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">INDEX</span> emp_up_name</span><br><span class=\"line\">  <span class=\"keyword\">ON</span> employees (<span class=\"keyword\">UPPER</span>(last_name));</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Ta gọi chỉ mục được tạo trên là function-based index (FBI), chỉ mục dựa trên function.</p>\n</blockquote>\n<p>Thay vì copy luôn dữ liệu cột được đánh vào cây index. Một function-based index sẽ apply function vào dữ liệu trước khi ghi vào cây index. Vậy trong ví dụ trên, cây index sẽ chứa toàn bộ last_name dưới dạng chữ hoa.</p>\n<blockquote>\n<p>Một số ORM dùng upper/lower 1 cách ngầm và mặc định, chớ không cần dev phải trực tiếp thực hiện, ví dụ như Hibernate sẽ tự động thực hiện function-based index với lower của cột cần đánh.</p>\n</blockquote>\n<p>Trên là kiến thức SQL, với các hệ quản trị cơ sở dữ liệu trong thực tế, cách thực hiện không phải lúc nào cũng như vậy.</p>\n<h3 id=\"User-Defined-Functions\"><a href=\"#User-Defined-Functions\" class=\"headerlink\" title=\"User-Defined Functions\"></a>User-Defined Functions</h3><p>Không phải function nào cũng có thể dùng cho function-based index.</p>\n<p>Chỉ những function là <strong>deterministic</strong> mới có thể dùng trong function-based index.</p>\n<blockquote>\n<p>deterministic: những function trả về cùng một kết quả khi nhận tham số giống nhau.</p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">FUNCTION</span> get_age(date_of_birth <span class=\"built_in\">DATE</span>)</span><br><span class=\"line\"><span class=\"keyword\">RETURN</span> <span class=\"built_in\">NUMBER</span></span><br><span class=\"line\"><span class=\"keyword\">AS</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\"> <span class=\"keyword\">RETURN</span></span><br><span class=\"line\"> TRUNC(MONTHS_BETWEEN(<span class=\"keyword\">SYSDATE</span>, date_of_birth)/<span class=\"number\">12</span>);</span><br><span class=\"line\"><span class=\"keyword\">END</span>;</span><br></pre></td></tr></table></figure>\n\n<p>Không thể dùng <strong>get_age</strong> cho function-based index. Vì ví dụ tôi sinh ngày 30/08/1995. Ứng với mỗi thời điểm khác nhau output của hàm này sẽ khác nhau với cùng một đối số truyền vào là ngày sinh của tôi. Vậy nên nó không dùng để function-based index được.</p>\n<blockquote>\n<p>Các function khác không thể dụng cho index là function random hoặc function dựa trên biến môi trường.</p>\n</blockquote>\n<p>Notes: Giả sử chúng ta đánh index cho cột <strong>last_name</strong> rồi đánh tiếp cho <strong>UPPER(last_name)</strong>, với mỗi lần update đối tượng có trường last_name, đồng nghĩa chúng ta phải update cho 2 index. Ứng với 2 index đã đánh, vì vậy không nên đánh index quá nhiều, nhất là với function-based index.</p>\n<h3 id=\"Parameterized-Queries\"><a href=\"#Parameterized-Queries\" class=\"headerlink\" title=\"Parameterized Queries\"></a>Parameterized Queries</h3><blockquote>\n<p>Bind parameters/dynamic parameters/ bind variables là một cách truyền tham số vào câu query gián tiếp bằng các ký hiệu như <strong>?</strong>, <strong>:name</strong>, <strong>@name</strong>.</p>\n</blockquote>\n<blockquote>\n<p>Bind variables are the best way to prevent SQL injection.</p>\n</blockquote>\n<blockquote>\n<p>Các hệ quản trị csdl sẽ cache lại các dữ liệu đường truy cập y hệt nhau. Khi ta thay đổi tham số truyền vào hệ cơ sở dữ liệu sẽ query mới và không còn dùng cache.</p>\n</blockquote>\n<blockquote>\n<p>Not using bind parameters is like recompiling a program every time.</p>\n</blockquote>\n<h3 id=\"Searching-for-Ranges\"><a href=\"#Searching-for-Ranges\" class=\"headerlink\" title=\"Searching for Ranges\"></a>Searching for Ranges</h3><blockquote>\n<p>Rủi do hiệu suất lớn nhất với INDEX RANGE SCAN là quá trình duyệt qua nút lá.</p>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, date_of_birth</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> date_of_birth &gt;= <span class=\"keyword\">TO_DATE</span>(?, <span class=\"string\">'YYYY-MM-DD'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">AND</span> date_of_birth &lt;= <span class=\"keyword\">TO_DATE</span>(?, <span class=\"string\">'YYYY-MM-DD'</span>)</span><br><span class=\"line\">  <span class=\"keyword\">AND</span> subsidiary_id = ?</span><br></pre></td></tr></table></figure>\n\n<p>Ok, giờ chúng ta có một câu truy vấn như trên, tìm tất cả nhân viên có subsidiary_id = 27 và ngày sinh nằm trong khoảng 1/1/1971 và 9/1/1971.</p>\n<p>Chúng ta sẽ đánh index cho 2 cột trên, đánh như bên trên đã ghi. Tuy nhiên <strong>thứ tự đánh index</strong> như nào?</p>\n<p><strong>Trường hợp xếp date_or_birth trước</strong>:</p>\n<p><img src=\"/../images/date-first.png\" alt=\"date- first\"></p>\n<p><strong>Trường hợp xếp subsidiary_id trước</strong>:</p>\n<p><img src=\"/../images/sub-first.png\" alt=\"sub- first\"></p>\n<p><strong>Tại sao trường hợp cho subsidiary_id đầu tiên trong index lại đem lại performance tốt hơn?</strong></p>\n<p>Lý giải: khi dùng range first, kiểu gì cũng phải duyệt hết range đó thôi, record nào trong range đó là sẽ được duyệt qua rồi so khớp với điều kiện so bằng thứ hai.</p>\n<p>Khi dùng trường so bằng đầu tiên, ta làm giảm phạm vì số record cần quét qua (theo quy tắc của B-Tree).</p>\n<blockquote>\n<p>Rule of thumb: index for equality first—then for ranges.</p>\n</blockquote>\n<h3 id=\"Indexing-LIKE-Filters\"><a href=\"#Indexing-LIKE-Filters\" class=\"headerlink\" title=\"Indexing LIKE Filters\"></a>Indexing LIKE Filters</h3><p>Với các query với <strong>LIKE</strong>, chúng ta vẫn có thể đánh index bình thường lên trường được truy vấn. Tuy nhiên trong một số trường hợp chúng ta sẽ gặp vấn đề ví dụ như:</p>\n<p>Dùng ký tự <strong>%</strong> trong từ cần tìm.</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, date_of_birth</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> <span class=\"keyword\">UPPER</span>(last_name) <span class=\"keyword\">LIKE</span> <span class=\"string\">'WINND'</span></span><br></pre></td></tr></table></figure>\n\n<p>Đánh index trên last_name và ngon.</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, date_of_birth</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> <span class=\"keyword\">UPPER</span>(last_name) <span class=\"keyword\">LIKE</span> <span class=\"string\">'WIN%D'</span></span><br></pre></td></tr></table></figure>\n\n<p>Ký tự <strong>%</strong> xuất hiện và không ngon nữa rồi. Vì lúc này, <strong>index</strong> chỉ sử dụng phần trước <strong>%</strong> để tính khoảng range cần quét, còn phần đằng sau <strong>%</strong> chỉ dùng nhiệm vụ so khớp.</p>\n<p>Tức là phải quét qua bao nhiêu phần tử sẽ hoàn toàn do phần đầu tiên quyết định. Từ có ta có 2 định nghĩa tác giả nêu ra:</p>\n<ol>\n<li><strong>access predicate</strong>: phần đầu</li>\n<li><strong>filter predicate</strong>: phần còn lại</li>\n</ol>\n<p>Ví dụ hình dưới đây:</p>\n<p><img src=\"/../images/like-query.png\" alt=\"like-query\"></p>\n<p>Khi thay cụm từ đứng trước <strong>%</strong> từ WI -&gt; WIN -&gt; WINA thì scan range đã thay đổi từ:</p>\n<p>18 -&gt; 2 -&gt; 1 (trong cơ sở dữ liệu mẫu).</p>\n<h3 id=\"Index-Merge\"><a href=\"#Index-Merge\" class=\"headerlink\" title=\"Index Merge\"></a>Index Merge</h3><blockquote>\n<p>One index scan is faster than two.</p>\n</blockquote>\n<p>Liệu nên tạo mỗi index cho một column, hay tạo một index cho tất cả column, trường hợp nào hiệu quả hơn? Câu trả lời của tác giả là nhiều cột cho một index sẽ hiệu quả hơn trong truy vấn where.</p>\n<p>Tại sao lại như vậy?</p>\n<p>Quay trở lại định nghĩa, chúng ta đã được đọc rằng index dùng B-Tree kết hợp với dslk đôi để cover các trường hợp.</p>\n<p>Vậy giả sử, ta đánh index lên 2 column (last_name và date_of_bird) theo đúng thứ tự sắp xếp. Khi này hệ quản trị csdl sẽ đánh sắp khoảng theo last_name, tức là node lá sẽ bắt đầu tới last_name có ký tự nhỏ nhất (ví dụ là A) và node lá cuối cùng sẽ là ký tự lớn nhất (ví dụ là Z). Khi này, trường thứ 2 trong index chỉ dùng để so khớp khi ta có 2 last_name bằng nhau mà thôi.</p>\n<p>Vậy nếu ta đánh 2 index riêng biệt cho last_name và date_of_bird thì sao? Lúc này với một câu truy vấn dưới đây:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> first_name, last_name, date_of_birth</span><br><span class=\"line\">  <span class=\"keyword\">FROM</span> employees</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> <span class=\"keyword\">UPPER</span>(last_name) &lt; ?</span><br><span class=\"line\">  <span class=\"keyword\">AND</span> date_of_birth &lt; ?</span><br></pre></td></tr></table></figure>\n\n<p>hệ quản trị csdl sẽ phải duyệt qua 2 cây index (1 cây ứng với index cho last_name và cây còn lại ứng với index cho date_of_birth). Sau đó combine kết quả của 2 lần duyệt ở trên lại.</p>\n<p>Sẽ tốn resource hơn rất nhiều so với đánh 1 index cho last_name + date_of_birth.</p>\n<blockquote>\n<p>Có một loại index giúp giải quyết bài toán trên gọi là bitmap index, tuy nhiên bitmap index gặp vấn đề lớn trong việc ghi đồng thời, vì thế nó không thể sử dụng trong các csdl thanh toán online.</p>\n</blockquote>\n<h3 id=\"Partial-Indexes\"><a href=\"#Partial-Indexes\" class=\"headerlink\" title=\"Partial Indexes\"></a>Partial Indexes</h3><p>Đánh chỉ mục cho 1 nhóm phần tử thuộc 1 bảng.</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">INDEX</span> messages_todo</span><br><span class=\"line\">  <span class=\"keyword\">ON</span> messages (receiver)</span><br><span class=\"line\">  <span class=\"keyword\">WHERE</span> processed = <span class=\"string\">'N'</span></span><br></pre></td></tr></table></figure>\n\n<p>Đánh index cho các row thuộc bảng messages mà có column processed có giá trị bằng N.</p>\n<p>Vậy ta dùng được index này khi nào. Câu trả lời là chúng ta có thể dùng mọi lúc khi query với mệnh đề where.</p>\n<h2 id=\"Performance-and-Scalability\"><a href=\"#Performance-and-Scalability\" class=\"headerlink\" title=\"Performance and Scalability\"></a>Performance and Scalability</h2><h2 id=\"The-Join-Operation\"><a href=\"#The-Join-Operation\" class=\"headerlink\" title=\"The Join Operation\"></a>The Join Operation</h2><h2 id=\"Clustering-Data\"><a href=\"#Clustering-Data\" class=\"headerlink\" title=\"Clustering Data\"></a>Clustering Data</h2>"},{"title":"ReactJS Short Note","date":"2020-01-07T17:00:00.000Z","label":"#note","_content":"\n> This is a short note from ReactJS docs.\n\n## Main Concepts\n\n### 1.JSX\n\nJSX là **syntax extension to JavaScript**\n\nLý do cần sự xuất hiện của JSX là để React nhúng logic vào giao diện.\n\nNhưng biểu thức logic vào JSX thông qua cặp ngoặc **{}**:\n\n```jsx\nconst name = \"Meo\";\nconst element = <b>{name}</b>\n```\n\nChúng ta cũng có thể nhúng JSX vào một **if** hay **for** trong javascript:\n\n```jsx\nfunction getGreeting(user) {\n  if (user) {\n    return <h1>Hello, {formatName(user)}!</h1>;\n  }\n\n  return <h1>Hello, Stranger.</h1>;\n}\n```\n\nNhứng biểu thức vào Attributes của một đối tượng:\n\n```jsx\nconst element = <img src={user.avatarUrl}></img>;\n```\n\nNote: Dùng \"\" cho chuỗi, dùng {} cho biểu thức logic, không dùng 2 thứ cùng lúc.\n\nJSX diễn tả một đối tượng:\n\nKhi babel biên dịch, đối tượng trên sẽ được call trong **React.createElement()**\n\n```jsx\nconst element = (\n  <h1 className=\"greeting\">\n    Hello, world!\n  </h1>\n);\n```\n\nSau biên dịch sẽ thành:\n\n```jsx\nconst element = {\n  type: 'h1',\n  props: {\n    className: 'greeting',\n    children: 'Hello, world!'\n  }\n};\n```\n\n### 2.Render Element\n\nReact dùng các đối tượng này để xây dựng cây DOM.\n\nReact elements là immutable. Một khi bạn tạo một element, bạn không thể thay đó thuộc tính hoặc children của nó. Một element React giống như một đoạn trong 1 cuốn phim: Nó chỉ đại diện cho UI trong 1 thời điểm.\n\nDo vậy, cách duy nhất để cập nhật giao diện là tạo ra một phần tử mới thay thế cho phần tử cũ. Và cách duy nhất để tạo ra một phần tử React là dùng **ReactDOM.render()**\n\n### 3.Component và Props\n\n**Function Component**:\n\n```jsx\nfunction Welcome(props) {\n  return <h1>Hello, {props.name}</h1>;\n}\n```\n\nChỉ chấp nhận 1 params props.\n\n**ES6 Class**:\n\n```jsx\nclass Welcome extends React.Component {\n  render() {\n    return <h1>Hello, {this.props.name}</h1>;\n  }\n}\n```\n\nKhi sử dụng Class sẽ có một số chức năng được bổ sung.\n\n>  React elements: là  thứ được biên dịch qua babel ở mục 2\n\nReact element có thể đại diện cho DOM tag hoặc user-defined components\n\n```jsx\nconst element = <div />;\n\nconst element = <Welcome name=\"Sara\" />;\n```\n\nReact khi gặp các element đại diện cho một user-defined componts, nó sẽ pass jsx attributes vào component đó dưới dạng **MỘT OBJECT DUY NHẤT**, đó là props.\n\n```jsx\nfunction Welcome(props) {\n  return <h1>Hello, {props.name}</h1>;\n}\n\nconst element = <Welcome name=\"Sara\" />;\nReactDOM.render(\n  element,\n  document.getElementById('root')\n);\n```\n\nTrong ví dụ trên, object duy nhất là: **props = {name: \"Sara\"}**\n\n1. We call ReactDOM.render() with the `<Welcome name=\"Sara\" />` element.\n2. React calls the Welcome component with {name: 'Sara'} as the props.\n3. Our Welcome component returns a `<h1>Hello, Sara</h1>` element as the result.\n4. React DOM efficiently updates the DOM to match `<h1>Hello, Sara</h1>`.\n\n> Luôn tạo một component với chữ cái đầu viết hoa, react dùng đấy để nhận diện chữ DOM tag và user-defined components\n\n### 4.State và vòng đời\n\nNơi duy nhất ta có thể set state là trong constructor. Ở các khu vực khác, phải call hàm setState để thay đổi giá trị state.\n\nCập nhật state là bất đồng bộ. Để khắc phục, setState nhận tham số đầu tiên là state cũ.\n\n```jsx\n// Correct\nthis.setState((state, props) => ({\n  counter: state.counter + props.increment\n}));\n```\n\n```jsx\nconstructor(props) {\n  super(props);\n\n  this.state = {\n    name: 'Chinh',\n    age: 25\n  }\n}\n```\n\nKhi gọi:\n\n```jsx\nthis.setState({\n  name: 'Duy'\n})\n```\n\nname trong state sẽ được replace và thay mới, còn age thì giữ nguyên => gọi là merge vậy thôi\n\n## Advandced Guide\n\n## React Hooks\n\n## Original Link\n\n[1] [https://reactjs.org/docs](https://reactjs.org/docs)\n","source":"_posts/2020-01-08-reactjs-notes.md","raw":"---\ntitle: \"ReactJS Short Note\"\ndate: 2020-01-08\ntags: [\"NOTES\"]\nlabel: \"#note\"\n---\n\n> This is a short note from ReactJS docs.\n\n## Main Concepts\n\n### 1.JSX\n\nJSX là **syntax extension to JavaScript**\n\nLý do cần sự xuất hiện của JSX là để React nhúng logic vào giao diện.\n\nNhưng biểu thức logic vào JSX thông qua cặp ngoặc **{}**:\n\n```jsx\nconst name = \"Meo\";\nconst element = <b>{name}</b>\n```\n\nChúng ta cũng có thể nhúng JSX vào một **if** hay **for** trong javascript:\n\n```jsx\nfunction getGreeting(user) {\n  if (user) {\n    return <h1>Hello, {formatName(user)}!</h1>;\n  }\n\n  return <h1>Hello, Stranger.</h1>;\n}\n```\n\nNhứng biểu thức vào Attributes của một đối tượng:\n\n```jsx\nconst element = <img src={user.avatarUrl}></img>;\n```\n\nNote: Dùng \"\" cho chuỗi, dùng {} cho biểu thức logic, không dùng 2 thứ cùng lúc.\n\nJSX diễn tả một đối tượng:\n\nKhi babel biên dịch, đối tượng trên sẽ được call trong **React.createElement()**\n\n```jsx\nconst element = (\n  <h1 className=\"greeting\">\n    Hello, world!\n  </h1>\n);\n```\n\nSau biên dịch sẽ thành:\n\n```jsx\nconst element = {\n  type: 'h1',\n  props: {\n    className: 'greeting',\n    children: 'Hello, world!'\n  }\n};\n```\n\n### 2.Render Element\n\nReact dùng các đối tượng này để xây dựng cây DOM.\n\nReact elements là immutable. Một khi bạn tạo một element, bạn không thể thay đó thuộc tính hoặc children của nó. Một element React giống như một đoạn trong 1 cuốn phim: Nó chỉ đại diện cho UI trong 1 thời điểm.\n\nDo vậy, cách duy nhất để cập nhật giao diện là tạo ra một phần tử mới thay thế cho phần tử cũ. Và cách duy nhất để tạo ra một phần tử React là dùng **ReactDOM.render()**\n\n### 3.Component và Props\n\n**Function Component**:\n\n```jsx\nfunction Welcome(props) {\n  return <h1>Hello, {props.name}</h1>;\n}\n```\n\nChỉ chấp nhận 1 params props.\n\n**ES6 Class**:\n\n```jsx\nclass Welcome extends React.Component {\n  render() {\n    return <h1>Hello, {this.props.name}</h1>;\n  }\n}\n```\n\nKhi sử dụng Class sẽ có một số chức năng được bổ sung.\n\n>  React elements: là  thứ được biên dịch qua babel ở mục 2\n\nReact element có thể đại diện cho DOM tag hoặc user-defined components\n\n```jsx\nconst element = <div />;\n\nconst element = <Welcome name=\"Sara\" />;\n```\n\nReact khi gặp các element đại diện cho một user-defined componts, nó sẽ pass jsx attributes vào component đó dưới dạng **MỘT OBJECT DUY NHẤT**, đó là props.\n\n```jsx\nfunction Welcome(props) {\n  return <h1>Hello, {props.name}</h1>;\n}\n\nconst element = <Welcome name=\"Sara\" />;\nReactDOM.render(\n  element,\n  document.getElementById('root')\n);\n```\n\nTrong ví dụ trên, object duy nhất là: **props = {name: \"Sara\"}**\n\n1. We call ReactDOM.render() with the `<Welcome name=\"Sara\" />` element.\n2. React calls the Welcome component with {name: 'Sara'} as the props.\n3. Our Welcome component returns a `<h1>Hello, Sara</h1>` element as the result.\n4. React DOM efficiently updates the DOM to match `<h1>Hello, Sara</h1>`.\n\n> Luôn tạo một component với chữ cái đầu viết hoa, react dùng đấy để nhận diện chữ DOM tag và user-defined components\n\n### 4.State và vòng đời\n\nNơi duy nhất ta có thể set state là trong constructor. Ở các khu vực khác, phải call hàm setState để thay đổi giá trị state.\n\nCập nhật state là bất đồng bộ. Để khắc phục, setState nhận tham số đầu tiên là state cũ.\n\n```jsx\n// Correct\nthis.setState((state, props) => ({\n  counter: state.counter + props.increment\n}));\n```\n\n```jsx\nconstructor(props) {\n  super(props);\n\n  this.state = {\n    name: 'Chinh',\n    age: 25\n  }\n}\n```\n\nKhi gọi:\n\n```jsx\nthis.setState({\n  name: 'Duy'\n})\n```\n\nname trong state sẽ được replace và thay mới, còn age thì giữ nguyên => gọi là merge vậy thôi\n\n## Advandced Guide\n\n## React Hooks\n\n## Original Link\n\n[1] [https://reactjs.org/docs](https://reactjs.org/docs)\n","slug":"2020-01-08-reactjs-notes","published":1,"updated":"2022-01-29T09:29:59.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbf003op3m2hhn13yvc","content":"<blockquote>\n<p>This is a short note from ReactJS docs.</p>\n</blockquote>\n<h2 id=\"Main-Concepts\"><a href=\"#Main-Concepts\" class=\"headerlink\" title=\"Main Concepts\"></a>Main Concepts</h2><h3 id=\"1-JSX\"><a href=\"#1-JSX\" class=\"headerlink\" title=\"1.JSX\"></a>1.JSX</h3><p>JSX là <strong>syntax extension to JavaScript</strong></p>\n<p>Lý do cần sự xuất hiện của JSX là để React nhúng logic vào giao diện.</p>\n<p>Nhưng biểu thức logic vào JSX thông qua cặp ngoặc <strong>{}</strong>:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">\"Meo\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">b</span>&gt;</span>&#123;name&#125;<span class=\"tag\">&lt;/<span class=\"name\">b</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>Chúng ta cũng có thể nhúng JSX vào một <strong>if</strong> hay <strong>for</strong> trong javascript:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getGreeting</span>(<span class=\"params\">user</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (user) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, &#123;formatName(user)&#125;!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, Stranger.<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Nhứng biểu thức vào Attributes của một đối tượng:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&#123;user.avatarUrl&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">img</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>\n\n<p>Note: Dùng “” cho chuỗi, dùng {} cho biểu thức logic, không dùng 2 thứ cùng lúc.</p>\n<p>JSX diễn tả một đối tượng:</p>\n<p>Khi babel biên dịch, đối tượng trên sẽ được call trong <strong>React.createElement()</strong></p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> element = (</span><br><span class=\"line\">  &lt;h1 className=<span class=\"string\">\"greeting\"</span>&gt;</span><br><span class=\"line\">    Hello, world!</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/h1&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">);</span></span><br></pre></td></tr></table></figure>\n\n<p>Sau biên dịch sẽ thành:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> element = &#123;</span><br><span class=\"line\">  type: <span class=\"string\">'h1'</span>,</span><br><span class=\"line\">  props: &#123;</span><br><span class=\"line\">    className: <span class=\"string\">'greeting'</span>,</span><br><span class=\"line\">    children: <span class=\"string\">'Hello, world!'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-Render-Element\"><a href=\"#2-Render-Element\" class=\"headerlink\" title=\"2.Render Element\"></a>2.Render Element</h3><p>React dùng các đối tượng này để xây dựng cây DOM.</p>\n<p>React elements là immutable. Một khi bạn tạo một element, bạn không thể thay đó thuộc tính hoặc children của nó. Một element React giống như một đoạn trong 1 cuốn phim: Nó chỉ đại diện cho UI trong 1 thời điểm.</p>\n<p>Do vậy, cách duy nhất để cập nhật giao diện là tạo ra một phần tử mới thay thế cho phần tử cũ. Và cách duy nhất để tạo ra một phần tử React là dùng <strong>ReactDOM.render()</strong></p>\n<h3 id=\"3-Component-va-Props\"><a href=\"#3-Component-va-Props\" class=\"headerlink\" title=\"3.Component và Props\"></a>3.Component và Props</h3><p><strong>Function Component</strong>:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Welcome</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Chỉ chấp nhận 1 params props.</p>\n<p><strong>ES6 Class</strong>:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Welcome</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Khi sử dụng Class sẽ có một số chức năng được bổ sung.</p>\n<blockquote>\n<p> React elements: là  thứ được biên dịch qua babel ở mục 2</p>\n</blockquote>\n<p>React element có thể đại diện cho DOM tag hoặc user-defined components</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> /&gt;</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Welcome</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Sara\"</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure>\n\n<p>React khi gặp các element đại diện cho một user-defined componts, nó sẽ pass jsx attributes vào component đó dưới dạng <strong>MỘT OBJECT DUY NHẤT</strong>, đó là props.</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Welcome</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Welcome</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Sara\"</span> /&gt;</span></span>;</span><br><span class=\"line\">ReactDOM.render(</span><br><span class=\"line\">  element,</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'root'</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>Trong ví dụ trên, object duy nhất là: <strong>props = {name: “Sara”}</strong></p>\n<ol>\n<li>We call ReactDOM.render() with the <code>&lt;Welcome name=&quot;Sara&quot; /&gt;</code> element.</li>\n<li>React calls the Welcome component with {name: ‘Sara’} as the props.</li>\n<li>Our Welcome component returns a <code>&lt;h1&gt;Hello, Sara&lt;/h1&gt;</code> element as the result.</li>\n<li>React DOM efficiently updates the DOM to match <code>&lt;h1&gt;Hello, Sara&lt;/h1&gt;</code>.</li>\n</ol>\n<blockquote>\n<p>Luôn tạo một component với chữ cái đầu viết hoa, react dùng đấy để nhận diện chữ DOM tag và user-defined components</p>\n</blockquote>\n<h3 id=\"4-State-va-vong-doi\"><a href=\"#4-State-va-vong-doi\" class=\"headerlink\" title=\"4.State và vòng đời\"></a>4.State và vòng đời</h3><p>Nơi duy nhất ta có thể set state là trong constructor. Ở các khu vực khác, phải call hàm setState để thay đổi giá trị state.</p>\n<p>Cập nhật state là bất đồng bộ. Để khắc phục, setState nhận tham số đầu tiên là state cũ.</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Correct</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.setState(<span class=\"function\">(<span class=\"params\">state, props</span>) =&gt;</span> (&#123;</span><br><span class=\"line\">  counter: state.counter + props.increment</span><br><span class=\"line\">&#125;));</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">constructor</span>(props) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">super</span>(props);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.state = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'Chinh'</span>,</span><br><span class=\"line\">    age: <span class=\"number\">25</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Khi gọi:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">  name: <span class=\"string\">'Duy'</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>name trong state sẽ được replace và thay mới, còn age thì giữ nguyên =&gt; gọi là merge vậy thôi</p>\n<h2 id=\"Advandced-Guide\"><a href=\"#Advandced-Guide\" class=\"headerlink\" title=\"Advandced Guide\"></a>Advandced Guide</h2><h2 id=\"React-Hooks\"><a href=\"#React-Hooks\" class=\"headerlink\" title=\"React Hooks\"></a>React Hooks</h2><h2 id=\"Original-Link\"><a href=\"#Original-Link\" class=\"headerlink\" title=\"Original Link\"></a>Original Link</h2><p>[1] <a href=\"https://reactjs.org/docs\" target=\"_blank\" rel=\"noopener\">https://reactjs.org/docs</a></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>This is a short note from ReactJS docs.</p>\n</blockquote>\n<h2 id=\"Main-Concepts\"><a href=\"#Main-Concepts\" class=\"headerlink\" title=\"Main Concepts\"></a>Main Concepts</h2><h3 id=\"1-JSX\"><a href=\"#1-JSX\" class=\"headerlink\" title=\"1.JSX\"></a>1.JSX</h3><p>JSX là <strong>syntax extension to JavaScript</strong></p>\n<p>Lý do cần sự xuất hiện của JSX là để React nhúng logic vào giao diện.</p>\n<p>Nhưng biểu thức logic vào JSX thông qua cặp ngoặc <strong>{}</strong>:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> name = <span class=\"string\">\"Meo\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">b</span>&gt;</span>&#123;name&#125;<span class=\"tag\">&lt;/<span class=\"name\">b</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>Chúng ta cũng có thể nhúng JSX vào một <strong>if</strong> hay <strong>for</strong> trong javascript:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getGreeting</span>(<span class=\"params\">user</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (user) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, &#123;formatName(user)&#125;!<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, Stranger.<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Nhứng biểu thức vào Attributes của một đối tượng:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">img</span> <span class=\"attr\">src</span>=<span class=\"string\">&#123;user.avatarUrl&#125;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">img</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>\n\n<p>Note: Dùng “” cho chuỗi, dùng {} cho biểu thức logic, không dùng 2 thứ cùng lúc.</p>\n<p>JSX diễn tả một đối tượng:</p>\n<p>Khi babel biên dịch, đối tượng trên sẽ được call trong <strong>React.createElement()</strong></p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> element = (</span><br><span class=\"line\">  &lt;h1 className=<span class=\"string\">\"greeting\"</span>&gt;</span><br><span class=\"line\">    Hello, world!</span><br><span class=\"line\">  &lt;<span class=\"regexp\">/h1&gt;</span></span><br><span class=\"line\"><span class=\"regexp\">);</span></span><br></pre></td></tr></table></figure>\n\n<p>Sau biên dịch sẽ thành:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> element = &#123;</span><br><span class=\"line\">  type: <span class=\"string\">'h1'</span>,</span><br><span class=\"line\">  props: &#123;</span><br><span class=\"line\">    className: <span class=\"string\">'greeting'</span>,</span><br><span class=\"line\">    children: <span class=\"string\">'Hello, world!'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-Render-Element\"><a href=\"#2-Render-Element\" class=\"headerlink\" title=\"2.Render Element\"></a>2.Render Element</h3><p>React dùng các đối tượng này để xây dựng cây DOM.</p>\n<p>React elements là immutable. Một khi bạn tạo một element, bạn không thể thay đó thuộc tính hoặc children của nó. Một element React giống như một đoạn trong 1 cuốn phim: Nó chỉ đại diện cho UI trong 1 thời điểm.</p>\n<p>Do vậy, cách duy nhất để cập nhật giao diện là tạo ra một phần tử mới thay thế cho phần tử cũ. Và cách duy nhất để tạo ra một phần tử React là dùng <strong>ReactDOM.render()</strong></p>\n<h3 id=\"3-Component-va-Props\"><a href=\"#3-Component-va-Props\" class=\"headerlink\" title=\"3.Component và Props\"></a>3.Component và Props</h3><p><strong>Function Component</strong>:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Welcome</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Chỉ chấp nhận 1 params props.</p>\n<p><strong>ES6 Class</strong>:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Welcome</span> <span class=\"keyword\">extends</span> <span class=\"title\">React</span>.<span class=\"title\">Component</span> </span>&#123;</span><br><span class=\"line\">  render() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Khi sử dụng Class sẽ có một số chức năng được bổ sung.</p>\n<blockquote>\n<p> React elements: là  thứ được biên dịch qua babel ở mục 2</p>\n</blockquote>\n<p>React element có thể đại diện cho DOM tag hoặc user-defined components</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span> /&gt;</span></span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Welcome</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Sara\"</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure>\n\n<p>React khi gặp các element đại diện cho một user-defined componts, nó sẽ pass jsx attributes vào component đó dưới dạng <strong>MỘT OBJECT DUY NHẤT</strong>, đó là props.</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Welcome</span>(<span class=\"params\">props</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">h1</span>&gt;</span>Hello, &#123;props.name&#125;<span class=\"tag\">&lt;/<span class=\"name\">h1</span>&gt;</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> element = <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">Welcome</span> <span class=\"attr\">name</span>=<span class=\"string\">\"Sara\"</span> /&gt;</span></span>;</span><br><span class=\"line\">ReactDOM.render(</span><br><span class=\"line\">  element,</span><br><span class=\"line\">  <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'root'</span>)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>Trong ví dụ trên, object duy nhất là: <strong>props = {name: “Sara”}</strong></p>\n<ol>\n<li>We call ReactDOM.render() with the <code>&lt;Welcome name=&quot;Sara&quot; /&gt;</code> element.</li>\n<li>React calls the Welcome component with {name: ‘Sara’} as the props.</li>\n<li>Our Welcome component returns a <code>&lt;h1&gt;Hello, Sara&lt;/h1&gt;</code> element as the result.</li>\n<li>React DOM efficiently updates the DOM to match <code>&lt;h1&gt;Hello, Sara&lt;/h1&gt;</code>.</li>\n</ol>\n<blockquote>\n<p>Luôn tạo một component với chữ cái đầu viết hoa, react dùng đấy để nhận diện chữ DOM tag và user-defined components</p>\n</blockquote>\n<h3 id=\"4-State-va-vong-doi\"><a href=\"#4-State-va-vong-doi\" class=\"headerlink\" title=\"4.State và vòng đời\"></a>4.State và vòng đời</h3><p>Nơi duy nhất ta có thể set state là trong constructor. Ở các khu vực khác, phải call hàm setState để thay đổi giá trị state.</p>\n<p>Cập nhật state là bất đồng bộ. Để khắc phục, setState nhận tham số đầu tiên là state cũ.</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Correct</span></span><br><span class=\"line\"><span class=\"keyword\">this</span>.setState(<span class=\"function\">(<span class=\"params\">state, props</span>) =&gt;</span> (&#123;</span><br><span class=\"line\">  counter: state.counter + props.increment</span><br><span class=\"line\">&#125;));</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">constructor</span>(props) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">super</span>(props);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">this</span>.state = &#123;</span><br><span class=\"line\">    name: <span class=\"string\">'Chinh'</span>,</span><br><span class=\"line\">    age: <span class=\"number\">25</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Khi gọi:</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.setState(&#123;</span><br><span class=\"line\">  name: <span class=\"string\">'Duy'</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>name trong state sẽ được replace và thay mới, còn age thì giữ nguyên =&gt; gọi là merge vậy thôi</p>\n<h2 id=\"Advandced-Guide\"><a href=\"#Advandced-Guide\" class=\"headerlink\" title=\"Advandced Guide\"></a>Advandced Guide</h2><h2 id=\"React-Hooks\"><a href=\"#React-Hooks\" class=\"headerlink\" title=\"React Hooks\"></a>React Hooks</h2><h2 id=\"Original-Link\"><a href=\"#Original-Link\" class=\"headerlink\" title=\"Original Link\"></a>Original Link</h2><p>[1] <a href=\"https://reactjs.org/docs\" target=\"_blank\" rel=\"noopener\">https://reactjs.org/docs</a></p>\n"},{"title":"Callback, Promise, Async Await","date":"2020-01-08T17:00:00.000Z","label":"#note","_content":"\n## 1. Event Loop\n\nJavascript chạy đơn luồng, tương tự như ruby, nhưng khác một điều, môi trường làm việc của javascript đa phần là trình duyệt, nếu mọi thứ đều chạy tuần tự đơn luồng liệu có ổn không?\n\nVí dụ:\n\n```javascript\nAPI.get(\"/cats\")\n\nAPI.get(\"/dogs\")\n```\n\nGiả dụ đoạn code lấy về dữ liệu dogs bên trên gặp lỗi hoặc tốn rất nhiều thời gian để thực hiện, khi đó giao diện (trên trình duyệt) của người dùng sẽ treo hoàn toàn nếu javascript không có giải pháp cho sự đơn luồng và chạy tuần tự?\n\nCách giải quyết là nó đơn luồng và chạy không tuần tự, hay còn gọi là chạy bất đồng bộ:\n\nVậy javascript và ruby cùng là đơn luồng, nhưng javascript chạy bất đồng bộ còn ruby thì chạy đồng bộ tuần tự.\n\nVideo số [6] dưới mục tham khảo đã giải thích rất hay về event loop và không có lý do gì chúng ta đi ghi lại 1 thứ đã có người làm quá tốt. Một vài lưu ý mình lượm lặt nên note lại:\n\n1. Event Loop có một nhiệm vụ duy nhất - giám sát **Call Stack** và **Callback Queue**. Nếu Call Stack trống, nó sẽ lấy sự kiện đầu tiên từ queue và đẩy vào Call Stack\n\n2.Những Web API này là gì? Chúng là những thread mà bạn không thể truy cập được, chỉ có thể gọi để xài mà thôi. Chúng là những nhân tố trong trình duyệt mà thực sự có thể chạy đồng thời (concurrency). Vậy thì event loop là gì:\n\n3. ES6 giới thiệu khái niệm về job queue được sử dụng bởi Promises trong JavaScript. Sự khác biệt giữa message queue và job queue là job queue có mức ưu tiên cao hơn message queue, có nghĩa là các promise job bên trong job queue sẽ được thực thi trước các callback bên trong message queue.\n\n\n## 2. Callback\n\nTrong js, function cũng là object.\n\nKhi chúng ta truyền function A và function B dưới dạng tham số của B, lúc này A được gọi là Callback function.\n\n```javascript\nfunction A() {\n  console.log(\"Pass me in B, but I don't know why we need do that\");\n}\n\nfunction B(callback) {\n  callback();\n}\n\nB(A);\n```\n\nKhi chúng ta truyền function không tên vào B thay vì truyền 1 function có tên là A, lúc này function đó gọi là anonymous function, trường hợp này chúng ta làm rất nhiều, tiêu biểu là các event jquery chúng vẫn dùng hay hàm `setTimeout` build-in trong javascript cũng là một ví dụ tiêu biểu, nó nhận vào 2 tham số: một function và 1 khoảng thời gian dạng milisecond.\n\n```javascript\nfunction B(callback) {\n  console.log(\"Do something before call callback\");\n  callback();\n  console.log(\"Do something after call callback\");\n}\n\nB(function() {\n  console.log(\"Callback runing...\");\n});\n\n// Output will be:\n\n// Do something before call callback\n// Callback runing...\n// Do something after call callback\n```\n\nTại sao cần dùng callback?\n\nVì bản chất của ngôn ngữ javascript là bất đồng bộ, làm gì làm luôn, mày làm trễ/chậm thì kệ mày, t** éo thích tuần tự.\n\n```javascript\n// Copy from: https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/\nfunction serverRequest(query, callback){\n  setTimeout(function(){\n    var response = query + \"full!\";\n    callback(response);\n  },5000);\n}\n\nfunction getResults(results){\n  console.log(\"Response from the server: \" + results);\n}\n\nserverRequest(\"The glass is half \", getResults);\n\n// Result in console after 5 second delay:\n// Response from the server: The glass is half full!\n```\n\nTrong ví dụ trên, chúng ta giả lập 1 request tới server, và request này tốn 5s, sau khi request này có kết quả thì 1 function khác ở đây mới chạy, chính là function `getResults`, vì vậy truyền `getResults` dưới dạng callback function vào `serverRequest` rồi \"sau khi nhận được response từ server\" ta truyền dữ liệu đó cho callback function để nó làm công việc mà nó cần làm.\n\nMột ví dụ khác:\n\n```javascript\n// Copy from: https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced\nT.get('search/tweets', params, function(err, data, response) {\n  if(!err){\n    // This is where the magic will happen\n  } else {\n    console.log(err);\n  }\n})\n```\n\nTrong ví dụ trên, callback function sẽ chạy sau khi mà cái hàm `T.get` chạy xong, các tham số của callback function chính là các giá trị `T.get` trả về.\n\n## 3. Promise\n\n```javascript\nlet p = new Promise((resolve, reject) => {\n  let a = 1\n\n  response = {\n    success: true,\n    data: {\n      name: 'Chinh',\n      age: 25\n    }\n  }\n\n  if (a == 1) {\n    resolve(response);\n  } else {\n    reject('Fail');\n  }\n});\n\np.then((data) => {\n  if (data.success) {\n    console.log('This is data: ', data.data);\n  } else {\n    console.log('Something went wrong!');\n  }\n}).catch((err) => {\n  console.log('The error is: ', err);\n});\n```\n\nVí dụ 2 về **Promise.all**\n\n```javascript\nlet cats = new Promise((resolve, reject) => {\n  resolve(\"all cats\");\n});\n\nlet dogs = new Promise((resolve, reject) => {\n  resolve(\"all dogs\");\n});\n\nPromise.all([\n  cats,\n  dogs\n]).then((data) => {\n  console.log(data);\n});\n\n// Output will be:\n// [\"all cats\", \"all dogs\"]\n```\n\n## 4. Async Await\n\nClear code cho promise, được bổ sung trong ES7\n\n```javascript\n// Copy from: https://www.youtube.com/watch?v=V_Kr9OSfDeU\nfunction makeRequest(location) {\n  return new Promise((resolve, reject) => {\n    if (location === 'Google') {\n      resolve('Google say hi');\n    } else {\n      reject('You can only talk to google');\n    }\n  })\n}\n\nfunction processRequest(response) {\n  return new Promise((resolve, reject) => {\n    console.log('Processing response');\n    resolve(`Extra information: ${response}`)\n  });\n}\n\n// Promise hell\nmakeRequest('Google').then(data => {\n  processRequest(data).then(extraData => {\n    console.log('Final data: ', extraData)\n  })\n}).catch((err) => {\n  console.log('err: ', err);\n});\n\n// Update to fix Promise hell\nmakeRequest('Google')\n  .then(data => {\n    return processRequest(data)\n  })\n  .then(extraData => {\n    console.log('Final data: ', extraData)\n  })\n  .catch((err) => {\n    console.log('err: ', err);\n  });\n```\n\nUpdate thành dùng **async await**\n\n```javascript\nasync function doWork() {\n  try {\n    const response = await makeRequest('Google');\n    const processedResponse = await processRequest(response);\n    // Do anything with processedResponse\n  } catch (err) {\n    console.log('err: ', err);\n  }\n}\n```\n\n## 5. References\n\n[1][https://viblo.asia/p/javascript-callback-function-PdbGnozAeyA](https://viblo.asia/p/javascript-callback-function-PdbGnozAeyA)\n[2][https://kipalog.com/posts/Promise-la-khi-gi-](https://kipalog.com/posts/Promise-la-khi-gi-)\n[3][https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/](https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/)\n[4][https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced](https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced)\n[5][https://viblo.asia/p/hieu-ve-asynchronous-javascript-RQqKLARmZ7z](https://viblo.asia/p/hieu-ve-asynchronous-javascript-RQqKLARmZ7z)\n[6][https://www.youtube.com/watch?v=8aGhZQkoFbQ](https://www.youtube.com/watch?v=8aGhZQkoFbQ)\n[7][https://www.youtube.com/watch?v=DHvZLI7Db8E](https://www.youtube.com/watch?v=DHvZLI7Db8E)\n[8][https://www.youtube.com/watch?v=V_Kr9OSfDeU](https://www.youtube.com/watch?v=V_Kr9OSfDeU)\n","source":"_posts/2020-01-09-callback-promise-anyc-await.md","raw":"---\ntitle: \"Callback, Promise, Async Await\"\ndate: 2020-01-09\ntags: [\"NOTES\"]\nlabel: \"#note\"\n---\n\n## 1. Event Loop\n\nJavascript chạy đơn luồng, tương tự như ruby, nhưng khác một điều, môi trường làm việc của javascript đa phần là trình duyệt, nếu mọi thứ đều chạy tuần tự đơn luồng liệu có ổn không?\n\nVí dụ:\n\n```javascript\nAPI.get(\"/cats\")\n\nAPI.get(\"/dogs\")\n```\n\nGiả dụ đoạn code lấy về dữ liệu dogs bên trên gặp lỗi hoặc tốn rất nhiều thời gian để thực hiện, khi đó giao diện (trên trình duyệt) của người dùng sẽ treo hoàn toàn nếu javascript không có giải pháp cho sự đơn luồng và chạy tuần tự?\n\nCách giải quyết là nó đơn luồng và chạy không tuần tự, hay còn gọi là chạy bất đồng bộ:\n\nVậy javascript và ruby cùng là đơn luồng, nhưng javascript chạy bất đồng bộ còn ruby thì chạy đồng bộ tuần tự.\n\nVideo số [6] dưới mục tham khảo đã giải thích rất hay về event loop và không có lý do gì chúng ta đi ghi lại 1 thứ đã có người làm quá tốt. Một vài lưu ý mình lượm lặt nên note lại:\n\n1. Event Loop có một nhiệm vụ duy nhất - giám sát **Call Stack** và **Callback Queue**. Nếu Call Stack trống, nó sẽ lấy sự kiện đầu tiên từ queue và đẩy vào Call Stack\n\n2.Những Web API này là gì? Chúng là những thread mà bạn không thể truy cập được, chỉ có thể gọi để xài mà thôi. Chúng là những nhân tố trong trình duyệt mà thực sự có thể chạy đồng thời (concurrency). Vậy thì event loop là gì:\n\n3. ES6 giới thiệu khái niệm về job queue được sử dụng bởi Promises trong JavaScript. Sự khác biệt giữa message queue và job queue là job queue có mức ưu tiên cao hơn message queue, có nghĩa là các promise job bên trong job queue sẽ được thực thi trước các callback bên trong message queue.\n\n\n## 2. Callback\n\nTrong js, function cũng là object.\n\nKhi chúng ta truyền function A và function B dưới dạng tham số của B, lúc này A được gọi là Callback function.\n\n```javascript\nfunction A() {\n  console.log(\"Pass me in B, but I don't know why we need do that\");\n}\n\nfunction B(callback) {\n  callback();\n}\n\nB(A);\n```\n\nKhi chúng ta truyền function không tên vào B thay vì truyền 1 function có tên là A, lúc này function đó gọi là anonymous function, trường hợp này chúng ta làm rất nhiều, tiêu biểu là các event jquery chúng vẫn dùng hay hàm `setTimeout` build-in trong javascript cũng là một ví dụ tiêu biểu, nó nhận vào 2 tham số: một function và 1 khoảng thời gian dạng milisecond.\n\n```javascript\nfunction B(callback) {\n  console.log(\"Do something before call callback\");\n  callback();\n  console.log(\"Do something after call callback\");\n}\n\nB(function() {\n  console.log(\"Callback runing...\");\n});\n\n// Output will be:\n\n// Do something before call callback\n// Callback runing...\n// Do something after call callback\n```\n\nTại sao cần dùng callback?\n\nVì bản chất của ngôn ngữ javascript là bất đồng bộ, làm gì làm luôn, mày làm trễ/chậm thì kệ mày, t** éo thích tuần tự.\n\n```javascript\n// Copy from: https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/\nfunction serverRequest(query, callback){\n  setTimeout(function(){\n    var response = query + \"full!\";\n    callback(response);\n  },5000);\n}\n\nfunction getResults(results){\n  console.log(\"Response from the server: \" + results);\n}\n\nserverRequest(\"The glass is half \", getResults);\n\n// Result in console after 5 second delay:\n// Response from the server: The glass is half full!\n```\n\nTrong ví dụ trên, chúng ta giả lập 1 request tới server, và request này tốn 5s, sau khi request này có kết quả thì 1 function khác ở đây mới chạy, chính là function `getResults`, vì vậy truyền `getResults` dưới dạng callback function vào `serverRequest` rồi \"sau khi nhận được response từ server\" ta truyền dữ liệu đó cho callback function để nó làm công việc mà nó cần làm.\n\nMột ví dụ khác:\n\n```javascript\n// Copy from: https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced\nT.get('search/tweets', params, function(err, data, response) {\n  if(!err){\n    // This is where the magic will happen\n  } else {\n    console.log(err);\n  }\n})\n```\n\nTrong ví dụ trên, callback function sẽ chạy sau khi mà cái hàm `T.get` chạy xong, các tham số của callback function chính là các giá trị `T.get` trả về.\n\n## 3. Promise\n\n```javascript\nlet p = new Promise((resolve, reject) => {\n  let a = 1\n\n  response = {\n    success: true,\n    data: {\n      name: 'Chinh',\n      age: 25\n    }\n  }\n\n  if (a == 1) {\n    resolve(response);\n  } else {\n    reject('Fail');\n  }\n});\n\np.then((data) => {\n  if (data.success) {\n    console.log('This is data: ', data.data);\n  } else {\n    console.log('Something went wrong!');\n  }\n}).catch((err) => {\n  console.log('The error is: ', err);\n});\n```\n\nVí dụ 2 về **Promise.all**\n\n```javascript\nlet cats = new Promise((resolve, reject) => {\n  resolve(\"all cats\");\n});\n\nlet dogs = new Promise((resolve, reject) => {\n  resolve(\"all dogs\");\n});\n\nPromise.all([\n  cats,\n  dogs\n]).then((data) => {\n  console.log(data);\n});\n\n// Output will be:\n// [\"all cats\", \"all dogs\"]\n```\n\n## 4. Async Await\n\nClear code cho promise, được bổ sung trong ES7\n\n```javascript\n// Copy from: https://www.youtube.com/watch?v=V_Kr9OSfDeU\nfunction makeRequest(location) {\n  return new Promise((resolve, reject) => {\n    if (location === 'Google') {\n      resolve('Google say hi');\n    } else {\n      reject('You can only talk to google');\n    }\n  })\n}\n\nfunction processRequest(response) {\n  return new Promise((resolve, reject) => {\n    console.log('Processing response');\n    resolve(`Extra information: ${response}`)\n  });\n}\n\n// Promise hell\nmakeRequest('Google').then(data => {\n  processRequest(data).then(extraData => {\n    console.log('Final data: ', extraData)\n  })\n}).catch((err) => {\n  console.log('err: ', err);\n});\n\n// Update to fix Promise hell\nmakeRequest('Google')\n  .then(data => {\n    return processRequest(data)\n  })\n  .then(extraData => {\n    console.log('Final data: ', extraData)\n  })\n  .catch((err) => {\n    console.log('err: ', err);\n  });\n```\n\nUpdate thành dùng **async await**\n\n```javascript\nasync function doWork() {\n  try {\n    const response = await makeRequest('Google');\n    const processedResponse = await processRequest(response);\n    // Do anything with processedResponse\n  } catch (err) {\n    console.log('err: ', err);\n  }\n}\n```\n\n## 5. References\n\n[1][https://viblo.asia/p/javascript-callback-function-PdbGnozAeyA](https://viblo.asia/p/javascript-callback-function-PdbGnozAeyA)\n[2][https://kipalog.com/posts/Promise-la-khi-gi-](https://kipalog.com/posts/Promise-la-khi-gi-)\n[3][https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/](https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/)\n[4][https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced](https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced)\n[5][https://viblo.asia/p/hieu-ve-asynchronous-javascript-RQqKLARmZ7z](https://viblo.asia/p/hieu-ve-asynchronous-javascript-RQqKLARmZ7z)\n[6][https://www.youtube.com/watch?v=8aGhZQkoFbQ](https://www.youtube.com/watch?v=8aGhZQkoFbQ)\n[7][https://www.youtube.com/watch?v=DHvZLI7Db8E](https://www.youtube.com/watch?v=DHvZLI7Db8E)\n[8][https://www.youtube.com/watch?v=V_Kr9OSfDeU](https://www.youtube.com/watch?v=V_Kr9OSfDeU)\n","slug":"2020-01-09-callback-promise-anyc-await","published":1,"updated":"2022-01-29T09:29:59.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbf003qp3m2am7a5b9f","content":"<h2 id=\"1-Event-Loop\"><a href=\"#1-Event-Loop\" class=\"headerlink\" title=\"1. Event Loop\"></a>1. Event Loop</h2><p>Javascript chạy đơn luồng, tương tự như ruby, nhưng khác một điều, môi trường làm việc của javascript đa phần là trình duyệt, nếu mọi thứ đều chạy tuần tự đơn luồng liệu có ổn không?</p>\n<p>Ví dụ:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">API.get(<span class=\"string\">\"/cats\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">API.get(<span class=\"string\">\"/dogs\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Giả dụ đoạn code lấy về dữ liệu dogs bên trên gặp lỗi hoặc tốn rất nhiều thời gian để thực hiện, khi đó giao diện (trên trình duyệt) của người dùng sẽ treo hoàn toàn nếu javascript không có giải pháp cho sự đơn luồng và chạy tuần tự?</p>\n<p>Cách giải quyết là nó đơn luồng và chạy không tuần tự, hay còn gọi là chạy bất đồng bộ:</p>\n<p>Vậy javascript và ruby cùng là đơn luồng, nhưng javascript chạy bất đồng bộ còn ruby thì chạy đồng bộ tuần tự.</p>\n<p>Video số [6] dưới mục tham khảo đã giải thích rất hay về event loop và không có lý do gì chúng ta đi ghi lại 1 thứ đã có người làm quá tốt. Một vài lưu ý mình lượm lặt nên note lại:</p>\n<ol>\n<li>Event Loop có một nhiệm vụ duy nhất - giám sát <strong>Call Stack</strong> và <strong>Callback Queue</strong>. Nếu Call Stack trống, nó sẽ lấy sự kiện đầu tiên từ queue và đẩy vào Call Stack</li>\n</ol>\n<p>2.Những Web API này là gì? Chúng là những thread mà bạn không thể truy cập được, chỉ có thể gọi để xài mà thôi. Chúng là những nhân tố trong trình duyệt mà thực sự có thể chạy đồng thời (concurrency). Vậy thì event loop là gì:</p>\n<ol start=\"3\">\n<li>ES6 giới thiệu khái niệm về job queue được sử dụng bởi Promises trong JavaScript. Sự khác biệt giữa message queue và job queue là job queue có mức ưu tiên cao hơn message queue, có nghĩa là các promise job bên trong job queue sẽ được thực thi trước các callback bên trong message queue.</li>\n</ol>\n<h2 id=\"2-Callback\"><a href=\"#2-Callback\" class=\"headerlink\" title=\"2. Callback\"></a>2. Callback</h2><p>Trong js, function cũng là object.</p>\n<p>Khi chúng ta truyền function A và function B dưới dạng tham số của B, lúc này A được gọi là Callback function.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Pass me in B, but I don't know why we need do that\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">  callback();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">B(A);</span><br></pre></td></tr></table></figure>\n\n<p>Khi chúng ta truyền function không tên vào B thay vì truyền 1 function có tên là A, lúc này function đó gọi là anonymous function, trường hợp này chúng ta làm rất nhiều, tiêu biểu là các event jquery chúng vẫn dùng hay hàm <code>setTimeout</code> build-in trong javascript cũng là một ví dụ tiêu biểu, nó nhận vào 2 tham số: một function và 1 khoảng thời gian dạng milisecond.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Do something before call callback\"</span>);</span><br><span class=\"line\">  callback();</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Do something after call callback\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">B(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Callback runing...\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output will be:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Do something before call callback</span></span><br><span class=\"line\"><span class=\"comment\">// Callback runing...</span></span><br><span class=\"line\"><span class=\"comment\">// Do something after call callback</span></span><br></pre></td></tr></table></figure>\n\n<p>Tại sao cần dùng callback?</p>\n<p>Vì bản chất của ngôn ngữ javascript là bất đồng bộ, làm gì làm luôn, mày làm trễ/chậm thì kệ mày, t** éo thích tuần tự.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy from: https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">serverRequest</span>(<span class=\"params\">query, callback</span>)</span>&#123;</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> response = query + <span class=\"string\">\"full!\"</span>;</span><br><span class=\"line\">    callback(response);</span><br><span class=\"line\">  &#125;,<span class=\"number\">5000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getResults</span>(<span class=\"params\">results</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Response from the server: \"</span> + results);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">serverRequest(<span class=\"string\">\"The glass is half \"</span>, getResults);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Result in console after 5 second delay:</span></span><br><span class=\"line\"><span class=\"comment\">// Response from the server: The glass is half full!</span></span><br></pre></td></tr></table></figure>\n\n<p>Trong ví dụ trên, chúng ta giả lập 1 request tới server, và request này tốn 5s, sau khi request này có kết quả thì 1 function khác ở đây mới chạy, chính là function <code>getResults</code>, vì vậy truyền <code>getResults</code> dưới dạng callback function vào <code>serverRequest</code> rồi “sau khi nhận được response từ server” ta truyền dữ liệu đó cho callback function để nó làm công việc mà nó cần làm.</p>\n<p>Một ví dụ khác:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy from: https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced</span></span><br><span class=\"line\">T.get(<span class=\"string\">'search/tweets'</span>, params, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data, response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!err)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// This is where the magic will happen</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Trong ví dụ trên, callback function sẽ chạy sau khi mà cái hàm <code>T.get</code> chạy xong, các tham số của callback function chính là các giá trị <code>T.get</code> trả về.</p>\n<h2 id=\"3-Promise\"><a href=\"#3-Promise\" class=\"headerlink\" title=\"3. Promise\"></a>3. Promise</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> a = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">  response = &#123;</span><br><span class=\"line\">    success: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'Chinh'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">25</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (a == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    resolve(response);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    reject(<span class=\"string\">'Fail'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (data.success) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'This is data: '</span>, data.data);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Something went wrong!'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;).catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'The error is: '</span>, err);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Ví dụ 2 về <strong>Promise.all</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> cats = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  resolve(<span class=\"string\">\"all cats\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> dogs = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  resolve(<span class=\"string\">\"all dogs\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.all([</span><br><span class=\"line\">  cats,</span><br><span class=\"line\">  dogs</span><br><span class=\"line\">]).then(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(data);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output will be:</span></span><br><span class=\"line\"><span class=\"comment\">// [\"all cats\", \"all dogs\"]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Async-Await\"><a href=\"#4-Async-Await\" class=\"headerlink\" title=\"4. Async Await\"></a>4. Async Await</h2><p>Clear code cho promise, được bổ sung trong ES7</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy from: https://www.youtube.com/watch?v=V_Kr9OSfDeU</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeRequest</span>(<span class=\"params\">location</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (location === <span class=\"string\">'Google'</span>) &#123;</span><br><span class=\"line\">      resolve(<span class=\"string\">'Google say hi'</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      reject(<span class=\"string\">'You can only talk to google'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">processRequest</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Processing response'</span>);</span><br><span class=\"line\">    resolve(<span class=\"string\">`Extra information: <span class=\"subst\">$&#123;response&#125;</span>`</span>)</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Promise hell</span></span><br><span class=\"line\">makeRequest(<span class=\"string\">'Google'</span>).then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">  processRequest(data).then(<span class=\"function\"><span class=\"params\">extraData</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Final data: '</span>, extraData)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;).catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'err: '</span>, err);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Update to fix Promise hell</span></span><br><span class=\"line\">makeRequest(<span class=\"string\">'Google'</span>)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> processRequest(data)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">extraData</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Final data: '</span>, extraData)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'err: '</span>, err);</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Update thành dùng <strong>async await</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doWork</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> makeRequest(<span class=\"string\">'Google'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> processedResponse = <span class=\"keyword\">await</span> processRequest(response);</span><br><span class=\"line\">    <span class=\"comment\">// Do anything with processedResponse</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'err: '</span>, err);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-References\"><a href=\"#5-References\" class=\"headerlink\" title=\"5. References\"></a>5. References</h2><p>[1]<a href=\"https://viblo.asia/p/javascript-callback-function-PdbGnozAeyA\" target=\"_blank\" rel=\"noopener\">https://viblo.asia/p/javascript-callback-function-PdbGnozAeyA</a><br>[2]<a href=\"https://kipalog.com/posts/Promise-la-khi-gi-\" target=\"_blank\" rel=\"noopener\">https://kipalog.com/posts/Promise-la-khi-gi-</a><br>[3]<a href=\"https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/\" target=\"_blank\" rel=\"noopener\">https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/</a><br>[4]<a href=\"https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced\" target=\"_blank\" rel=\"noopener\">https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced</a><br>[5]<a href=\"https://viblo.asia/p/hieu-ve-asynchronous-javascript-RQqKLARmZ7z\" target=\"_blank\" rel=\"noopener\">https://viblo.asia/p/hieu-ve-asynchronous-javascript-RQqKLARmZ7z</a><br>[6]<a href=\"https://www.youtube.com/watch?v=8aGhZQkoFbQ\" target=\"_blank\" rel=\"noopener\">https://www.youtube.com/watch?v=8aGhZQkoFbQ</a><br>[7]<a href=\"https://www.youtube.com/watch?v=DHvZLI7Db8E\" target=\"_blank\" rel=\"noopener\">https://www.youtube.com/watch?v=DHvZLI7Db8E</a><br>[8]<a href=\"https://www.youtube.com/watch?v=V_Kr9OSfDeU\" target=\"_blank\" rel=\"noopener\">https://www.youtube.com/watch?v=V_Kr9OSfDeU</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Event-Loop\"><a href=\"#1-Event-Loop\" class=\"headerlink\" title=\"1. Event Loop\"></a>1. Event Loop</h2><p>Javascript chạy đơn luồng, tương tự như ruby, nhưng khác một điều, môi trường làm việc của javascript đa phần là trình duyệt, nếu mọi thứ đều chạy tuần tự đơn luồng liệu có ổn không?</p>\n<p>Ví dụ:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">API.get(<span class=\"string\">\"/cats\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">API.get(<span class=\"string\">\"/dogs\"</span>)</span><br></pre></td></tr></table></figure>\n\n<p>Giả dụ đoạn code lấy về dữ liệu dogs bên trên gặp lỗi hoặc tốn rất nhiều thời gian để thực hiện, khi đó giao diện (trên trình duyệt) của người dùng sẽ treo hoàn toàn nếu javascript không có giải pháp cho sự đơn luồng và chạy tuần tự?</p>\n<p>Cách giải quyết là nó đơn luồng và chạy không tuần tự, hay còn gọi là chạy bất đồng bộ:</p>\n<p>Vậy javascript và ruby cùng là đơn luồng, nhưng javascript chạy bất đồng bộ còn ruby thì chạy đồng bộ tuần tự.</p>\n<p>Video số [6] dưới mục tham khảo đã giải thích rất hay về event loop và không có lý do gì chúng ta đi ghi lại 1 thứ đã có người làm quá tốt. Một vài lưu ý mình lượm lặt nên note lại:</p>\n<ol>\n<li>Event Loop có một nhiệm vụ duy nhất - giám sát <strong>Call Stack</strong> và <strong>Callback Queue</strong>. Nếu Call Stack trống, nó sẽ lấy sự kiện đầu tiên từ queue và đẩy vào Call Stack</li>\n</ol>\n<p>2.Những Web API này là gì? Chúng là những thread mà bạn không thể truy cập được, chỉ có thể gọi để xài mà thôi. Chúng là những nhân tố trong trình duyệt mà thực sự có thể chạy đồng thời (concurrency). Vậy thì event loop là gì:</p>\n<ol start=\"3\">\n<li>ES6 giới thiệu khái niệm về job queue được sử dụng bởi Promises trong JavaScript. Sự khác biệt giữa message queue và job queue là job queue có mức ưu tiên cao hơn message queue, có nghĩa là các promise job bên trong job queue sẽ được thực thi trước các callback bên trong message queue.</li>\n</ol>\n<h2 id=\"2-Callback\"><a href=\"#2-Callback\" class=\"headerlink\" title=\"2. Callback\"></a>2. Callback</h2><p>Trong js, function cũng là object.</p>\n<p>Khi chúng ta truyền function A và function B dưới dạng tham số của B, lúc này A được gọi là Callback function.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">A</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Pass me in B, but I don't know why we need do that\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">  callback();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">B(A);</span><br></pre></td></tr></table></figure>\n\n<p>Khi chúng ta truyền function không tên vào B thay vì truyền 1 function có tên là A, lúc này function đó gọi là anonymous function, trường hợp này chúng ta làm rất nhiều, tiêu biểu là các event jquery chúng vẫn dùng hay hàm <code>setTimeout</code> build-in trong javascript cũng là một ví dụ tiêu biểu, nó nhận vào 2 tham số: một function và 1 khoảng thời gian dạng milisecond.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">B</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Do something before call callback\"</span>);</span><br><span class=\"line\">  callback();</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Do something after call callback\"</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">B(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Callback runing...\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output will be:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Do something before call callback</span></span><br><span class=\"line\"><span class=\"comment\">// Callback runing...</span></span><br><span class=\"line\"><span class=\"comment\">// Do something after call callback</span></span><br></pre></td></tr></table></figure>\n\n<p>Tại sao cần dùng callback?</p>\n<p>Vì bản chất của ngôn ngữ javascript là bất đồng bộ, làm gì làm luôn, mày làm trễ/chậm thì kệ mày, t** éo thích tuần tự.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy from: https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">serverRequest</span>(<span class=\"params\">query, callback</span>)</span>&#123;</span><br><span class=\"line\">  setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> response = query + <span class=\"string\">\"full!\"</span>;</span><br><span class=\"line\">    callback(response);</span><br><span class=\"line\">  &#125;,<span class=\"number\">5000</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getResults</span>(<span class=\"params\">results</span>)</span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Response from the server: \"</span> + results);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">serverRequest(<span class=\"string\">\"The glass is half \"</span>, getResults);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Result in console after 5 second delay:</span></span><br><span class=\"line\"><span class=\"comment\">// Response from the server: The glass is half full!</span></span><br></pre></td></tr></table></figure>\n\n<p>Trong ví dụ trên, chúng ta giả lập 1 request tới server, và request này tốn 5s, sau khi request này có kết quả thì 1 function khác ở đây mới chạy, chính là function <code>getResults</code>, vì vậy truyền <code>getResults</code> dưới dạng callback function vào <code>serverRequest</code> rồi “sau khi nhận được response từ server” ta truyền dữ liệu đó cho callback function để nó làm công việc mà nó cần làm.</p>\n<p>Một ví dụ khác:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy from: https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced</span></span><br><span class=\"line\">T.get(<span class=\"string\">'search/tweets'</span>, params, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">err, data, response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(!err)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// This is where the magic will happen</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(err);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Trong ví dụ trên, callback function sẽ chạy sau khi mà cái hàm <code>T.get</code> chạy xong, các tham số của callback function chính là các giá trị <code>T.get</code> trả về.</p>\n<h2 id=\"3-Promise\"><a href=\"#3-Promise\" class=\"headerlink\" title=\"3. Promise\"></a>3. Promise</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> a = <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">  response = &#123;</span><br><span class=\"line\">    success: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    data: &#123;</span><br><span class=\"line\">      name: <span class=\"string\">'Chinh'</span>,</span><br><span class=\"line\">      age: <span class=\"number\">25</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (a == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">    resolve(response);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    reject(<span class=\"string\">'Fail'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">p.then(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (data.success) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'This is data: '</span>, data.data);</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Something went wrong!'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;).catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'The error is: '</span>, err);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Ví dụ 2 về <strong>Promise.all</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> cats = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  resolve(<span class=\"string\">\"all cats\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> dogs = <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  resolve(<span class=\"string\">\"all dogs\"</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Promise</span>.all([</span><br><span class=\"line\">  cats,</span><br><span class=\"line\">  dogs</span><br><span class=\"line\">]).then(<span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(data);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Output will be:</span></span><br><span class=\"line\"><span class=\"comment\">// [\"all cats\", \"all dogs\"]</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Async-Await\"><a href=\"#4-Async-Await\" class=\"headerlink\" title=\"4. Async Await\"></a>4. Async Await</h2><p>Clear code cho promise, được bổ sung trong ES7</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy from: https://www.youtube.com/watch?v=V_Kr9OSfDeU</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">makeRequest</span>(<span class=\"params\">location</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (location === <span class=\"string\">'Google'</span>) &#123;</span><br><span class=\"line\">      resolve(<span class=\"string\">'Google say hi'</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      reject(<span class=\"string\">'You can only talk to google'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">processRequest</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Processing response'</span>);</span><br><span class=\"line\">    resolve(<span class=\"string\">`Extra information: <span class=\"subst\">$&#123;response&#125;</span>`</span>)</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Promise hell</span></span><br><span class=\"line\">makeRequest(<span class=\"string\">'Google'</span>).then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">  processRequest(data).then(<span class=\"function\"><span class=\"params\">extraData</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Final data: '</span>, extraData)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;).catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'err: '</span>, err);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Update to fix Promise hell</span></span><br><span class=\"line\">makeRequest(<span class=\"string\">'Google'</span>)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> processRequest(data)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">extraData</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Final data: '</span>, extraData)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'err: '</span>, err);</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Update thành dùng <strong>async await</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doWork</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> makeRequest(<span class=\"string\">'Google'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> processedResponse = <span class=\"keyword\">await</span> processRequest(response);</span><br><span class=\"line\">    <span class=\"comment\">// Do anything with processedResponse</span></span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'err: '</span>, err);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-References\"><a href=\"#5-References\" class=\"headerlink\" title=\"5. References\"></a>5. References</h2><p>[1]<a href=\"https://viblo.asia/p/javascript-callback-function-PdbGnozAeyA\" target=\"_blank\" rel=\"noopener\">https://viblo.asia/p/javascript-callback-function-PdbGnozAeyA</a><br>[2]<a href=\"https://kipalog.com/posts/Promise-la-khi-gi-\" target=\"_blank\" rel=\"noopener\">https://kipalog.com/posts/Promise-la-khi-gi-</a><br>[3]<a href=\"https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/\" target=\"_blank\" rel=\"noopener\">https://www.freecodecamp.org/news/what-is-a-callback-function-in-javascript/</a><br>[4]<a href=\"https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced\" target=\"_blank\" rel=\"noopener\">https://codeburst.io/javascript-what-the-heck-is-a-callback-aba4da2deced</a><br>[5]<a href=\"https://viblo.asia/p/hieu-ve-asynchronous-javascript-RQqKLARmZ7z\" target=\"_blank\" rel=\"noopener\">https://viblo.asia/p/hieu-ve-asynchronous-javascript-RQqKLARmZ7z</a><br>[6]<a href=\"https://www.youtube.com/watch?v=8aGhZQkoFbQ\" target=\"_blank\" rel=\"noopener\">https://www.youtube.com/watch?v=8aGhZQkoFbQ</a><br>[7]<a href=\"https://www.youtube.com/watch?v=DHvZLI7Db8E\" target=\"_blank\" rel=\"noopener\">https://www.youtube.com/watch?v=DHvZLI7Db8E</a><br>[8]<a href=\"https://www.youtube.com/watch?v=V_Kr9OSfDeU\" target=\"_blank\" rel=\"noopener\">https://www.youtube.com/watch?v=V_Kr9OSfDeU</a></p>\n"},{"title":"Method And Function","date":"2020-01-10T17:00:00.000Z","label":"#note","_content":"\n### 1.What is the different between method and function?\n\n> A method is on an object. (Tồn tại trên/trong một Object)\n\n> A function is independent of an object. (Độc lập với các Object)\n\n### 2.Method and Function in programming languages\n\n> For C, there are only functions (because no OOP context in C)\n\n> For C++ it would depend on whether or not you're in a class.\n\n> For Ruby, there are only methods, because almost anything in Ruby is Object and when you define a \"function\" not blong to any object, actually it still exist in an \"global object\" (feeling matrix movie).\n\n> For Js, existing both.\n\n### 3.Reference\n\n[1][https://stackoverflow.com/questions/155609/whats-the-difference-between-a-method-and-a-function](https://stackoverflow.com/questions/155609/whats-the-difference-between-a-method-and-a-function)\n","source":"_posts/2020-01-10-method-and-function-notes.md","raw":"---\ntitle: \"Method And Function\"\ndate: 2020-01-11\ntags: [\"NOTES\"]\nlabel: \"#note\"\n---\n\n### 1.What is the different between method and function?\n\n> A method is on an object. (Tồn tại trên/trong một Object)\n\n> A function is independent of an object. (Độc lập với các Object)\n\n### 2.Method and Function in programming languages\n\n> For C, there are only functions (because no OOP context in C)\n\n> For C++ it would depend on whether or not you're in a class.\n\n> For Ruby, there are only methods, because almost anything in Ruby is Object and when you define a \"function\" not blong to any object, actually it still exist in an \"global object\" (feeling matrix movie).\n\n> For Js, existing both.\n\n### 3.Reference\n\n[1][https://stackoverflow.com/questions/155609/whats-the-difference-between-a-method-and-a-function](https://stackoverflow.com/questions/155609/whats-the-difference-between-a-method-and-a-function)\n","slug":"2020-01-10-method-and-function-notes","published":1,"updated":"2022-01-29T09:29:59.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbg003sp3m2fihu5ff6","content":"<h3 id=\"1-What-is-the-different-between-method-and-function\"><a href=\"#1-What-is-the-different-between-method-and-function\" class=\"headerlink\" title=\"1.What is the different between method and function?\"></a>1.What is the different between method and function?</h3><blockquote>\n<p>A method is on an object. (Tồn tại trên/trong một Object)</p>\n</blockquote>\n<blockquote>\n<p>A function is independent of an object. (Độc lập với các Object)</p>\n</blockquote>\n<h3 id=\"2-Method-and-Function-in-programming-languages\"><a href=\"#2-Method-and-Function-in-programming-languages\" class=\"headerlink\" title=\"2.Method and Function in programming languages\"></a>2.Method and Function in programming languages</h3><blockquote>\n<p>For C, there are only functions (because no OOP context in C)</p>\n</blockquote>\n<blockquote>\n<p>For C++ it would depend on whether or not you’re in a class.</p>\n</blockquote>\n<blockquote>\n<p>For Ruby, there are only methods, because almost anything in Ruby is Object and when you define a “function” not blong to any object, actually it still exist in an “global object” (feeling matrix movie).</p>\n</blockquote>\n<blockquote>\n<p>For Js, existing both.</p>\n</blockquote>\n<h3 id=\"3-Reference\"><a href=\"#3-Reference\" class=\"headerlink\" title=\"3.Reference\"></a>3.Reference</h3><p>[1]<a href=\"https://stackoverflow.com/questions/155609/whats-the-difference-between-a-method-and-a-function\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/155609/whats-the-difference-between-a-method-and-a-function</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"1-What-is-the-different-between-method-and-function\"><a href=\"#1-What-is-the-different-between-method-and-function\" class=\"headerlink\" title=\"1.What is the different between method and function?\"></a>1.What is the different between method and function?</h3><blockquote>\n<p>A method is on an object. (Tồn tại trên/trong một Object)</p>\n</blockquote>\n<blockquote>\n<p>A function is independent of an object. (Độc lập với các Object)</p>\n</blockquote>\n<h3 id=\"2-Method-and-Function-in-programming-languages\"><a href=\"#2-Method-and-Function-in-programming-languages\" class=\"headerlink\" title=\"2.Method and Function in programming languages\"></a>2.Method and Function in programming languages</h3><blockquote>\n<p>For C, there are only functions (because no OOP context in C)</p>\n</blockquote>\n<blockquote>\n<p>For C++ it would depend on whether or not you’re in a class.</p>\n</blockquote>\n<blockquote>\n<p>For Ruby, there are only methods, because almost anything in Ruby is Object and when you define a “function” not blong to any object, actually it still exist in an “global object” (feeling matrix movie).</p>\n</blockquote>\n<blockquote>\n<p>For Js, existing both.</p>\n</blockquote>\n<h3 id=\"3-Reference\"><a href=\"#3-Reference\" class=\"headerlink\" title=\"3.Reference\"></a>3.Reference</h3><p>[1]<a href=\"https://stackoverflow.com/questions/155609/whats-the-difference-between-a-method-and-a-function\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/155609/whats-the-difference-between-a-method-and-a-function</a></p>\n"},{"title":"The THIS Keyword In Javascript","date":"2020-01-09T17:00:00.000Z","_content":"\nI don't remember I write the first line of JS code how long before from now. It seems like happen every a long time ago, Until now, I still do not know what exactly is **this** in JS. Too bad, but today I will try to understand it again.\n\n## What is THIS?\n\n**this** is an object in Javascript and object in Javascript like a hash in other language programming.\n\nIn a blank file js, if you run one line code blow:\n\n```javascript\nconsole.log(this);\n```\n\nSo, what is appear after run? The output will not is an error, just like blow:\n\n```javascript\n{}\n```\n\nSo, yes, **this** always exist in Javascript code. I used to believe **this** only exist in an object or in a function, but it's not true.\n\n> The JavaScript this keyword refers to the object it belongs to. So that is why always exist an this in Javascript.\n\n## THIS in Context\n\n**This** has different values depending on where it is used:\n\n1. In a **method**, this refers to the **owner object**.\n\n2. **Alone**, this refers to the **global object**.\n\n3. In a **function**, this refers to the **global object**.\n\n4. In a **function, in strict mode**, this is **undefined**.\n\n5. In **an event**, this refers to **the element that received the event**.\n\n6. Methods like call(), and apply() can refer this to any object.\n\n## Reference\n\n[1][https://www.w3schools.com/js/js_this.asp](https://www.w3schools.com/js/js_this.asp)\n\n[2][https://developer.mozilla.org/en-US/docs/Glossary/Global_object](https://developer.mozilla.org/en-US/docs/Glossary/Global_object)\n\n[3][https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/](https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/)\n","source":"_posts/2020-01-11-this-in-javascript.md","raw":"---\ntitle: \"The THIS Keyword In Javascript\"\ndate: 2020-01-10\ntags: [\"JS\"]\n# label: \"note\"\n---\n\nI don't remember I write the first line of JS code how long before from now. It seems like happen every a long time ago, Until now, I still do not know what exactly is **this** in JS. Too bad, but today I will try to understand it again.\n\n## What is THIS?\n\n**this** is an object in Javascript and object in Javascript like a hash in other language programming.\n\nIn a blank file js, if you run one line code blow:\n\n```javascript\nconsole.log(this);\n```\n\nSo, what is appear after run? The output will not is an error, just like blow:\n\n```javascript\n{}\n```\n\nSo, yes, **this** always exist in Javascript code. I used to believe **this** only exist in an object or in a function, but it's not true.\n\n> The JavaScript this keyword refers to the object it belongs to. So that is why always exist an this in Javascript.\n\n## THIS in Context\n\n**This** has different values depending on where it is used:\n\n1. In a **method**, this refers to the **owner object**.\n\n2. **Alone**, this refers to the **global object**.\n\n3. In a **function**, this refers to the **global object**.\n\n4. In a **function, in strict mode**, this is **undefined**.\n\n5. In **an event**, this refers to **the element that received the event**.\n\n6. Methods like call(), and apply() can refer this to any object.\n\n## Reference\n\n[1][https://www.w3schools.com/js/js_this.asp](https://www.w3schools.com/js/js_this.asp)\n\n[2][https://developer.mozilla.org/en-US/docs/Glossary/Global_object](https://developer.mozilla.org/en-US/docs/Glossary/Global_object)\n\n[3][https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/](https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/)\n","slug":"2020-01-11-this-in-javascript","published":1,"updated":"2022-01-29T09:29:59.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbi003tp3m2cmpa00ey","content":"<p>I don’t remember I write the first line of JS code how long before from now. It seems like happen every a long time ago, Until now, I still do not know what exactly is <strong>this</strong> in JS. Too bad, but today I will try to understand it again.</p>\n<h2 id=\"What-is-THIS\"><a href=\"#What-is-THIS\" class=\"headerlink\" title=\"What is THIS?\"></a>What is THIS?</h2><p><strong>this</strong> is an object in Javascript and object in Javascript like a hash in other language programming.</p>\n<p>In a blank file js, if you run one line code blow:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>);</span><br></pre></td></tr></table></figure>\n\n<p>So, what is appear after run? The output will not is an error, just like blow:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>So, yes, <strong>this</strong> always exist in Javascript code. I used to believe <strong>this</strong> only exist in an object or in a function, but it’s not true.</p>\n<blockquote>\n<p>The JavaScript this keyword refers to the object it belongs to. So that is why always exist an this in Javascript.</p>\n</blockquote>\n<h2 id=\"THIS-in-Context\"><a href=\"#THIS-in-Context\" class=\"headerlink\" title=\"THIS in Context\"></a>THIS in Context</h2><p><strong>This</strong> has different values depending on where it is used:</p>\n<ol>\n<li><p>In a <strong>method</strong>, this refers to the <strong>owner object</strong>.</p>\n</li>\n<li><p><strong>Alone</strong>, this refers to the <strong>global object</strong>.</p>\n</li>\n<li><p>In a <strong>function</strong>, this refers to the <strong>global object</strong>.</p>\n</li>\n<li><p>In a <strong>function, in strict mode</strong>, this is <strong>undefined</strong>.</p>\n</li>\n<li><p>In <strong>an event</strong>, this refers to <strong>the element that received the event</strong>.</p>\n</li>\n<li><p>Methods like call(), and apply() can refer this to any object.</p>\n</li>\n</ol>\n<h2 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h2><p>[1]<a href=\"https://www.w3schools.com/js/js_this.asp\" target=\"_blank\" rel=\"noopener\">https://www.w3schools.com/js/js_this.asp</a></p>\n<p>[2]<a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Global_object\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/en-US/docs/Glossary/Global_object</a></p>\n<p>[3]<a href=\"https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/\" target=\"_blank\" rel=\"noopener\">https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>I don’t remember I write the first line of JS code how long before from now. It seems like happen every a long time ago, Until now, I still do not know what exactly is <strong>this</strong> in JS. Too bad, but today I will try to understand it again.</p>\n<h2 id=\"What-is-THIS\"><a href=\"#What-is-THIS\" class=\"headerlink\" title=\"What is THIS?\"></a>What is THIS?</h2><p><strong>this</strong> is an object in Javascript and object in Javascript like a hash in other language programming.</p>\n<p>In a blank file js, if you run one line code blow:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"keyword\">this</span>);</span><br></pre></td></tr></table></figure>\n\n<p>So, what is appear after run? The output will not is an error, just like blow:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>So, yes, <strong>this</strong> always exist in Javascript code. I used to believe <strong>this</strong> only exist in an object or in a function, but it’s not true.</p>\n<blockquote>\n<p>The JavaScript this keyword refers to the object it belongs to. So that is why always exist an this in Javascript.</p>\n</blockquote>\n<h2 id=\"THIS-in-Context\"><a href=\"#THIS-in-Context\" class=\"headerlink\" title=\"THIS in Context\"></a>THIS in Context</h2><p><strong>This</strong> has different values depending on where it is used:</p>\n<ol>\n<li><p>In a <strong>method</strong>, this refers to the <strong>owner object</strong>.</p>\n</li>\n<li><p><strong>Alone</strong>, this refers to the <strong>global object</strong>.</p>\n</li>\n<li><p>In a <strong>function</strong>, this refers to the <strong>global object</strong>.</p>\n</li>\n<li><p>In a <strong>function, in strict mode</strong>, this is <strong>undefined</strong>.</p>\n</li>\n<li><p>In <strong>an event</strong>, this refers to <strong>the element that received the event</strong>.</p>\n</li>\n<li><p>Methods like call(), and apply() can refer this to any object.</p>\n</li>\n</ol>\n<h2 id=\"Reference\"><a href=\"#Reference\" class=\"headerlink\" title=\"Reference\"></a>Reference</h2><p>[1]<a href=\"https://www.w3schools.com/js/js_this.asp\" target=\"_blank\" rel=\"noopener\">https://www.w3schools.com/js/js_this.asp</a></p>\n<p>[2]<a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Global_object\" target=\"_blank\" rel=\"noopener\">https://developer.mozilla.org/en-US/docs/Glossary/Global_object</a></p>\n<p>[3]<a href=\"https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/\" target=\"_blank\" rel=\"noopener\">https://www.smashingmagazine.com/2014/01/understanding-javascript-function-prototype-bind/</a></p>\n"},{"title":"New Project Notes [Part 1]","date":"2020-02-04T17:00:00.000Z","label":"#note","_content":"\n## 1. Rbenv does not show all version ruby.\n\n- Reseaon: ruby-build outdated\n- Solution: update ruby-build\n\nFind ruby-build folder and pull the latest code, just type **git pull** (it is a repository).\n\n## 2. Apply bootstrap for rails 6\n\n- step 1: **yarn add bootstrap jquery popper.js**\n\n- step 2: add the code below to **config/webpack/environment.js**\n\n```js\nconst { environment } = require('@rails/webpacker')\n\nconst webpack = require('webpack')\nenvironment.plugins.append('Provide', new webpack.ProvidePlugin({\n  $: 'jquery',\n  jQuery: 'jquery',\n  Popper: ['popper.js', 'default']\n}))\n\nmodule.exports = environment\n```\n\n- step 3: add to **app/javascript/packs/application.js**\nrequire(\"bootstrap/dist/js/bootstrap\")\n\n- step 4: add to **app/assets/stylesheets/application.css**\n@import \"bootstrap/scss/bootstrap\";\n\n## 3. Apply git ignore to committed files\n\n- step 1: edit **.gitignore**\n- step 2: **git rm --cached /path/to/file* or *git rm --cached -r /path/to/folder**\n\n## 4. Rename both local and remote branch\n\n- step 1: rename local branch **git branch -m new-name**\n- step 2: delete old remote branch **git push origin :old-name new-name**\n- step 3: update for the new romote branch **git push origin -u new-name**\n\n## 5. References\n\n[1][https://gorails.com/forum/install-bootstrap-with-webpack-with-rails-6-beta](https://gorails.com/forum/install-bootstrap-with-webpack-with-rails-6-beta)\n\n[2][https://stackoverflow.com/questions/7527982/applying-gitignore-to-committed-files](https://stackoverflow.com/questions/7527982/applying-gitignore-to-committed-files)\n\n[3][https://linuxize.com/post/how-to-create-mysql-user-accounts-and-grant-privileges/](https://linuxize.com/post/how-to-create-mysql-user-accounts-and-grant-privileges/)\n\n[4][https://multiplestates.wordpress.com/2015/02/05/rename-a-local-and-remote-branch-in-git/](https://multiplestates.wordpress.com/2015/02/05/rename-a-local-and-remote-branch-in-git/)\n","source":"_posts/2020-02-05-the-first-note-in-the-new-luna-year.md","raw":"---\ntitle: \"New Project Notes [Part 1]\"\ndate: 2020-02-05\ntags: [\"NOTES\"]\nlabel: \"#note\"\n---\n\n## 1. Rbenv does not show all version ruby.\n\n- Reseaon: ruby-build outdated\n- Solution: update ruby-build\n\nFind ruby-build folder and pull the latest code, just type **git pull** (it is a repository).\n\n## 2. Apply bootstrap for rails 6\n\n- step 1: **yarn add bootstrap jquery popper.js**\n\n- step 2: add the code below to **config/webpack/environment.js**\n\n```js\nconst { environment } = require('@rails/webpacker')\n\nconst webpack = require('webpack')\nenvironment.plugins.append('Provide', new webpack.ProvidePlugin({\n  $: 'jquery',\n  jQuery: 'jquery',\n  Popper: ['popper.js', 'default']\n}))\n\nmodule.exports = environment\n```\n\n- step 3: add to **app/javascript/packs/application.js**\nrequire(\"bootstrap/dist/js/bootstrap\")\n\n- step 4: add to **app/assets/stylesheets/application.css**\n@import \"bootstrap/scss/bootstrap\";\n\n## 3. Apply git ignore to committed files\n\n- step 1: edit **.gitignore**\n- step 2: **git rm --cached /path/to/file* or *git rm --cached -r /path/to/folder**\n\n## 4. Rename both local and remote branch\n\n- step 1: rename local branch **git branch -m new-name**\n- step 2: delete old remote branch **git push origin :old-name new-name**\n- step 3: update for the new romote branch **git push origin -u new-name**\n\n## 5. References\n\n[1][https://gorails.com/forum/install-bootstrap-with-webpack-with-rails-6-beta](https://gorails.com/forum/install-bootstrap-with-webpack-with-rails-6-beta)\n\n[2][https://stackoverflow.com/questions/7527982/applying-gitignore-to-committed-files](https://stackoverflow.com/questions/7527982/applying-gitignore-to-committed-files)\n\n[3][https://linuxize.com/post/how-to-create-mysql-user-accounts-and-grant-privileges/](https://linuxize.com/post/how-to-create-mysql-user-accounts-and-grant-privileges/)\n\n[4][https://multiplestates.wordpress.com/2015/02/05/rename-a-local-and-remote-branch-in-git/](https://multiplestates.wordpress.com/2015/02/05/rename-a-local-and-remote-branch-in-git/)\n","slug":"2020-02-05-the-first-note-in-the-new-luna-year","published":1,"updated":"2022-01-29T09:29:59.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbn003vp3m2dc3g8eeg","content":"<h2 id=\"1-Rbenv-does-not-show-all-version-ruby\"><a href=\"#1-Rbenv-does-not-show-all-version-ruby\" class=\"headerlink\" title=\"1. Rbenv does not show all version ruby.\"></a>1. Rbenv does not show all version ruby.</h2><ul>\n<li>Reseaon: ruby-build outdated</li>\n<li>Solution: update ruby-build</li>\n</ul>\n<p>Find ruby-build folder and pull the latest code, just type <strong>git pull</strong> (it is a repository).</p>\n<h2 id=\"2-Apply-bootstrap-for-rails-6\"><a href=\"#2-Apply-bootstrap-for-rails-6\" class=\"headerlink\" title=\"2. Apply bootstrap for rails 6\"></a>2. Apply bootstrap for rails 6</h2><ul>\n<li><p>step 1: <strong>yarn add bootstrap jquery popper.js</strong></p>\n</li>\n<li><p>step 2: add the code below to <strong>config/webpack/environment.js</strong></p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; environment &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'@rails/webpacker'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>)</span><br><span class=\"line\">environment.plugins.append(<span class=\"string\">'Provide'</span>, <span class=\"keyword\">new</span> webpack.ProvidePlugin(&#123;</span><br><span class=\"line\">  $: <span class=\"string\">'jquery'</span>,</span><br><span class=\"line\">  jQuery: <span class=\"string\">'jquery'</span>,</span><br><span class=\"line\">  Popper: [<span class=\"string\">'popper.js'</span>, <span class=\"string\">'default'</span>]</span><br><span class=\"line\">&#125;))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = environment</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>step 3: add to <strong>app/javascript/packs/application.js</strong><br>require(“bootstrap/dist/js/bootstrap”)</p>\n</li>\n<li><p>step 4: add to <strong>app/assets/stylesheets/application.css</strong><br>@import “bootstrap/scss/bootstrap”;</p>\n</li>\n</ul>\n<h2 id=\"3-Apply-git-ignore-to-committed-files\"><a href=\"#3-Apply-git-ignore-to-committed-files\" class=\"headerlink\" title=\"3. Apply git ignore to committed files\"></a>3. Apply git ignore to committed files</h2><ul>\n<li>step 1: edit <strong>.gitignore</strong></li>\n<li>step 2: <strong>git rm –cached /path/to/file* or *git rm –cached -r /path/to/folder</strong></li>\n</ul>\n<h2 id=\"4-Rename-both-local-and-remote-branch\"><a href=\"#4-Rename-both-local-and-remote-branch\" class=\"headerlink\" title=\"4. Rename both local and remote branch\"></a>4. Rename both local and remote branch</h2><ul>\n<li>step 1: rename local branch <strong>git branch -m new-name</strong></li>\n<li>step 2: delete old remote branch <strong>git push origin :old-name new-name</strong></li>\n<li>step 3: update for the new romote branch <strong>git push origin -u new-name</strong></li>\n</ul>\n<h2 id=\"5-References\"><a href=\"#5-References\" class=\"headerlink\" title=\"5. References\"></a>5. References</h2><p>[1]<a href=\"https://gorails.com/forum/install-bootstrap-with-webpack-with-rails-6-beta\" target=\"_blank\" rel=\"noopener\">https://gorails.com/forum/install-bootstrap-with-webpack-with-rails-6-beta</a></p>\n<p>[2]<a href=\"https://stackoverflow.com/questions/7527982/applying-gitignore-to-committed-files\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/7527982/applying-gitignore-to-committed-files</a></p>\n<p>[3]<a href=\"https://linuxize.com/post/how-to-create-mysql-user-accounts-and-grant-privileges/\" target=\"_blank\" rel=\"noopener\">https://linuxize.com/post/how-to-create-mysql-user-accounts-and-grant-privileges/</a></p>\n<p>[4]<a href=\"https://multiplestates.wordpress.com/2015/02/05/rename-a-local-and-remote-branch-in-git/\" target=\"_blank\" rel=\"noopener\">https://multiplestates.wordpress.com/2015/02/05/rename-a-local-and-remote-branch-in-git/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Rbenv-does-not-show-all-version-ruby\"><a href=\"#1-Rbenv-does-not-show-all-version-ruby\" class=\"headerlink\" title=\"1. Rbenv does not show all version ruby.\"></a>1. Rbenv does not show all version ruby.</h2><ul>\n<li>Reseaon: ruby-build outdated</li>\n<li>Solution: update ruby-build</li>\n</ul>\n<p>Find ruby-build folder and pull the latest code, just type <strong>git pull</strong> (it is a repository).</p>\n<h2 id=\"2-Apply-bootstrap-for-rails-6\"><a href=\"#2-Apply-bootstrap-for-rails-6\" class=\"headerlink\" title=\"2. Apply bootstrap for rails 6\"></a>2. Apply bootstrap for rails 6</h2><ul>\n<li><p>step 1: <strong>yarn add bootstrap jquery popper.js</strong></p>\n</li>\n<li><p>step 2: add the code below to <strong>config/webpack/environment.js</strong></p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; environment &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">'@rails/webpacker'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">'webpack'</span>)</span><br><span class=\"line\">environment.plugins.append(<span class=\"string\">'Provide'</span>, <span class=\"keyword\">new</span> webpack.ProvidePlugin(&#123;</span><br><span class=\"line\">  $: <span class=\"string\">'jquery'</span>,</span><br><span class=\"line\">  jQuery: <span class=\"string\">'jquery'</span>,</span><br><span class=\"line\">  Popper: [<span class=\"string\">'popper.js'</span>, <span class=\"string\">'default'</span>]</span><br><span class=\"line\">&#125;))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = environment</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>step 3: add to <strong>app/javascript/packs/application.js</strong><br>require(“bootstrap/dist/js/bootstrap”)</p>\n</li>\n<li><p>step 4: add to <strong>app/assets/stylesheets/application.css</strong><br>@import “bootstrap/scss/bootstrap”;</p>\n</li>\n</ul>\n<h2 id=\"3-Apply-git-ignore-to-committed-files\"><a href=\"#3-Apply-git-ignore-to-committed-files\" class=\"headerlink\" title=\"3. Apply git ignore to committed files\"></a>3. Apply git ignore to committed files</h2><ul>\n<li>step 1: edit <strong>.gitignore</strong></li>\n<li>step 2: <strong>git rm –cached /path/to/file* or *git rm –cached -r /path/to/folder</strong></li>\n</ul>\n<h2 id=\"4-Rename-both-local-and-remote-branch\"><a href=\"#4-Rename-both-local-and-remote-branch\" class=\"headerlink\" title=\"4. Rename both local and remote branch\"></a>4. Rename both local and remote branch</h2><ul>\n<li>step 1: rename local branch <strong>git branch -m new-name</strong></li>\n<li>step 2: delete old remote branch <strong>git push origin :old-name new-name</strong></li>\n<li>step 3: update for the new romote branch <strong>git push origin -u new-name</strong></li>\n</ul>\n<h2 id=\"5-References\"><a href=\"#5-References\" class=\"headerlink\" title=\"5. References\"></a>5. References</h2><p>[1]<a href=\"https://gorails.com/forum/install-bootstrap-with-webpack-with-rails-6-beta\" target=\"_blank\" rel=\"noopener\">https://gorails.com/forum/install-bootstrap-with-webpack-with-rails-6-beta</a></p>\n<p>[2]<a href=\"https://stackoverflow.com/questions/7527982/applying-gitignore-to-committed-files\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/7527982/applying-gitignore-to-committed-files</a></p>\n<p>[3]<a href=\"https://linuxize.com/post/how-to-create-mysql-user-accounts-and-grant-privileges/\" target=\"_blank\" rel=\"noopener\">https://linuxize.com/post/how-to-create-mysql-user-accounts-and-grant-privileges/</a></p>\n<p>[4]<a href=\"https://multiplestates.wordpress.com/2015/02/05/rename-a-local-and-remote-branch-in-git/\" target=\"_blank\" rel=\"noopener\">https://multiplestates.wordpress.com/2015/02/05/rename-a-local-and-remote-branch-in-git/</a></p>\n"},{"title":"New Project Notes [Part 2]","date":"2020-03-15T17:00:00.000Z","label":"#note","_content":"\n## 1. Install homebrew formula\n\nWhen you install a new homebrew formula, homebrew will update all formula as default option. In almost case, it's no problem. But, if you'd like to install new formula without update current formula, try:\n\n```\nHOMEBREW_NO_AUTO_UPDATE=1 brew install <formula>\n```\n\n## 2. Why you need run \"bundle exec\"\n\nYou have installed rspec for your project. sometime you run **rspec** and everything work well, but sometimes it does not, it required you type **bundle exec rspec**.\n\nThe short explain, when you have more than one version of gem (eg. rspec), you need type **bundle exec** to tell rails use the version in Gemfile (Gemfile.lock)\n\n\n## 3. Install the older version mysql in macos with homebrew\n\nToday, I have a crazy problem with our project that we are working on. The one f**king lib in this project need mysql 5.7\n\nBut, remember, when you copy paste from go rails to install ruby, rails and related databases, we always install the lastest version of all, :D\n\nSo what? Let quick check mysql version on my machine...\n\nOh, shit, above 8.0.\n\nOk, no worry, just google \"how to install another mysql version with homebrew\" and then I take 3 hours to install, remove, run command which I have no idea what it doing for....and still  get error, error and error again. I'm sad, I lost my hope about my carrer :(\n\nAnd finally, I try to install mysql 5.7\n\n1. Remove mysql current version\n```\nbrew uninstall mysql\n```\n\n2. Remove mysql version 5.7\n```\nbrew uninstall mysql@5.7\n```\n\n3. Remove folder config mysql\n```\nrm -rf /usr/local/var/mysql\n```\n\n4. Remove config file\n```\nrm /usr/local/etc/my.cnf\n```\n\n5. Reinstall mysql version 5.7\n```\nrm /usr/local/etc/my.cnf\n```\n\n6. Manually link to mysql 5.7 because it's not latest version so home brew will do nothing\n\n```\nbrew link --force mysql@5.7\n```\n\n7. Start mysql 5.7\n```\nbrew services start mysql@5.7\n```\n\n8. Important note\nWhen you reinstall mysql with older version, in all projects that you used mysql, you need to **gem uninstall mysql2** and **bundle** to reinstall gems mysql2, if not, you will get error.\n\n## 4. Ignore migration file check\n```ruby\nconfig.active_record.migration_error = false\n```\n\nAdd above config to config file.(config/envirements/*.rb)\n\n## 3. References\n\n[1][https://stackoverflow.com/questions/6588674/what-does-bundle-exec-rake-mean](https://stackoverflow.com/questions/6588674/what-does-bundle-exec-rake-mean)\n\n[2][https://medium.com/@at0dd/install-mysql-5-7-on-mac-os-mojave-cd07ec936034](https://medium.com/@at0dd/install-mysql-5-7-on-mac-os-mojave-cd07ec936034)\n","source":"_posts/2020-03-16-new-project-notes-2.md","raw":"---\ntitle: \"New Project Notes [Part 2]\"\ndate: 2020-03-16\ntags: [\"NOTES\"]\nlabel: \"#note\"\n---\n\n## 1. Install homebrew formula\n\nWhen you install a new homebrew formula, homebrew will update all formula as default option. In almost case, it's no problem. But, if you'd like to install new formula without update current formula, try:\n\n```\nHOMEBREW_NO_AUTO_UPDATE=1 brew install <formula>\n```\n\n## 2. Why you need run \"bundle exec\"\n\nYou have installed rspec for your project. sometime you run **rspec** and everything work well, but sometimes it does not, it required you type **bundle exec rspec**.\n\nThe short explain, when you have more than one version of gem (eg. rspec), you need type **bundle exec** to tell rails use the version in Gemfile (Gemfile.lock)\n\n\n## 3. Install the older version mysql in macos with homebrew\n\nToday, I have a crazy problem with our project that we are working on. The one f**king lib in this project need mysql 5.7\n\nBut, remember, when you copy paste from go rails to install ruby, rails and related databases, we always install the lastest version of all, :D\n\nSo what? Let quick check mysql version on my machine...\n\nOh, shit, above 8.0.\n\nOk, no worry, just google \"how to install another mysql version with homebrew\" and then I take 3 hours to install, remove, run command which I have no idea what it doing for....and still  get error, error and error again. I'm sad, I lost my hope about my carrer :(\n\nAnd finally, I try to install mysql 5.7\n\n1. Remove mysql current version\n```\nbrew uninstall mysql\n```\n\n2. Remove mysql version 5.7\n```\nbrew uninstall mysql@5.7\n```\n\n3. Remove folder config mysql\n```\nrm -rf /usr/local/var/mysql\n```\n\n4. Remove config file\n```\nrm /usr/local/etc/my.cnf\n```\n\n5. Reinstall mysql version 5.7\n```\nrm /usr/local/etc/my.cnf\n```\n\n6. Manually link to mysql 5.7 because it's not latest version so home brew will do nothing\n\n```\nbrew link --force mysql@5.7\n```\n\n7. Start mysql 5.7\n```\nbrew services start mysql@5.7\n```\n\n8. Important note\nWhen you reinstall mysql with older version, in all projects that you used mysql, you need to **gem uninstall mysql2** and **bundle** to reinstall gems mysql2, if not, you will get error.\n\n## 4. Ignore migration file check\n```ruby\nconfig.active_record.migration_error = false\n```\n\nAdd above config to config file.(config/envirements/*.rb)\n\n## 3. References\n\n[1][https://stackoverflow.com/questions/6588674/what-does-bundle-exec-rake-mean](https://stackoverflow.com/questions/6588674/what-does-bundle-exec-rake-mean)\n\n[2][https://medium.com/@at0dd/install-mysql-5-7-on-mac-os-mojave-cd07ec936034](https://medium.com/@at0dd/install-mysql-5-7-on-mac-os-mojave-cd07ec936034)\n","slug":"2020-03-16-new-project-notes-2","published":1,"updated":"2022-01-29T09:29:59.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbn003xp3m2c9i3ebk3","content":"<h2 id=\"1-Install-homebrew-formula\"><a href=\"#1-Install-homebrew-formula\" class=\"headerlink\" title=\"1. Install homebrew formula\"></a>1. Install homebrew formula</h2><p>When you install a new homebrew formula, homebrew will update all formula as default option. In almost case, it’s no problem. But, if you’d like to install new formula without update current formula, try:</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">HOMEBREW_NO_AUTO_UPDATE</span>=<span class=\"number\">1</span> brew install &lt;formula&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Why-you-need-run-“bundle-exec”\"><a href=\"#2-Why-you-need-run-“bundle-exec”\" class=\"headerlink\" title=\"2. Why you need run “bundle exec”\"></a>2. Why you need run “bundle exec”</h2><p>You have installed rspec for your project. sometime you run <strong>rspec</strong> and everything work well, but sometimes it does not, it required you type <strong>bundle exec rspec</strong>.</p>\n<p>The short explain, when you have more than one version of gem (eg. rspec), you need type <strong>bundle exec</strong> to tell rails use the version in Gemfile (Gemfile.lock)</p>\n<h2 id=\"3-Install-the-older-version-mysql-in-macos-with-homebrew\"><a href=\"#3-Install-the-older-version-mysql-in-macos-with-homebrew\" class=\"headerlink\" title=\"3. Install the older version mysql in macos with homebrew\"></a>3. Install the older version mysql in macos with homebrew</h2><p>Today, I have a crazy problem with our project that we are working on. The one f**king lib in this project need mysql 5.7</p>\n<p>But, remember, when you copy paste from go rails to install ruby, rails and related databases, we always install the lastest version of all, :D</p>\n<p>So what? Let quick check mysql version on my machine…</p>\n<p>Oh, shit, above 8.0.</p>\n<p>Ok, no worry, just google “how to install another mysql version with homebrew” and then I take 3 hours to install, remove, run command which I have no idea what it doing for….and still  get error, error and error again. I’m sad, I lost my hope about my carrer :(</p>\n<p>And finally, I try to install mysql 5.7</p>\n<ol>\n<li><p>Remove mysql current version</p>\n<figure class=\"highlight armasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">brew </span>uninstall mysql</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Remove mysql version 5.7</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew uninstall <span class=\"symbol\">mysql@</span><span class=\"number\">5.7</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Remove folder config mysql</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">rm</span> -rf /usr/<span class=\"keyword\">local</span>/<span class=\"keyword\">var</span>/mysql</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Remove config file</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm /usr/<span class=\"keyword\">local</span>/etc/<span class=\"keyword\">my</span>.cnf</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Reinstall mysql version 5.7</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm /usr/<span class=\"keyword\">local</span>/etc/<span class=\"keyword\">my</span>.cnf</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Manually link to mysql 5.7 because it’s not latest version so home brew will do nothing</p>\n</li>\n</ol>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew link --force <span class=\"symbol\">mysql@</span><span class=\"number\">5.7</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"7\">\n<li><p>Start mysql 5.7</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew services start <span class=\"symbol\">mysql@</span><span class=\"number\">5.7</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Important note<br>When you reinstall mysql with older version, in all projects that you used mysql, you need to <strong>gem uninstall mysql2</strong> and <strong>bundle</strong> to reinstall gems mysql2, if not, you will get error.</p>\n</li>\n</ol>\n<h2 id=\"4-Ignore-migration-file-check\"><a href=\"#4-Ignore-migration-file-check\" class=\"headerlink\" title=\"4. Ignore migration file check\"></a>4. Ignore migration file check</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.active_record.migration_error = <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<p>Add above config to config file.(config/envirements/*.rb)</p>\n<h2 id=\"3-References\"><a href=\"#3-References\" class=\"headerlink\" title=\"3. References\"></a>3. References</h2><p>[1]<a href=\"https://stackoverflow.com/questions/6588674/what-does-bundle-exec-rake-mean\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/6588674/what-does-bundle-exec-rake-mean</a></p>\n<p>[2]<a href=\"https://medium.com/@at0dd/install-mysql-5-7-on-mac-os-mojave-cd07ec936034\" target=\"_blank\" rel=\"noopener\">https://medium.com/@at0dd/install-mysql-5-7-on-mac-os-mojave-cd07ec936034</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Install-homebrew-formula\"><a href=\"#1-Install-homebrew-formula\" class=\"headerlink\" title=\"1. Install homebrew formula\"></a>1. Install homebrew formula</h2><p>When you install a new homebrew formula, homebrew will update all formula as default option. In almost case, it’s no problem. But, if you’d like to install new formula without update current formula, try:</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">HOMEBREW_NO_AUTO_UPDATE</span>=<span class=\"number\">1</span> brew install &lt;formula&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Why-you-need-run-“bundle-exec”\"><a href=\"#2-Why-you-need-run-“bundle-exec”\" class=\"headerlink\" title=\"2. Why you need run “bundle exec”\"></a>2. Why you need run “bundle exec”</h2><p>You have installed rspec for your project. sometime you run <strong>rspec</strong> and everything work well, but sometimes it does not, it required you type <strong>bundle exec rspec</strong>.</p>\n<p>The short explain, when you have more than one version of gem (eg. rspec), you need type <strong>bundle exec</strong> to tell rails use the version in Gemfile (Gemfile.lock)</p>\n<h2 id=\"3-Install-the-older-version-mysql-in-macos-with-homebrew\"><a href=\"#3-Install-the-older-version-mysql-in-macos-with-homebrew\" class=\"headerlink\" title=\"3. Install the older version mysql in macos with homebrew\"></a>3. Install the older version mysql in macos with homebrew</h2><p>Today, I have a crazy problem with our project that we are working on. The one f**king lib in this project need mysql 5.7</p>\n<p>But, remember, when you copy paste from go rails to install ruby, rails and related databases, we always install the lastest version of all, :D</p>\n<p>So what? Let quick check mysql version on my machine…</p>\n<p>Oh, shit, above 8.0.</p>\n<p>Ok, no worry, just google “how to install another mysql version with homebrew” and then I take 3 hours to install, remove, run command which I have no idea what it doing for….and still  get error, error and error again. I’m sad, I lost my hope about my carrer :(</p>\n<p>And finally, I try to install mysql 5.7</p>\n<ol>\n<li><p>Remove mysql current version</p>\n<figure class=\"highlight armasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">brew </span>uninstall mysql</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Remove mysql version 5.7</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew uninstall <span class=\"symbol\">mysql@</span><span class=\"number\">5.7</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Remove folder config mysql</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">rm</span> -rf /usr/<span class=\"keyword\">local</span>/<span class=\"keyword\">var</span>/mysql</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Remove config file</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm /usr/<span class=\"keyword\">local</span>/etc/<span class=\"keyword\">my</span>.cnf</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Reinstall mysql version 5.7</p>\n<figure class=\"highlight applescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rm /usr/<span class=\"keyword\">local</span>/etc/<span class=\"keyword\">my</span>.cnf</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Manually link to mysql 5.7 because it’s not latest version so home brew will do nothing</p>\n</li>\n</ol>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew link --force <span class=\"symbol\">mysql@</span><span class=\"number\">5.7</span></span><br></pre></td></tr></table></figure>\n\n<ol start=\"7\">\n<li><p>Start mysql 5.7</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew services start <span class=\"symbol\">mysql@</span><span class=\"number\">5.7</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Important note<br>When you reinstall mysql with older version, in all projects that you used mysql, you need to <strong>gem uninstall mysql2</strong> and <strong>bundle</strong> to reinstall gems mysql2, if not, you will get error.</p>\n</li>\n</ol>\n<h2 id=\"4-Ignore-migration-file-check\"><a href=\"#4-Ignore-migration-file-check\" class=\"headerlink\" title=\"4. Ignore migration file check\"></a>4. Ignore migration file check</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">config.active_record.migration_error = <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n\n<p>Add above config to config file.(config/envirements/*.rb)</p>\n<h2 id=\"3-References\"><a href=\"#3-References\" class=\"headerlink\" title=\"3. References\"></a>3. References</h2><p>[1]<a href=\"https://stackoverflow.com/questions/6588674/what-does-bundle-exec-rake-mean\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/6588674/what-does-bundle-exec-rake-mean</a></p>\n<p>[2]<a href=\"https://medium.com/@at0dd/install-mysql-5-7-on-mac-os-mojave-cd07ec936034\" target=\"_blank\" rel=\"noopener\">https://medium.com/@at0dd/install-mysql-5-7-on-mac-os-mojave-cd07ec936034</a></p>\n"},{"title":"Redux Notes","date":"2020-01-08T17:00:00.000Z","label":"#note","_content":"\nSource from:\n\n[1][https://www.youtube.com/watch?v=HOrA-uzZpw8](https://www.youtube.com/watch?v=HOrA-uzZpw8)\n[2][https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js](https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js)\n\n```javascript\n// Copy from: https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js\nconsole.log(window.Redux)\n\nconst { createStore } = window.Redux;\n\n// SETUP REDUX STORE\n// state\n// reducer\n// store\nconst initialState = JSON.parse(localStorage.getItem('hobby_list')) || [];\n\nconst hobbyReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'ADD_HOBBY': {\n      const newList = [...state];\n      newList.push(action.payload);\n\n      return newList;\n    }\n    default:\n      return state;\n  }\n}\n\nconst store = createStore(hobbyReducer);\n\n// -----------------\n\n// RENDER REDUX HOBBY LIST\nconst renderHobbyList = (hobbyList) => {\n  if (!Array.isArray(hobbyList) || hobbyList.length === 0) return;\n\n  const ulElement = document.querySelector('#hobbyListId');\n  if (!ulElement) return;\n\n  // reset previous content of ul\n  ulElement.innerHTML = '';\n\n  for (const hobby of hobbyList) {\n    const liElement = document.createElement('li');\n    liElement.textContent = hobby;\n\n    ulElement.appendChild(liElement);\n  }\n}\n\n\n// RENDER INITIAL HOBBY LIST\nconst initialHobbyList = store.getState();\nconsole.log(initialHobbyList);\nrenderHobbyList(initialHobbyList);\n\n\n// HANDLE FORM SUBMIT\nconst hobbyFormElement = document.querySelector('#hobbyFormId');\nif (hobbyFormElement) {\n  const handleFormSubmit = (e) => {\n    // prevent browser from reloading\n    e.preventDefault();\n\n    const hobbyTextElement = hobbyFormElement.querySelector('#hobbyTextId');\n    if (!hobbyTextElement) return;\n\n    console.log('SUBMIT', hobbyTextElement.value);\n    const action = {\n      type: 'ADD_HOBBY',\n      payload: hobbyTextElement.value\n    };\n    store.dispatch(action);\n\n    // reset form\n    hobbyFormElement.reset();\n  };\n\n  hobbyFormElement.addEventListener('submit', handleFormSubmit);\n}\n\nstore.subscribe(() => {\n  console.log('STATE UPDATE: ', store.getState());\n  const newHobbyList = store.getState();\n  renderHobbyList(newHobbyList);\n\n  localStorage.setItem('hobby_list', JSON.stringify(newHobbyList));\n});\n```\n","source":"_posts/2020-03-8-redux-co-ban.md","raw":"---\ntitle: \"Redux Notes\"\ndate: 2020-01-09\ntags: [\"NOTES\"]\nlabel: \"#note\"\n---\n\nSource from:\n\n[1][https://www.youtube.com/watch?v=HOrA-uzZpw8](https://www.youtube.com/watch?v=HOrA-uzZpw8)\n[2][https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js](https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js)\n\n```javascript\n// Copy from: https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js\nconsole.log(window.Redux)\n\nconst { createStore } = window.Redux;\n\n// SETUP REDUX STORE\n// state\n// reducer\n// store\nconst initialState = JSON.parse(localStorage.getItem('hobby_list')) || [];\n\nconst hobbyReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case 'ADD_HOBBY': {\n      const newList = [...state];\n      newList.push(action.payload);\n\n      return newList;\n    }\n    default:\n      return state;\n  }\n}\n\nconst store = createStore(hobbyReducer);\n\n// -----------------\n\n// RENDER REDUX HOBBY LIST\nconst renderHobbyList = (hobbyList) => {\n  if (!Array.isArray(hobbyList) || hobbyList.length === 0) return;\n\n  const ulElement = document.querySelector('#hobbyListId');\n  if (!ulElement) return;\n\n  // reset previous content of ul\n  ulElement.innerHTML = '';\n\n  for (const hobby of hobbyList) {\n    const liElement = document.createElement('li');\n    liElement.textContent = hobby;\n\n    ulElement.appendChild(liElement);\n  }\n}\n\n\n// RENDER INITIAL HOBBY LIST\nconst initialHobbyList = store.getState();\nconsole.log(initialHobbyList);\nrenderHobbyList(initialHobbyList);\n\n\n// HANDLE FORM SUBMIT\nconst hobbyFormElement = document.querySelector('#hobbyFormId');\nif (hobbyFormElement) {\n  const handleFormSubmit = (e) => {\n    // prevent browser from reloading\n    e.preventDefault();\n\n    const hobbyTextElement = hobbyFormElement.querySelector('#hobbyTextId');\n    if (!hobbyTextElement) return;\n\n    console.log('SUBMIT', hobbyTextElement.value);\n    const action = {\n      type: 'ADD_HOBBY',\n      payload: hobbyTextElement.value\n    };\n    store.dispatch(action);\n\n    // reset form\n    hobbyFormElement.reset();\n  };\n\n  hobbyFormElement.addEventListener('submit', handleFormSubmit);\n}\n\nstore.subscribe(() => {\n  console.log('STATE UPDATE: ', store.getState());\n  const newHobbyList = store.getState();\n  renderHobbyList(newHobbyList);\n\n  localStorage.setItem('hobby_list', JSON.stringify(newHobbyList));\n});\n```\n","slug":"2020-03-8-redux-co-ban","published":1,"updated":"2022-01-29T09:29:59.929Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbo0040p3m2dz43gip5","content":"<p>Source from:</p>\n<p>[1]<a href=\"https://www.youtube.com/watch?v=HOrA-uzZpw8\" target=\"_blank\" rel=\"noopener\">https://www.youtube.com/watch?v=HOrA-uzZpw8</a><br>[2]<a href=\"https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js\" target=\"_blank\" rel=\"noopener\">https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy from: https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">window</span>.Redux)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; createStore &#125; = <span class=\"built_in\">window</span>.Redux;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// SETUP REDUX STORE</span></span><br><span class=\"line\"><span class=\"comment\">// state</span></span><br><span class=\"line\"><span class=\"comment\">// reducer</span></span><br><span class=\"line\"><span class=\"comment\">// store</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> initialState = <span class=\"built_in\">JSON</span>.parse(localStorage.getItem(<span class=\"string\">'hobby_list'</span>)) || [];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> hobbyReducer = <span class=\"function\">(<span class=\"params\">state = initialState, action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.type) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'ADD_HOBBY'</span>: &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> newList = [...state];</span><br><span class=\"line\">      newList.push(action.payload);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> newList;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> store = createStore(hobbyReducer);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// -----------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// RENDER REDUX HOBBY LIST</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> renderHobbyList = <span class=\"function\">(<span class=\"params\">hobbyList</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!<span class=\"built_in\">Array</span>.isArray(hobbyList) || hobbyList.length === <span class=\"number\">0</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> ulElement = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'#hobbyListId'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!ulElement) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// reset previous content of ul</span></span><br><span class=\"line\">  ulElement.innerHTML = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> hobby <span class=\"keyword\">of</span> hobbyList) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> liElement = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'li'</span>);</span><br><span class=\"line\">    liElement.textContent = hobby;</span><br><span class=\"line\"></span><br><span class=\"line\">    ulElement.appendChild(liElement);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// RENDER INITIAL HOBBY LIST</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> initialHobbyList = store.getState();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(initialHobbyList);</span><br><span class=\"line\">renderHobbyList(initialHobbyList);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// HANDLE FORM SUBMIT</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> hobbyFormElement = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'#hobbyFormId'</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (hobbyFormElement) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> handleFormSubmit = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// prevent browser from reloading</span></span><br><span class=\"line\">    e.preventDefault();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> hobbyTextElement = hobbyFormElement.querySelector(<span class=\"string\">'#hobbyTextId'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!hobbyTextElement) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'SUBMIT'</span>, hobbyTextElement.value);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> action = &#123;</span><br><span class=\"line\">      type: <span class=\"string\">'ADD_HOBBY'</span>,</span><br><span class=\"line\">      payload: hobbyTextElement.value</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    store.dispatch(action);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// reset form</span></span><br><span class=\"line\">    hobbyFormElement.reset();</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  hobbyFormElement.addEventListener(<span class=\"string\">'submit'</span>, handleFormSubmit);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">store.subscribe(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'STATE UPDATE: '</span>, store.getState());</span><br><span class=\"line\">  <span class=\"keyword\">const</span> newHobbyList = store.getState();</span><br><span class=\"line\">  renderHobbyList(newHobbyList);</span><br><span class=\"line\"></span><br><span class=\"line\">  localStorage.setItem(<span class=\"string\">'hobby_list'</span>, <span class=\"built_in\">JSON</span>.stringify(newHobbyList));</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>Source from:</p>\n<p>[1]<a href=\"https://www.youtube.com/watch?v=HOrA-uzZpw8\" target=\"_blank\" rel=\"noopener\">https://www.youtube.com/watch?v=HOrA-uzZpw8</a><br>[2]<a href=\"https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js\" target=\"_blank\" rel=\"noopener\">https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy from: https://github.com/paulnguyen-mn/redux-pure-js/blob/master/main.js</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"built_in\">window</span>.Redux)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; createStore &#125; = <span class=\"built_in\">window</span>.Redux;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// SETUP REDUX STORE</span></span><br><span class=\"line\"><span class=\"comment\">// state</span></span><br><span class=\"line\"><span class=\"comment\">// reducer</span></span><br><span class=\"line\"><span class=\"comment\">// store</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> initialState = <span class=\"built_in\">JSON</span>.parse(localStorage.getItem(<span class=\"string\">'hobby_list'</span>)) || [];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> hobbyReducer = <span class=\"function\">(<span class=\"params\">state = initialState, action</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span> (action.type) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"string\">'ADD_HOBBY'</span>: &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> newList = [...state];</span><br><span class=\"line\">      newList.push(action.payload);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> newList;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> store = createStore(hobbyReducer);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// -----------------</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// RENDER REDUX HOBBY LIST</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> renderHobbyList = <span class=\"function\">(<span class=\"params\">hobbyList</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!<span class=\"built_in\">Array</span>.isArray(hobbyList) || hobbyList.length === <span class=\"number\">0</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> ulElement = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'#hobbyListId'</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!ulElement) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// reset previous content of ul</span></span><br><span class=\"line\">  ulElement.innerHTML = <span class=\"string\">''</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> hobby <span class=\"keyword\">of</span> hobbyList) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> liElement = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'li'</span>);</span><br><span class=\"line\">    liElement.textContent = hobby;</span><br><span class=\"line\"></span><br><span class=\"line\">    ulElement.appendChild(liElement);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// RENDER INITIAL HOBBY LIST</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> initialHobbyList = store.getState();</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(initialHobbyList);</span><br><span class=\"line\">renderHobbyList(initialHobbyList);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// HANDLE FORM SUBMIT</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> hobbyFormElement = <span class=\"built_in\">document</span>.querySelector(<span class=\"string\">'#hobbyFormId'</span>);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (hobbyFormElement) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> handleFormSubmit = <span class=\"function\">(<span class=\"params\">e</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// prevent browser from reloading</span></span><br><span class=\"line\">    e.preventDefault();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">const</span> hobbyTextElement = hobbyFormElement.querySelector(<span class=\"string\">'#hobbyTextId'</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!hobbyTextElement) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'SUBMIT'</span>, hobbyTextElement.value);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> action = &#123;</span><br><span class=\"line\">      type: <span class=\"string\">'ADD_HOBBY'</span>,</span><br><span class=\"line\">      payload: hobbyTextElement.value</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    store.dispatch(action);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// reset form</span></span><br><span class=\"line\">    hobbyFormElement.reset();</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">  hobbyFormElement.addEventListener(<span class=\"string\">'submit'</span>, handleFormSubmit);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">store.subscribe(<span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'STATE UPDATE: '</span>, store.getState());</span><br><span class=\"line\">  <span class=\"keyword\">const</span> newHobbyList = store.getState();</span><br><span class=\"line\">  renderHobbyList(newHobbyList);</span><br><span class=\"line\"></span><br><span class=\"line\">  localStorage.setItem(<span class=\"string\">'hobby_list'</span>, <span class=\"built_in\">JSON</span>.stringify(newHobbyList));</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n"},{"title":"Exception Trong Rails [Part 2]","date":"2020-04-22T17:00:00.000Z","_content":"\n## 1. Xử lý exception trong method\n\nE.g. Trong products_controller.rb ta có method sau:\n\n```ruby\n  def show\n    product = Product.find(12)\n\n    render layout_for_product_detail\n  end\n```\n\nNếu không có product nào có id = 12, đoạn code trên sẽ gặp lỗi, và người dùng sẽ nhận được 1 màn hình error server.\n\nKhông muốn điều này xảy ra, ta update lại đoạn code như sau:\n\n```ruby\ndef show\n  begin\n    product = Product.find(12)\n\n    render layout_for_product_detail\n  rescue StandardError => e\n    # Do something good for user\n  end\nend\n```\n\nVậy là ổn, như trong bài phần 1, catch exception với StandardError là đủ tốt để áp dụng và có lẽ đủ tốt để pass review code.\n\n## 2. Xử lý exception với controller\n\nPhần 1 đã ổn, nhưng không được tốt, lý do là vì nếu chúng ta có 100 methods, vậy chúng ta sẽ lắp lại đoạn catch exception kia 100 lần. Không DRY chút nào, viết 1 chục method lặp lại cùng 1 exception thì có lẽ không pass được review code =))\n\nUpdate: products_controller.rb\n\n```ruby\nclass ProductsController < ApplicationController\n  rescue_from StandardError, with: :private_method_you_use_to_handle_exception\n\n  def show\n    product = Product.find(12)\n\n    render layout_for_product_detail\n  end\n\n  # 100 methods nữa ở đây...\n\n  private\n\n  def private_method_you_use_to_handle_exception\n    # Do something good\n  end\nend\n```\n\nNhư vậy đỡ phải viết lặp đi lặp lại 100 lần. Có vẻ tốt hơn rồi, tuy nhiên đã đủ tốt?\n\n## 3. Xử lý exception với controller cha\n\nVậy nếu ta có 100 controller, và chỉ để bắt StandardError mà chúng ta phải viết rescue_from cho cả 100 controller đó?\n\nTa có thể xử lý trường hơp trên bằng cách dùng rescue_from trong controller cha, ở đây thì cha của products controller là application controller.\n\n```ruby\nclass ApplicationControler < ActionController::Base\n  rescue_from StandardError, with: :private_method_you_use_to_handle_exception\n\n  private\n\n  def private_method_you_use_to_handle_exception\n    # Do something good\n  end\nend\n\nclass ProductsController < ApplicationController\n  def show\n    product = Product.find(12)\n\n    render layout_for_product_detail\n  end\nend\n```\n\n## 4. Tách exception ra module riêng\n\nGiờ chúng ta chỉ có 1 exception cơ bản, nhưng không gì đảm bảo được rằng thế giới quan ngoài kia có thể kìm hãm nổi tài năng của bạn, rất có thể vài năm sau project làm chơi ngày nào của bạn thành startup triệu đô? =)) logic và bussiness lúc đó phức tạp thêm chục/trăm/ngàn lần.\n\nNên tách exception handle sang 1 module riêng là lựa chọn không tồi cho hiện tại và là lựa chọn không thể tránh khỏi trong tương lai (project của bạn mập lên).\n\nBạn muốn tách moudle này vào đâu? tôi không biết, tôi thì bỏ vào concerns folder của folder controller cho nhanh.\n\n```ruby\n# controllers/concerns/handle_exception.rb\nmodule HandleException\n  included do\n    rescue_from StandardError do |e|\n      # Do something good\n    end\n end\nend\n\nclass ApplicationControler < ActionController::Base\n  include HandleException\nend\n\n```\n\nVậy là chúng ta đã tách đoạn logic xử lý exception ra khỏi controller.\n\n## 5. Bắt exception chi tiết hơn\n\nĐến mục số 4, mọi thứ đã khá tốt, tuy vậy, có nhiều exception trong rails (và framework nào cũng vậy). Standard là 1 exception rất chung chung, vì vậy chỉ bắt Standard exception có lẽ giành cho trường hợp chúng ta... lười, hoặc dự án không nhiều logic, hoặc không đủ thời gian để implement, deadline dí quá chạy không kịp, nên chạy được là tốt rồi chứ chả còn thời gian mà nghĩ đến exception tốt hay chưa.\n\nTrong trường hợp bạn...rảnh hoặc dự án yêu cầu, hoặc leader khó tính, chúng ta nên bắt các exception chi tiết hơn và chỉ nên cover Standard sau cùng.\n\n\n```ruby\n# controllers/concerns/handle_exception.rb\nmodule HandleException\n  included do\n    # Exception 1\n    rescue_from StandardError do |e|\n      # Do something good\n    end\n\n    # Exception 2\n    rescue_from ActiveRecord::RecordNotFound do |e|\n      # Do something good\n    end\n\n    # ... N exception nữa, tuỳ nhu cầu của bạn.\n end\nend\n\nclass ApplicationControler < ActionController::Base\n  include HandleException\nend\n\n```\n\n> Theo thứ tự included, exception khai báo sau sẽ được gọi trước, vậy exception 2 sẽ được gọi trước exception 1. Do đó nên khai báo cho Standard exception làm exception đầu tiên.\n\n## 6. Tạo thêm các lớp exception\n\nGiả sử với lượng exception mặc định trong rails không đủ cho project tầm cỡ 4.0 của bạn? bạn muốn catch những exception đặc biệt mà bạn chỉ bạn nghĩ ra?\n\nChúng ta có thể tạo thêm các class exception để đáp ứng nhu cầu trên:\n\n```ruby\n# controllers/concerns/handle_exception.rb\nmodule HandleException\n  # Khái báo class exception bạn tạo,\n  # chúng đều kế thừa từ class StandardError\n  class WeakPassword < StandardError; end\n\n  included do\n    # Exception 1\n    rescue_from StandardError do |e|\n      # Do something good\n    end\n\n    # Exception 2\n    rescue_from ActiveRecord::RecordNotFound do |e|\n      # Do something good\n    end\n\n\n    # Exception 3\n    rescue_from HandleException::WeakPassword do |e|\n      # TODO: notification password too weak\n      # TODO: init recommmend password\n      # TODO: display recommend password for UI\n    end\n\n    # ... N exception nữa, tuỳ nhu cầu của bạn.\n end\nend\n\nclass ApplicationControler < ActionController::Base\n  include HandleException\nend\n\n```\n\nNhư vậy, khi bạn validate mật khẩu của user submit lên, nếu không thoả mãn điều kiện là một mật khẩu đủ mạnh, **raise** exception đã khai báo.\n\n## 7. Xử lý exception trong method\n\nLại quay lại bước 1, nhưng không phải chúng ta xử lý mọi exception trong từng method. Mà khi chúng ta có 1 đoạn logic đặc biệt, không lặp lại, và có tính quan trọng thì chúng ta nên catch exception ngay tại chỗ đoạn logic đó diễn ra:\n\n1. dễ đọc code\n2. vì là 1 trường hợp logic quan trọng nên cũng cần những xử lý exception có thể quan trọng theo, chứ không chỉ là bắn bug ra terminal hay ghi log.\n\n```ruby\nclass ChargesController < ApplicationController\n  def important_method\n    begin\n      payment_intent = Stripe::PaymentIntent.create(\n        :amount => source.amount,\n        :currency => source.currency,\n        :source => source.id,\n        :payment_method_types => [source.type],\n        :description => \"PaymentIntent for Source webhook\",\n        :confirm => true,\n        :capture_method => ENV['CAPTURE_METHOD'] == \"manual\" ? \"manual\" : \"automatic\",\n      )\n    rescue Stripe::StripeError => e\n      status 400\n      return log_info(\"Webhook: Error creating PaymentIntent: #{e.message}\")\n    end\n  end\nend\n```\n\n> Đoạn code trên được copy từ [stripe sample code](https://github.com/stripe/example-mobile-backend/blob/master/web.rb)\n\nNhư ví dụ trên, khi bạn xử dụng thư viện, hoặc api của bên thứ 3, có những exception đặc trưng cho từng loại thư viện, làm theo docs của thư viện đó thôi, nên bắt các exception ngay tại nơi logic đang diễn ra. Sau có dục thư viện đó đi hay update thì cũng dễ xử lý hơn.\n\n## 8. Ghi log\n\nCuối cùng, khi sản phẩm của bạn lên production, bạn cần ghi log, để đọc, truy vết điều tra lỗi khi cần.\n\nTôi hiện viết log theo cách sau:\n\n```ruby\n# controllers/concerns/handle_log.rb\nmodule HandleLog\n  def write_log(e)\n    issue = \"START: ---------------------------\\n\"\n    issue << \"TIME: #{Time.now.utc} \\n\"\n    issue << \"PARAMS: #{params.to_json} \\n\"\n    issue << \"MESSAGE: #{e.message}\\n\"\n    issue << \"----------------------------- :END\\n\"\n\n    Rails.logger.info issue\n  end\nend\n\n# controllers/concerns/handle_exception.rb\nmodule HandleException\n  # Khái báo class exception bạn tạo,\n  # chúng đều kế thừa từ class StandardError\n  class WeakPassword < StandardError; end\n\n  included do\n    # Exception 1\n    rescue_from StandardError do |e|\n      # Do something good\n      write_log(e)\n    end\n\n    # Exception 2\n    rescue_from ActiveRecord::RecordNotFound do |e|\n      # Do something good\n      write_log(e)\n    end\n\n\n    # Exception 3\n    rescue_from HandleException::WeakPassword do |e|\n      # TODO: notification password too weak\n      # TODO: init recommmend password\n      # TODO: display recommend password for UI\n    end\n\n    # ... N exception nữa, tuỳ nhu cầu của bạn.\n end\nend\n\nclass ApplicationControler < ActionController::Base\n  include HandleLog\n  include HandleException\nend\n```\n\n## 9. Tham khảo\n\n[1] [http://rubylearning.com/satishtalim/ruby_exceptions.html](http://rubylearning.com/satishtalim/ruby_exceptions.html)\n","source":"_posts/2020-04-23-handle-exception-in-rails.md","raw":"---\ntitle: \"Exception Trong Rails [Part 2]\"\ndate: 2020-04-23\ntags: [\"RUBY\"]\n---\n\n## 1. Xử lý exception trong method\n\nE.g. Trong products_controller.rb ta có method sau:\n\n```ruby\n  def show\n    product = Product.find(12)\n\n    render layout_for_product_detail\n  end\n```\n\nNếu không có product nào có id = 12, đoạn code trên sẽ gặp lỗi, và người dùng sẽ nhận được 1 màn hình error server.\n\nKhông muốn điều này xảy ra, ta update lại đoạn code như sau:\n\n```ruby\ndef show\n  begin\n    product = Product.find(12)\n\n    render layout_for_product_detail\n  rescue StandardError => e\n    # Do something good for user\n  end\nend\n```\n\nVậy là ổn, như trong bài phần 1, catch exception với StandardError là đủ tốt để áp dụng và có lẽ đủ tốt để pass review code.\n\n## 2. Xử lý exception với controller\n\nPhần 1 đã ổn, nhưng không được tốt, lý do là vì nếu chúng ta có 100 methods, vậy chúng ta sẽ lắp lại đoạn catch exception kia 100 lần. Không DRY chút nào, viết 1 chục method lặp lại cùng 1 exception thì có lẽ không pass được review code =))\n\nUpdate: products_controller.rb\n\n```ruby\nclass ProductsController < ApplicationController\n  rescue_from StandardError, with: :private_method_you_use_to_handle_exception\n\n  def show\n    product = Product.find(12)\n\n    render layout_for_product_detail\n  end\n\n  # 100 methods nữa ở đây...\n\n  private\n\n  def private_method_you_use_to_handle_exception\n    # Do something good\n  end\nend\n```\n\nNhư vậy đỡ phải viết lặp đi lặp lại 100 lần. Có vẻ tốt hơn rồi, tuy nhiên đã đủ tốt?\n\n## 3. Xử lý exception với controller cha\n\nVậy nếu ta có 100 controller, và chỉ để bắt StandardError mà chúng ta phải viết rescue_from cho cả 100 controller đó?\n\nTa có thể xử lý trường hơp trên bằng cách dùng rescue_from trong controller cha, ở đây thì cha của products controller là application controller.\n\n```ruby\nclass ApplicationControler < ActionController::Base\n  rescue_from StandardError, with: :private_method_you_use_to_handle_exception\n\n  private\n\n  def private_method_you_use_to_handle_exception\n    # Do something good\n  end\nend\n\nclass ProductsController < ApplicationController\n  def show\n    product = Product.find(12)\n\n    render layout_for_product_detail\n  end\nend\n```\n\n## 4. Tách exception ra module riêng\n\nGiờ chúng ta chỉ có 1 exception cơ bản, nhưng không gì đảm bảo được rằng thế giới quan ngoài kia có thể kìm hãm nổi tài năng của bạn, rất có thể vài năm sau project làm chơi ngày nào của bạn thành startup triệu đô? =)) logic và bussiness lúc đó phức tạp thêm chục/trăm/ngàn lần.\n\nNên tách exception handle sang 1 module riêng là lựa chọn không tồi cho hiện tại và là lựa chọn không thể tránh khỏi trong tương lai (project của bạn mập lên).\n\nBạn muốn tách moudle này vào đâu? tôi không biết, tôi thì bỏ vào concerns folder của folder controller cho nhanh.\n\n```ruby\n# controllers/concerns/handle_exception.rb\nmodule HandleException\n  included do\n    rescue_from StandardError do |e|\n      # Do something good\n    end\n end\nend\n\nclass ApplicationControler < ActionController::Base\n  include HandleException\nend\n\n```\n\nVậy là chúng ta đã tách đoạn logic xử lý exception ra khỏi controller.\n\n## 5. Bắt exception chi tiết hơn\n\nĐến mục số 4, mọi thứ đã khá tốt, tuy vậy, có nhiều exception trong rails (và framework nào cũng vậy). Standard là 1 exception rất chung chung, vì vậy chỉ bắt Standard exception có lẽ giành cho trường hợp chúng ta... lười, hoặc dự án không nhiều logic, hoặc không đủ thời gian để implement, deadline dí quá chạy không kịp, nên chạy được là tốt rồi chứ chả còn thời gian mà nghĩ đến exception tốt hay chưa.\n\nTrong trường hợp bạn...rảnh hoặc dự án yêu cầu, hoặc leader khó tính, chúng ta nên bắt các exception chi tiết hơn và chỉ nên cover Standard sau cùng.\n\n\n```ruby\n# controllers/concerns/handle_exception.rb\nmodule HandleException\n  included do\n    # Exception 1\n    rescue_from StandardError do |e|\n      # Do something good\n    end\n\n    # Exception 2\n    rescue_from ActiveRecord::RecordNotFound do |e|\n      # Do something good\n    end\n\n    # ... N exception nữa, tuỳ nhu cầu của bạn.\n end\nend\n\nclass ApplicationControler < ActionController::Base\n  include HandleException\nend\n\n```\n\n> Theo thứ tự included, exception khai báo sau sẽ được gọi trước, vậy exception 2 sẽ được gọi trước exception 1. Do đó nên khai báo cho Standard exception làm exception đầu tiên.\n\n## 6. Tạo thêm các lớp exception\n\nGiả sử với lượng exception mặc định trong rails không đủ cho project tầm cỡ 4.0 của bạn? bạn muốn catch những exception đặc biệt mà bạn chỉ bạn nghĩ ra?\n\nChúng ta có thể tạo thêm các class exception để đáp ứng nhu cầu trên:\n\n```ruby\n# controllers/concerns/handle_exception.rb\nmodule HandleException\n  # Khái báo class exception bạn tạo,\n  # chúng đều kế thừa từ class StandardError\n  class WeakPassword < StandardError; end\n\n  included do\n    # Exception 1\n    rescue_from StandardError do |e|\n      # Do something good\n    end\n\n    # Exception 2\n    rescue_from ActiveRecord::RecordNotFound do |e|\n      # Do something good\n    end\n\n\n    # Exception 3\n    rescue_from HandleException::WeakPassword do |e|\n      # TODO: notification password too weak\n      # TODO: init recommmend password\n      # TODO: display recommend password for UI\n    end\n\n    # ... N exception nữa, tuỳ nhu cầu của bạn.\n end\nend\n\nclass ApplicationControler < ActionController::Base\n  include HandleException\nend\n\n```\n\nNhư vậy, khi bạn validate mật khẩu của user submit lên, nếu không thoả mãn điều kiện là một mật khẩu đủ mạnh, **raise** exception đã khai báo.\n\n## 7. Xử lý exception trong method\n\nLại quay lại bước 1, nhưng không phải chúng ta xử lý mọi exception trong từng method. Mà khi chúng ta có 1 đoạn logic đặc biệt, không lặp lại, và có tính quan trọng thì chúng ta nên catch exception ngay tại chỗ đoạn logic đó diễn ra:\n\n1. dễ đọc code\n2. vì là 1 trường hợp logic quan trọng nên cũng cần những xử lý exception có thể quan trọng theo, chứ không chỉ là bắn bug ra terminal hay ghi log.\n\n```ruby\nclass ChargesController < ApplicationController\n  def important_method\n    begin\n      payment_intent = Stripe::PaymentIntent.create(\n        :amount => source.amount,\n        :currency => source.currency,\n        :source => source.id,\n        :payment_method_types => [source.type],\n        :description => \"PaymentIntent for Source webhook\",\n        :confirm => true,\n        :capture_method => ENV['CAPTURE_METHOD'] == \"manual\" ? \"manual\" : \"automatic\",\n      )\n    rescue Stripe::StripeError => e\n      status 400\n      return log_info(\"Webhook: Error creating PaymentIntent: #{e.message}\")\n    end\n  end\nend\n```\n\n> Đoạn code trên được copy từ [stripe sample code](https://github.com/stripe/example-mobile-backend/blob/master/web.rb)\n\nNhư ví dụ trên, khi bạn xử dụng thư viện, hoặc api của bên thứ 3, có những exception đặc trưng cho từng loại thư viện, làm theo docs của thư viện đó thôi, nên bắt các exception ngay tại nơi logic đang diễn ra. Sau có dục thư viện đó đi hay update thì cũng dễ xử lý hơn.\n\n## 8. Ghi log\n\nCuối cùng, khi sản phẩm của bạn lên production, bạn cần ghi log, để đọc, truy vết điều tra lỗi khi cần.\n\nTôi hiện viết log theo cách sau:\n\n```ruby\n# controllers/concerns/handle_log.rb\nmodule HandleLog\n  def write_log(e)\n    issue = \"START: ---------------------------\\n\"\n    issue << \"TIME: #{Time.now.utc} \\n\"\n    issue << \"PARAMS: #{params.to_json} \\n\"\n    issue << \"MESSAGE: #{e.message}\\n\"\n    issue << \"----------------------------- :END\\n\"\n\n    Rails.logger.info issue\n  end\nend\n\n# controllers/concerns/handle_exception.rb\nmodule HandleException\n  # Khái báo class exception bạn tạo,\n  # chúng đều kế thừa từ class StandardError\n  class WeakPassword < StandardError; end\n\n  included do\n    # Exception 1\n    rescue_from StandardError do |e|\n      # Do something good\n      write_log(e)\n    end\n\n    # Exception 2\n    rescue_from ActiveRecord::RecordNotFound do |e|\n      # Do something good\n      write_log(e)\n    end\n\n\n    # Exception 3\n    rescue_from HandleException::WeakPassword do |e|\n      # TODO: notification password too weak\n      # TODO: init recommmend password\n      # TODO: display recommend password for UI\n    end\n\n    # ... N exception nữa, tuỳ nhu cầu của bạn.\n end\nend\n\nclass ApplicationControler < ActionController::Base\n  include HandleLog\n  include HandleException\nend\n```\n\n## 9. Tham khảo\n\n[1] [http://rubylearning.com/satishtalim/ruby_exceptions.html](http://rubylearning.com/satishtalim/ruby_exceptions.html)\n","slug":"2020-04-23-handle-exception-in-rails","published":1,"updated":"2022-01-29T09:29:59.930Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbp0042p3m25b2n4old","content":"<h2 id=\"1-Xu-ly-exception-trong-method\"><a href=\"#1-Xu-ly-exception-trong-method\" class=\"headerlink\" title=\"1. Xử lý exception trong method\"></a>1. Xử lý exception trong method</h2><p>E.g. Trong products_controller.rb ta có method sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show</span></span></span><br><span class=\"line\">  product = Product.find(<span class=\"number\">12</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  render layout_for_product_detail</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Nếu không có product nào có id = 12, đoạn code trên sẽ gặp lỗi, và người dùng sẽ nhận được 1 màn hình error server.</p>\n<p>Không muốn điều này xảy ra, ta update lại đoạn code như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show</span></span></span><br><span class=\"line\">  <span class=\"keyword\">begin</span></span><br><span class=\"line\">    product = Product.find(<span class=\"number\">12</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    render layout_for_product_detail</span><br><span class=\"line\">  <span class=\"keyword\">rescue</span> StandardError =&gt; e</span><br><span class=\"line\">    <span class=\"comment\"># Do something good for user</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Vậy là ổn, như trong bài phần 1, catch exception với StandardError là đủ tốt để áp dụng và có lẽ đủ tốt để pass review code.</p>\n<h2 id=\"2-Xu-ly-exception-voi-controller\"><a href=\"#2-Xu-ly-exception-voi-controller\" class=\"headerlink\" title=\"2. Xử lý exception với controller\"></a>2. Xử lý exception với controller</h2><p>Phần 1 đã ổn, nhưng không được tốt, lý do là vì nếu chúng ta có 100 methods, vậy chúng ta sẽ lắp lại đoạn catch exception kia 100 lần. Không DRY chút nào, viết 1 chục method lặp lại cùng 1 exception thì có lẽ không pass được review code =))</p>\n<p>Update: products_controller.rb</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProductsController</span> &lt; ApplicationController</span></span><br><span class=\"line\">  rescue_from StandardError, <span class=\"symbol\">with:</span> <span class=\"symbol\">:private_method_you_use_to_handle_exception</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show</span></span></span><br><span class=\"line\">    product = Product.find(<span class=\"number\">12</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    render layout_for_product_detail</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 100 methods nữa ở đây...</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">private_method_you_use_to_handle_exception</span></span></span><br><span class=\"line\">    <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Như vậy đỡ phải viết lặp đi lặp lại 100 lần. Có vẻ tốt hơn rồi, tuy nhiên đã đủ tốt?</p>\n<h2 id=\"3-Xu-ly-exception-voi-controller-cha\"><a href=\"#3-Xu-ly-exception-voi-controller-cha\" class=\"headerlink\" title=\"3. Xử lý exception với controller cha\"></a>3. Xử lý exception với controller cha</h2><p>Vậy nếu ta có 100 controller, và chỉ để bắt StandardError mà chúng ta phải viết rescue_from cho cả 100 controller đó?</p>\n<p>Ta có thể xử lý trường hơp trên bằng cách dùng rescue_from trong controller cha, ở đây thì cha của products controller là application controller.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationControler</span> &lt; ActionController::Base</span></span><br><span class=\"line\">  rescue_from StandardError, <span class=\"symbol\">with:</span> <span class=\"symbol\">:private_method_you_use_to_handle_exception</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">private_method_you_use_to_handle_exception</span></span></span><br><span class=\"line\">    <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProductsController</span> &lt; ApplicationController</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show</span></span></span><br><span class=\"line\">    product = Product.find(<span class=\"number\">12</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    render layout_for_product_detail</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Tach-exception-ra-module-rieng\"><a href=\"#4-Tach-exception-ra-module-rieng\" class=\"headerlink\" title=\"4. Tách exception ra module riêng\"></a>4. Tách exception ra module riêng</h2><p>Giờ chúng ta chỉ có 1 exception cơ bản, nhưng không gì đảm bảo được rằng thế giới quan ngoài kia có thể kìm hãm nổi tài năng của bạn, rất có thể vài năm sau project làm chơi ngày nào của bạn thành startup triệu đô? =)) logic và bussiness lúc đó phức tạp thêm chục/trăm/ngàn lần.</p>\n<p>Nên tách exception handle sang 1 module riêng là lựa chọn không tồi cho hiện tại và là lựa chọn không thể tránh khỏi trong tương lai (project của bạn mập lên).</p>\n<p>Bạn muốn tách moudle này vào đâu? tôi không biết, tôi thì bỏ vào concerns folder của folder controller cho nhanh.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># controllers/concerns/handle_exception.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">HandleException</span></span></span><br><span class=\"line\">  included <span class=\"keyword\">do</span></span><br><span class=\"line\">    rescue_from StandardError <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"> <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationControler</span> &lt; ActionController::Base</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> HandleException</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Vậy là chúng ta đã tách đoạn logic xử lý exception ra khỏi controller.</p>\n<h2 id=\"5-Bat-exception-chi-tiet-hon\"><a href=\"#5-Bat-exception-chi-tiet-hon\" class=\"headerlink\" title=\"5. Bắt exception chi tiết hơn\"></a>5. Bắt exception chi tiết hơn</h2><p>Đến mục số 4, mọi thứ đã khá tốt, tuy vậy, có nhiều exception trong rails (và framework nào cũng vậy). Standard là 1 exception rất chung chung, vì vậy chỉ bắt Standard exception có lẽ giành cho trường hợp chúng ta… lười, hoặc dự án không nhiều logic, hoặc không đủ thời gian để implement, deadline dí quá chạy không kịp, nên chạy được là tốt rồi chứ chả còn thời gian mà nghĩ đến exception tốt hay chưa.</p>\n<p>Trong trường hợp bạn…rảnh hoặc dự án yêu cầu, hoặc leader khó tính, chúng ta nên bắt các exception chi tiết hơn và chỉ nên cover Standard sau cùng.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># controllers/concerns/handle_exception.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">HandleException</span></span></span><br><span class=\"line\">  included <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"comment\"># Exception 1</span></span><br><span class=\"line\">    rescue_from StandardError <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Exception 2</span></span><br><span class=\"line\">    rescue_from ActiveRecord::RecordNotFound <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># ... N exception nữa, tuỳ nhu cầu của bạn.</span></span><br><span class=\"line\"> <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationControler</span> &lt; ActionController::Base</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> HandleException</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Theo thứ tự included, exception khai báo sau sẽ được gọi trước, vậy exception 2 sẽ được gọi trước exception 1. Do đó nên khai báo cho Standard exception làm exception đầu tiên.</p>\n</blockquote>\n<h2 id=\"6-Tao-them-cac-lop-exception\"><a href=\"#6-Tao-them-cac-lop-exception\" class=\"headerlink\" title=\"6. Tạo thêm các lớp exception\"></a>6. Tạo thêm các lớp exception</h2><p>Giả sử với lượng exception mặc định trong rails không đủ cho project tầm cỡ 4.0 của bạn? bạn muốn catch những exception đặc biệt mà bạn chỉ bạn nghĩ ra?</p>\n<p>Chúng ta có thể tạo thêm các class exception để đáp ứng nhu cầu trên:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># controllers/concerns/handle_exception.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">HandleException</span></span></span><br><span class=\"line\">  <span class=\"comment\"># Khái báo class exception bạn tạo,</span></span><br><span class=\"line\">  <span class=\"comment\"># chúng đều kế thừa từ class StandardError</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WeakPassword</span> &lt; StandardError;</span> <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  included <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"comment\"># Exception 1</span></span><br><span class=\"line\">    rescue_from StandardError <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Exception 2</span></span><br><span class=\"line\">    rescue_from ActiveRecord::RecordNotFound <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Exception 3</span></span><br><span class=\"line\">    rescue_from HandleException::WeakPassword <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> notification password too weak</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> init recommmend password</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> display recommend password for UI</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># ... N exception nữa, tuỳ nhu cầu của bạn.</span></span><br><span class=\"line\"> <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationControler</span> &lt; ActionController::Base</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> HandleException</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Như vậy, khi bạn validate mật khẩu của user submit lên, nếu không thoả mãn điều kiện là một mật khẩu đủ mạnh, <strong>raise</strong> exception đã khai báo.</p>\n<h2 id=\"7-Xu-ly-exception-trong-method\"><a href=\"#7-Xu-ly-exception-trong-method\" class=\"headerlink\" title=\"7. Xử lý exception trong method\"></a>7. Xử lý exception trong method</h2><p>Lại quay lại bước 1, nhưng không phải chúng ta xử lý mọi exception trong từng method. Mà khi chúng ta có 1 đoạn logic đặc biệt, không lặp lại, và có tính quan trọng thì chúng ta nên catch exception ngay tại chỗ đoạn logic đó diễn ra:</p>\n<ol>\n<li>dễ đọc code</li>\n<li>vì là 1 trường hợp logic quan trọng nên cũng cần những xử lý exception có thể quan trọng theo, chứ không chỉ là bắn bug ra terminal hay ghi log.</li>\n</ol>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ChargesController</span> &lt; ApplicationController</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">important_method</span></span></span><br><span class=\"line\">    <span class=\"keyword\">begin</span></span><br><span class=\"line\">      payment_intent = Stripe::PaymentIntent.create(</span><br><span class=\"line\">        <span class=\"symbol\">:amount</span> =&gt; source.amount,</span><br><span class=\"line\">        <span class=\"symbol\">:currency</span> =&gt; source.currency,</span><br><span class=\"line\">        <span class=\"symbol\">:source</span> =&gt; source.id,</span><br><span class=\"line\">        <span class=\"symbol\">:payment_method_types</span> =&gt; [source.type],</span><br><span class=\"line\">        <span class=\"symbol\">:description</span> =&gt; <span class=\"string\">\"PaymentIntent for Source webhook\"</span>,</span><br><span class=\"line\">        <span class=\"symbol\">:confirm</span> =&gt; <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"symbol\">:capture_method</span> =&gt; ENV[<span class=\"string\">'CAPTURE_METHOD'</span>] == <span class=\"string\">\"manual\"</span> ? <span class=\"string\">\"manual\"</span> : <span class=\"string\">\"automatic\"</span>,</span><br><span class=\"line\">      )</span><br><span class=\"line\">    <span class=\"keyword\">rescue</span> Stripe::StripeError =&gt; e</span><br><span class=\"line\">      status <span class=\"number\">400</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> log_info(<span class=\"string\">\"Webhook: Error creating PaymentIntent: <span class=\"subst\">#&#123;e.message&#125;</span>\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Đoạn code trên được copy từ <a href=\"https://github.com/stripe/example-mobile-backend/blob/master/web.rb\" target=\"_blank\" rel=\"noopener\">stripe sample code</a></p>\n</blockquote>\n<p>Như ví dụ trên, khi bạn xử dụng thư viện, hoặc api của bên thứ 3, có những exception đặc trưng cho từng loại thư viện, làm theo docs của thư viện đó thôi, nên bắt các exception ngay tại nơi logic đang diễn ra. Sau có dục thư viện đó đi hay update thì cũng dễ xử lý hơn.</p>\n<h2 id=\"8-Ghi-log\"><a href=\"#8-Ghi-log\" class=\"headerlink\" title=\"8. Ghi log\"></a>8. Ghi log</h2><p>Cuối cùng, khi sản phẩm của bạn lên production, bạn cần ghi log, để đọc, truy vết điều tra lỗi khi cần.</p>\n<p>Tôi hiện viết log theo cách sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># controllers/concerns/handle_log.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">HandleLog</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">write_log</span><span class=\"params\">(e)</span></span></span><br><span class=\"line\">    issue = <span class=\"string\">\"START: ---------------------------\\n\"</span></span><br><span class=\"line\">    issue &lt;&lt; <span class=\"string\">\"TIME: <span class=\"subst\">#&#123;Time.now.utc&#125;</span> \\n\"</span></span><br><span class=\"line\">    issue &lt;&lt; <span class=\"string\">\"PARAMS: <span class=\"subst\">#&#123;params.to_json&#125;</span> \\n\"</span></span><br><span class=\"line\">    issue &lt;&lt; <span class=\"string\">\"MESSAGE: <span class=\"subst\">#&#123;e.message&#125;</span>\\n\"</span></span><br><span class=\"line\">    issue &lt;&lt; <span class=\"string\">\"----------------------------- :END\\n\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Rails.logger.info issue</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># controllers/concerns/handle_exception.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">HandleException</span></span></span><br><span class=\"line\">  <span class=\"comment\"># Khái báo class exception bạn tạo,</span></span><br><span class=\"line\">  <span class=\"comment\"># chúng đều kế thừa từ class StandardError</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WeakPassword</span> &lt; StandardError;</span> <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  included <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"comment\"># Exception 1</span></span><br><span class=\"line\">    rescue_from StandardError <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">      write_log(e)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Exception 2</span></span><br><span class=\"line\">    rescue_from ActiveRecord::RecordNotFound <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">      write_log(e)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Exception 3</span></span><br><span class=\"line\">    rescue_from HandleException::WeakPassword <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> notification password too weak</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> init recommmend password</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> display recommend password for UI</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># ... N exception nữa, tuỳ nhu cầu của bạn.</span></span><br><span class=\"line\"> <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationControler</span> &lt; ActionController::Base</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> HandleLog</span><br><span class=\"line\">  <span class=\"keyword\">include</span> HandleException</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"9-Tham-khao\"><a href=\"#9-Tham-khao\" class=\"headerlink\" title=\"9. Tham khảo\"></a>9. Tham khảo</h2><p>[1] <a href=\"http://rubylearning.com/satishtalim/ruby_exceptions.html\" target=\"_blank\" rel=\"noopener\">http://rubylearning.com/satishtalim/ruby_exceptions.html</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Xu-ly-exception-trong-method\"><a href=\"#1-Xu-ly-exception-trong-method\" class=\"headerlink\" title=\"1. Xử lý exception trong method\"></a>1. Xử lý exception trong method</h2><p>E.g. Trong products_controller.rb ta có method sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show</span></span></span><br><span class=\"line\">  product = Product.find(<span class=\"number\">12</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">  render layout_for_product_detail</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Nếu không có product nào có id = 12, đoạn code trên sẽ gặp lỗi, và người dùng sẽ nhận được 1 màn hình error server.</p>\n<p>Không muốn điều này xảy ra, ta update lại đoạn code như sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show</span></span></span><br><span class=\"line\">  <span class=\"keyword\">begin</span></span><br><span class=\"line\">    product = Product.find(<span class=\"number\">12</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    render layout_for_product_detail</span><br><span class=\"line\">  <span class=\"keyword\">rescue</span> StandardError =&gt; e</span><br><span class=\"line\">    <span class=\"comment\"># Do something good for user</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Vậy là ổn, như trong bài phần 1, catch exception với StandardError là đủ tốt để áp dụng và có lẽ đủ tốt để pass review code.</p>\n<h2 id=\"2-Xu-ly-exception-voi-controller\"><a href=\"#2-Xu-ly-exception-voi-controller\" class=\"headerlink\" title=\"2. Xử lý exception với controller\"></a>2. Xử lý exception với controller</h2><p>Phần 1 đã ổn, nhưng không được tốt, lý do là vì nếu chúng ta có 100 methods, vậy chúng ta sẽ lắp lại đoạn catch exception kia 100 lần. Không DRY chút nào, viết 1 chục method lặp lại cùng 1 exception thì có lẽ không pass được review code =))</p>\n<p>Update: products_controller.rb</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProductsController</span> &lt; ApplicationController</span></span><br><span class=\"line\">  rescue_from StandardError, <span class=\"symbol\">with:</span> <span class=\"symbol\">:private_method_you_use_to_handle_exception</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show</span></span></span><br><span class=\"line\">    product = Product.find(<span class=\"number\">12</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    render layout_for_product_detail</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"># 100 methods nữa ở đây...</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">private_method_you_use_to_handle_exception</span></span></span><br><span class=\"line\">    <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Như vậy đỡ phải viết lặp đi lặp lại 100 lần. Có vẻ tốt hơn rồi, tuy nhiên đã đủ tốt?</p>\n<h2 id=\"3-Xu-ly-exception-voi-controller-cha\"><a href=\"#3-Xu-ly-exception-voi-controller-cha\" class=\"headerlink\" title=\"3. Xử lý exception với controller cha\"></a>3. Xử lý exception với controller cha</h2><p>Vậy nếu ta có 100 controller, và chỉ để bắt StandardError mà chúng ta phải viết rescue_from cho cả 100 controller đó?</p>\n<p>Ta có thể xử lý trường hơp trên bằng cách dùng rescue_from trong controller cha, ở đây thì cha của products controller là application controller.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationControler</span> &lt; ActionController::Base</span></span><br><span class=\"line\">  rescue_from StandardError, <span class=\"symbol\">with:</span> <span class=\"symbol\">:private_method_you_use_to_handle_exception</span></span><br><span class=\"line\"></span><br><span class=\"line\">  private</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">private_method_you_use_to_handle_exception</span></span></span><br><span class=\"line\">    <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProductsController</span> &lt; ApplicationController</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">show</span></span></span><br><span class=\"line\">    product = Product.find(<span class=\"number\">12</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    render layout_for_product_detail</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"4-Tach-exception-ra-module-rieng\"><a href=\"#4-Tach-exception-ra-module-rieng\" class=\"headerlink\" title=\"4. Tách exception ra module riêng\"></a>4. Tách exception ra module riêng</h2><p>Giờ chúng ta chỉ có 1 exception cơ bản, nhưng không gì đảm bảo được rằng thế giới quan ngoài kia có thể kìm hãm nổi tài năng của bạn, rất có thể vài năm sau project làm chơi ngày nào của bạn thành startup triệu đô? =)) logic và bussiness lúc đó phức tạp thêm chục/trăm/ngàn lần.</p>\n<p>Nên tách exception handle sang 1 module riêng là lựa chọn không tồi cho hiện tại và là lựa chọn không thể tránh khỏi trong tương lai (project của bạn mập lên).</p>\n<p>Bạn muốn tách moudle này vào đâu? tôi không biết, tôi thì bỏ vào concerns folder của folder controller cho nhanh.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># controllers/concerns/handle_exception.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">HandleException</span></span></span><br><span class=\"line\">  included <span class=\"keyword\">do</span></span><br><span class=\"line\">    rescue_from StandardError <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"> <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationControler</span> &lt; ActionController::Base</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> HandleException</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Vậy là chúng ta đã tách đoạn logic xử lý exception ra khỏi controller.</p>\n<h2 id=\"5-Bat-exception-chi-tiet-hon\"><a href=\"#5-Bat-exception-chi-tiet-hon\" class=\"headerlink\" title=\"5. Bắt exception chi tiết hơn\"></a>5. Bắt exception chi tiết hơn</h2><p>Đến mục số 4, mọi thứ đã khá tốt, tuy vậy, có nhiều exception trong rails (và framework nào cũng vậy). Standard là 1 exception rất chung chung, vì vậy chỉ bắt Standard exception có lẽ giành cho trường hợp chúng ta… lười, hoặc dự án không nhiều logic, hoặc không đủ thời gian để implement, deadline dí quá chạy không kịp, nên chạy được là tốt rồi chứ chả còn thời gian mà nghĩ đến exception tốt hay chưa.</p>\n<p>Trong trường hợp bạn…rảnh hoặc dự án yêu cầu, hoặc leader khó tính, chúng ta nên bắt các exception chi tiết hơn và chỉ nên cover Standard sau cùng.</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># controllers/concerns/handle_exception.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">HandleException</span></span></span><br><span class=\"line\">  included <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"comment\"># Exception 1</span></span><br><span class=\"line\">    rescue_from StandardError <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Exception 2</span></span><br><span class=\"line\">    rescue_from ActiveRecord::RecordNotFound <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># ... N exception nữa, tuỳ nhu cầu của bạn.</span></span><br><span class=\"line\"> <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationControler</span> &lt; ActionController::Base</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> HandleException</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Theo thứ tự included, exception khai báo sau sẽ được gọi trước, vậy exception 2 sẽ được gọi trước exception 1. Do đó nên khai báo cho Standard exception làm exception đầu tiên.</p>\n</blockquote>\n<h2 id=\"6-Tao-them-cac-lop-exception\"><a href=\"#6-Tao-them-cac-lop-exception\" class=\"headerlink\" title=\"6. Tạo thêm các lớp exception\"></a>6. Tạo thêm các lớp exception</h2><p>Giả sử với lượng exception mặc định trong rails không đủ cho project tầm cỡ 4.0 của bạn? bạn muốn catch những exception đặc biệt mà bạn chỉ bạn nghĩ ra?</p>\n<p>Chúng ta có thể tạo thêm các class exception để đáp ứng nhu cầu trên:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># controllers/concerns/handle_exception.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">HandleException</span></span></span><br><span class=\"line\">  <span class=\"comment\"># Khái báo class exception bạn tạo,</span></span><br><span class=\"line\">  <span class=\"comment\"># chúng đều kế thừa từ class StandardError</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WeakPassword</span> &lt; StandardError;</span> <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  included <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"comment\"># Exception 1</span></span><br><span class=\"line\">    rescue_from StandardError <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Exception 2</span></span><br><span class=\"line\">    rescue_from ActiveRecord::RecordNotFound <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Exception 3</span></span><br><span class=\"line\">    rescue_from HandleException::WeakPassword <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> notification password too weak</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> init recommmend password</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> display recommend password for UI</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># ... N exception nữa, tuỳ nhu cầu của bạn.</span></span><br><span class=\"line\"> <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationControler</span> &lt; ActionController::Base</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> HandleException</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<p>Như vậy, khi bạn validate mật khẩu của user submit lên, nếu không thoả mãn điều kiện là một mật khẩu đủ mạnh, <strong>raise</strong> exception đã khai báo.</p>\n<h2 id=\"7-Xu-ly-exception-trong-method\"><a href=\"#7-Xu-ly-exception-trong-method\" class=\"headerlink\" title=\"7. Xử lý exception trong method\"></a>7. Xử lý exception trong method</h2><p>Lại quay lại bước 1, nhưng không phải chúng ta xử lý mọi exception trong từng method. Mà khi chúng ta có 1 đoạn logic đặc biệt, không lặp lại, và có tính quan trọng thì chúng ta nên catch exception ngay tại chỗ đoạn logic đó diễn ra:</p>\n<ol>\n<li>dễ đọc code</li>\n<li>vì là 1 trường hợp logic quan trọng nên cũng cần những xử lý exception có thể quan trọng theo, chứ không chỉ là bắn bug ra terminal hay ghi log.</li>\n</ol>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ChargesController</span> &lt; ApplicationController</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">important_method</span></span></span><br><span class=\"line\">    <span class=\"keyword\">begin</span></span><br><span class=\"line\">      payment_intent = Stripe::PaymentIntent.create(</span><br><span class=\"line\">        <span class=\"symbol\">:amount</span> =&gt; source.amount,</span><br><span class=\"line\">        <span class=\"symbol\">:currency</span> =&gt; source.currency,</span><br><span class=\"line\">        <span class=\"symbol\">:source</span> =&gt; source.id,</span><br><span class=\"line\">        <span class=\"symbol\">:payment_method_types</span> =&gt; [source.type],</span><br><span class=\"line\">        <span class=\"symbol\">:description</span> =&gt; <span class=\"string\">\"PaymentIntent for Source webhook\"</span>,</span><br><span class=\"line\">        <span class=\"symbol\">:confirm</span> =&gt; <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"symbol\">:capture_method</span> =&gt; ENV[<span class=\"string\">'CAPTURE_METHOD'</span>] == <span class=\"string\">\"manual\"</span> ? <span class=\"string\">\"manual\"</span> : <span class=\"string\">\"automatic\"</span>,</span><br><span class=\"line\">      )</span><br><span class=\"line\">    <span class=\"keyword\">rescue</span> Stripe::StripeError =&gt; e</span><br><span class=\"line\">      status <span class=\"number\">400</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> log_info(<span class=\"string\">\"Webhook: Error creating PaymentIntent: <span class=\"subst\">#&#123;e.message&#125;</span>\"</span>)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Đoạn code trên được copy từ <a href=\"https://github.com/stripe/example-mobile-backend/blob/master/web.rb\" target=\"_blank\" rel=\"noopener\">stripe sample code</a></p>\n</blockquote>\n<p>Như ví dụ trên, khi bạn xử dụng thư viện, hoặc api của bên thứ 3, có những exception đặc trưng cho từng loại thư viện, làm theo docs của thư viện đó thôi, nên bắt các exception ngay tại nơi logic đang diễn ra. Sau có dục thư viện đó đi hay update thì cũng dễ xử lý hơn.</p>\n<h2 id=\"8-Ghi-log\"><a href=\"#8-Ghi-log\" class=\"headerlink\" title=\"8. Ghi log\"></a>8. Ghi log</h2><p>Cuối cùng, khi sản phẩm của bạn lên production, bạn cần ghi log, để đọc, truy vết điều tra lỗi khi cần.</p>\n<p>Tôi hiện viết log theo cách sau:</p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># controllers/concerns/handle_log.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">HandleLog</span></span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">write_log</span><span class=\"params\">(e)</span></span></span><br><span class=\"line\">    issue = <span class=\"string\">\"START: ---------------------------\\n\"</span></span><br><span class=\"line\">    issue &lt;&lt; <span class=\"string\">\"TIME: <span class=\"subst\">#&#123;Time.now.utc&#125;</span> \\n\"</span></span><br><span class=\"line\">    issue &lt;&lt; <span class=\"string\">\"PARAMS: <span class=\"subst\">#&#123;params.to_json&#125;</span> \\n\"</span></span><br><span class=\"line\">    issue &lt;&lt; <span class=\"string\">\"MESSAGE: <span class=\"subst\">#&#123;e.message&#125;</span>\\n\"</span></span><br><span class=\"line\">    issue &lt;&lt; <span class=\"string\">\"----------------------------- :END\\n\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Rails.logger.info issue</span><br><span class=\"line\">  <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># controllers/concerns/handle_exception.rb</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">module</span> <span class=\"title\">HandleException</span></span></span><br><span class=\"line\">  <span class=\"comment\"># Khái báo class exception bạn tạo,</span></span><br><span class=\"line\">  <span class=\"comment\"># chúng đều kế thừa từ class StandardError</span></span><br><span class=\"line\">  <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WeakPassword</span> &lt; StandardError;</span> <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">  included <span class=\"keyword\">do</span></span><br><span class=\"line\">    <span class=\"comment\"># Exception 1</span></span><br><span class=\"line\">    rescue_from StandardError <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">      write_log(e)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Exception 2</span></span><br><span class=\"line\">    rescue_from ActiveRecord::RecordNotFound <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># Do something good</span></span><br><span class=\"line\">      write_log(e)</span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Exception 3</span></span><br><span class=\"line\">    rescue_from HandleException::WeakPassword <span class=\"keyword\">do</span> <span class=\"params\">|e|</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> notification password too weak</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> init recommmend password</span></span><br><span class=\"line\">      <span class=\"comment\"># <span class=\"doctag\">TODO:</span> display recommend password for UI</span></span><br><span class=\"line\">    <span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># ... N exception nữa, tuỳ nhu cầu của bạn.</span></span><br><span class=\"line\"> <span class=\"keyword\">end</span></span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ApplicationControler</span> &lt; ActionController::Base</span></span><br><span class=\"line\">  <span class=\"keyword\">include</span> HandleLog</span><br><span class=\"line\">  <span class=\"keyword\">include</span> HandleException</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"9-Tham-khao\"><a href=\"#9-Tham-khao\" class=\"headerlink\" title=\"9. Tham khảo\"></a>9. Tham khảo</h2><p>[1] <a href=\"http://rubylearning.com/satishtalim/ruby_exceptions.html\" target=\"_blank\" rel=\"noopener\">http://rubylearning.com/satishtalim/ruby_exceptions.html</a></p>\n"},{"title":"Save Navigation Operator","date":"2020-05-11T17:00:00.000Z","label":"#til","_content":"\n> Just take a note from resources on internet!\n\n## 1. ActiveRecord\n\n```ruby\naccount = Account.new(owner: nil) # account without an owner\n\naccount.owner.address\n# => NoMethodError: undefined method `address' for nil:NilClass\n\naccount && account.owner && account.owner.address\n# => nil\n\naccount.try(:owner).try(:address)\n# => nil\n\naccount&.owner&.address\n# => nil\n```\n\n```ruby\naccount = Account.new(owner: false)\n\naccount.owner.address\n# => NoMethodError: undefined method `address' for false:FalseClass `\n\naccount && account.owner && account.owner.address\n# => false\n\naccount.try(:owner).try(:address)\n# => nil\n\naccount&.owner&.address\n# => undefined method `address' for false:FalseClass`\n```\n\n```ruby\naccount = Account.new(owner: Object.new)\n# owner have not addreess column\n\naccount.owner.address\n# => NoMethodError: undefined method `address' for #<Object:0x00559996b5bde8>\n\naccount && account.owner && account.owner.address\n# => NoMethodError: undefined method `address' for #<Object:0x00559996b5bde8>`\n\naccount.try(:owner).try(:address)\n# => nil\n\naccount&.owner&.address\n# => NoMethodError: undefined method `address' for #<Object:0x00559996b5bde8>`\n```\n\nCatch exception with `try!`\n\n```ruby\naccount.try!(:owner).try!(:address)\n# => NoMethodError: undefined method `address' for #<Object:0x00559996b5bde8>`\n```\n\n## 2. Hash\n\n```ruby\nh = {\n  key_1: {\n    key_2: {\n      key_3: \"Value\"\n    }\n  }\n}\n```\n\n```ruby\nh&.[](:key_1)&.[](:key_2)&.[](:key_3)\n```\n\n```ruby\nh.dig(:key_1, :key_2, :key_3)\n```\n\n## Resources\n\n[1][http://mitrev.net/ruby/2015/11/13/the-operator-in-ruby/](http://mitrev.net/ruby/2015/11/13/the-operator-in-ruby/)\n\n[2][https://stackoverflow.com/questions/35922774/safe-navigation-equivalent-to-rails-try-for-hashes](https://stackoverflow.com/questions/35922774/safe-navigation-equivalent-to-rails-try-for-hashes)\n","source":"_posts/2020-05-12-safe-navigation-operator.md","raw":"---\ntitle: \"Save Navigation Operator\"\ndate: 2020-05-12\ntags: [\"NOTES\"]\nlabel: \"#til\"\n---\n\n> Just take a note from resources on internet!\n\n## 1. ActiveRecord\n\n```ruby\naccount = Account.new(owner: nil) # account without an owner\n\naccount.owner.address\n# => NoMethodError: undefined method `address' for nil:NilClass\n\naccount && account.owner && account.owner.address\n# => nil\n\naccount.try(:owner).try(:address)\n# => nil\n\naccount&.owner&.address\n# => nil\n```\n\n```ruby\naccount = Account.new(owner: false)\n\naccount.owner.address\n# => NoMethodError: undefined method `address' for false:FalseClass `\n\naccount && account.owner && account.owner.address\n# => false\n\naccount.try(:owner).try(:address)\n# => nil\n\naccount&.owner&.address\n# => undefined method `address' for false:FalseClass`\n```\n\n```ruby\naccount = Account.new(owner: Object.new)\n# owner have not addreess column\n\naccount.owner.address\n# => NoMethodError: undefined method `address' for #<Object:0x00559996b5bde8>\n\naccount && account.owner && account.owner.address\n# => NoMethodError: undefined method `address' for #<Object:0x00559996b5bde8>`\n\naccount.try(:owner).try(:address)\n# => nil\n\naccount&.owner&.address\n# => NoMethodError: undefined method `address' for #<Object:0x00559996b5bde8>`\n```\n\nCatch exception with `try!`\n\n```ruby\naccount.try!(:owner).try!(:address)\n# => NoMethodError: undefined method `address' for #<Object:0x00559996b5bde8>`\n```\n\n## 2. Hash\n\n```ruby\nh = {\n  key_1: {\n    key_2: {\n      key_3: \"Value\"\n    }\n  }\n}\n```\n\n```ruby\nh&.[](:key_1)&.[](:key_2)&.[](:key_3)\n```\n\n```ruby\nh.dig(:key_1, :key_2, :key_3)\n```\n\n## Resources\n\n[1][http://mitrev.net/ruby/2015/11/13/the-operator-in-ruby/](http://mitrev.net/ruby/2015/11/13/the-operator-in-ruby/)\n\n[2][https://stackoverflow.com/questions/35922774/safe-navigation-equivalent-to-rails-try-for-hashes](https://stackoverflow.com/questions/35922774/safe-navigation-equivalent-to-rails-try-for-hashes)\n","slug":"2020-05-12-safe-navigation-operator","published":1,"updated":"2022-01-29T09:29:59.930Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbp0045p3m2gtwubt2w","content":"<blockquote>\n<p>Just take a note from resources on internet!</p>\n</blockquote>\n<h2 id=\"1-ActiveRecord\"><a href=\"#1-ActiveRecord\" class=\"headerlink\" title=\"1. ActiveRecord\"></a>1. ActiveRecord</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">account = Account.new(<span class=\"symbol\">owner:</span> <span class=\"literal\">nil</span>) <span class=\"comment\"># account without an owner</span></span><br><span class=\"line\"></span><br><span class=\"line\">account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for nil:NilClass</span></span><br><span class=\"line\"></span><br><span class=\"line\">account &amp;&amp; account.owner &amp;&amp; account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; nil</span></span><br><span class=\"line\"></span><br><span class=\"line\">account.try(<span class=\"symbol\">:owner</span>).try(<span class=\"symbol\">:address</span>)</span><br><span class=\"line\"><span class=\"comment\"># =&gt; nil</span></span><br><span class=\"line\"></span><br><span class=\"line\">account&amp;.owner&amp;.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; nil</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">account = Account.new(<span class=\"symbol\">owner:</span> <span class=\"literal\">false</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for false:FalseClass `</span></span><br><span class=\"line\"></span><br><span class=\"line\">account &amp;&amp; account.owner &amp;&amp; account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; false</span></span><br><span class=\"line\"></span><br><span class=\"line\">account.try(<span class=\"symbol\">:owner</span>).try(<span class=\"symbol\">:address</span>)</span><br><span class=\"line\"><span class=\"comment\"># =&gt; nil</span></span><br><span class=\"line\"></span><br><span class=\"line\">account&amp;.owner&amp;.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; undefined method `address' for false:FalseClass`</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">account = Account.new(<span class=\"symbol\">owner:</span> Object.new)</span><br><span class=\"line\"><span class=\"comment\"># owner have not addreess column</span></span><br><span class=\"line\"></span><br><span class=\"line\">account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for #&lt;Object:0x00559996b5bde8&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">account &amp;&amp; account.owner &amp;&amp; account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for #&lt;Object:0x00559996b5bde8&gt;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">account.try(<span class=\"symbol\">:owner</span>).try(<span class=\"symbol\">:address</span>)</span><br><span class=\"line\"><span class=\"comment\"># =&gt; nil</span></span><br><span class=\"line\"></span><br><span class=\"line\">account&amp;.owner&amp;.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for #&lt;Object:0x00559996b5bde8&gt;`</span></span><br></pre></td></tr></table></figure>\n\n<p>Catch exception with <code>try!</code></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">account.try!(<span class=\"symbol\">:owner</span>).try!(<span class=\"symbol\">:address</span>)</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for #&lt;Object:0x00559996b5bde8&gt;`</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Hash\"><a href=\"#2-Hash\" class=\"headerlink\" title=\"2. Hash\"></a>2. Hash</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">h = &#123;</span><br><span class=\"line\">  <span class=\"symbol\">key_1:</span> &#123;</span><br><span class=\"line\">    <span class=\"symbol\">key_2:</span> &#123;</span><br><span class=\"line\">      <span class=\"symbol\">key_3:</span> <span class=\"string\">\"Value\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">h&amp;.[](<span class=\"symbol\">:key_1</span>)&amp;.[](<span class=\"symbol\">:key_2</span>)&amp;.[](<span class=\"symbol\">:key_3</span>)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">h.dig(<span class=\"symbol\">:key_1</span>, <span class=\"symbol\">:key_2</span>, <span class=\"symbol\">:key_3</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Resources\"><a href=\"#Resources\" class=\"headerlink\" title=\"Resources\"></a>Resources</h2><p>[1]<a href=\"http://mitrev.net/ruby/2015/11/13/the-operator-in-ruby/\" target=\"_blank\" rel=\"noopener\">http://mitrev.net/ruby/2015/11/13/the-operator-in-ruby/</a></p>\n<p>[2]<a href=\"https://stackoverflow.com/questions/35922774/safe-navigation-equivalent-to-rails-try-for-hashes\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/35922774/safe-navigation-equivalent-to-rails-try-for-hashes</a></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>Just take a note from resources on internet!</p>\n</blockquote>\n<h2 id=\"1-ActiveRecord\"><a href=\"#1-ActiveRecord\" class=\"headerlink\" title=\"1. ActiveRecord\"></a>1. ActiveRecord</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">account = Account.new(<span class=\"symbol\">owner:</span> <span class=\"literal\">nil</span>) <span class=\"comment\"># account without an owner</span></span><br><span class=\"line\"></span><br><span class=\"line\">account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for nil:NilClass</span></span><br><span class=\"line\"></span><br><span class=\"line\">account &amp;&amp; account.owner &amp;&amp; account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; nil</span></span><br><span class=\"line\"></span><br><span class=\"line\">account.try(<span class=\"symbol\">:owner</span>).try(<span class=\"symbol\">:address</span>)</span><br><span class=\"line\"><span class=\"comment\"># =&gt; nil</span></span><br><span class=\"line\"></span><br><span class=\"line\">account&amp;.owner&amp;.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; nil</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">account = Account.new(<span class=\"symbol\">owner:</span> <span class=\"literal\">false</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for false:FalseClass `</span></span><br><span class=\"line\"></span><br><span class=\"line\">account &amp;&amp; account.owner &amp;&amp; account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; false</span></span><br><span class=\"line\"></span><br><span class=\"line\">account.try(<span class=\"symbol\">:owner</span>).try(<span class=\"symbol\">:address</span>)</span><br><span class=\"line\"><span class=\"comment\"># =&gt; nil</span></span><br><span class=\"line\"></span><br><span class=\"line\">account&amp;.owner&amp;.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; undefined method `address' for false:FalseClass`</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">account = Account.new(<span class=\"symbol\">owner:</span> Object.new)</span><br><span class=\"line\"><span class=\"comment\"># owner have not addreess column</span></span><br><span class=\"line\"></span><br><span class=\"line\">account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for #&lt;Object:0x00559996b5bde8&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">account &amp;&amp; account.owner &amp;&amp; account.owner.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for #&lt;Object:0x00559996b5bde8&gt;`</span></span><br><span class=\"line\"></span><br><span class=\"line\">account.try(<span class=\"symbol\">:owner</span>).try(<span class=\"symbol\">:address</span>)</span><br><span class=\"line\"><span class=\"comment\"># =&gt; nil</span></span><br><span class=\"line\"></span><br><span class=\"line\">account&amp;.owner&amp;.address</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for #&lt;Object:0x00559996b5bde8&gt;`</span></span><br></pre></td></tr></table></figure>\n\n<p>Catch exception with <code>try!</code></p>\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">account.try!(<span class=\"symbol\">:owner</span>).try!(<span class=\"symbol\">:address</span>)</span><br><span class=\"line\"><span class=\"comment\"># =&gt; NoMethodError: undefined method `address' for #&lt;Object:0x00559996b5bde8&gt;`</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Hash\"><a href=\"#2-Hash\" class=\"headerlink\" title=\"2. Hash\"></a>2. Hash</h2><figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">h = &#123;</span><br><span class=\"line\">  <span class=\"symbol\">key_1:</span> &#123;</span><br><span class=\"line\">    <span class=\"symbol\">key_2:</span> &#123;</span><br><span class=\"line\">      <span class=\"symbol\">key_3:</span> <span class=\"string\">\"Value\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">h&amp;.[](<span class=\"symbol\">:key_1</span>)&amp;.[](<span class=\"symbol\">:key_2</span>)&amp;.[](<span class=\"symbol\">:key_3</span>)</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight ruby\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">h.dig(<span class=\"symbol\">:key_1</span>, <span class=\"symbol\">:key_2</span>, <span class=\"symbol\">:key_3</span>)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Resources\"><a href=\"#Resources\" class=\"headerlink\" title=\"Resources\"></a>Resources</h2><p>[1]<a href=\"http://mitrev.net/ruby/2015/11/13/the-operator-in-ruby/\" target=\"_blank\" rel=\"noopener\">http://mitrev.net/ruby/2015/11/13/the-operator-in-ruby/</a></p>\n<p>[2]<a href=\"https://stackoverflow.com/questions/35922774/safe-navigation-equivalent-to-rails-try-for-hashes\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/35922774/safe-navigation-equivalent-to-rails-try-for-hashes</a></p>\n"},{"title":"URLs: Dash vs. Underscores","date":"2020-05-13T17:00:00.000Z","label":"#til","_content":"\nConsider using punctuation in your URLs. The URL http://www.example.com/green-dress.html is much more useful to us than http://www.example.com/greendress.html. We recommend that you use hyphens (-) instead of underscores (_) in your URLs.\n\n>Dashes are recommended by Google over underscores.\n>Dashes are more familiar to the end user.\n>Dashes are easier to write on a standard keyboard (no need to Shift).\n>Dashes don't hide behind underlines.\n>Dashes feel more native in the context of URLs as they are allowed in domain names.\n\n[1][https://stackoverflow.com/questions/119312/urls-dash-vs-underscore](https://stackoverflow.com/questions/119312/urls-dash-vs-underscore)\n\n[2][https://support.google.com/webmasters/answer/76329?hl=en](https://support.google.com/webmasters/answer/76329?hl=en)\n","source":"_posts/2020-05-14-url-dash-vs-underscore.md","raw":"---\ntitle: \"URLs: Dash vs. Underscores\"\ndate: 2020-05-14\ntags: [\"NOTES\"]\nlabel: \"#til\"\n---\n\nConsider using punctuation in your URLs. The URL http://www.example.com/green-dress.html is much more useful to us than http://www.example.com/greendress.html. We recommend that you use hyphens (-) instead of underscores (_) in your URLs.\n\n>Dashes are recommended by Google over underscores.\n>Dashes are more familiar to the end user.\n>Dashes are easier to write on a standard keyboard (no need to Shift).\n>Dashes don't hide behind underlines.\n>Dashes feel more native in the context of URLs as they are allowed in domain names.\n\n[1][https://stackoverflow.com/questions/119312/urls-dash-vs-underscore](https://stackoverflow.com/questions/119312/urls-dash-vs-underscore)\n\n[2][https://support.google.com/webmasters/answer/76329?hl=en](https://support.google.com/webmasters/answer/76329?hl=en)\n","slug":"2020-05-14-url-dash-vs-underscore","published":1,"updated":"2022-01-29T09:29:59.930Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbq0047p3m2cahtc3ny","content":"<p>Consider using punctuation in your URLs. The URL <a href=\"http://www.example.com/green-dress.html\" target=\"_blank\" rel=\"noopener\">http://www.example.com/green-dress.html</a> is much more useful to us than <a href=\"http://www.example.com/greendress.html\" target=\"_blank\" rel=\"noopener\">http://www.example.com/greendress.html</a>. We recommend that you use hyphens (-) instead of underscores (_) in your URLs.</p>\n<blockquote>\n<p>Dashes are recommended by Google over underscores.<br>Dashes are more familiar to the end user.<br>Dashes are easier to write on a standard keyboard (no need to Shift).<br>Dashes don’t hide behind underlines.<br>Dashes feel more native in the context of URLs as they are allowed in domain names.</p>\n</blockquote>\n<p>[1]<a href=\"https://stackoverflow.com/questions/119312/urls-dash-vs-underscore\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/119312/urls-dash-vs-underscore</a></p>\n<p>[2]<a href=\"https://support.google.com/webmasters/answer/76329?hl=en\" target=\"_blank\" rel=\"noopener\">https://support.google.com/webmasters/answer/76329?hl=en</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Consider using punctuation in your URLs. The URL <a href=\"http://www.example.com/green-dress.html\" target=\"_blank\" rel=\"noopener\">http://www.example.com/green-dress.html</a> is much more useful to us than <a href=\"http://www.example.com/greendress.html\" target=\"_blank\" rel=\"noopener\">http://www.example.com/greendress.html</a>. We recommend that you use hyphens (-) instead of underscores (_) in your URLs.</p>\n<blockquote>\n<p>Dashes are recommended by Google over underscores.<br>Dashes are more familiar to the end user.<br>Dashes are easier to write on a standard keyboard (no need to Shift).<br>Dashes don’t hide behind underlines.<br>Dashes feel more native in the context of URLs as they are allowed in domain names.</p>\n</blockquote>\n<p>[1]<a href=\"https://stackoverflow.com/questions/119312/urls-dash-vs-underscore\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/119312/urls-dash-vs-underscore</a></p>\n<p>[2]<a href=\"https://support.google.com/webmasters/answer/76329?hl=en\" target=\"_blank\" rel=\"noopener\">https://support.google.com/webmasters/answer/76329?hl=en</a></p>\n"},{"title":"Làm Mini App Cho Vợ P.1","date":"2020-05-16T17:00:00.000Z","_content":"\n## Nhu cầu\n\nChuyện là mình đã lấy vợ được nửa năm, tính ra cũng khá sớm, nhưng âu là cái duyên, duyên đến thì nhận, sớm hay muộn là do nhận mà ra, quan trọng bản thân cảm thấy vui vẻ.\n\nVợ chồng mình trẻ...và dĩ nhiên cũng nghèo :(, chi tiêu, giá cả tăng phi mã, cái con số lạm phát trên tivi có vẻ không được chính xác, 2 vợ chồng đi làm có cố gắng mà cuối tháng không bỏ ra được đáng bao nhiêu tiền, trong khi còn chưa có con cái, đáng suy ngẫm mà cũng đáng để lo lắng.\n\nCó vấn đề, thì ta tìm cách giải quyết, mình đi đến 2 quyết định:\n\n1. Tìm một công việc khác có thu nhập tốt hơn.\n2. Các chi tiêu cần được thống kê lại.\n\nĐể có thể thực hiện điều số 2, vợ chồng mình cần chủ động ghi chép lại toàn bộ chi tiêu, mà rồi làm sao để ghi chép?\n\nMình có tìm hiểu một số ứng dụng thống kê, ghi chép thu chi, nhưng kết quả không tốt, với lý do những ứng dụng đó không match được với nhu cầu. **Hơn nữa điều quan trọng nhất, đó là vợ chồng mình lười, vậy nên để duy trì một thói quen lâu dài, chúng mình cần công việc đó thực sự ĐƠN GIẢN.**\n\nCác ứng dụng mình tìm được quá phức tạp, ngay cả việc mở 1 cái app note lên ghi note text lại thôi, chưa chắc bạn đã làm được ngày này qua ngày khác, huống hồ ghi thu chi.\n\n\nVì vậy, mình quyết định làm 1 ứng dụng mini để match đúng nhu cầu mình đang có, và nó phải đơn giản, đơn giản đến mức mình (1 người lười) cũng có thể duy trì lâu dài.\n\n## Dự định\n\nVới dự định như trên, mình quyết định làm 1 **Chat Bot** đơn giản, để mỗi lần ghi thu chi mình có thẻ mở 1 app nhắn tin nào đó lên gõ và enter là xong. Tiếp đó mình cần 1 **web app** cũng đơn giản không kém, chỉ cần có chức năng đăng nhập, xem thu chi trong ngày, trong tháng, trong năm, xem đồ thị so sánh giữa các ngày trong tuần, xem đồ thị so sánh giữa các tuần trong tháng, và có thể trong tương lai là so sánh các ngày trong năm, và có chức năng gửi report qua email. Vậy là ổn và match với nhu cầu tiết kiệm của vợ chồng mình.\n\nVới số tính năng trên mình đã lựa chọn như sau:\n\n1. **Chat Bot**: Sử dụng nền tảng của facebook messenger (lý do: nổi tiếng, bản thân mình và vợ cũng hay xài).\n\n2. **Web App**: Backend (Ruby On Rails, mình có 1 side project nên giờ chỉ viết thêm module cho phần chức năng cần có của app thu chi chứ không cần tạo project từ đầu - Triển khai trên Heroku), Frontend (Reactjs - Triển khai trên Now.sh).\n\nFlow như sau:\n\n1. Mình gửi tin nhắn đến facebook chatbot.\n2. Tin nhắn đó được gửi tới server backend. Backend phân tích format của tin nhắn và lưu lại thông tin nếu dữ liệu hợp lệ.\n3. Mình vào web Frontend để monitor quá trình chi tiêu.\n\n## Tổng kết\n\nKhi mình viết bài viết này, thì ứng dụng nhỏ này đã được triển khai và vợ chồng mình đã có 1 tuần sử dụng, chúng mình khá ưng ý, hi vọng có thể duy trì thói quen này lâu dài.\n\nQua đây mình sẽ viết quá trình làm mini app này, từ khi làm tới khi triển khai và sau đó là cố gắng học hỏi để improve tổ chức project tốt hơn (mình chưa có nhiều kinh nghiệm Frontend, nên đây cũng là cơ hội để đọc những tài liệu hay ho về Frontend).\n","source":"_posts/2020-05-17-lam-mini-app-cho-vo-phan-1.md","raw":"---\ntitle: \"Làm Mini App Cho Vợ P.1\"\ndate: 2020-05-17\n---\n\n## Nhu cầu\n\nChuyện là mình đã lấy vợ được nửa năm, tính ra cũng khá sớm, nhưng âu là cái duyên, duyên đến thì nhận, sớm hay muộn là do nhận mà ra, quan trọng bản thân cảm thấy vui vẻ.\n\nVợ chồng mình trẻ...và dĩ nhiên cũng nghèo :(, chi tiêu, giá cả tăng phi mã, cái con số lạm phát trên tivi có vẻ không được chính xác, 2 vợ chồng đi làm có cố gắng mà cuối tháng không bỏ ra được đáng bao nhiêu tiền, trong khi còn chưa có con cái, đáng suy ngẫm mà cũng đáng để lo lắng.\n\nCó vấn đề, thì ta tìm cách giải quyết, mình đi đến 2 quyết định:\n\n1. Tìm một công việc khác có thu nhập tốt hơn.\n2. Các chi tiêu cần được thống kê lại.\n\nĐể có thể thực hiện điều số 2, vợ chồng mình cần chủ động ghi chép lại toàn bộ chi tiêu, mà rồi làm sao để ghi chép?\n\nMình có tìm hiểu một số ứng dụng thống kê, ghi chép thu chi, nhưng kết quả không tốt, với lý do những ứng dụng đó không match được với nhu cầu. **Hơn nữa điều quan trọng nhất, đó là vợ chồng mình lười, vậy nên để duy trì một thói quen lâu dài, chúng mình cần công việc đó thực sự ĐƠN GIẢN.**\n\nCác ứng dụng mình tìm được quá phức tạp, ngay cả việc mở 1 cái app note lên ghi note text lại thôi, chưa chắc bạn đã làm được ngày này qua ngày khác, huống hồ ghi thu chi.\n\n\nVì vậy, mình quyết định làm 1 ứng dụng mini để match đúng nhu cầu mình đang có, và nó phải đơn giản, đơn giản đến mức mình (1 người lười) cũng có thể duy trì lâu dài.\n\n## Dự định\n\nVới dự định như trên, mình quyết định làm 1 **Chat Bot** đơn giản, để mỗi lần ghi thu chi mình có thẻ mở 1 app nhắn tin nào đó lên gõ và enter là xong. Tiếp đó mình cần 1 **web app** cũng đơn giản không kém, chỉ cần có chức năng đăng nhập, xem thu chi trong ngày, trong tháng, trong năm, xem đồ thị so sánh giữa các ngày trong tuần, xem đồ thị so sánh giữa các tuần trong tháng, và có thể trong tương lai là so sánh các ngày trong năm, và có chức năng gửi report qua email. Vậy là ổn và match với nhu cầu tiết kiệm của vợ chồng mình.\n\nVới số tính năng trên mình đã lựa chọn như sau:\n\n1. **Chat Bot**: Sử dụng nền tảng của facebook messenger (lý do: nổi tiếng, bản thân mình và vợ cũng hay xài).\n\n2. **Web App**: Backend (Ruby On Rails, mình có 1 side project nên giờ chỉ viết thêm module cho phần chức năng cần có của app thu chi chứ không cần tạo project từ đầu - Triển khai trên Heroku), Frontend (Reactjs - Triển khai trên Now.sh).\n\nFlow như sau:\n\n1. Mình gửi tin nhắn đến facebook chatbot.\n2. Tin nhắn đó được gửi tới server backend. Backend phân tích format của tin nhắn và lưu lại thông tin nếu dữ liệu hợp lệ.\n3. Mình vào web Frontend để monitor quá trình chi tiêu.\n\n## Tổng kết\n\nKhi mình viết bài viết này, thì ứng dụng nhỏ này đã được triển khai và vợ chồng mình đã có 1 tuần sử dụng, chúng mình khá ưng ý, hi vọng có thể duy trì thói quen này lâu dài.\n\nQua đây mình sẽ viết quá trình làm mini app này, từ khi làm tới khi triển khai và sau đó là cố gắng học hỏi để improve tổ chức project tốt hơn (mình chưa có nhiều kinh nghiệm Frontend, nên đây cũng là cơ hội để đọc những tài liệu hay ho về Frontend).\n","slug":"2020-05-17-lam-mini-app-cho-vo-phan-1","published":1,"updated":"2022-01-29T09:29:59.930Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbq004ap3m291jeg5kh","content":"<h2 id=\"Nhu-cau\"><a href=\"#Nhu-cau\" class=\"headerlink\" title=\"Nhu cầu\"></a>Nhu cầu</h2><p>Chuyện là mình đã lấy vợ được nửa năm, tính ra cũng khá sớm, nhưng âu là cái duyên, duyên đến thì nhận, sớm hay muộn là do nhận mà ra, quan trọng bản thân cảm thấy vui vẻ.</p>\n<p>Vợ chồng mình trẻ…và dĩ nhiên cũng nghèo :(, chi tiêu, giá cả tăng phi mã, cái con số lạm phát trên tivi có vẻ không được chính xác, 2 vợ chồng đi làm có cố gắng mà cuối tháng không bỏ ra được đáng bao nhiêu tiền, trong khi còn chưa có con cái, đáng suy ngẫm mà cũng đáng để lo lắng.</p>\n<p>Có vấn đề, thì ta tìm cách giải quyết, mình đi đến 2 quyết định:</p>\n<ol>\n<li>Tìm một công việc khác có thu nhập tốt hơn.</li>\n<li>Các chi tiêu cần được thống kê lại.</li>\n</ol>\n<p>Để có thể thực hiện điều số 2, vợ chồng mình cần chủ động ghi chép lại toàn bộ chi tiêu, mà rồi làm sao để ghi chép?</p>\n<p>Mình có tìm hiểu một số ứng dụng thống kê, ghi chép thu chi, nhưng kết quả không tốt, với lý do những ứng dụng đó không match được với nhu cầu. <strong>Hơn nữa điều quan trọng nhất, đó là vợ chồng mình lười, vậy nên để duy trì một thói quen lâu dài, chúng mình cần công việc đó thực sự ĐƠN GIẢN.</strong></p>\n<p>Các ứng dụng mình tìm được quá phức tạp, ngay cả việc mở 1 cái app note lên ghi note text lại thôi, chưa chắc bạn đã làm được ngày này qua ngày khác, huống hồ ghi thu chi.</p>\n<p>Vì vậy, mình quyết định làm 1 ứng dụng mini để match đúng nhu cầu mình đang có, và nó phải đơn giản, đơn giản đến mức mình (1 người lười) cũng có thể duy trì lâu dài.</p>\n<h2 id=\"Du-dinh\"><a href=\"#Du-dinh\" class=\"headerlink\" title=\"Dự định\"></a>Dự định</h2><p>Với dự định như trên, mình quyết định làm 1 <strong>Chat Bot</strong> đơn giản, để mỗi lần ghi thu chi mình có thẻ mở 1 app nhắn tin nào đó lên gõ và enter là xong. Tiếp đó mình cần 1 <strong>web app</strong> cũng đơn giản không kém, chỉ cần có chức năng đăng nhập, xem thu chi trong ngày, trong tháng, trong năm, xem đồ thị so sánh giữa các ngày trong tuần, xem đồ thị so sánh giữa các tuần trong tháng, và có thể trong tương lai là so sánh các ngày trong năm, và có chức năng gửi report qua email. Vậy là ổn và match với nhu cầu tiết kiệm của vợ chồng mình.</p>\n<p>Với số tính năng trên mình đã lựa chọn như sau:</p>\n<ol>\n<li><p><strong>Chat Bot</strong>: Sử dụng nền tảng của facebook messenger (lý do: nổi tiếng, bản thân mình và vợ cũng hay xài).</p>\n</li>\n<li><p><strong>Web App</strong>: Backend (Ruby On Rails, mình có 1 side project nên giờ chỉ viết thêm module cho phần chức năng cần có của app thu chi chứ không cần tạo project từ đầu - Triển khai trên Heroku), Frontend (Reactjs - Triển khai trên Now.sh).</p>\n</li>\n</ol>\n<p>Flow như sau:</p>\n<ol>\n<li>Mình gửi tin nhắn đến facebook chatbot.</li>\n<li>Tin nhắn đó được gửi tới server backend. Backend phân tích format của tin nhắn và lưu lại thông tin nếu dữ liệu hợp lệ.</li>\n<li>Mình vào web Frontend để monitor quá trình chi tiêu.</li>\n</ol>\n<h2 id=\"Tong-ket\"><a href=\"#Tong-ket\" class=\"headerlink\" title=\"Tổng kết\"></a>Tổng kết</h2><p>Khi mình viết bài viết này, thì ứng dụng nhỏ này đã được triển khai và vợ chồng mình đã có 1 tuần sử dụng, chúng mình khá ưng ý, hi vọng có thể duy trì thói quen này lâu dài.</p>\n<p>Qua đây mình sẽ viết quá trình làm mini app này, từ khi làm tới khi triển khai và sau đó là cố gắng học hỏi để improve tổ chức project tốt hơn (mình chưa có nhiều kinh nghiệm Frontend, nên đây cũng là cơ hội để đọc những tài liệu hay ho về Frontend).</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Nhu-cau\"><a href=\"#Nhu-cau\" class=\"headerlink\" title=\"Nhu cầu\"></a>Nhu cầu</h2><p>Chuyện là mình đã lấy vợ được nửa năm, tính ra cũng khá sớm, nhưng âu là cái duyên, duyên đến thì nhận, sớm hay muộn là do nhận mà ra, quan trọng bản thân cảm thấy vui vẻ.</p>\n<p>Vợ chồng mình trẻ…và dĩ nhiên cũng nghèo :(, chi tiêu, giá cả tăng phi mã, cái con số lạm phát trên tivi có vẻ không được chính xác, 2 vợ chồng đi làm có cố gắng mà cuối tháng không bỏ ra được đáng bao nhiêu tiền, trong khi còn chưa có con cái, đáng suy ngẫm mà cũng đáng để lo lắng.</p>\n<p>Có vấn đề, thì ta tìm cách giải quyết, mình đi đến 2 quyết định:</p>\n<ol>\n<li>Tìm một công việc khác có thu nhập tốt hơn.</li>\n<li>Các chi tiêu cần được thống kê lại.</li>\n</ol>\n<p>Để có thể thực hiện điều số 2, vợ chồng mình cần chủ động ghi chép lại toàn bộ chi tiêu, mà rồi làm sao để ghi chép?</p>\n<p>Mình có tìm hiểu một số ứng dụng thống kê, ghi chép thu chi, nhưng kết quả không tốt, với lý do những ứng dụng đó không match được với nhu cầu. <strong>Hơn nữa điều quan trọng nhất, đó là vợ chồng mình lười, vậy nên để duy trì một thói quen lâu dài, chúng mình cần công việc đó thực sự ĐƠN GIẢN.</strong></p>\n<p>Các ứng dụng mình tìm được quá phức tạp, ngay cả việc mở 1 cái app note lên ghi note text lại thôi, chưa chắc bạn đã làm được ngày này qua ngày khác, huống hồ ghi thu chi.</p>\n<p>Vì vậy, mình quyết định làm 1 ứng dụng mini để match đúng nhu cầu mình đang có, và nó phải đơn giản, đơn giản đến mức mình (1 người lười) cũng có thể duy trì lâu dài.</p>\n<h2 id=\"Du-dinh\"><a href=\"#Du-dinh\" class=\"headerlink\" title=\"Dự định\"></a>Dự định</h2><p>Với dự định như trên, mình quyết định làm 1 <strong>Chat Bot</strong> đơn giản, để mỗi lần ghi thu chi mình có thẻ mở 1 app nhắn tin nào đó lên gõ và enter là xong. Tiếp đó mình cần 1 <strong>web app</strong> cũng đơn giản không kém, chỉ cần có chức năng đăng nhập, xem thu chi trong ngày, trong tháng, trong năm, xem đồ thị so sánh giữa các ngày trong tuần, xem đồ thị so sánh giữa các tuần trong tháng, và có thể trong tương lai là so sánh các ngày trong năm, và có chức năng gửi report qua email. Vậy là ổn và match với nhu cầu tiết kiệm của vợ chồng mình.</p>\n<p>Với số tính năng trên mình đã lựa chọn như sau:</p>\n<ol>\n<li><p><strong>Chat Bot</strong>: Sử dụng nền tảng của facebook messenger (lý do: nổi tiếng, bản thân mình và vợ cũng hay xài).</p>\n</li>\n<li><p><strong>Web App</strong>: Backend (Ruby On Rails, mình có 1 side project nên giờ chỉ viết thêm module cho phần chức năng cần có của app thu chi chứ không cần tạo project từ đầu - Triển khai trên Heroku), Frontend (Reactjs - Triển khai trên Now.sh).</p>\n</li>\n</ol>\n<p>Flow như sau:</p>\n<ol>\n<li>Mình gửi tin nhắn đến facebook chatbot.</li>\n<li>Tin nhắn đó được gửi tới server backend. Backend phân tích format của tin nhắn và lưu lại thông tin nếu dữ liệu hợp lệ.</li>\n<li>Mình vào web Frontend để monitor quá trình chi tiêu.</li>\n</ol>\n<h2 id=\"Tong-ket\"><a href=\"#Tong-ket\" class=\"headerlink\" title=\"Tổng kết\"></a>Tổng kết</h2><p>Khi mình viết bài viết này, thì ứng dụng nhỏ này đã được triển khai và vợ chồng mình đã có 1 tuần sử dụng, chúng mình khá ưng ý, hi vọng có thể duy trì thói quen này lâu dài.</p>\n<p>Qua đây mình sẽ viết quá trình làm mini app này, từ khi làm tới khi triển khai và sau đó là cố gắng học hỏi để improve tổ chức project tốt hơn (mình chưa có nhiều kinh nghiệm Frontend, nên đây cũng là cơ hội để đọc những tài liệu hay ho về Frontend).</p>\n"},{"title":"Linux Process Type","date":"2020-05-12T17:00:00.000Z","label":"#til","_content":"\n> In Linux, these processes are divided into 3 types of processes: Interactive, Batch and Daemon.\n\nThe processes which are run by a user at the command line are called **Interactive processes**.\n\nThe processes which are not associated with the command line and are presented from a queue of processes, which are also most convenient for recurring tasks during the time when the system usage is low is called **the batch processes**.\n\nThe process which is identified by the system and whose PID is always ‘init’, is called as **Daemons**. The ‘init’ is a process which always gets started first at the time when a Linux computer is turned on and it remains on that system until the computer is turned off.\n\nThe Processes due to which Daemons get initiated are forking, making a parent process die when the child process starts performing their normal functions.\n\n[1][https://www.quora.com/What-is-a-daemon-process-in-Linux](https://www.quora.com/What-is-a-daemon-process-in-Linux)\n","source":"_posts/2020-05-13-linux-process-types-dirty-method.md","raw":"---\ntitle: \"Linux Process Type\"\ndate: 2020-05-13\ntags: [\"NOTES\"]\nlabel: \"#til\"\n---\n\n> In Linux, these processes are divided into 3 types of processes: Interactive, Batch and Daemon.\n\nThe processes which are run by a user at the command line are called **Interactive processes**.\n\nThe processes which are not associated with the command line and are presented from a queue of processes, which are also most convenient for recurring tasks during the time when the system usage is low is called **the batch processes**.\n\nThe process which is identified by the system and whose PID is always ‘init’, is called as **Daemons**. The ‘init’ is a process which always gets started first at the time when a Linux computer is turned on and it remains on that system until the computer is turned off.\n\nThe Processes due to which Daemons get initiated are forking, making a parent process die when the child process starts performing their normal functions.\n\n[1][https://www.quora.com/What-is-a-daemon-process-in-Linux](https://www.quora.com/What-is-a-daemon-process-in-Linux)\n","slug":"2020-05-13-linux-process-types-dirty-method","published":1,"updated":"2022-01-29T09:29:59.930Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbr004cp3m22kfphlqw","content":"<blockquote>\n<p>In Linux, these processes are divided into 3 types of processes: Interactive, Batch and Daemon.</p>\n</blockquote>\n<p>The processes which are run by a user at the command line are called <strong>Interactive processes</strong>.</p>\n<p>The processes which are not associated with the command line and are presented from a queue of processes, which are also most convenient for recurring tasks during the time when the system usage is low is called <strong>the batch processes</strong>.</p>\n<p>The process which is identified by the system and whose PID is always ‘init’, is called as <strong>Daemons</strong>. The ‘init’ is a process which always gets started first at the time when a Linux computer is turned on and it remains on that system until the computer is turned off.</p>\n<p>The Processes due to which Daemons get initiated are forking, making a parent process die when the child process starts performing their normal functions.</p>\n<p>[1]<a href=\"https://www.quora.com/What-is-a-daemon-process-in-Linux\" target=\"_blank\" rel=\"noopener\">https://www.quora.com/What-is-a-daemon-process-in-Linux</a></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>In Linux, these processes are divided into 3 types of processes: Interactive, Batch and Daemon.</p>\n</blockquote>\n<p>The processes which are run by a user at the command line are called <strong>Interactive processes</strong>.</p>\n<p>The processes which are not associated with the command line and are presented from a queue of processes, which are also most convenient for recurring tasks during the time when the system usage is low is called <strong>the batch processes</strong>.</p>\n<p>The process which is identified by the system and whose PID is always ‘init’, is called as <strong>Daemons</strong>. The ‘init’ is a process which always gets started first at the time when a Linux computer is turned on and it remains on that system until the computer is turned off.</p>\n<p>The Processes due to which Daemons get initiated are forking, making a parent process die when the child process starts performing their normal functions.</p>\n<p>[1]<a href=\"https://www.quora.com/What-is-a-daemon-process-in-Linux\" target=\"_blank\" rel=\"noopener\">https://www.quora.com/What-is-a-daemon-process-in-Linux</a></p>\n"},{"title":"Side Project Tiếp Theo","date":"2020-06-26T17:00:00.000Z","_content":"\nChuyện là mình vừa nghỉ làm ở công ty cũ, trong thời gian về nhà trước khi tìm việc mới, mình quyết định làm một side project nhỏ tiếp theo.\n\nÝ tưởng của project này đến từ 2 nguồn cảm hứng:\n1. Sự lười học Tiếng Anh đến cùng cực của mình.\n2. Phương pháp Spaced Repetition.\n\nVà thế là một Web App để học từ vựng tiếng anh lại được ra đời, mặc cho đã có biết bao nhiêu App có chức năng tương tự.\n\nSau 5 ngày, dự án nhỏ của mình đã hoàn thành, cũng đã deploy và hiện giờ mình cũng đang sử dụng.\n\nChức năng thì vô cùng đơn giản, nhưng cũng tốn khá nhiều thời gian. Lý do là mình host BE trên heroku với gói free, nên cũng phải căn chỉnh đầu đuôi đảm bảo chạy được cho 10k users chứ :)\n\nQua dự án nhỏ này mình cũng học thêm được vài thứ hay ho, không liên quan đến coding (lý do là có quá ít chức năng và app quá đơn giản nên cũng chả có gì để mà improve như phim).\n\nNhững điều mình học được là cách tiếp cận vấn đề, đứng góc nhìn của user chứ **không tự overskill những thứ không quan trọng**, mình nghĩ **nhận thức về UX của mình cũng đã được mở mang**, UI tuy xấu nhưng mình tin là UX của mình đang ổn. Ngoài ra với tài nguyên và thời gian hữu hạn, **tự lên chiến lược**, thực hiện và triển khai dự án nhỏ này cũng giúp mình lên kế hoạch tốt hơn, chính mình và có thể cả bạn, người đọc những dòng này đã từng nhiều lần lên kế hoạch làm gì đó nhưng cuối cùng lại không bao giờ làm.\n\nHiện giờ cái app đơn giản của mình đã có 1k user đăng ký và sấp xỉ 100 user active hàng ngày. À sao lại lên nhanh như vậy á hả? Cái này là nhờ cậu bạn mình có cái page gần 50K like trên FB, nên mình mượn PR chút đỉnh. Hơn thế có 2 user rất trung thành đó là mình và vợ, coi như vậy đã thành công 1 phần, bản chất side project mà người viết ra lại không dùng được thì coi như thất bại.\n\nÀ còn về phương pháp Spaced Repetition, mình lấy cảm hứng từ bài viết dưới đây, các bạn đọc thử nhé, tạo rất nhiều động lực để nhớ cả thế giới =))) Còn làm được hay không thì vẫn là dấu hỏi. Bài viết này mình đọc được thông qua getpocket.\n\n[https://ncase.me/remember/](https://ncase.me/remember/)\n","source":"_posts/2020-06-27-viet-side-project.md","raw":"---\ntitle: \"Side Project Tiếp Theo\"\ndate: 2020-06-27\n---\n\nChuyện là mình vừa nghỉ làm ở công ty cũ, trong thời gian về nhà trước khi tìm việc mới, mình quyết định làm một side project nhỏ tiếp theo.\n\nÝ tưởng của project này đến từ 2 nguồn cảm hứng:\n1. Sự lười học Tiếng Anh đến cùng cực của mình.\n2. Phương pháp Spaced Repetition.\n\nVà thế là một Web App để học từ vựng tiếng anh lại được ra đời, mặc cho đã có biết bao nhiêu App có chức năng tương tự.\n\nSau 5 ngày, dự án nhỏ của mình đã hoàn thành, cũng đã deploy và hiện giờ mình cũng đang sử dụng.\n\nChức năng thì vô cùng đơn giản, nhưng cũng tốn khá nhiều thời gian. Lý do là mình host BE trên heroku với gói free, nên cũng phải căn chỉnh đầu đuôi đảm bảo chạy được cho 10k users chứ :)\n\nQua dự án nhỏ này mình cũng học thêm được vài thứ hay ho, không liên quan đến coding (lý do là có quá ít chức năng và app quá đơn giản nên cũng chả có gì để mà improve như phim).\n\nNhững điều mình học được là cách tiếp cận vấn đề, đứng góc nhìn của user chứ **không tự overskill những thứ không quan trọng**, mình nghĩ **nhận thức về UX của mình cũng đã được mở mang**, UI tuy xấu nhưng mình tin là UX của mình đang ổn. Ngoài ra với tài nguyên và thời gian hữu hạn, **tự lên chiến lược**, thực hiện và triển khai dự án nhỏ này cũng giúp mình lên kế hoạch tốt hơn, chính mình và có thể cả bạn, người đọc những dòng này đã từng nhiều lần lên kế hoạch làm gì đó nhưng cuối cùng lại không bao giờ làm.\n\nHiện giờ cái app đơn giản của mình đã có 1k user đăng ký và sấp xỉ 100 user active hàng ngày. À sao lại lên nhanh như vậy á hả? Cái này là nhờ cậu bạn mình có cái page gần 50K like trên FB, nên mình mượn PR chút đỉnh. Hơn thế có 2 user rất trung thành đó là mình và vợ, coi như vậy đã thành công 1 phần, bản chất side project mà người viết ra lại không dùng được thì coi như thất bại.\n\nÀ còn về phương pháp Spaced Repetition, mình lấy cảm hứng từ bài viết dưới đây, các bạn đọc thử nhé, tạo rất nhiều động lực để nhớ cả thế giới =))) Còn làm được hay không thì vẫn là dấu hỏi. Bài viết này mình đọc được thông qua getpocket.\n\n[https://ncase.me/remember/](https://ncase.me/remember/)\n","slug":"2020-06-27-viet-side-project","published":1,"updated":"2022-01-29T09:29:59.930Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbr004fp3m20qwz5xwb","content":"<p>Chuyện là mình vừa nghỉ làm ở công ty cũ, trong thời gian về nhà trước khi tìm việc mới, mình quyết định làm một side project nhỏ tiếp theo.</p>\n<p>Ý tưởng của project này đến từ 2 nguồn cảm hứng:</p>\n<ol>\n<li>Sự lười học Tiếng Anh đến cùng cực của mình.</li>\n<li>Phương pháp Spaced Repetition.</li>\n</ol>\n<p>Và thế là một Web App để học từ vựng tiếng anh lại được ra đời, mặc cho đã có biết bao nhiêu App có chức năng tương tự.</p>\n<p>Sau 5 ngày, dự án nhỏ của mình đã hoàn thành, cũng đã deploy và hiện giờ mình cũng đang sử dụng.</p>\n<p>Chức năng thì vô cùng đơn giản, nhưng cũng tốn khá nhiều thời gian. Lý do là mình host BE trên heroku với gói free, nên cũng phải căn chỉnh đầu đuôi đảm bảo chạy được cho 10k users chứ :)</p>\n<p>Qua dự án nhỏ này mình cũng học thêm được vài thứ hay ho, không liên quan đến coding (lý do là có quá ít chức năng và app quá đơn giản nên cũng chả có gì để mà improve như phim).</p>\n<p>Những điều mình học được là cách tiếp cận vấn đề, đứng góc nhìn của user chứ <strong>không tự overskill những thứ không quan trọng</strong>, mình nghĩ <strong>nhận thức về UX của mình cũng đã được mở mang</strong>, UI tuy xấu nhưng mình tin là UX của mình đang ổn. Ngoài ra với tài nguyên và thời gian hữu hạn, <strong>tự lên chiến lược</strong>, thực hiện và triển khai dự án nhỏ này cũng giúp mình lên kế hoạch tốt hơn, chính mình và có thể cả bạn, người đọc những dòng này đã từng nhiều lần lên kế hoạch làm gì đó nhưng cuối cùng lại không bao giờ làm.</p>\n<p>Hiện giờ cái app đơn giản của mình đã có 1k user đăng ký và sấp xỉ 100 user active hàng ngày. À sao lại lên nhanh như vậy á hả? Cái này là nhờ cậu bạn mình có cái page gần 50K like trên FB, nên mình mượn PR chút đỉnh. Hơn thế có 2 user rất trung thành đó là mình và vợ, coi như vậy đã thành công 1 phần, bản chất side project mà người viết ra lại không dùng được thì coi như thất bại.</p>\n<p>À còn về phương pháp Spaced Repetition, mình lấy cảm hứng từ bài viết dưới đây, các bạn đọc thử nhé, tạo rất nhiều động lực để nhớ cả thế giới =))) Còn làm được hay không thì vẫn là dấu hỏi. Bài viết này mình đọc được thông qua getpocket.</p>\n<p><a href=\"https://ncase.me/remember/\" target=\"_blank\" rel=\"noopener\">https://ncase.me/remember/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Chuyện là mình vừa nghỉ làm ở công ty cũ, trong thời gian về nhà trước khi tìm việc mới, mình quyết định làm một side project nhỏ tiếp theo.</p>\n<p>Ý tưởng của project này đến từ 2 nguồn cảm hứng:</p>\n<ol>\n<li>Sự lười học Tiếng Anh đến cùng cực của mình.</li>\n<li>Phương pháp Spaced Repetition.</li>\n</ol>\n<p>Và thế là một Web App để học từ vựng tiếng anh lại được ra đời, mặc cho đã có biết bao nhiêu App có chức năng tương tự.</p>\n<p>Sau 5 ngày, dự án nhỏ của mình đã hoàn thành, cũng đã deploy và hiện giờ mình cũng đang sử dụng.</p>\n<p>Chức năng thì vô cùng đơn giản, nhưng cũng tốn khá nhiều thời gian. Lý do là mình host BE trên heroku với gói free, nên cũng phải căn chỉnh đầu đuôi đảm bảo chạy được cho 10k users chứ :)</p>\n<p>Qua dự án nhỏ này mình cũng học thêm được vài thứ hay ho, không liên quan đến coding (lý do là có quá ít chức năng và app quá đơn giản nên cũng chả có gì để mà improve như phim).</p>\n<p>Những điều mình học được là cách tiếp cận vấn đề, đứng góc nhìn của user chứ <strong>không tự overskill những thứ không quan trọng</strong>, mình nghĩ <strong>nhận thức về UX của mình cũng đã được mở mang</strong>, UI tuy xấu nhưng mình tin là UX của mình đang ổn. Ngoài ra với tài nguyên và thời gian hữu hạn, <strong>tự lên chiến lược</strong>, thực hiện và triển khai dự án nhỏ này cũng giúp mình lên kế hoạch tốt hơn, chính mình và có thể cả bạn, người đọc những dòng này đã từng nhiều lần lên kế hoạch làm gì đó nhưng cuối cùng lại không bao giờ làm.</p>\n<p>Hiện giờ cái app đơn giản của mình đã có 1k user đăng ký và sấp xỉ 100 user active hàng ngày. À sao lại lên nhanh như vậy á hả? Cái này là nhờ cậu bạn mình có cái page gần 50K like trên FB, nên mình mượn PR chút đỉnh. Hơn thế có 2 user rất trung thành đó là mình và vợ, coi như vậy đã thành công 1 phần, bản chất side project mà người viết ra lại không dùng được thì coi như thất bại.</p>\n<p>À còn về phương pháp Spaced Repetition, mình lấy cảm hứng từ bài viết dưới đây, các bạn đọc thử nhé, tạo rất nhiều động lực để nhớ cả thế giới =))) Còn làm được hay không thì vẫn là dấu hỏi. Bài viết này mình đọc được thông qua getpocket.</p>\n<p><a href=\"https://ncase.me/remember/\" target=\"_blank\" rel=\"noopener\">https://ncase.me/remember/</a></p>\n"},{"title":"Bad way to deploy Rails project to EC2","date":"2022-06-17T17:00:00.000Z","_content":"\n## 1. Setup Docker\n\n```bash\nsudo apt-get update\n```\n\n```bash\nsudo apt-get install \\\n    ca-certificates \\\n    curl \\\n    gnupg \\\n    lsb-release\n```\n\n```bash\nsudo mkdir -p /etc/apt/keyrings\n```\n\n```bash\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\n```\n\n```bash\n echo \\\n  \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\\n  $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n```\n\n```bash\nsudo apt-get update\n```\n\n```bash\nsudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin\n```\n\n```bash\nsudo usermod -aG docker $USER\n```\n\n```bash\nsudo docker run hello-world\n```\n\n## 2. Setup docker compose\n\n```bash\nsudo apt-get update\n```\n\n```bash\nsudo apt-get install docker-compose-plugin\n```\n\n```bash\ndocker compose version\n```\n\n## 3. Pull source code to EC2\n\n## 4. Build docker images\n\n```bash\ndocker compose build\n```\n\n## 5. Run docker container\n\n```bash\ndocker compose up -d\n```\n\n## References\n[1][https://docs.docker.com/engine/install/ubuntu/#install-docker-engine](https://docs.docker.com/engine/install/ubuntu/#install-docker-engine)\n[2][https://docs.docker.com/compose/install/compose-plugin/#install-using-the-repository](https://docs.docker.com/compose/install/compose-plugin/#install-using-the-repository)\n","source":"_posts/2022-02-01-docker-2021.md","raw":"---\ntitle: Bad way to deploy Rails project to EC2\ndate: 2022-06-18\n---\n\n## 1. Setup Docker\n\n```bash\nsudo apt-get update\n```\n\n```bash\nsudo apt-get install \\\n    ca-certificates \\\n    curl \\\n    gnupg \\\n    lsb-release\n```\n\n```bash\nsudo mkdir -p /etc/apt/keyrings\n```\n\n```bash\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\n```\n\n```bash\n echo \\\n  \"deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\\n  $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n```\n\n```bash\nsudo apt-get update\n```\n\n```bash\nsudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin\n```\n\n```bash\nsudo usermod -aG docker $USER\n```\n\n```bash\nsudo docker run hello-world\n```\n\n## 2. Setup docker compose\n\n```bash\nsudo apt-get update\n```\n\n```bash\nsudo apt-get install docker-compose-plugin\n```\n\n```bash\ndocker compose version\n```\n\n## 3. Pull source code to EC2\n\n## 4. Build docker images\n\n```bash\ndocker compose build\n```\n\n## 5. Run docker container\n\n```bash\ndocker compose up -d\n```\n\n## References\n[1][https://docs.docker.com/engine/install/ubuntu/#install-docker-engine](https://docs.docker.com/engine/install/ubuntu/#install-docker-engine)\n[2][https://docs.docker.com/compose/install/compose-plugin/#install-using-the-repository](https://docs.docker.com/compose/install/compose-plugin/#install-using-the-repository)\n","slug":"2022-02-01-docker-2021","published":1,"updated":"2022-06-18T08:36:29.946Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbr004hp3m24x5s8lbz","content":"<h2 id=\"1-Setup-Docker\"><a href=\"#1-Setup-Docker\" class=\"headerlink\" title=\"1. Setup Docker\"></a>1. Setup Docker</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install \\</span><br><span class=\"line\">    ca-certificates \\</span><br><span class=\"line\">    curl \\</span><br><span class=\"line\">    gnupg \\</span><br><span class=\"line\">    lsb-release</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /etc/apt/keyrings</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> \\</span><br><span class=\"line\"> <span class=\"string\">\"deb [arch=<span class=\"variable\">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\</span></span><br><span class=\"line\"><span class=\"string\"> <span class=\"variable\">$(lsb_release -cs)</span> stable\"</span> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo usermod -aG docker <span class=\"variable\">$USER</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run hello-world</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Setup-docker-compose\"><a href=\"#2-Setup-docker-compose\" class=\"headerlink\" title=\"2. Setup docker compose\"></a>2. Setup docker compose</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install docker-compose-plugin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose version</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-Pull-source-code-to-EC2\"><a href=\"#3-Pull-source-code-to-EC2\" class=\"headerlink\" title=\"3. Pull source code to EC2\"></a>3. Pull source code to EC2</h2><h2 id=\"4-Build-docker-images\"><a href=\"#4-Build-docker-images\" class=\"headerlink\" title=\"4. Build docker images\"></a>4. Build docker images</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose build</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-Run-docker-container\"><a href=\"#5-Run-docker-container\" class=\"headerlink\" title=\"5. Run docker container\"></a>5. Run docker container</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><p>[1]<a href=\"https://docs.docker.com/engine/install/ubuntu/#install-docker-engine\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/engine/install/ubuntu/#install-docker-engine</a><br>[2]<a href=\"https://docs.docker.com/compose/install/compose-plugin/#install-using-the-repository\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/compose/install/compose-plugin/#install-using-the-repository</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Setup-Docker\"><a href=\"#1-Setup-Docker\" class=\"headerlink\" title=\"1. Setup Docker\"></a>1. Setup Docker</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install \\</span><br><span class=\"line\">    ca-certificates \\</span><br><span class=\"line\">    curl \\</span><br><span class=\"line\">    gnupg \\</span><br><span class=\"line\">    lsb-release</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /etc/apt/keyrings</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> \\</span><br><span class=\"line\"> <span class=\"string\">\"deb [arch=<span class=\"variable\">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\</span></span><br><span class=\"line\"><span class=\"string\"> <span class=\"variable\">$(lsb_release -cs)</span> stable\"</span> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo usermod -aG docker <span class=\"variable\">$USER</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo docker run hello-world</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Setup-docker-compose\"><a href=\"#2-Setup-docker-compose\" class=\"headerlink\" title=\"2. Setup docker compose\"></a>2. Setup docker compose</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get update</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install docker-compose-plugin</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose version</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-Pull-source-code-to-EC2\"><a href=\"#3-Pull-source-code-to-EC2\" class=\"headerlink\" title=\"3. Pull source code to EC2\"></a>3. Pull source code to EC2</h2><h2 id=\"4-Build-docker-images\"><a href=\"#4-Build-docker-images\" class=\"headerlink\" title=\"4. Build docker images\"></a>4. Build docker images</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose build</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"5-Run-docker-container\"><a href=\"#5-Run-docker-container\" class=\"headerlink\" title=\"5. Run docker container\"></a>5. Run docker container</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker compose up -d</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><p>[1]<a href=\"https://docs.docker.com/engine/install/ubuntu/#install-docker-engine\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/engine/install/ubuntu/#install-docker-engine</a><br>[2]<a href=\"https://docs.docker.com/compose/install/compose-plugin/#install-using-the-repository\" target=\"_blank\" rel=\"noopener\">https://docs.docker.com/compose/install/compose-plugin/#install-using-the-repository</a></p>\n"},{"title":"Leetcode Tracking List","date":"2020-07-02T17:00:00.000Z","label":"#note","_content":"\n## 1. Array\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/two-sum/      |  3/7/2020 | normal |\n|2| https://leetcode.com/problems/container-with-most-water/     | 3/7/2020  |  high |\n|3| https://leetcode.com/problems/remove-duplicates-from-sorted-array/ | 4/7/2020 | high|\n\n## 2. Hash\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/two-sum/      | n/a | normal |\n|2| https://leetcode.com/problems/single-number/    | n/a | normal |\n|3| https://leetcode.com/problems/valid-anagram/   | n/a | high |\n|4| https://leetcode.com/problems/group-anagrams/   | n/a | high |\n|5| https://leetcode.com/problems/contains-duplicate/   | n/a | high |\n|6| https://leetcode.com/problems/top-k-frequent-elements/   | n/a | high |\n\n\n## 4. Search\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/two-sum/      | n/a | n/a |\n|2| https://leetcode.com/problems/container-with-most-water/     | n/a   |  n/a |\n\n## 5. Sort\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/two-sum/      | n/a | n/a |\n|2| https://leetcode.com/problems/container-with-most-water/     | n/a   |  n/a |\n\n## 6. Linked List\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/two-sum/      | n/a | n/a |\n|2| https://leetcode.com/problems/container-with-most-water/     | n/a   |  n/a |\n\n## 7. Sliding Window\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1|https://leetcode.com/problems/longest-substring-without-repeating-characters/     | n/a | high |\n\n## 7. SQL\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/combine-two-tables/ | n/a | high |\n|2| https://leetcode.com/problems/second-highest-salary/| n/a | high |\n|3| https://leetcode.com/problems/employees-earning-more-than-their-managers/submissions/| n/a | high |\n|4|https://leetcode.com/problems/duplicate-emails/| n/a | high |\n|5|https://leetcode.com/problems/customers-who-never-order/| n/a | high |\n|6|https://leetcode.com/problems/delete-duplicate-emails/solution/| n/a | high |\n|7|https://leetcode.com/problems/not-boring-movies/submissions/| n/a | high |\n|7|https://leetcode.com/problems/classes-more-than-5-students/ |n/a | high |\n|8|https://leetcode.com/problems/swap-salary/|n/a | high |\n\n## References\n\n[1][https://hackernoon.com/14-patterns-to-ace-any-coding-interview-question-c5bb3357f6ed](https://hackernoon.com/14-patterns-to-ace-any-coding-interview-question-c5bb3357f6ed)\n[2][https://stackoverflow.com/questions/8269916/what-is-sliding-window-algorithm-examples](https://stackoverflow.com/questions/8269916/what-is-sliding-window-algorithm-examples)\n[3][https://medium.com/outco/how-to-solve-sliding-window-problems-28d67601a66](https://medium.com/outco/how-to-solve-sliding-window-problems-28d67601a66)\n[4][https://www.geeksforgeeks.org/window-sliding-technique/](https://www.geeksforgeeks.org/window-sliding-technique/)\n[5][https://www.w3schools.com/sql/exercise.asp](https://www.w3schools.com/sql/exercise.asp)\n[6][https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/intro/src/art/bkntjoin.gif](https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/intro/src/art/bkntjoin.gif)\n","source":"_posts/2020-07-03-leetcode-track-list.md","raw":"---\ntitle: \"Leetcode Tracking List\"\ndate: 2020-07-03\nlabel: \"#note\"\n---\n\n## 1. Array\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/two-sum/      |  3/7/2020 | normal |\n|2| https://leetcode.com/problems/container-with-most-water/     | 3/7/2020  |  high |\n|3| https://leetcode.com/problems/remove-duplicates-from-sorted-array/ | 4/7/2020 | high|\n\n## 2. Hash\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/two-sum/      | n/a | normal |\n|2| https://leetcode.com/problems/single-number/    | n/a | normal |\n|3| https://leetcode.com/problems/valid-anagram/   | n/a | high |\n|4| https://leetcode.com/problems/group-anagrams/   | n/a | high |\n|5| https://leetcode.com/problems/contains-duplicate/   | n/a | high |\n|6| https://leetcode.com/problems/top-k-frequent-elements/   | n/a | high |\n\n\n## 4. Search\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/two-sum/      | n/a | n/a |\n|2| https://leetcode.com/problems/container-with-most-water/     | n/a   |  n/a |\n\n## 5. Sort\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/two-sum/      | n/a | n/a |\n|2| https://leetcode.com/problems/container-with-most-water/     | n/a   |  n/a |\n\n## 6. Linked List\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/two-sum/      | n/a | n/a |\n|2| https://leetcode.com/problems/container-with-most-water/     | n/a   |  n/a |\n\n## 7. Sliding Window\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1|https://leetcode.com/problems/longest-substring-without-repeating-characters/     | n/a | high |\n\n## 7. SQL\n\n| Order | Question        | Last Time           | Priority  |\n| --: | ------------- |:-------------:| -----:|\n|1| https://leetcode.com/problems/combine-two-tables/ | n/a | high |\n|2| https://leetcode.com/problems/second-highest-salary/| n/a | high |\n|3| https://leetcode.com/problems/employees-earning-more-than-their-managers/submissions/| n/a | high |\n|4|https://leetcode.com/problems/duplicate-emails/| n/a | high |\n|5|https://leetcode.com/problems/customers-who-never-order/| n/a | high |\n|6|https://leetcode.com/problems/delete-duplicate-emails/solution/| n/a | high |\n|7|https://leetcode.com/problems/not-boring-movies/submissions/| n/a | high |\n|7|https://leetcode.com/problems/classes-more-than-5-students/ |n/a | high |\n|8|https://leetcode.com/problems/swap-salary/|n/a | high |\n\n## References\n\n[1][https://hackernoon.com/14-patterns-to-ace-any-coding-interview-question-c5bb3357f6ed](https://hackernoon.com/14-patterns-to-ace-any-coding-interview-question-c5bb3357f6ed)\n[2][https://stackoverflow.com/questions/8269916/what-is-sliding-window-algorithm-examples](https://stackoverflow.com/questions/8269916/what-is-sliding-window-algorithm-examples)\n[3][https://medium.com/outco/how-to-solve-sliding-window-problems-28d67601a66](https://medium.com/outco/how-to-solve-sliding-window-problems-28d67601a66)\n[4][https://www.geeksforgeeks.org/window-sliding-technique/](https://www.geeksforgeeks.org/window-sliding-technique/)\n[5][https://www.w3schools.com/sql/exercise.asp](https://www.w3schools.com/sql/exercise.asp)\n[6][https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/intro/src/art/bkntjoin.gif](https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/intro/src/art/bkntjoin.gif)\n","slug":"2020-07-03-leetcode-track-list","published":1,"updated":"2022-01-29T09:34:22.460Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbs004ip3m20rdrfavb","content":"<h2 id=\"1-Array\"><a href=\"#1-Array\" class=\"headerlink\" title=\"1. Array\"></a>1. Array</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/two-sum/</a></td>\n<td align=\"center\">3/7/2020</td>\n<td align=\"right\">normal</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/container-with-most-water/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/container-with-most-water/</a></td>\n<td align=\"center\">3/7/2020</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">3</td>\n<td><a href=\"https://leetcode.com/problems/remove-duplicates-from-sorted-array/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/remove-duplicates-from-sorted-array/</a></td>\n<td align=\"center\">4/7/2020</td>\n<td align=\"right\">high</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-Hash\"><a href=\"#2-Hash\" class=\"headerlink\" title=\"2. Hash\"></a>2. Hash</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/two-sum/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">normal</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/single-number/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/single-number/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">normal</td>\n</tr>\n<tr>\n<td align=\"right\">3</td>\n<td><a href=\"https://leetcode.com/problems/valid-anagram/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/valid-anagram/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">4</td>\n<td><a href=\"https://leetcode.com/problems/group-anagrams/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/group-anagrams/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">5</td>\n<td><a href=\"https://leetcode.com/problems/contains-duplicate/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/contains-duplicate/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">6</td>\n<td><a href=\"https://leetcode.com/problems/top-k-frequent-elements/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/top-k-frequent-elements/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n</tbody></table>\n<h2 id=\"4-Search\"><a href=\"#4-Search\" class=\"headerlink\" title=\"4. Search\"></a>4. Search</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/two-sum/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/container-with-most-water/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/container-with-most-water/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n</tbody></table>\n<h2 id=\"5-Sort\"><a href=\"#5-Sort\" class=\"headerlink\" title=\"5. Sort\"></a>5. Sort</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/two-sum/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/container-with-most-water/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/container-with-most-water/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n</tbody></table>\n<h2 id=\"6-Linked-List\"><a href=\"#6-Linked-List\" class=\"headerlink\" title=\"6. Linked List\"></a>6. Linked List</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/two-sum/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/container-with-most-water/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/container-with-most-water/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n</tbody></table>\n<h2 id=\"7-Sliding-Window\"><a href=\"#7-Sliding-Window\" class=\"headerlink\" title=\"7. Sliding Window\"></a>7. Sliding Window</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/longest-substring-without-repeating-characters/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/longest-substring-without-repeating-characters/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n</tbody></table>\n<h2 id=\"7-SQL\"><a href=\"#7-SQL\" class=\"headerlink\" title=\"7. SQL\"></a>7. SQL</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/combine-two-tables/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/combine-two-tables/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/second-highest-salary/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/second-highest-salary/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">3</td>\n<td><a href=\"https://leetcode.com/problems/employees-earning-more-than-their-managers/submissions/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/employees-earning-more-than-their-managers/submissions/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">4</td>\n<td><a href=\"https://leetcode.com/problems/duplicate-emails/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/duplicate-emails/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">5</td>\n<td><a href=\"https://leetcode.com/problems/customers-who-never-order/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/customers-who-never-order/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">6</td>\n<td><a href=\"https://leetcode.com/problems/delete-duplicate-emails/solution/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/delete-duplicate-emails/solution/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">7</td>\n<td><a href=\"https://leetcode.com/problems/not-boring-movies/submissions/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/not-boring-movies/submissions/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">7</td>\n<td><a href=\"https://leetcode.com/problems/classes-more-than-5-students/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/classes-more-than-5-students/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">8</td>\n<td><a href=\"https://leetcode.com/problems/swap-salary/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/swap-salary/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n</tbody></table>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><p>[1]<a href=\"https://hackernoon.com/14-patterns-to-ace-any-coding-interview-question-c5bb3357f6ed\" target=\"_blank\" rel=\"noopener\">https://hackernoon.com/14-patterns-to-ace-any-coding-interview-question-c5bb3357f6ed</a><br>[2]<a href=\"https://stackoverflow.com/questions/8269916/what-is-sliding-window-algorithm-examples\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/8269916/what-is-sliding-window-algorithm-examples</a><br>[3]<a href=\"https://medium.com/outco/how-to-solve-sliding-window-problems-28d67601a66\" target=\"_blank\" rel=\"noopener\">https://medium.com/outco/how-to-solve-sliding-window-problems-28d67601a66</a><br>[4]<a href=\"https://www.geeksforgeeks.org/window-sliding-technique/\" target=\"_blank\" rel=\"noopener\">https://www.geeksforgeeks.org/window-sliding-technique/</a><br>[5]<a href=\"https://www.w3schools.com/sql/exercise.asp\" target=\"_blank\" rel=\"noopener\">https://www.w3schools.com/sql/exercise.asp</a><br>[6]<a href=\"https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/intro/src/art/bkntjoin.gif\" target=\"_blank\" rel=\"noopener\">https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/intro/src/art/bkntjoin.gif</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Array\"><a href=\"#1-Array\" class=\"headerlink\" title=\"1. Array\"></a>1. Array</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/two-sum/</a></td>\n<td align=\"center\">3/7/2020</td>\n<td align=\"right\">normal</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/container-with-most-water/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/container-with-most-water/</a></td>\n<td align=\"center\">3/7/2020</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">3</td>\n<td><a href=\"https://leetcode.com/problems/remove-duplicates-from-sorted-array/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/remove-duplicates-from-sorted-array/</a></td>\n<td align=\"center\">4/7/2020</td>\n<td align=\"right\">high</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-Hash\"><a href=\"#2-Hash\" class=\"headerlink\" title=\"2. Hash\"></a>2. Hash</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/two-sum/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">normal</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/single-number/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/single-number/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">normal</td>\n</tr>\n<tr>\n<td align=\"right\">3</td>\n<td><a href=\"https://leetcode.com/problems/valid-anagram/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/valid-anagram/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">4</td>\n<td><a href=\"https://leetcode.com/problems/group-anagrams/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/group-anagrams/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">5</td>\n<td><a href=\"https://leetcode.com/problems/contains-duplicate/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/contains-duplicate/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">6</td>\n<td><a href=\"https://leetcode.com/problems/top-k-frequent-elements/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/top-k-frequent-elements/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n</tbody></table>\n<h2 id=\"4-Search\"><a href=\"#4-Search\" class=\"headerlink\" title=\"4. Search\"></a>4. Search</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/two-sum/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/container-with-most-water/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/container-with-most-water/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n</tbody></table>\n<h2 id=\"5-Sort\"><a href=\"#5-Sort\" class=\"headerlink\" title=\"5. Sort\"></a>5. Sort</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/two-sum/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/container-with-most-water/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/container-with-most-water/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n</tbody></table>\n<h2 id=\"6-Linked-List\"><a href=\"#6-Linked-List\" class=\"headerlink\" title=\"6. Linked List\"></a>6. Linked List</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/two-sum/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/two-sum/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/container-with-most-water/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/container-with-most-water/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">n/a</td>\n</tr>\n</tbody></table>\n<h2 id=\"7-Sliding-Window\"><a href=\"#7-Sliding-Window\" class=\"headerlink\" title=\"7. Sliding Window\"></a>7. Sliding Window</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/longest-substring-without-repeating-characters/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/longest-substring-without-repeating-characters/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n</tbody></table>\n<h2 id=\"7-SQL\"><a href=\"#7-SQL\" class=\"headerlink\" title=\"7. SQL\"></a>7. SQL</h2><table>\n<thead>\n<tr>\n<th align=\"right\">Order</th>\n<th>Question</th>\n<th align=\"center\">Last Time</th>\n<th align=\"right\">Priority</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"right\">1</td>\n<td><a href=\"https://leetcode.com/problems/combine-two-tables/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/combine-two-tables/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">2</td>\n<td><a href=\"https://leetcode.com/problems/second-highest-salary/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/second-highest-salary/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">3</td>\n<td><a href=\"https://leetcode.com/problems/employees-earning-more-than-their-managers/submissions/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/employees-earning-more-than-their-managers/submissions/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">4</td>\n<td><a href=\"https://leetcode.com/problems/duplicate-emails/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/duplicate-emails/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">5</td>\n<td><a href=\"https://leetcode.com/problems/customers-who-never-order/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/customers-who-never-order/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">6</td>\n<td><a href=\"https://leetcode.com/problems/delete-duplicate-emails/solution/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/delete-duplicate-emails/solution/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">7</td>\n<td><a href=\"https://leetcode.com/problems/not-boring-movies/submissions/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/not-boring-movies/submissions/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">7</td>\n<td><a href=\"https://leetcode.com/problems/classes-more-than-5-students/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/classes-more-than-5-students/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n<tr>\n<td align=\"right\">8</td>\n<td><a href=\"https://leetcode.com/problems/swap-salary/\" target=\"_blank\" rel=\"noopener\">https://leetcode.com/problems/swap-salary/</a></td>\n<td align=\"center\">n/a</td>\n<td align=\"right\">high</td>\n</tr>\n</tbody></table>\n<h2 id=\"References\"><a href=\"#References\" class=\"headerlink\" title=\"References\"></a>References</h2><p>[1]<a href=\"https://hackernoon.com/14-patterns-to-ace-any-coding-interview-question-c5bb3357f6ed\" target=\"_blank\" rel=\"noopener\">https://hackernoon.com/14-patterns-to-ace-any-coding-interview-question-c5bb3357f6ed</a><br>[2]<a href=\"https://stackoverflow.com/questions/8269916/what-is-sliding-window-algorithm-examples\" target=\"_blank\" rel=\"noopener\">https://stackoverflow.com/questions/8269916/what-is-sliding-window-algorithm-examples</a><br>[3]<a href=\"https://medium.com/outco/how-to-solve-sliding-window-problems-28d67601a66\" target=\"_blank\" rel=\"noopener\">https://medium.com/outco/how-to-solve-sliding-window-problems-28d67601a66</a><br>[4]<a href=\"https://www.geeksforgeeks.org/window-sliding-technique/\" target=\"_blank\" rel=\"noopener\">https://www.geeksforgeeks.org/window-sliding-technique/</a><br>[5]<a href=\"https://www.w3schools.com/sql/exercise.asp\" target=\"_blank\" rel=\"noopener\">https://www.w3schools.com/sql/exercise.asp</a><br>[6]<a href=\"https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/intro/src/art/bkntjoin.gif\" target=\"_blank\" rel=\"noopener\">https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/intro/src/art/bkntjoin.gif</a></p>\n"},{"title":"Gọi API Tại Frontend","date":"2020-06-27T17:00:00.000Z","label":"#note","_content":"\n## 1. Fetch\n\nFetch là một module được tích hợp sẵn trong các trình duyệt, điều đó có nghĩa là không phải tất cả các trình duyệt cũ đều có thể sử dụng fetch.\n\nƯu điểm là không cần cài thêm package cho phần xử lý API. Nhược điểm là chỉ dùng cho ứng dụng chạy với trình duyệt.\n\nĐối tượng được trả về là dạng Stream, đồng nghĩa với việc phải convert khi gửi data lẫn khi nhận data.\n\n### 1.1 Fetch với async await\n\n```\nasync function getCats() {\n  try {\n    const url = \"http://localhost:4000/api/v1/cats\";\n    const response = await fetch(url);\n    const responseJSON = await response.json();\n\n    return responseJSON.data;\n  } catch (err) {\n    return [];\n  }\n}\n\n// Set data to state\ngetCats().then((cats) => {\n  this.setState({ cats });\n});\n```\n\n### 1.2 Fetch với Promise\n\n```javascript\nconst url = \"http://localhost:4000/api/v1/cats\";\nconst _this = this;\n\nfetch(url)\n.then(\n  function(response) {\n    // .json() return a promise\n    response.json().then(data => {\n      _this.setState({\n        cats: data.data\n      });\n    })\n  }\n)\n.catch(err => {\n  console.log('Error:', err)\n});\n```\n\n###  1.3 Các ví dụ khác\n\n```javascript\n// Copy from: http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript\nfunction status(response) {\n  if (response.status >= 200 && response.status < 300) {\n    return Promise.resolve(response)\n  } else {\n    return Promise.reject(new Error(response.statusText))\n  }\n}\nfunction json(response) {\n  return response.json()\n}\n\nfetch('')\n  .then(status)\n  .then(json)\n  .then(data => {\n    console.log('Request succeeded with JSON response', data);\n  })\n  .catch(function(error) {\n    console.log('Request failed', error);\n  });\n\n\nfetch(url, {\n  method: 'POST',\n  headers: {\n    \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n  },\n  body: 'foo=bar&lorem=ipsum'\n})\n.then(json)\n.then(data => {\n  console.log('Request succeeded with JSON response', data);\n})\n.catch(error => {\n  console.log('Request failed', error);\n});\n\n// Post json object\nvar data = {username: 'example'};\n\nfetch(url, {\n  method: 'POST',\n  body: JSON.stringify(data),\n  headers:{\n    'Content-Type': 'application/json'\n  }\n})\n.then(res => res.json())\n.then(response => console.log('Success:', JSON.stringify(response)))\n.catch(error => console.error('Error:', error))\n```\n\n## 2. Axios\n\n```javascript\naxios.get(`http://localhost:4000/api/v1/cats`)\n  .then(res => {\n    const persons = res.data;\n    this.setState({ cats });\n  })\n\nconst user = {\n  name: this.state.name\n};\n\naxios.post(`http://localhost:4000/api/v1/cats`, { user })\n  .then(res => {\n    console.log(res);\n    console.log(res.data);\n  })\n```\n\n## 3. References\n\n[1][http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript/](http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript/)\n[2][https://alligator.io/react/axios-react/](https://alligator.io/react/axios-react/)\n","source":"_posts/2020-06-28-goi-api-tu-fe.md","raw":"---\ntitle: \"Gọi API Tại Frontend\"\ndate: 2020-06-28\nlabel: \"#note\"\n---\n\n## 1. Fetch\n\nFetch là một module được tích hợp sẵn trong các trình duyệt, điều đó có nghĩa là không phải tất cả các trình duyệt cũ đều có thể sử dụng fetch.\n\nƯu điểm là không cần cài thêm package cho phần xử lý API. Nhược điểm là chỉ dùng cho ứng dụng chạy với trình duyệt.\n\nĐối tượng được trả về là dạng Stream, đồng nghĩa với việc phải convert khi gửi data lẫn khi nhận data.\n\n### 1.1 Fetch với async await\n\n```\nasync function getCats() {\n  try {\n    const url = \"http://localhost:4000/api/v1/cats\";\n    const response = await fetch(url);\n    const responseJSON = await response.json();\n\n    return responseJSON.data;\n  } catch (err) {\n    return [];\n  }\n}\n\n// Set data to state\ngetCats().then((cats) => {\n  this.setState({ cats });\n});\n```\n\n### 1.2 Fetch với Promise\n\n```javascript\nconst url = \"http://localhost:4000/api/v1/cats\";\nconst _this = this;\n\nfetch(url)\n.then(\n  function(response) {\n    // .json() return a promise\n    response.json().then(data => {\n      _this.setState({\n        cats: data.data\n      });\n    })\n  }\n)\n.catch(err => {\n  console.log('Error:', err)\n});\n```\n\n###  1.3 Các ví dụ khác\n\n```javascript\n// Copy from: http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript\nfunction status(response) {\n  if (response.status >= 200 && response.status < 300) {\n    return Promise.resolve(response)\n  } else {\n    return Promise.reject(new Error(response.statusText))\n  }\n}\nfunction json(response) {\n  return response.json()\n}\n\nfetch('')\n  .then(status)\n  .then(json)\n  .then(data => {\n    console.log('Request succeeded with JSON response', data);\n  })\n  .catch(function(error) {\n    console.log('Request failed', error);\n  });\n\n\nfetch(url, {\n  method: 'POST',\n  headers: {\n    \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n  },\n  body: 'foo=bar&lorem=ipsum'\n})\n.then(json)\n.then(data => {\n  console.log('Request succeeded with JSON response', data);\n})\n.catch(error => {\n  console.log('Request failed', error);\n});\n\n// Post json object\nvar data = {username: 'example'};\n\nfetch(url, {\n  method: 'POST',\n  body: JSON.stringify(data),\n  headers:{\n    'Content-Type': 'application/json'\n  }\n})\n.then(res => res.json())\n.then(response => console.log('Success:', JSON.stringify(response)))\n.catch(error => console.error('Error:', error))\n```\n\n## 2. Axios\n\n```javascript\naxios.get(`http://localhost:4000/api/v1/cats`)\n  .then(res => {\n    const persons = res.data;\n    this.setState({ cats });\n  })\n\nconst user = {\n  name: this.state.name\n};\n\naxios.post(`http://localhost:4000/api/v1/cats`, { user })\n  .then(res => {\n    console.log(res);\n    console.log(res.data);\n  })\n```\n\n## 3. References\n\n[1][http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript/](http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript/)\n[2][https://alligator.io/react/axios-react/](https://alligator.io/react/axios-react/)\n","slug":"2020-06-28-goi-api-tu-fe","published":1,"updated":"2022-01-31T13:24:08.245Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl4jmlsbs004lp3m2hudqbvwf","content":"<h2 id=\"1-Fetch\"><a href=\"#1-Fetch\" class=\"headerlink\" title=\"1. Fetch\"></a>1. Fetch</h2><p>Fetch là một module được tích hợp sẵn trong các trình duyệt, điều đó có nghĩa là không phải tất cả các trình duyệt cũ đều có thể sử dụng fetch.</p>\n<p>Ưu điểm là không cần cài thêm package cho phần xử lý API. Nhược điểm là chỉ dùng cho ứng dụng chạy với trình duyệt.</p>\n<p>Đối tượng được trả về là dạng Stream, đồng nghĩa với việc phải convert khi gửi data lẫn khi nhận data.</p>\n<h3 id=\"1-1-Fetch-voi-async-await\"><a href=\"#1-1-Fetch-voi-async-await\" class=\"headerlink\" title=\"1.1 Fetch với async await\"></a>1.1 Fetch với async await</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getCats</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> url = <span class=\"string\">\"http://localhost:4000/api/v1/cats\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> fetch(url);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> responseJSON = <span class=\"keyword\">await</span> response.json();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> responseJSON.data;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Set data to state</span></span><br><span class=\"line\">getCats().then(<span class=\"function\">(<span class=\"params\">cats</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.setState(&#123; cats &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-Fetch-voi-Promise\"><a href=\"#1-2-Fetch-voi-Promise\" class=\"headerlink\" title=\"1.2 Fetch với Promise\"></a>1.2 Fetch với Promise</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"string\">\"http://localhost:4000/api/v1/cats\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> _this = <span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">fetch(url)</span><br><span class=\"line\">.then(</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// .json() return a promise</span></span><br><span class=\"line\">    response.json().then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">      _this.setState(&#123;</span><br><span class=\"line\">        cats: data.data</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\">.catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Error:'</span>, err)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-3-Cac-vi-du-khac\"><a href=\"#1-3-Cac-vi-du-khac\" class=\"headerlink\" title=\"1.3 Các ví dụ khác\"></a>1.3 Các ví dụ khác</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy from: http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">status</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (response.status &gt;= <span class=\"number\">200</span> &amp;&amp; response.status &lt; <span class=\"number\">300</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve(response)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.reject(<span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(response.statusText))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">json</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> response.json()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fetch(<span class=\"string\">''</span>)</span><br><span class=\"line\">  .then(status)</span><br><span class=\"line\">  .then(json)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Request succeeded with JSON response'</span>, data);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Request failed'</span>, error);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">fetch(url, &#123;</span><br><span class=\"line\">  method: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">  headers: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"application/x-www-form-urlencoded; charset=UTF-8\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  body: <span class=\"string\">'foo=bar&amp;lorem=ipsum'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.then(json)</span><br><span class=\"line\">.then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Request succeeded with JSON response'</span>, data);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.catch(<span class=\"function\"><span class=\"params\">error</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Request failed'</span>, error);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Post json object</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> data = &#123;<span class=\"attr\">username</span>: <span class=\"string\">'example'</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">fetch(url, &#123;</span><br><span class=\"line\">  method: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">  body: <span class=\"built_in\">JSON</span>.stringify(data),</span><br><span class=\"line\">  headers:&#123;</span><br><span class=\"line\">    <span class=\"string\">'Content-Type'</span>: <span class=\"string\">'application/json'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> res.json())</span><br><span class=\"line\">.then(<span class=\"function\"><span class=\"params\">response</span> =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'Success:'</span>, <span class=\"built_in\">JSON</span>.stringify(response)))</span><br><span class=\"line\">.catch(<span class=\"function\"><span class=\"params\">error</span> =&gt;</span> <span class=\"built_in\">console</span>.error(<span class=\"string\">'Error:'</span>, error))</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Axios\"><a href=\"#2-Axios\" class=\"headerlink\" title=\"2. Axios\"></a>2. Axios</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">axios.get(<span class=\"string\">`http://localhost:4000/api/v1/cats`</span>)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> persons = res.data;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setState(&#123; cats &#125;);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> user = &#123;</span><br><span class=\"line\">  name: <span class=\"keyword\">this</span>.state.name</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">axios.post(<span class=\"string\">`http://localhost:4000/api/v1/cats`</span>, &#123; user &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res.data);</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-References\"><a href=\"#3-References\" class=\"headerlink\" title=\"3. References\"></a>3. References</h2><p>[1]<a href=\"http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript/\" target=\"_blank\" rel=\"noopener\">http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript/</a><br>[2]<a href=\"https://alligator.io/react/axios-react/\" target=\"_blank\" rel=\"noopener\">https://alligator.io/react/axios-react/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1-Fetch\"><a href=\"#1-Fetch\" class=\"headerlink\" title=\"1. Fetch\"></a>1. Fetch</h2><p>Fetch là một module được tích hợp sẵn trong các trình duyệt, điều đó có nghĩa là không phải tất cả các trình duyệt cũ đều có thể sử dụng fetch.</p>\n<p>Ưu điểm là không cần cài thêm package cho phần xử lý API. Nhược điểm là chỉ dùng cho ứng dụng chạy với trình duyệt.</p>\n<p>Đối tượng được trả về là dạng Stream, đồng nghĩa với việc phải convert khi gửi data lẫn khi nhận data.</p>\n<h3 id=\"1-1-Fetch-voi-async-await\"><a href=\"#1-1-Fetch-voi-async-await\" class=\"headerlink\" title=\"1.1 Fetch với async await\"></a>1.1 Fetch với async await</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getCats</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> url = <span class=\"string\">\"http://localhost:4000/api/v1/cats\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> response = <span class=\"keyword\">await</span> fetch(url);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> responseJSON = <span class=\"keyword\">await</span> response.json();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> responseJSON.data;</span><br><span class=\"line\">  &#125; <span class=\"keyword\">catch</span> (err) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Set data to state</span></span><br><span class=\"line\">getCats().then(<span class=\"function\">(<span class=\"params\">cats</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.setState(&#123; cats &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-Fetch-voi-Promise\"><a href=\"#1-2-Fetch-voi-Promise\" class=\"headerlink\" title=\"1.2 Fetch với Promise\"></a>1.2 Fetch với Promise</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> url = <span class=\"string\">\"http://localhost:4000/api/v1/cats\"</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> _this = <span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">fetch(url)</span><br><span class=\"line\">.then(</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// .json() return a promise</span></span><br><span class=\"line\">    response.json().then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">      _this.setState(&#123;</span><br><span class=\"line\">        cats: data.data</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">)</span><br><span class=\"line\">.catch(<span class=\"function\"><span class=\"params\">err</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Error:'</span>, err)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-3-Cac-vi-du-khac\"><a href=\"#1-3-Cac-vi-du-khac\" class=\"headerlink\" title=\"1.3 Các ví dụ khác\"></a>1.3 Các ví dụ khác</h3><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Copy from: http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">status</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (response.status &gt;= <span class=\"number\">200</span> &amp;&amp; response.status &lt; <span class=\"number\">300</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.resolve(response)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.reject(<span class=\"keyword\">new</span> <span class=\"built_in\">Error</span>(response.statusText))</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">json</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> response.json()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">fetch(<span class=\"string\">''</span>)</span><br><span class=\"line\">  .then(status)</span><br><span class=\"line\">  .then(json)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Request succeeded with JSON response'</span>, data);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">error</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Request failed'</span>, error);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">fetch(url, &#123;</span><br><span class=\"line\">  method: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">  headers: &#123;</span><br><span class=\"line\">    <span class=\"string\">\"Content-Type\"</span>: <span class=\"string\">\"application/x-www-form-urlencoded; charset=UTF-8\"</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  body: <span class=\"string\">'foo=bar&amp;lorem=ipsum'</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.then(json)</span><br><span class=\"line\">.then(<span class=\"function\"><span class=\"params\">data</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Request succeeded with JSON response'</span>, data);</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.catch(<span class=\"function\"><span class=\"params\">error</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'Request failed'</span>, error);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Post json object</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> data = &#123;<span class=\"attr\">username</span>: <span class=\"string\">'example'</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">fetch(url, &#123;</span><br><span class=\"line\">  method: <span class=\"string\">'POST'</span>,</span><br><span class=\"line\">  body: <span class=\"built_in\">JSON</span>.stringify(data),</span><br><span class=\"line\">  headers:&#123;</span><br><span class=\"line\">    <span class=\"string\">'Content-Type'</span>: <span class=\"string\">'application/json'</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">.then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> res.json())</span><br><span class=\"line\">.then(<span class=\"function\"><span class=\"params\">response</span> =&gt;</span> <span class=\"built_in\">console</span>.log(<span class=\"string\">'Success:'</span>, <span class=\"built_in\">JSON</span>.stringify(response)))</span><br><span class=\"line\">.catch(<span class=\"function\"><span class=\"params\">error</span> =&gt;</span> <span class=\"built_in\">console</span>.error(<span class=\"string\">'Error:'</span>, error))</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-Axios\"><a href=\"#2-Axios\" class=\"headerlink\" title=\"2. Axios\"></a>2. Axios</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">axios.get(<span class=\"string\">`http://localhost:4000/api/v1/cats`</span>)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> persons = res.data;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.setState(&#123; cats &#125;);</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> user = &#123;</span><br><span class=\"line\">  name: <span class=\"keyword\">this</span>.state.name</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">axios.post(<span class=\"string\">`http://localhost:4000/api/v1/cats`</span>, &#123; user &#125;)</span><br><span class=\"line\">  .then(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res.data);</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"3-References\"><a href=\"#3-References\" class=\"headerlink\" title=\"3. References\"></a>3. References</h2><p>[1]<a href=\"http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript/\" target=\"_blank\" rel=\"noopener\">http://vuilaptrinh.com/2018-10-01-huong-dan-gioi-thieu-fetch-javascript/</a><br>[2]<a href=\"https://alligator.io/react/axios-react/\" target=\"_blank\" rel=\"noopener\">https://alligator.io/react/axios-react/</a></p>\n"},{"title":"Put Images In The Header","date":"2022-01-30T17:00:00.000Z","photos":["/images/test/test1.jpg","/images/test/test2.jpg","/images/test/test3.jpg","/images/test/test4.jpg","/images/test/test5.jpg","/images/test/test6.jpg","/images/test/test7.jpg","/images/test/test8.jpg","/images/test/test9.jpg","/images/test/test10.jpg"],"_content":"","source":"_posts/2022-01-31-put-images-in-the-header.md","raw":"---\ntitle: Put Images In The Header\ndate: 2022-01-31\nphotos:\n- /images/test/test1.jpg\n- /images/test/test2.jpg\n- /images/test/test3.jpg\n- /images/test/test4.jpg\n- /images/test/test5.jpg\n- /images/test/test6.jpg\n- /images/test/test7.jpg\n- /images/test/test8.jpg\n- /images/test/test9.jpg\n- /images/test/test10.jpg\n---\n","slug":"2022-01-31-put-images-in-the-header","published":1,"updated":"2022-02-01T13:20:11.591Z","comments":1,"layout":"post","link":"","_id":"cl4jmlsbt004np3m24qtggdji","content":"","site":{"data":{}},"excerpt":"","more":""}],"PostAsset":[],"PostCategory":[{"post_id":"cl4jmls9t0000p3m29zu12hwq","category_id":"cl4jmlsa50003p3m25k1d0bwd","_id":"cl4jmlsad000ep3m20jobdq8g"},{"post_id":"cl4jmlsa20002p3m2dd183ajn","category_id":"cl4jmlsa50003p3m25k1d0bwd","_id":"cl4jmlsae000jp3m26uyq90nh"},{"post_id":"cl4jmlsad000hp3m20u4h4iwp","category_id":"cl4jmlsa50003p3m25k1d0bwd","_id":"cl4jmlsag000pp3m29ubo8mir"},{"post_id":"cl4jmlsa60005p3m2gcd2eidk","category_id":"cl4jmlsa50003p3m25k1d0bwd","_id":"cl4jmlsaj000sp3m2dgqdftrk"},{"post_id":"cl4jmlsae000ip3m25gc82b75","category_id":"cl4jmlsaf000np3m24nrshf9b","_id":"cl4jmlsal0010p3m2hjty2ipb"},{"post_id":"cl4jmlsak000xp3m2egka1dhz","category_id":"cl4jmlsaj000up3m2h7hq2bif","_id":"cl4jmlsaq0017p3m284yl38tn"},{"post_id":"cl4jmlsaf000mp3m2fmqielb1","category_id":"cl4jmlsaj000up3m2h7hq2bif","_id":"cl4jmlsar001ap3m20u1rb9vr"},{"post_id":"cl4jmlsak000zp3m2bsz05h09","category_id":"cl4jmlsaj000up3m2h7hq2bif","_id":"cl4jmlsat001dp3m2biegf6xy"},{"post_id":"cl4jmlsan0014p3m2afkldx31","category_id":"cl4jmlsaj000up3m2h7hq2bif","_id":"cl4jmlsau001hp3m23pjcci75"},{"post_id":"cl4jmlsaj000tp3m24olxbr6z","category_id":"cl4jmlsaj000up3m2h7hq2bif","_id":"cl4jmlsaw001kp3m2hr7l41o8"},{"post_id":"cl4jmlsat001cp3m25opih4xm","category_id":"cl4jmlsaf000np3m24nrshf9b","_id":"cl4jmlsaz001np3m202rs4oi1"},{"post_id":"cl4jmlsau001gp3m20s2u9j6i","category_id":"cl4jmlsaj000up3m2h7hq2bif","_id":"cl4jmlsb4001sp3m2gn74fa9l"},{"post_id":"cl4jmlsb5001zp3m2gr1p2vmr","category_id":"cl4jmlsb2001pp3m2e0763hdz","_id":"cl4jmlsb70029p3m2gug4fjeu"},{"post_id":"cl4jmlsax001mp3m2epto803r","category_id":"cl4jmlsb2001pp3m2e0763hdz","_id":"cl4jmlsb8002dp3m2eauj64ho"},{"post_id":"cl4jmlsb60022p3m242jha7ss","category_id":"cl4jmlsb2001pp3m2e0763hdz","_id":"cl4jmlsb8002hp3m23jngav66"},{"post_id":"cl4jmlsb3001rp3m24xpf63g1","category_id":"cl4jmlsb60023p3m219lwa81e","_id":"cl4jmlsb9002lp3m27e2mc6dh"},{"post_id":"cl4jmlsb70028p3m22412dup0","category_id":"cl4jmlsb2001pp3m2e0763hdz","_id":"cl4jmlsb9002op3m25x7gfidu"},{"post_id":"cl4jmlsb4001up3m24ams57lp","category_id":"cl4jmlsb60023p3m219lwa81e","_id":"cl4jmlsba002tp3m2b45ba2w7"},{"post_id":"cl4jmlsaw001jp3m2basybd2q","category_id":"cl4jmlsb2001pp3m2e0763hdz","_id":"cl4jmlsba002yp3m23ygq7m55"},{"post_id":"cl4jmlsaw001jp3m2basybd2q","category_id":"cl4jmlsb8002jp3m236853bx0","_id":"cl4jmlsbb0030p3m20bdh8219"},{"post_id":"cl4jmlsb4001wp3m26aaaai9f","category_id":"cl4jmlsb60023p3m219lwa81e","_id":"cl4jmlsbb0033p3m2co0fdz1g"},{"post_id":"cl4jmlsb7002cp3m20yle4b0o","category_id":"cl4jmlsba002xp3m23se00p4t","_id":"cl4jmlsbd003cp3m24536c6as"},{"post_id":"cl4jmlsb8002gp3m24gb8hzd4","category_id":"cl4jmlsba002xp3m23se00p4t","_id":"cl4jmlsbe003ip3m26cze75co"},{"post_id":"cl4jmlsb8002kp3m266czc1nn","category_id":"cl4jmlsbd003bp3m2hzuzf0ox","_id":"cl4jmlsbf003pp3m22i3j76ql"}],"PostTag":[{"post_id":"cl4jmls9t0000p3m29zu12hwq","tag_id":"cl4jmlsa60004p3m21t5a91iz","_id":"cl4jmlsaa000ap3m25fkh6pse"},{"post_id":"cl4jmlsa20002p3m2dd183ajn","tag_id":"cl4jmlsa60004p3m21t5a91iz","_id":"cl4jmlsad000gp3m28fxed27k"},{"post_id":"cl4jmlsa60005p3m2gcd2eidk","tag_id":"cl4jmlsa60004p3m21t5a91iz","_id":"cl4jmlsaf000lp3m26if86cjv"},{"post_id":"cl4jmlsai000rp3m241tx0xdg","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsak000wp3m2ezrhg06h"},{"post_id":"cl4jmlsa70006p3m21i8zbbmd","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsak000yp3m248u69d44"},{"post_id":"cl4jmlsa70006p3m21i8zbbmd","tag_id":"cl4jmlsag000qp3m256er73o8","_id":"cl4jmlsan0013p3m26fpqhe77"},{"post_id":"cl4jmlsa80007p3m2842meocb","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsao0015p3m236vj8ve0"},{"post_id":"cl4jmlsab000bp3m2aucx0i58","tag_id":"cl4jmlsal0012p3m26npx2r6a","_id":"cl4jmlsat001bp3m26woe778l"},{"post_id":"cl4jmlsao0016p3m22urk7b17","tag_id":"cl4jmlsag000qp3m256er73o8","_id":"cl4jmlsat001ep3m29idaebfh"},{"post_id":"cl4jmlsar0019p3m27dy15vq3","tag_id":"cl4jmlsag000qp3m256er73o8","_id":"cl4jmlsav001ip3m2988p25l4"},{"post_id":"cl4jmlsab000cp3m2dks73agw","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsaw001lp3m29vedcx79"},{"post_id":"cl4jmlsad000hp3m20u4h4iwp","tag_id":"cl4jmlsat001fp3m28l82c1qo","_id":"cl4jmlsb3001qp3m2e6a18fmd"},{"post_id":"cl4jmlsax001mp3m2epto803r","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsb4001tp3m2f0wbgti2"},{"post_id":"cl4jmlsae000ip3m25gc82b75","tag_id":"cl4jmlsb0001op3m2frxhaiss","_id":"cl4jmlsb5001yp3m2g5sn3c3s"},{"post_id":"cl4jmlsb4001up3m24ams57lp","tag_id":"cl4jmlsag000qp3m256er73o8","_id":"cl4jmlsb50020p3m29klxdgqk"},{"post_id":"cl4jmlsb4001wp3m26aaaai9f","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsb60024p3m255dw1tlt"},{"post_id":"cl4jmlsb4001wp3m26aaaai9f","tag_id":"cl4jmlsag000qp3m256er73o8","_id":"cl4jmlsb60026p3m2fxagaxid"},{"post_id":"cl4jmlsb5001zp3m2gr1p2vmr","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsb7002ap3m2bn948p9h"},{"post_id":"cl4jmlsaf000mp3m2fmqielb1","tag_id":"cl4jmlsb4001vp3m24931c1un","_id":"cl4jmlsb8002ep3m23pncglw5"},{"post_id":"cl4jmlsaf000mp3m2fmqielb1","tag_id":"cl4jmlsb60021p3m2h35wbfpn","_id":"cl4jmlsb8002ip3m21chf32s8"},{"post_id":"cl4jmlsb70028p3m22412dup0","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsb9002mp3m2h11y6usm"},{"post_id":"cl4jmlsaf000op3m24zkz5xb7","tag_id":"cl4jmlsag000qp3m256er73o8","_id":"cl4jmlsb9002qp3m26342hk67"},{"post_id":"cl4jmlsaj000tp3m24olxbr6z","tag_id":"cl4jmlsb8002fp3m2bpqa1h1v","_id":"cl4jmlsba002up3m25khwdwiz"},{"post_id":"cl4jmlsbb002zp3m2hk1p8ar8","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsbc0034p3m2ezfghwuk"},{"post_id":"cl4jmlsbb0031p3m24p19gzbh","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsbc0037p3m2dn1p0rsx"},{"post_id":"cl4jmlsbc0036p3m243osdgse","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsbd003ap3m211pd4u4i"},{"post_id":"cl4jmlsak000xp3m2egka1dhz","tag_id":"cl4jmlsb9002pp3m264v3h5a3","_id":"cl4jmlsbd003ep3m21ssshbyk"},{"post_id":"cl4jmlsak000xp3m2egka1dhz","tag_id":"cl4jmlsb60021p3m2h35wbfpn","_id":"cl4jmlsbe003hp3m23na6ejsi"},{"post_id":"cl4jmlsak000xp3m2egka1dhz","tag_id":"cl4jmlsb8002fp3m2bpqa1h1v","_id":"cl4jmlsbe003kp3m2gvvj094k"},{"post_id":"cl4jmlsbc0038p3m20kvy4mx1","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsbf003np3m22ksvdx3d"},{"post_id":"cl4jmlsak000zp3m2bsz05h09","tag_id":"cl4jmlsb60021p3m2h35wbfpn","_id":"cl4jmlsbn003wp3m24biybfb5"},{"post_id":"cl4jmlsak000zp3m2bsz05h09","tag_id":"cl4jmlsb9002pp3m264v3h5a3","_id":"cl4jmlsbo003yp3m25zl5h9a5"},{"post_id":"cl4jmlsak000zp3m2bsz05h09","tag_id":"cl4jmlsbe003mp3m2fetx6l08","_id":"cl4jmlsbo0041p3m2hdwncspp"},{"post_id":"cl4jmlsak000zp3m2bsz05h09","tag_id":"cl4jmlsb8002fp3m2bpqa1h1v","_id":"cl4jmlsbp0043p3m23u6ffgmt"},{"post_id":"cl4jmlsan0014p3m2afkldx31","tag_id":"cl4jmlsbm003up3m2g4uj7mfp","_id":"cl4jmlsbp0046p3m26ibz7ugr"},{"post_id":"cl4jmlsan0014p3m2afkldx31","tag_id":"cl4jmlsb4001vp3m24931c1un","_id":"cl4jmlsbq0048p3m22sfy59ze"},{"post_id":"cl4jmlsbp0042p3m25b2n4old","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsbq004bp3m21wsh0buf"},{"post_id":"cl4jmlsat001cp3m25opih4xm","tag_id":"cl4jmlsb0001op3m2frxhaiss","_id":"cl4jmlsbr004dp3m2f8zgdnsx"},{"post_id":"cl4jmlsau001gp3m20s2u9j6i","tag_id":"cl4jmlsb60021p3m2h35wbfpn","_id":"cl4jmlsbr004gp3m2ekz829z1"},{"post_id":"cl4jmlsaw001jp3m2basybd2q","tag_id":"cl4jmlsbr004ep3m2gy5j98ol","_id":"cl4jmlsbs004kp3m24oz09nyg"},{"post_id":"cl4jmlsaw001jp3m2basybd2q","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsbt004mp3m2aiod5147"},{"post_id":"cl4jmlsb3001rp3m24xpf63g1","tag_id":"cl4jmlsbs004jp3m2aoz64d8t","_id":"cl4jmlsbt004pp3m2733f4g73"},{"post_id":"cl4jmlsb3001rp3m24xpf63g1","tag_id":"cl4jmlsag000qp3m256er73o8","_id":"cl4jmlsbt004qp3m29cih0br3"},{"post_id":"cl4jmlsb60022p3m242jha7ss","tag_id":"cl4jmlsbt004op3m2hzn460tc","_id":"cl4jmlsbt004sp3m2bg4khhzw"},{"post_id":"cl4jmlsb60022p3m242jha7ss","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsbt004tp3m223pt9sj8"},{"post_id":"cl4jmlsb60025p3m2cm933tm0","tag_id":"cl4jmlsbt004rp3m2dxelcyte","_id":"cl4jmlsbu004vp3m2ayq9f1ei"},{"post_id":"cl4jmlsb60025p3m2cm933tm0","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsbu004wp3m2btdhhlyn"},{"post_id":"cl4jmlsb7002cp3m20yle4b0o","tag_id":"cl4jmlsbt004up3m2afin71l4","_id":"cl4jmlsbu004yp3m2akgl93ty"},{"post_id":"cl4jmlsb8002gp3m24gb8hzd4","tag_id":"cl4jmlsbt004up3m2afin71l4","_id":"cl4jmlsbv0050p3m2di54aey2"},{"post_id":"cl4jmlsb8002kp3m266czc1nn","tag_id":"cl4jmlsbt004up3m2afin71l4","_id":"cl4jmlsbv0052p3m25kj442rp"},{"post_id":"cl4jmlsb9002np3m22gwieq4f","tag_id":"cl4jmlsbv0051p3m22w57d979","_id":"cl4jmlsbv0054p3m2gtlfbq5h"},{"post_id":"cl4jmlsba002sp3m26niucg7s","tag_id":"cl4jmlsbv0051p3m22w57d979","_id":"cl4jmlsbx0056p3m2as9c4q0c"},{"post_id":"cl4jmlsba002vp3m2f8iogfvu","tag_id":"cl4jmlsae000kp3m21n1dfr6h","_id":"cl4jmlsby0058p3m2epn3es6r"},{"post_id":"cl4jmlsba002vp3m2f8iogfvu","tag_id":"cl4jmlsbv0051p3m22w57d979","_id":"cl4jmlsby0059p3m22brxhi6g"},{"post_id":"cl4jmlsbd003dp3m27o2udrvk","tag_id":"cl4jmlsbx0057p3m2h57i0tco","_id":"cl4jmlsc1005bp3m2h0tqe35c"},{"post_id":"cl4jmlsbd003fp3m2bjflbkyu","tag_id":"cl4jmlsby005ap3m2co51e0rb","_id":"cl4jmlsc2005dp3m2bl089rz6"},{"post_id":"cl4jmlsbe003lp3m2fx8adqn7","tag_id":"cl4jmlsby005ap3m2co51e0rb","_id":"cl4jmlsc3005fp3m26wje39vs"},{"post_id":"cl4jmlsbf003op3m2hhn13yvc","tag_id":"cl4jmlsby005ap3m2co51e0rb","_id":"cl4jmlsc3005hp3m2gkwy1bai"},{"post_id":"cl4jmlsbf003qp3m2am7a5b9f","tag_id":"cl4jmlsby005ap3m2co51e0rb","_id":"cl4jmlsc4005jp3m2bs0n3e5z"},{"post_id":"cl4jmlsbg003sp3m2fihu5ff6","tag_id":"cl4jmlsby005ap3m2co51e0rb","_id":"cl4jmlsc4005lp3m2czf44uud"},{"post_id":"cl4jmlsbi003tp3m2cmpa00ey","tag_id":"cl4jmlsbx0057p3m2h57i0tco","_id":"cl4jmlsc4005np3m28zok8qsw"},{"post_id":"cl4jmlsbn003vp3m2dc3g8eeg","tag_id":"cl4jmlsby005ap3m2co51e0rb","_id":"cl4jmlsc5005pp3m2fovnbqaz"},{"post_id":"cl4jmlsbn003xp3m2c9i3ebk3","tag_id":"cl4jmlsby005ap3m2co51e0rb","_id":"cl4jmlsc5005rp3m23h1t5q7h"},{"post_id":"cl4jmlsbo0040p3m2dz43gip5","tag_id":"cl4jmlsby005ap3m2co51e0rb","_id":"cl4jmlsc5005tp3m2bw9x2new"},{"post_id":"cl4jmlsbp0045p3m2gtwubt2w","tag_id":"cl4jmlsby005ap3m2co51e0rb","_id":"cl4jmlsc5005vp3m2bmfr7cgs"},{"post_id":"cl4jmlsbq0047p3m2cahtc3ny","tag_id":"cl4jmlsby005ap3m2co51e0rb","_id":"cl4jmlsc6005xp3m2bo4jbeir"},{"post_id":"cl4jmlsbr004cp3m22kfphlqw","tag_id":"cl4jmlsby005ap3m2co51e0rb","_id":"cl4jmlsc6005yp3m233in2x14"}],"Tag":[{"name":"UNIX","_id":"cl4jmlsa60004p3m21t5a91iz"},{"name":"RUBY","_id":"cl4jmlsae000kp3m21n1dfr6h"},{"name":"RAILS","_id":"cl4jmlsag000qp3m256er73o8"},{"name":"random","_id":"cl4jmlsal0012p3m26npx2r6a"},{"name":"unix","_id":"cl4jmlsat001fp3m28l82c1qo"},{"name":"ruby","_id":"cl4jmlsb0001op3m2frxhaiss"},{"name":"secure","_id":"cl4jmlsb4001vp3m24931c1un"},{"name":"rails","_id":"cl4jmlsb60021p3m2h35wbfpn"},{"name":"til","_id":"cl4jmlsb8002fp3m2bpqa1h1v"},{"name":"aws","_id":"cl4jmlsb9002pp3m264v3h5a3"},{"name":"carrierwave","_id":"cl4jmlsbe003mp3m2fetx6l08"},{"name":"https","_id":"cl4jmlsbm003up3m2g4uj7mfp"},{"name":"SOLID","_id":"cl4jmlsbr004ep3m2gy5j98ol"},{"name":"SECURE","_id":"cl4jmlsbs004jp3m2aoz64d8t"},{"name":"ORM","_id":"cl4jmlsbt004op3m2hzn460tc"},{"name":"RACK","_id":"cl4jmlsbt004rp3m2dxelcyte"},{"name":"TIl","_id":"cl4jmlsbt004up3m2afin71l4"},{"name":"TIL","_id":"cl4jmlsbv0051p3m22w57d979"},{"name":"JS","_id":"cl4jmlsbx0057p3m2h57i0tco"},{"name":"NOTES","_id":"cl4jmlsby005ap3m2co51e0rb"}]}}